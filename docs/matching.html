<!DOCTYPE html>
<html xmlns="http://www.w3.org/1999/xhtml" lang="es" xml:lang="es"><head>

<meta charset="utf-8">
<meta name="generator" content="quarto-1.1.251">

<meta name="viewport" content="width=device-width, initial-scale=1.0, user-scalable=yes">


<title>Dise√±os experimentales y cuasiexperimentales - 6&nbsp; Subclasificaci√≥n y matching</title>
<style>
code{white-space: pre-wrap;}
span.smallcaps{font-variant: small-caps;}
div.columns{display: flex; gap: min(4vw, 1.5em);}
div.column{flex: auto; overflow-x: auto;}
div.hanging-indent{margin-left: 1.5em; text-indent: -1.5em;}
ul.task-list{list-style: none;}
ul.task-list li input[type="checkbox"] {
  width: 0.8em;
  margin: 0 0.8em 0.2em -1.6em;
  vertical-align: middle;
}
pre > code.sourceCode { white-space: pre; position: relative; }
pre > code.sourceCode > span { display: inline-block; line-height: 1.25; }
pre > code.sourceCode > span:empty { height: 1.2em; }
.sourceCode { overflow: visible; }
code.sourceCode > span { color: inherit; text-decoration: inherit; }
div.sourceCode { margin: 1em 0; }
pre.sourceCode { margin: 0; }
@media screen {
div.sourceCode { overflow: auto; }
}
@media print {
pre > code.sourceCode { white-space: pre-wrap; }
pre > code.sourceCode > span { text-indent: -5em; padding-left: 5em; }
}
pre.numberSource code
  { counter-reset: source-line 0; }
pre.numberSource code > span
  { position: relative; left: -4em; counter-increment: source-line; }
pre.numberSource code > span > a:first-child::before
  { content: counter(source-line);
    position: relative; left: -1em; text-align: right; vertical-align: baseline;
    border: none; display: inline-block;
    -webkit-touch-callout: none; -webkit-user-select: none;
    -khtml-user-select: none; -moz-user-select: none;
    -ms-user-select: none; user-select: none;
    padding: 0 4px; width: 4em;
    color: #aaaaaa;
  }
pre.numberSource { margin-left: 3em; border-left: 1px solid #aaaaaa;  padding-left: 4px; }
div.sourceCode
  {   }
@media screen {
pre > code.sourceCode > span > a:first-child::before { text-decoration: underline; }
}
code span.al { color: #ff0000; font-weight: bold; } /* Alert */
code span.an { color: #60a0b0; font-weight: bold; font-style: italic; } /* Annotation */
code span.at { color: #7d9029; } /* Attribute */
code span.bn { color: #40a070; } /* BaseN */
code span.bu { color: #008000; } /* BuiltIn */
code span.cf { color: #007020; font-weight: bold; } /* ControlFlow */
code span.ch { color: #4070a0; } /* Char */
code span.cn { color: #880000; } /* Constant */
code span.co { color: #60a0b0; font-style: italic; } /* Comment */
code span.cv { color: #60a0b0; font-weight: bold; font-style: italic; } /* CommentVar */
code span.do { color: #ba2121; font-style: italic; } /* Documentation */
code span.dt { color: #902000; } /* DataType */
code span.dv { color: #40a070; } /* DecVal */
code span.er { color: #ff0000; font-weight: bold; } /* Error */
code span.ex { } /* Extension */
code span.fl { color: #40a070; } /* Float */
code span.fu { color: #06287e; } /* Function */
code span.im { color: #008000; font-weight: bold; } /* Import */
code span.in { color: #60a0b0; font-weight: bold; font-style: italic; } /* Information */
code span.kw { color: #007020; font-weight: bold; } /* Keyword */
code span.op { color: #666666; } /* Operator */
code span.ot { color: #007020; } /* Other */
code span.pp { color: #bc7a00; } /* Preprocessor */
code span.sc { color: #4070a0; } /* SpecialChar */
code span.ss { color: #bb6688; } /* SpecialString */
code span.st { color: #4070a0; } /* String */
code span.va { color: #19177c; } /* Variable */
code span.vs { color: #4070a0; } /* VerbatimString */
code span.wa { color: #60a0b0; font-weight: bold; font-style: italic; } /* Warning */
</style>


<script src="site_libs/quarto-nav/quarto-nav.js"></script>
<script src="site_libs/quarto-nav/headroom.min.js"></script>
<script src="site_libs/clipboard/clipboard.min.js"></script>
<script src="site_libs/quarto-search/autocomplete.umd.js"></script>
<script src="site_libs/quarto-search/fuse.min.js"></script>
<script src="site_libs/quarto-search/quarto-search.js"></script>
<meta name="quarto:offset" content="./">
<link href="./diff_in_diff.html" rel="next">
<link href="./exp_aleatorios.html" rel="prev">
<script src="site_libs/quarto-html/quarto.js"></script>
<script src="site_libs/quarto-html/popper.min.js"></script>
<script src="site_libs/quarto-html/tippy.umd.min.js"></script>
<script src="site_libs/quarto-html/anchor.min.js"></script>
<link href="site_libs/quarto-html/tippy.css" rel="stylesheet">
<link href="site_libs/quarto-html/quarto-syntax-highlighting.css" rel="stylesheet" class="quarto-color-scheme" id="quarto-text-highlighting-styles">
<link href="site_libs/quarto-html/quarto-syntax-highlighting-dark.css" rel="prefetch" class="quarto-color-scheme quarto-color-alternate" id="quarto-text-highlighting-styles">
<script src="site_libs/bootstrap/bootstrap.min.js"></script>
<link href="site_libs/bootstrap/bootstrap-icons.css" rel="stylesheet">
<link href="site_libs/bootstrap/bootstrap.min.css" rel="stylesheet" class="quarto-color-scheme" id="quarto-bootstrap" data-mode="light">
<link href="site_libs/bootstrap/bootstrap-dark.min.css" rel="prefetch" class="quarto-color-scheme quarto-color-alternate" id="quarto-bootstrap" data-mode="dark">
<script id="quarto-search-options" type="application/json">{
  "location": "sidebar",
  "copy-button": false,
  "collapse-after": 3,
  "panel-placement": "start",
  "type": "textbox",
  "limit": 20,
  "language": {
    "search-no-results-text": "S√≠n resultados",
    "search-matching-documents-text": "documentos encontrados",
    "search-copy-link-title": "Copiar el enlace en la busqueda",
    "search-hide-matches-text": "Esconder resultados adicionales",
    "search-more-match-text": "hay m√°s resultados en este documento",
    "search-more-matches-text": "m√°s resultados en este documento",
    "search-clear-button-title": "Borrar",
    "search-detached-cancel-button-title": "Cancelar",
    "search-submit-button-title": "Eviar"
  }
}</script>

  <script src="https://cdn.jsdelivr.net/npm/mathjax@3/es5/tex-chtml-full.js" type="text/javascript"></script>

</head>

<body class="nav-sidebar floating slimcontent">

<div id="quarto-search-results"></div>
  <header id="quarto-header" class="headroom fixed-top">
  <nav class="quarto-secondary-nav" data-bs-toggle="collapse" data-bs-target="#quarto-sidebar" aria-controls="quarto-sidebar" aria-expanded="false" aria-label="Toggle sidebar navigation" onclick="if (window.quartoToggleHeadroom) { window.quartoToggleHeadroom(); }">
    <div class="container-fluid d-flex justify-content-between">
      <h1 class="quarto-secondary-nav-title"><span class="chapter-number">6</span>&nbsp; <span class="chapter-title">Subclasificaci√≥n y <em>matching</em></span></h1>
      <button type="button" class="quarto-btn-toggle btn" aria-label="Show secondary navigation">
        <i class="bi bi-chevron-right"></i>
      </button>
    </div>
  </nav>
</header>
<!-- content -->
<div id="quarto-content" class="quarto-container page-columns page-rows-contents page-layout-article">
<!-- sidebar -->
  <nav id="quarto-sidebar" class="sidebar collapse sidebar-navigation floating overflow-auto">
    <div class="pt-lg-2 mt-2 text-left sidebar-header">
    <div class="sidebar-title mb-0 py-0">
      <a href="./">Dise√±os experimentales y cuasiexperimentales</a> 
        <div class="sidebar-tools-main">
  <a href="" class="quarto-color-scheme-toggle sidebar-tool" onclick="window.quartoToggleColorScheme(); return false;" title="Toggle dark mode"><i class="bi"></i></a>
  <a href="" class="quarto-reader-toggle sidebar-tool" onclick="window.quartoToggleReader(); return false;" title="Toggle reader mode">
  <div class="quarto-reader-toggle-btn">
  <i class="bi"></i>
  </div>
</a>
</div>
    </div>
      </div>
      <div class="mt-2 flex-shrink-0 align-items-center">
        <div class="sidebar-search">
        <div id="quarto-search" class="" title="Search"></div>
        </div>
      </div>
    <div class="sidebar-menu-container"> 
    <ul class="list-unstyled mt-1">
        <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./index.html" class="sidebar-item-text sidebar-link">Prefacio</a>
  </div>
</li>
        <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./intro_R.html" class="sidebar-item-text sidebar-link"><span class="chapter-number">1</span>&nbsp; <span class="chapter-title">R y el tidyverse</span></a>
  </div>
</li>
        <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./intro_stat.html" class="sidebar-item-text sidebar-link"><span class="chapter-number">2</span>&nbsp; <span class="chapter-title">Repaso de probabilidad y estad√≠stica</span></a>
  </div>
</li>
        <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./potential_outcomes.html" class="sidebar-item-text sidebar-link"><span class="chapter-number">3</span>&nbsp; <span class="chapter-title"><em>Potential outcomes</em></span></a>
  </div>
</li>
        <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./dags.html" class="sidebar-item-text sidebar-link"><span class="chapter-number">4</span>&nbsp; <span class="chapter-title">Grafos ac√≠clicos dirigidos (DAGS)</span></a>
  </div>
</li>
        <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./exp_aleatorios.html" class="sidebar-item-text sidebar-link"><span class="chapter-number">5</span>&nbsp; <span class="chapter-title">Experimentos aleatorios</span></a>
  </div>
</li>
        <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./matching.html" class="sidebar-item-text sidebar-link active"><span class="chapter-number">6</span>&nbsp; <span class="chapter-title">Subclasificaci√≥n y <em>matching</em></span></a>
  </div>
</li>
        <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./diff_in_diff.html" class="sidebar-item-text sidebar-link"><span class="chapter-number">7</span>&nbsp; <span class="chapter-title">Diferencias en diferencias</span></a>
  </div>
</li>
        <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./reg_discontinua.html" class="sidebar-item-text sidebar-link"><span class="chapter-number">8</span>&nbsp; <span class="chapter-title">Regresi√≥n discontinua</span></a>
  </div>
</li>
        <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./var_instrumentales.html" class="sidebar-item-text sidebar-link"><span class="chapter-number">9</span>&nbsp; <span class="chapter-title">Variables instrumentales</span></a>
  </div>
</li>
        <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./references.html" class="sidebar-item-text sidebar-link">Referencias</a>
  </div>
</li>
    </ul>
    </div>
    <nav id="TOC" role="doc-toc" class="toc-active">
    <h2 id="toc-title">√çndice</h2>
   
  <ul>
  <li><a href="#subclasificaci√≥n" id="toc-subclasificaci√≥n" class="nav-link active" data-scroll-target="#subclasificaci√≥n"><span class="toc-section-number">6.1</span>  Subclasificaci√≥n</a>
  <ul class="collapse">
  <li><a href="#por-qu√©-subclasificar-motivaci√≥n-y-objetivo" id="toc-por-qu√©-subclasificar-motivaci√≥n-y-objetivo" class="nav-link" data-scroll-target="#por-qu√©-subclasificar-motivaci√≥n-y-objetivo"><span class="toc-section-number">6.1.1</span>  ¬øPor qu√© subclasificar? Motivaci√≥n y objetivo</a></li>
  <li><a href="#independencia-vs.-independencia-condicional" id="toc-independencia-vs.-independencia-condicional" class="nav-link" data-scroll-target="#independencia-vs.-independencia-condicional"><span class="toc-section-number">6.1.2</span>  Independencia vs.&nbsp;independencia condicional</a></li>
  <li><a href="#el-estimador-de-subclasificaci√≥n-un-ejemplo-con-descuento" id="toc-el-estimador-de-subclasificaci√≥n-un-ejemplo-con-descuento" class="nav-link" data-scroll-target="#el-estimador-de-subclasificaci√≥n-un-ejemplo-con-descuento"><span class="toc-section-number">6.1.3</span>  El estimador de subclasificaci√≥n: Un ejemplo con descuento</a></li>
  </ul></li>
  <li><a href="#matching" id="toc-matching" class="nav-link" data-scroll-target="#matching"><span class="toc-section-number">6.2</span>  <em>Matching</em></a>
  <ul class="collapse">
  <li><a href="#exact-matching" id="toc-exact-matching" class="nav-link" data-scroll-target="#exact-matching"><span class="toc-section-number">6.2.1</span>  <em>Exact Matching</em></a></li>
  <li><a href="#approximate-matching" id="toc-approximate-matching" class="nav-link" data-scroll-target="#approximate-matching"><span class="toc-section-number">6.2.2</span>  <em>Approximate Matching</em></a></li>
  <li><a href="#la-quesoporte-com√∫n" id="toc-la-quesoporte-com√∫n" class="nav-link" data-scroll-target="#la-quesoporte-com√∫n"><span class="toc-section-number">6.2.3</span>  La queso(porte com√∫n)</a></li>
  <li><a href="#euclideana-vs.-mahalanobis-la-batalla-final" id="toc-euclideana-vs.-mahalanobis-la-batalla-final" class="nav-link" data-scroll-target="#euclideana-vs.-mahalanobis-la-batalla-final"><span class="toc-section-number">6.2.4</span>  Euclideana vs.&nbsp;Mahalanobis, la batalla final</a></li>
  </ul></li>
  <li><a href="#sec-matching_vs_reg" id="toc-sec-matching_vs_reg" class="nav-link" data-scroll-target="#sec-matching_vs_reg"><span class="toc-section-number">6.3</span>  <em>Matching</em> vs.&nbsp;regresi√≥n</a></li>
  </ul>
</nav>
</nav>
<!-- margin-sidebar -->
    <div id="quarto-margin-sidebar" class="sidebar margin-sidebar">
    </div>
<!-- main -->
<main class="content page-columns page-full" id="quarto-document-content">

<header id="title-block-header" class="quarto-title-block default">
<div class="quarto-title">
<h1 class="title"><span id="sec-matching" class="quarto-section-identifier d-none d-lg-block"><span class="chapter-number">6</span>&nbsp; <span class="chapter-title">Subclasificaci√≥n y <em>matching</em></span></span></h1>
</div>



<div class="quarto-title-meta">

    
    
  </div>
  

</header>

<div class="cell">

</div>
<section id="subclasificaci√≥n" class="level2 page-columns page-full" data-number="6.1">
<h2 data-number="6.1" class="anchored" data-anchor-id="subclasificaci√≥n"><span class="header-section-number">6.1</span> Subclasificaci√≥n</h2>
<section id="por-qu√©-subclasificar-motivaci√≥n-y-objetivo" class="level3" data-number="6.1.1">
<h3 data-number="6.1.1" class="anchored" data-anchor-id="por-qu√©-subclasificar-motivaci√≥n-y-objetivo"><span class="header-section-number">6.1.1</span> ¬øPor qu√© subclasificar? Motivaci√≥n y objetivo</h3>
<p>En estudios observacionales la asignaci√≥n al ‚Äútratamiento‚Äù muchas veces ocurre de forma completamente no aleatoria. Por ejemplo, supongamos que queremos medir el efecto de ofrecer un descuento en la cantidad de ventas de tiendas, pero el descuento se aplic√≥ principalmente en aquellas regiones donde las ventas siempre fueron m√°s bajas.</p>
<p>Si s√≥lo comparamos el promedio de ventas de tiendas con descuento frente a las que no lo recibieron, el resultado estar√° sesgado, porque la asignaci√≥n del ‚Äútratamiento‚Äù (el descuento) no fue aleatoria. Es decir, el efecto reflejar√° tanto el descuento como las caracter√≠sticas de la regi√≥n.</p>
<p>El objetivo de la subclasificaci√≥n es, entonces, estimar el efecto causal del descuento como si la asignaci√≥n hubiera sido aleatoria dentro de cada regi√≥n. Para ello, se divide el conjunto de tiendas en estratos seg√∫n la regi√≥n, se calcula la diferencia de ventas entre tiendas con y sin descuento en cada estrato, y luego se combinan esos efectos de forma ponderada. De este modo, se logra balancear la comparaci√≥n y acercarse a un estimador no sesgado del efecto promedio del descuento.</p>
</section>
<section id="independencia-vs.-independencia-condicional" class="level3 page-columns page-full" data-number="6.1.2">
<h3 data-number="6.1.2" class="anchored" data-anchor-id="independencia-vs.-independencia-condicional"><span class="header-section-number">6.1.2</span> Independencia vs.&nbsp;independencia condicional</h3>
<p>Hablamos de <strong>independencia</strong>, cuando tenemos un experimento con asignaci√≥n completamente aleatoria:</p>
<p><span class="math display">\[
D \perp (Y_0,Y_1)
\]</span></p>
<p>Es decir, la decisi√≥n de asignar a tratamiento o no (D) es independiente de los potential outcomes, y por lo tanto la diferencia de medias entre tratados y controles ofrece una estimaci√≥n v√°lida del ATE.</p>
<div class="page-columns page-full"><p>Sin embargo, en muchos cuasiexperimentos la ‚Äúaleatorizaci√≥n‚Äù s√≥lo ocurre <strong>condicional</strong> a alguna caracter√≠stica observable X. Esto nos lleva a la <strong>asunci√≥n de independencia condicional</strong> (CIA<a href="#fn1" class="footnote-ref" id="fnref1" role="doc-noteref"><sup>1</sup></a>), que podemos escribir como:</p><div class="no-row-height column-margin column-container"><li id="fn1"><p><sup>1</sup>&nbsp;Del ingl√©s <em>Conditional Independence Assumption</em>.</p></li></div></div>
<p><span class="math display">\[
D \perp (Y_0,Y_1) | X
\]</span></p>
<p>O sea, <strong>una vez que fijamos X</strong>, la asignaci√≥n al tratamiento se comporta como si fuera aleatoria.</p>
<p>En estudios observacionales como el de las tiendas y descuentos, la <strong>regi√≥n</strong> (X) influye tanto en la probabilidad de recibir descuento (<span class="math inline">\(D\)</span>) como en las ventas (<span class="math inline">\(Y\)</span>), lo que genera un camino en el que <span class="math inline">\(X\)</span> es confusor (<span class="math inline">\(D \leftarrow X \rightarrow Y\)</span>). Si ignoramos esa ruta, la comparaci√≥n global de medias mezclar√° el efecto real del descuento con las diferencias regionales, produciendo un sesgo.</p>
<p>Para entender por qu√© la subclasificaci√≥n corrige esto, podemos representar el problema en un DAG:</p>
<div class="cell" data-layout-align="center">
<div class="cell-output-display">
<div class="quarto-figure quarto-figure-center">
<figure class="figure">
<p><img src="matching_files/figure-html/unnamed-chunk-2-1.png" class="img-fluid figure-img" width="384"></p>
<p></p><figcaption class="figure-caption">DAG que representa la relaci√≥n entre D e Y teniendo a A como confusor.</figcaption><p></p>
</figure>
</div>
</div>
</div>
<p>Al condicionar en <span class="math inline">\(X\)</span> (es decir, subclasificar o estratificar por regi√≥n), cerramos el backdoor <span class="math inline">\(D \leftarrow X \rightarrow Y\)</span>. Dentro de cada regi√≥n, la asignaci√≥n del descuento ya no est√° correlacionada con las ventas antes del tratamiento.</p>
</section>
<section id="el-estimador-de-subclasificaci√≥n-un-ejemplo-con-descuento" class="level3" data-number="6.1.3">
<h3 data-number="6.1.3" class="anchored" data-anchor-id="el-estimador-de-subclasificaci√≥n-un-ejemplo-con-descuento"><span class="header-section-number">6.1.3</span> El estimador de subclasificaci√≥n: Un ejemplo con descuento</h3>
<p>¬øC√≥mo aplicamos esta idea de la subclasificaci√≥n a un ejemplo real? Bueno, empecemos con un ejemplo ‚Äúreal‚Äù.</p>
<p>Supongamos que tenemos una distribuidora de gaseosas en el Gran Buenos Aires. Queremos medir el efecto de ofrecer un descuento a los clientes en las ventas. Este es un descuento que se le da s√≥lo a algunos clientes, pero sabemos que la asignaci√≥n del descuento es aleatoria, pero s√≥lo dentro de cada regi√≥n. Esto pas√≥ porque el jefe, muy astutamente dijo ‚Äú¬øY si les ofrecemos m√°s descuentos a la regi√≥n que menos compra?‚Äù. Los clientes que menos compran son los del oeste(compra promedio $<span class="math inline">\(2000\)</span>), y por eso tienen una <span class="math inline">\(p=0.8\)</span> de recibir el descuento. Los del norte (compra promedio $<span class="math inline">\(3500\)</span>) tienen una <span class="math inline">\(p=0.2\)</span> y los del este (compra promedio $<span class="math inline">\(3000\)</span>) una <span class="math inline">\(p=0.5\)</span>. Tambi√©n es relevante para el problema que algunas zonas tienen m√°s clientes que otras, por ejemplo, el oeste tiene <span class="math inline">\(220\)</span> clientes, el norte <span class="math inline">\(500\)</span> y el este s√≥lo <span class="math inline">\(130\)</span>.</p>
<p>Como todas las simulaciones que hicimos a lo largo del libro (si es que a esto se le puede llamar libro) conocemos el tama√±o del efecto que queremos estimar y tiene como valor medio $<span class="math inline">\(300\)</span>. Otra cosa a la que vamos a poder ecceder es a ambos <em>potential outcomes</em>, es decir, tanto al observado como al contraf√°ctico (si es que a esto se le puede llamar contraf√°ctico). Estos son lujos que nos podemos dar (si es que a esto se le puede llamar un lujo). Veamos <span class="math inline">\(5\)</span> filas al azar de los datos simulados.</p>
<div class="cell">
<details>
<summary>Ver el c√≥digo</summary>
<div class="sourceCode cell-code" id="cb1"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb1-1"><a href="#cb1-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Simulaci√≥n de los datos ####</span></span>
<span id="cb1-2"><a href="#cb1-2" aria-hidden="true" tabindex="-1"></a><span class="fu">set.seed</span>(<span class="dv">1989</span>)</span>
<span id="cb1-3"><a href="#cb1-3" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb1-4"><a href="#cb1-4" aria-hidden="true" tabindex="-1"></a>n_este <span class="ot">&lt;-</span> <span class="dv">130</span></span>
<span id="cb1-5"><a href="#cb1-5" aria-hidden="true" tabindex="-1"></a>n_oeste <span class="ot">&lt;-</span> <span class="dv">220</span></span>
<span id="cb1-6"><a href="#cb1-6" aria-hidden="true" tabindex="-1"></a>n_norte <span class="ot">&lt;-</span> <span class="dv">500</span></span>
<span id="cb1-7"><a href="#cb1-7" aria-hidden="true" tabindex="-1"></a>n_total <span class="ot">&lt;-</span> n_este <span class="sc">+</span> n_oeste <span class="sc">+</span> n_norte</span>
<span id="cb1-8"><a href="#cb1-8" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb1-9"><a href="#cb1-9" aria-hidden="true" tabindex="-1"></a>customers <span class="ot">&lt;-</span></span>
<span id="cb1-10"><a href="#cb1-10" aria-hidden="true" tabindex="-1"></a>  <span class="fu">tibble</span>(</span>
<span id="cb1-11"><a href="#cb1-11" aria-hidden="true" tabindex="-1"></a>    <span class="at">customer_id =</span> <span class="fu">seq</span>(n_total),</span>
<span id="cb1-12"><a href="#cb1-12" aria-hidden="true" tabindex="-1"></a>    <span class="at">region =</span> <span class="fu">c</span>(<span class="fu">rep</span>(<span class="st">"Este"</span>, n_este),</span>
<span id="cb1-13"><a href="#cb1-13" aria-hidden="true" tabindex="-1"></a>               <span class="fu">rep</span>(<span class="st">"Oeste"</span>, n_oeste),</span>
<span id="cb1-14"><a href="#cb1-14" aria-hidden="true" tabindex="-1"></a>               <span class="fu">rep</span>(<span class="st">"Norte"</span>, n_norte)),</span>
<span id="cb1-15"><a href="#cb1-15" aria-hidden="true" tabindex="-1"></a>    <span class="co"># El efecto del tratamiento es 300USD + ruido [N(300,200)]</span></span>
<span id="cb1-16"><a href="#cb1-16" aria-hidden="true" tabindex="-1"></a>    <span class="at">treatment_effect =</span> <span class="fu">rnorm</span>(n_total, <span class="at">mean =</span> <span class="dv">300</span>, <span class="at">sd =</span> <span class="dv">200</span>),</span>
<span id="cb1-17"><a href="#cb1-17" aria-hidden="true" tabindex="-1"></a>    <span class="co"># Ventas por cliente cuando no se ofrece ning'un descuento (no tratado)</span></span>
<span id="cb1-18"><a href="#cb1-18" aria-hidden="true" tabindex="-1"></a>    <span class="at">y0 =</span> <span class="fu">c</span>(</span>
<span id="cb1-19"><a href="#cb1-19" aria-hidden="true" tabindex="-1"></a>      <span class="fu">rnorm</span>(n_este, <span class="at">mean =</span> <span class="dv">3000</span>, <span class="at">sd =</span> <span class="dv">200</span>),</span>
<span id="cb1-20"><a href="#cb1-20" aria-hidden="true" tabindex="-1"></a>      <span class="fu">rnorm</span>(n_oeste, <span class="at">mean =</span> <span class="dv">2000</span>, <span class="at">sd =</span> <span class="dv">200</span>),</span>
<span id="cb1-21"><a href="#cb1-21" aria-hidden="true" tabindex="-1"></a>      <span class="fu">rnorm</span>(n_norte, <span class="at">mean =</span> <span class="dv">3500</span>, <span class="at">sd =</span> <span class="dv">200</span>)</span>
<span id="cb1-22"><a href="#cb1-22" aria-hidden="true" tabindex="-1"></a>    ),</span>
<span id="cb1-23"><a href="#cb1-23" aria-hidden="true" tabindex="-1"></a>    <span class="co"># Ventas cuando se ofrece un descuento</span></span>
<span id="cb1-24"><a href="#cb1-24" aria-hidden="true" tabindex="-1"></a>    <span class="at">y1 =</span> y0 <span class="sc">+</span> treatment_effect,</span>
<span id="cb1-25"><a href="#cb1-25" aria-hidden="true" tabindex="-1"></a>    <span class="co"># El vector de asignaci√≥n de tratamiento D</span></span>
<span id="cb1-26"><a href="#cb1-26" aria-hidden="true" tabindex="-1"></a>    <span class="at">d =</span> <span class="fu">c</span>(</span>
<span id="cb1-27"><a href="#cb1-27" aria-hidden="true" tabindex="-1"></a>      <span class="fu">rbinom</span>(n_este, <span class="dv">1</span>, <span class="fl">0.5</span>),</span>
<span id="cb1-28"><a href="#cb1-28" aria-hidden="true" tabindex="-1"></a>      <span class="fu">rbinom</span>(n_oeste, <span class="dv">1</span>, <span class="fl">0.8</span>),</span>
<span id="cb1-29"><a href="#cb1-29" aria-hidden="true" tabindex="-1"></a>      <span class="fu">rbinom</span>(n_norte, <span class="dv">1</span>, <span class="fl">0.2</span>)</span>
<span id="cb1-30"><a href="#cb1-30" aria-hidden="true" tabindex="-1"></a>    ),</span>
<span id="cb1-31"><a href="#cb1-31" aria-hidden="true" tabindex="-1"></a>    <span class="co"># Switching equation</span></span>
<span id="cb1-32"><a href="#cb1-32" aria-hidden="true" tabindex="-1"></a>    <span class="at">y =</span> y0 <span class="sc">+</span> treatment_effect<span class="sc">*</span>d</span>
<span id="cb1-33"><a href="#cb1-33" aria-hidden="true" tabindex="-1"></a>  ) <span class="sc">%&gt;%</span></span>
<span id="cb1-34"><a href="#cb1-34" aria-hidden="true" tabindex="-1"></a>  <span class="fu">mutate</span>(<span class="at">tratamiento =</span> <span class="fu">if_else</span>(d <span class="sc">==</span> <span class="dv">0</span>, <span class="st">"Control"</span>, <span class="st">"Tratamiento"</span>))</span>
<span id="cb1-35"><a href="#cb1-35" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb1-36"><a href="#cb1-36" aria-hidden="true" tabindex="-1"></a><span class="fu">sample_n</span>(customers, <span class="dv">5</span>) <span class="sc">%&gt;%</span></span>
<span id="cb1-37"><a href="#cb1-37" aria-hidden="true" tabindex="-1"></a>  gt<span class="sc">::</span><span class="fu">gt</span>() <span class="sc">%&gt;%</span></span>
<span id="cb1-38"><a href="#cb1-38" aria-hidden="true" tabindex="-1"></a>  gt<span class="sc">::</span><span class="fu">tab_header</span>(</span>
<span id="cb1-39"><a href="#cb1-39" aria-hidden="true" tabindex="-1"></a>    <span class="at">title =</span> <span class="st">"Datos de clientes con descuento (5 filas al azar)"</span></span>
<span id="cb1-40"><a href="#cb1-40" aria-hidden="true" tabindex="-1"></a>  )</span></code><button title="Copiar al portapapeles" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
<div class="cell-output-display">

<div id="lvvgstlgyk" style="padding-left:0px;padding-right:0px;padding-top:10px;padding-bottom:10px;overflow-x:auto;overflow-y:auto;width:auto;height:auto;">
<style>#lvvgstlgyk table {
  font-family: system-ui, 'Segoe UI', Roboto, Helvetica, Arial, sans-serif, 'Apple Color Emoji', 'Segoe UI Emoji', 'Segoe UI Symbol', 'Noto Color Emoji';
  -webkit-font-smoothing: antialiased;
  -moz-osx-font-smoothing: grayscale;
}

#lvvgstlgyk thead, #lvvgstlgyk tbody, #lvvgstlgyk tfoot, #lvvgstlgyk tr, #lvvgstlgyk td, #lvvgstlgyk th {
  border-style: none;
}

#lvvgstlgyk p {
  margin: 0;
  padding: 0;
}

#lvvgstlgyk .gt_table {
  display: table;
  border-collapse: collapse;
  line-height: normal;
  margin-left: auto;
  margin-right: auto;
  color: #333333;
  font-size: 16px;
  font-weight: normal;
  font-style: normal;
  background-color: #FFFFFF;
  width: auto;
  border-top-style: solid;
  border-top-width: 2px;
  border-top-color: #A8A8A8;
  border-right-style: none;
  border-right-width: 2px;
  border-right-color: #D3D3D3;
  border-bottom-style: solid;
  border-bottom-width: 2px;
  border-bottom-color: #A8A8A8;
  border-left-style: none;
  border-left-width: 2px;
  border-left-color: #D3D3D3;
}

#lvvgstlgyk .gt_caption {
  padding-top: 4px;
  padding-bottom: 4px;
}

#lvvgstlgyk .gt_title {
  color: #333333;
  font-size: 125%;
  font-weight: initial;
  padding-top: 4px;
  padding-bottom: 4px;
  padding-left: 5px;
  padding-right: 5px;
  border-bottom-color: #FFFFFF;
  border-bottom-width: 0;
}

#lvvgstlgyk .gt_subtitle {
  color: #333333;
  font-size: 85%;
  font-weight: initial;
  padding-top: 3px;
  padding-bottom: 5px;
  padding-left: 5px;
  padding-right: 5px;
  border-top-color: #FFFFFF;
  border-top-width: 0;
}

#lvvgstlgyk .gt_heading {
  background-color: #FFFFFF;
  text-align: center;
  border-bottom-color: #FFFFFF;
  border-left-style: none;
  border-left-width: 1px;
  border-left-color: #D3D3D3;
  border-right-style: none;
  border-right-width: 1px;
  border-right-color: #D3D3D3;
}

#lvvgstlgyk .gt_bottom_border {
  border-bottom-style: solid;
  border-bottom-width: 2px;
  border-bottom-color: #D3D3D3;
}

#lvvgstlgyk .gt_col_headings {
  border-top-style: solid;
  border-top-width: 2px;
  border-top-color: #D3D3D3;
  border-bottom-style: solid;
  border-bottom-width: 2px;
  border-bottom-color: #D3D3D3;
  border-left-style: none;
  border-left-width: 1px;
  border-left-color: #D3D3D3;
  border-right-style: none;
  border-right-width: 1px;
  border-right-color: #D3D3D3;
}

#lvvgstlgyk .gt_col_heading {
  color: #333333;
  background-color: #FFFFFF;
  font-size: 100%;
  font-weight: normal;
  text-transform: inherit;
  border-left-style: none;
  border-left-width: 1px;
  border-left-color: #D3D3D3;
  border-right-style: none;
  border-right-width: 1px;
  border-right-color: #D3D3D3;
  vertical-align: bottom;
  padding-top: 5px;
  padding-bottom: 6px;
  padding-left: 5px;
  padding-right: 5px;
  overflow-x: hidden;
}

#lvvgstlgyk .gt_column_spanner_outer {
  color: #333333;
  background-color: #FFFFFF;
  font-size: 100%;
  font-weight: normal;
  text-transform: inherit;
  padding-top: 0;
  padding-bottom: 0;
  padding-left: 4px;
  padding-right: 4px;
}

#lvvgstlgyk .gt_column_spanner_outer:first-child {
  padding-left: 0;
}

#lvvgstlgyk .gt_column_spanner_outer:last-child {
  padding-right: 0;
}

#lvvgstlgyk .gt_column_spanner {
  border-bottom-style: solid;
  border-bottom-width: 2px;
  border-bottom-color: #D3D3D3;
  vertical-align: bottom;
  padding-top: 5px;
  padding-bottom: 5px;
  overflow-x: hidden;
  display: inline-block;
  width: 100%;
}

#lvvgstlgyk .gt_spanner_row {
  border-bottom-style: hidden;
}

#lvvgstlgyk .gt_group_heading {
  padding-top: 8px;
  padding-bottom: 8px;
  padding-left: 5px;
  padding-right: 5px;
  color: #333333;
  background-color: #FFFFFF;
  font-size: 100%;
  font-weight: initial;
  text-transform: inherit;
  border-top-style: solid;
  border-top-width: 2px;
  border-top-color: #D3D3D3;
  border-bottom-style: solid;
  border-bottom-width: 2px;
  border-bottom-color: #D3D3D3;
  border-left-style: none;
  border-left-width: 1px;
  border-left-color: #D3D3D3;
  border-right-style: none;
  border-right-width: 1px;
  border-right-color: #D3D3D3;
  vertical-align: middle;
  text-align: left;
}

#lvvgstlgyk .gt_empty_group_heading {
  padding: 0.5px;
  color: #333333;
  background-color: #FFFFFF;
  font-size: 100%;
  font-weight: initial;
  border-top-style: solid;
  border-top-width: 2px;
  border-top-color: #D3D3D3;
  border-bottom-style: solid;
  border-bottom-width: 2px;
  border-bottom-color: #D3D3D3;
  vertical-align: middle;
}

#lvvgstlgyk .gt_from_md > :first-child {
  margin-top: 0;
}

#lvvgstlgyk .gt_from_md > :last-child {
  margin-bottom: 0;
}

#lvvgstlgyk .gt_row {
  padding-top: 8px;
  padding-bottom: 8px;
  padding-left: 5px;
  padding-right: 5px;
  margin: 10px;
  border-top-style: solid;
  border-top-width: 1px;
  border-top-color: #D3D3D3;
  border-left-style: none;
  border-left-width: 1px;
  border-left-color: #D3D3D3;
  border-right-style: none;
  border-right-width: 1px;
  border-right-color: #D3D3D3;
  vertical-align: middle;
  overflow-x: hidden;
}

#lvvgstlgyk .gt_stub {
  color: #333333;
  background-color: #FFFFFF;
  font-size: 100%;
  font-weight: initial;
  text-transform: inherit;
  border-right-style: solid;
  border-right-width: 2px;
  border-right-color: #D3D3D3;
  padding-left: 5px;
  padding-right: 5px;
}

#lvvgstlgyk .gt_stub_row_group {
  color: #333333;
  background-color: #FFFFFF;
  font-size: 100%;
  font-weight: initial;
  text-transform: inherit;
  border-right-style: solid;
  border-right-width: 2px;
  border-right-color: #D3D3D3;
  padding-left: 5px;
  padding-right: 5px;
  vertical-align: top;
}

#lvvgstlgyk .gt_row_group_first td {
  border-top-width: 2px;
}

#lvvgstlgyk .gt_row_group_first th {
  border-top-width: 2px;
}

#lvvgstlgyk .gt_summary_row {
  color: #333333;
  background-color: #FFFFFF;
  text-transform: inherit;
  padding-top: 8px;
  padding-bottom: 8px;
  padding-left: 5px;
  padding-right: 5px;
}

#lvvgstlgyk .gt_first_summary_row {
  border-top-style: solid;
  border-top-color: #D3D3D3;
}

#lvvgstlgyk .gt_first_summary_row.thick {
  border-top-width: 2px;
}

#lvvgstlgyk .gt_last_summary_row {
  padding-top: 8px;
  padding-bottom: 8px;
  padding-left: 5px;
  padding-right: 5px;
  border-bottom-style: solid;
  border-bottom-width: 2px;
  border-bottom-color: #D3D3D3;
}

#lvvgstlgyk .gt_grand_summary_row {
  color: #333333;
  background-color: #FFFFFF;
  text-transform: inherit;
  padding-top: 8px;
  padding-bottom: 8px;
  padding-left: 5px;
  padding-right: 5px;
}

#lvvgstlgyk .gt_first_grand_summary_row {
  padding-top: 8px;
  padding-bottom: 8px;
  padding-left: 5px;
  padding-right: 5px;
  border-top-style: double;
  border-top-width: 6px;
  border-top-color: #D3D3D3;
}

#lvvgstlgyk .gt_last_grand_summary_row_top {
  padding-top: 8px;
  padding-bottom: 8px;
  padding-left: 5px;
  padding-right: 5px;
  border-bottom-style: double;
  border-bottom-width: 6px;
  border-bottom-color: #D3D3D3;
}

#lvvgstlgyk .gt_striped {
  background-color: rgba(128, 128, 128, 0.05);
}

#lvvgstlgyk .gt_table_body {
  border-top-style: solid;
  border-top-width: 2px;
  border-top-color: #D3D3D3;
  border-bottom-style: solid;
  border-bottom-width: 2px;
  border-bottom-color: #D3D3D3;
}

#lvvgstlgyk .gt_footnotes {
  color: #333333;
  background-color: #FFFFFF;
  border-bottom-style: none;
  border-bottom-width: 2px;
  border-bottom-color: #D3D3D3;
  border-left-style: none;
  border-left-width: 2px;
  border-left-color: #D3D3D3;
  border-right-style: none;
  border-right-width: 2px;
  border-right-color: #D3D3D3;
}

#lvvgstlgyk .gt_footnote {
  margin: 0px;
  font-size: 90%;
  padding-top: 4px;
  padding-bottom: 4px;
  padding-left: 5px;
  padding-right: 5px;
}

#lvvgstlgyk .gt_sourcenotes {
  color: #333333;
  background-color: #FFFFFF;
  border-bottom-style: none;
  border-bottom-width: 2px;
  border-bottom-color: #D3D3D3;
  border-left-style: none;
  border-left-width: 2px;
  border-left-color: #D3D3D3;
  border-right-style: none;
  border-right-width: 2px;
  border-right-color: #D3D3D3;
}

#lvvgstlgyk .gt_sourcenote {
  font-size: 90%;
  padding-top: 4px;
  padding-bottom: 4px;
  padding-left: 5px;
  padding-right: 5px;
}

#lvvgstlgyk .gt_left {
  text-align: left;
}

#lvvgstlgyk .gt_center {
  text-align: center;
}

#lvvgstlgyk .gt_right {
  text-align: right;
  font-variant-numeric: tabular-nums;
}

#lvvgstlgyk .gt_font_normal {
  font-weight: normal;
}

#lvvgstlgyk .gt_font_bold {
  font-weight: bold;
}

#lvvgstlgyk .gt_font_italic {
  font-style: italic;
}

#lvvgstlgyk .gt_super {
  font-size: 65%;
}

#lvvgstlgyk .gt_footnote_marks {
  font-size: 75%;
  vertical-align: 0.4em;
  position: initial;
}

#lvvgstlgyk .gt_asterisk {
  font-size: 100%;
  vertical-align: 0;
}

#lvvgstlgyk .gt_indent_1 {
  text-indent: 5px;
}

#lvvgstlgyk .gt_indent_2 {
  text-indent: 10px;
}

#lvvgstlgyk .gt_indent_3 {
  text-indent: 15px;
}

#lvvgstlgyk .gt_indent_4 {
  text-indent: 20px;
}

#lvvgstlgyk .gt_indent_5 {
  text-indent: 25px;
}

#lvvgstlgyk .katex-display {
  display: inline-flex !important;
  margin-bottom: 0.75em !important;
}

#lvvgstlgyk div.Reactable > div.rt-table > div.rt-thead > div.rt-tr.rt-tr-group-header > div.rt-th-group:after {
  height: 0px !important;
}
</style>
<table class="gt_table" data-quarto-disable-processing="false" data-quarto-bootstrap="false">
  <thead>
    <tr class="gt_heading">
      <td colspan="8" class="gt_heading gt_title gt_font_normal gt_bottom_border" style="">Datos de clientes con descuento (5 filas al azar)</td>
    </tr>
    
    <tr class="gt_col_headings">
      <th class="gt_col_heading gt_columns_bottom_border gt_right" rowspan="1" colspan="1" scope="col" id="customer_id">customer_id</th>
      <th class="gt_col_heading gt_columns_bottom_border gt_left" rowspan="1" colspan="1" scope="col" id="region">region</th>
      <th class="gt_col_heading gt_columns_bottom_border gt_right" rowspan="1" colspan="1" scope="col" id="treatment_effect">treatment_effect</th>
      <th class="gt_col_heading gt_columns_bottom_border gt_right" rowspan="1" colspan="1" scope="col" id="y0">y0</th>
      <th class="gt_col_heading gt_columns_bottom_border gt_right" rowspan="1" colspan="1" scope="col" id="y1">y1</th>
      <th class="gt_col_heading gt_columns_bottom_border gt_right" rowspan="1" colspan="1" scope="col" id="d">d</th>
      <th class="gt_col_heading gt_columns_bottom_border gt_right" rowspan="1" colspan="1" scope="col" id="y">y</th>
      <th class="gt_col_heading gt_columns_bottom_border gt_left" rowspan="1" colspan="1" scope="col" id="tratamiento">tratamiento</th>
    </tr>
  </thead>
  <tbody class="gt_table_body">
    <tr><td headers="customer_id" class="gt_row gt_right">241</td>
<td headers="region" class="gt_row gt_left">Oeste</td>
<td headers="treatment_effect" class="gt_row gt_right">338.1579</td>
<td headers="y0" class="gt_row gt_right">1841.329</td>
<td headers="y1" class="gt_row gt_right">2179.487</td>
<td headers="d" class="gt_row gt_right">1</td>
<td headers="y" class="gt_row gt_right">2179.487</td>
<td headers="tratamiento" class="gt_row gt_left">Tratamiento</td></tr>
    <tr><td headers="customer_id" class="gt_row gt_right">585</td>
<td headers="region" class="gt_row gt_left">Norte</td>
<td headers="treatment_effect" class="gt_row gt_right">113.7443</td>
<td headers="y0" class="gt_row gt_right">3323.805</td>
<td headers="y1" class="gt_row gt_right">3437.550</td>
<td headers="d" class="gt_row gt_right">0</td>
<td headers="y" class="gt_row gt_right">3323.805</td>
<td headers="tratamiento" class="gt_row gt_left">Control</td></tr>
    <tr><td headers="customer_id" class="gt_row gt_right">845</td>
<td headers="region" class="gt_row gt_left">Norte</td>
<td headers="treatment_effect" class="gt_row gt_right">599.7978</td>
<td headers="y0" class="gt_row gt_right">3735.531</td>
<td headers="y1" class="gt_row gt_right">4335.329</td>
<td headers="d" class="gt_row gt_right">0</td>
<td headers="y" class="gt_row gt_right">3735.531</td>
<td headers="tratamiento" class="gt_row gt_left">Control</td></tr>
    <tr><td headers="customer_id" class="gt_row gt_right">347</td>
<td headers="region" class="gt_row gt_left">Oeste</td>
<td headers="treatment_effect" class="gt_row gt_right">468.4059</td>
<td headers="y0" class="gt_row gt_right">2004.665</td>
<td headers="y1" class="gt_row gt_right">2473.071</td>
<td headers="d" class="gt_row gt_right">0</td>
<td headers="y" class="gt_row gt_right">2004.665</td>
<td headers="tratamiento" class="gt_row gt_left">Control</td></tr>
    <tr><td headers="customer_id" class="gt_row gt_right">732</td>
<td headers="region" class="gt_row gt_left">Norte</td>
<td headers="treatment_effect" class="gt_row gt_right">371.6284</td>
<td headers="y0" class="gt_row gt_right">3544.635</td>
<td headers="y1" class="gt_row gt_right">3916.264</td>
<td headers="d" class="gt_row gt_right">0</td>
<td headers="y" class="gt_row gt_right">3544.635</td>
<td headers="tratamiento" class="gt_row gt_left">Control</td></tr>
  </tbody>
  
  
</table>
</div>
</div>
</div>
<p>Lo primero que uno pensar√≠a en estos casos (aunque cualquier lector o lectora de este libro podr√≠a intuir por qu√© es incorrecto) es en tomar los sujetos del grupo tratamiento y los del control y calcular la diferencia simple entre medias (<strong>SDO</strong>). Veamos que pinta tiene eso gr√°ficamente y despu√©s calculemoslo.</p>
<div class="cell">
<details>
<summary>Ver el c√≥digo</summary>
<div class="sourceCode cell-code" id="cb2"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb2-1"><a href="#cb2-1" aria-hidden="true" tabindex="-1"></a>customers <span class="sc">%&gt;%</span></span>
<span id="cb2-2"><a href="#cb2-2" aria-hidden="true" tabindex="-1"></a>  <span class="fu">ggplot</span>(<span class="fu">aes</span>(<span class="at">x =</span> tratamiento, </span>
<span id="cb2-3"><a href="#cb2-3" aria-hidden="true" tabindex="-1"></a>             <span class="at">y =</span> y, </span>
<span id="cb2-4"><a href="#cb2-4" aria-hidden="true" tabindex="-1"></a>             <span class="at">color =</span> tratamiento)) <span class="sc">+</span></span>
<span id="cb2-5"><a href="#cb2-5" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_jitter</span>(<span class="at">alpha =</span> .<span class="dv">3</span>, <span class="at">width =</span> .<span class="dv">1</span>, <span class="at">size =</span> <span class="dv">1</span>) <span class="sc">+</span> </span>
<span id="cb2-6"><a href="#cb2-6" aria-hidden="true" tabindex="-1"></a>  <span class="fu">stat_summary</span>(<span class="at">color =</span> <span class="st">"black"</span>, <span class="at">width =</span> .<span class="dv">4</span>) <span class="sc">+</span></span>
<span id="cb2-7"><a href="#cb2-7" aria-hidden="true" tabindex="-1"></a>  <span class="fu">scale_color_brewer</span>(<span class="at">palette =</span> <span class="st">"Dark2"</span>) <span class="sc">+</span></span>
<span id="cb2-8"><a href="#cb2-8" aria-hidden="true" tabindex="-1"></a>  <span class="fu">labs</span>(<span class="at">x =</span> <span class="cn">NULL</span>, <span class="at">y =</span> <span class="st">"Ventas por mes por cliente"</span>, <span class="at">color =</span> <span class="cn">NULL</span>) <span class="sc">+</span></span>
<span id="cb2-9"><a href="#cb2-9" aria-hidden="true" tabindex="-1"></a>  <span class="fu">theme_bw</span>() <span class="sc">+</span></span>
<span id="cb2-10"><a href="#cb2-10" aria-hidden="true" tabindex="-1"></a>  <span class="fu">theme</span>(<span class="at">legend.position =</span> <span class="st">"top"</span>)</span>
<span id="cb2-11"><a href="#cb2-11" aria-hidden="true" tabindex="-1"></a><span class="co">#&gt; Warning in stat_summary(color = "black", width = 0.4): Ignoring unknown</span></span>
<span id="cb2-12"><a href="#cb2-12" aria-hidden="true" tabindex="-1"></a><span class="co">#&gt; parameters: `width`</span></span>
<span id="cb2-13"><a href="#cb2-13" aria-hidden="true" tabindex="-1"></a><span class="co">#&gt; No summary function supplied, defaulting to `mean_se()`</span></span></code><button title="Copiar al portapapeles" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
<div class="cell-output-display">
<p><img src="matching_files/figure-html/unnamed-chunk-4-1.png" class="img-fluid" width="576"></p>
</div>
</div>
<p>¬øPero no era que el tratamiento ten√≠a un efecto conocido de $<span class="math inline">\(300\)</span>? A ver, tomemos un respiro y calculemos el <strong>SDO</strong>, recordemos c√≥mo calcularlo:</p>
<p><span class="math display">\[
SDO = \frac{1}{N_t} \sum_{i=1}^n (y_i | d_i=1) - \frac{1}{N_t} \sum_{i=1}^n (y_i | d_i=0),
\]</span></p>
<p>o, en lenguaje computacional:</p>
<p><code>SDO &lt;- mean(customers$y[customers$d==1]) - mean(customers$y[customers$d==0])</code>.</p>
<p>Si lo calculamos nos da efectivamente $-334. Es decir, no s√≥lo no vale $<span class="math inline">\(300\)</span> sino que su valor es negativo, o sea, ofrecer un descuento disminuye las ventas. ¬øAlguna sospecha de qu√© est√° pasando? Como vimos en el cap√≠tulo [#sec-pot-outcomes], cuando las asignaciones <strong>NO</strong> son aleatorias, no podemos asegurar que el <strong>SDO</strong> sea un buen estimador del <strong>ATE</strong>. En este caso no tenemos sesgo de efecto heterog√©neo (lo sabemos porque simulamos los datos) pero qu√© opinan del sesgo de selecci√≥n. ¬øDepende acaso al asignaci√≥n al grupo tratamiento de alguno de los <em>outcome</em> potenciales? La respuesta es un rotundo <strong>S√ç</strong>, ya que el genio del jefe, que se ve que no sabe nada de inferencia causal, decidi√≥ condicionar la asignaci√≥n justamente a las ventas esperadas.</p>
<p>Veamos ahora las ventas para grupo tratamiento y control pero por regi√≥n.</p>
<div class="cell">
<details>
<summary>Ver el c√≥digo</summary>
<div class="sourceCode cell-code" id="cb3"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb3-1"><a href="#cb3-1" aria-hidden="true" tabindex="-1"></a>customers <span class="sc">%&gt;%</span></span>
<span id="cb3-2"><a href="#cb3-2" aria-hidden="true" tabindex="-1"></a>  <span class="fu">ggplot</span>(<span class="fu">aes</span>(<span class="at">x =</span> tratamiento, </span>
<span id="cb3-3"><a href="#cb3-3" aria-hidden="true" tabindex="-1"></a>             <span class="at">y =</span> y, </span>
<span id="cb3-4"><a href="#cb3-4" aria-hidden="true" tabindex="-1"></a>             <span class="at">color =</span> tratamiento)) <span class="sc">+</span></span>
<span id="cb3-5"><a href="#cb3-5" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_jitter</span>(<span class="at">alpha =</span> .<span class="dv">3</span>, <span class="at">width =</span> .<span class="dv">1</span>, <span class="at">size =</span> <span class="dv">1</span>) <span class="sc">+</span> </span>
<span id="cb3-6"><a href="#cb3-6" aria-hidden="true" tabindex="-1"></a>  <span class="fu">stat_summary</span>(<span class="at">color =</span> <span class="st">"black"</span>, <span class="at">width =</span> .<span class="dv">4</span>) <span class="sc">+</span></span>
<span id="cb3-7"><a href="#cb3-7" aria-hidden="true" tabindex="-1"></a>  <span class="fu">scale_color_brewer</span>(<span class="at">palette =</span> <span class="st">"Dark2"</span>) <span class="sc">+</span></span>
<span id="cb3-8"><a href="#cb3-8" aria-hidden="true" tabindex="-1"></a>  <span class="fu">labs</span>(<span class="at">x =</span> <span class="cn">NULL</span>, <span class="at">y =</span> <span class="st">"Ventas por mes por cliente"</span>, <span class="at">color =</span> <span class="cn">NULL</span>) <span class="sc">+</span></span>
<span id="cb3-9"><a href="#cb3-9" aria-hidden="true" tabindex="-1"></a>  <span class="fu">facet_wrap</span>(<span class="sc">~</span>region) <span class="sc">+</span></span>
<span id="cb3-10"><a href="#cb3-10" aria-hidden="true" tabindex="-1"></a>  <span class="fu">theme_minimal</span>() <span class="sc">+</span></span>
<span id="cb3-11"><a href="#cb3-11" aria-hidden="true" tabindex="-1"></a>  <span class="fu">theme</span>(<span class="at">legend.position =</span> <span class="st">"top"</span>)</span>
<span id="cb3-12"><a href="#cb3-12" aria-hidden="true" tabindex="-1"></a><span class="co">#&gt; Warning in stat_summary(color = "black", width = 0.4): Ignoring unknown</span></span>
<span id="cb3-13"><a href="#cb3-13" aria-hidden="true" tabindex="-1"></a><span class="co">#&gt; parameters: `width`</span></span>
<span id="cb3-14"><a href="#cb3-14" aria-hidden="true" tabindex="-1"></a><span class="co">#&gt; No summary function supplied, defaulting to `mean_se()`</span></span>
<span id="cb3-15"><a href="#cb3-15" aria-hidden="true" tabindex="-1"></a><span class="co">#&gt; No summary function supplied, defaulting to `mean_se()`</span></span>
<span id="cb3-16"><a href="#cb3-16" aria-hidden="true" tabindex="-1"></a><span class="co">#&gt; No summary function supplied, defaulting to `mean_se()`</span></span></code><button title="Copiar al portapapeles" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
<div class="cell-output-display">
<p><img src="matching_files/figure-html/unnamed-chunk-5-1.png" class="img-fluid" width="576"></p>
</div>
</div>
<p>Apa, la cosa ahora es distinta. Tal como lo esper√°bamos, en cada grupo el efecto del tratamiento es un aumento en las ventas. Lo que ocurre es una combinaci√≥n de sesgo de selecci√≥n con el tama√±o de las regiones. La regi√≥n del norte, que es la m√°s grande, tiene m√°s sujetos asignados a control, por lo tanto, los controles tienen una sobrerepresentaci√≥n de clientes que tienden a comprar m√°s. Por el contrario, la regi√≥n del oeste, que es la m√°s chica, tiene m√°s sujetos asignados al grupo tratamiento, lo cual genera una sobrerepresentaci√≥n de ratone‚Ä¶ clientes que gastan menos en el grupo tratamiento.</p>
<p>¬øSe les ocurre alguna soluci√≥n elegante üé©? Claro, podemos calcular el efecto del tratamiento dentro de cada grupo (una especie de <strong>SDO</strong> local) y despu√©s vemos qu√© hacemos. Empecemos por eso.</p>
<div class="cell">
<details>
<summary>Ver el c√≥digo</summary>
<div class="sourceCode cell-code" id="cb4"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb4-1"><a href="#cb4-1" aria-hidden="true" tabindex="-1"></a>SDO_este <span class="ot">&lt;-</span> <span class="fu">mean</span>(customers<span class="sc">$</span>y[customers<span class="sc">$</span>region<span class="sc">==</span><span class="st">"Este"</span> <span class="sc">&amp;</span> customers<span class="sc">$</span>d<span class="sc">==</span><span class="dv">1</span>]) <span class="sc">-</span> </span>
<span id="cb4-2"><a href="#cb4-2" aria-hidden="true" tabindex="-1"></a>  <span class="fu">mean</span>(customers<span class="sc">$</span>y[customers<span class="sc">$</span>region<span class="sc">==</span><span class="st">"Este"</span> <span class="sc">&amp;</span> customers<span class="sc">$</span>d<span class="sc">==</span><span class="dv">0</span>])</span>
<span id="cb4-3"><a href="#cb4-3" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb4-4"><a href="#cb4-4" aria-hidden="true" tabindex="-1"></a>SDO_norte <span class="ot">&lt;-</span> <span class="fu">mean</span>(customers<span class="sc">$</span>y[customers<span class="sc">$</span>region<span class="sc">==</span><span class="st">"Norte"</span> <span class="sc">&amp;</span> customers<span class="sc">$</span>d<span class="sc">==</span><span class="dv">1</span>]) <span class="sc">-</span> </span>
<span id="cb4-5"><a href="#cb4-5" aria-hidden="true" tabindex="-1"></a>  <span class="fu">mean</span>(customers<span class="sc">$</span>y[customers<span class="sc">$</span>region<span class="sc">==</span><span class="st">"Norte"</span> <span class="sc">&amp;</span> customers<span class="sc">$</span>d<span class="sc">==</span><span class="dv">0</span>])</span>
<span id="cb4-6"><a href="#cb4-6" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb4-7"><a href="#cb4-7" aria-hidden="true" tabindex="-1"></a>SDO_oeste <span class="ot">&lt;-</span> <span class="fu">mean</span>(customers<span class="sc">$</span>y[customers<span class="sc">$</span>region<span class="sc">==</span><span class="st">"Oeste"</span> <span class="sc">&amp;</span> customers<span class="sc">$</span>d<span class="sc">==</span><span class="dv">1</span>]) <span class="sc">-</span> </span>
<span id="cb4-8"><a href="#cb4-8" aria-hidden="true" tabindex="-1"></a>  <span class="fu">mean</span>(customers<span class="sc">$</span>y[customers<span class="sc">$</span>region<span class="sc">==</span><span class="st">"Oeste"</span> <span class="sc">&amp;</span> customers<span class="sc">$</span>d<span class="sc">==</span><span class="dv">0</span>])</span>
<span id="cb4-9"><a href="#cb4-9" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb4-10"><a href="#cb4-10" aria-hidden="true" tabindex="-1"></a><span class="fu">tibble</span>(Regi√≥n <span class="ot">=</span> <span class="fu">c</span>(<span class="st">"Este"</span>, <span class="st">"Norte"</span>, <span class="st">"Oeste"</span>),</span>
<span id="cb4-11"><a href="#cb4-11" aria-hidden="true" tabindex="-1"></a>       <span class="at">SDO =</span> <span class="fu">c</span>(SDO_este, SDO_norte, SDO_oeste)) <span class="sc">%&gt;%</span></span>
<span id="cb4-12"><a href="#cb4-12" aria-hidden="true" tabindex="-1"></a>  <span class="fu">gt</span>()</span></code><button title="Copiar al portapapeles" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
<div class="cell-output-display">

<div id="egyvmitcct" style="padding-left:0px;padding-right:0px;padding-top:10px;padding-bottom:10px;overflow-x:auto;overflow-y:auto;width:auto;height:auto;">
<style>#egyvmitcct table {
  font-family: system-ui, 'Segoe UI', Roboto, Helvetica, Arial, sans-serif, 'Apple Color Emoji', 'Segoe UI Emoji', 'Segoe UI Symbol', 'Noto Color Emoji';
  -webkit-font-smoothing: antialiased;
  -moz-osx-font-smoothing: grayscale;
}

#egyvmitcct thead, #egyvmitcct tbody, #egyvmitcct tfoot, #egyvmitcct tr, #egyvmitcct td, #egyvmitcct th {
  border-style: none;
}

#egyvmitcct p {
  margin: 0;
  padding: 0;
}

#egyvmitcct .gt_table {
  display: table;
  border-collapse: collapse;
  line-height: normal;
  margin-left: auto;
  margin-right: auto;
  color: #333333;
  font-size: 16px;
  font-weight: normal;
  font-style: normal;
  background-color: #FFFFFF;
  width: auto;
  border-top-style: solid;
  border-top-width: 2px;
  border-top-color: #A8A8A8;
  border-right-style: none;
  border-right-width: 2px;
  border-right-color: #D3D3D3;
  border-bottom-style: solid;
  border-bottom-width: 2px;
  border-bottom-color: #A8A8A8;
  border-left-style: none;
  border-left-width: 2px;
  border-left-color: #D3D3D3;
}

#egyvmitcct .gt_caption {
  padding-top: 4px;
  padding-bottom: 4px;
}

#egyvmitcct .gt_title {
  color: #333333;
  font-size: 125%;
  font-weight: initial;
  padding-top: 4px;
  padding-bottom: 4px;
  padding-left: 5px;
  padding-right: 5px;
  border-bottom-color: #FFFFFF;
  border-bottom-width: 0;
}

#egyvmitcct .gt_subtitle {
  color: #333333;
  font-size: 85%;
  font-weight: initial;
  padding-top: 3px;
  padding-bottom: 5px;
  padding-left: 5px;
  padding-right: 5px;
  border-top-color: #FFFFFF;
  border-top-width: 0;
}

#egyvmitcct .gt_heading {
  background-color: #FFFFFF;
  text-align: center;
  border-bottom-color: #FFFFFF;
  border-left-style: none;
  border-left-width: 1px;
  border-left-color: #D3D3D3;
  border-right-style: none;
  border-right-width: 1px;
  border-right-color: #D3D3D3;
}

#egyvmitcct .gt_bottom_border {
  border-bottom-style: solid;
  border-bottom-width: 2px;
  border-bottom-color: #D3D3D3;
}

#egyvmitcct .gt_col_headings {
  border-top-style: solid;
  border-top-width: 2px;
  border-top-color: #D3D3D3;
  border-bottom-style: solid;
  border-bottom-width: 2px;
  border-bottom-color: #D3D3D3;
  border-left-style: none;
  border-left-width: 1px;
  border-left-color: #D3D3D3;
  border-right-style: none;
  border-right-width: 1px;
  border-right-color: #D3D3D3;
}

#egyvmitcct .gt_col_heading {
  color: #333333;
  background-color: #FFFFFF;
  font-size: 100%;
  font-weight: normal;
  text-transform: inherit;
  border-left-style: none;
  border-left-width: 1px;
  border-left-color: #D3D3D3;
  border-right-style: none;
  border-right-width: 1px;
  border-right-color: #D3D3D3;
  vertical-align: bottom;
  padding-top: 5px;
  padding-bottom: 6px;
  padding-left: 5px;
  padding-right: 5px;
  overflow-x: hidden;
}

#egyvmitcct .gt_column_spanner_outer {
  color: #333333;
  background-color: #FFFFFF;
  font-size: 100%;
  font-weight: normal;
  text-transform: inherit;
  padding-top: 0;
  padding-bottom: 0;
  padding-left: 4px;
  padding-right: 4px;
}

#egyvmitcct .gt_column_spanner_outer:first-child {
  padding-left: 0;
}

#egyvmitcct .gt_column_spanner_outer:last-child {
  padding-right: 0;
}

#egyvmitcct .gt_column_spanner {
  border-bottom-style: solid;
  border-bottom-width: 2px;
  border-bottom-color: #D3D3D3;
  vertical-align: bottom;
  padding-top: 5px;
  padding-bottom: 5px;
  overflow-x: hidden;
  display: inline-block;
  width: 100%;
}

#egyvmitcct .gt_spanner_row {
  border-bottom-style: hidden;
}

#egyvmitcct .gt_group_heading {
  padding-top: 8px;
  padding-bottom: 8px;
  padding-left: 5px;
  padding-right: 5px;
  color: #333333;
  background-color: #FFFFFF;
  font-size: 100%;
  font-weight: initial;
  text-transform: inherit;
  border-top-style: solid;
  border-top-width: 2px;
  border-top-color: #D3D3D3;
  border-bottom-style: solid;
  border-bottom-width: 2px;
  border-bottom-color: #D3D3D3;
  border-left-style: none;
  border-left-width: 1px;
  border-left-color: #D3D3D3;
  border-right-style: none;
  border-right-width: 1px;
  border-right-color: #D3D3D3;
  vertical-align: middle;
  text-align: left;
}

#egyvmitcct .gt_empty_group_heading {
  padding: 0.5px;
  color: #333333;
  background-color: #FFFFFF;
  font-size: 100%;
  font-weight: initial;
  border-top-style: solid;
  border-top-width: 2px;
  border-top-color: #D3D3D3;
  border-bottom-style: solid;
  border-bottom-width: 2px;
  border-bottom-color: #D3D3D3;
  vertical-align: middle;
}

#egyvmitcct .gt_from_md > :first-child {
  margin-top: 0;
}

#egyvmitcct .gt_from_md > :last-child {
  margin-bottom: 0;
}

#egyvmitcct .gt_row {
  padding-top: 8px;
  padding-bottom: 8px;
  padding-left: 5px;
  padding-right: 5px;
  margin: 10px;
  border-top-style: solid;
  border-top-width: 1px;
  border-top-color: #D3D3D3;
  border-left-style: none;
  border-left-width: 1px;
  border-left-color: #D3D3D3;
  border-right-style: none;
  border-right-width: 1px;
  border-right-color: #D3D3D3;
  vertical-align: middle;
  overflow-x: hidden;
}

#egyvmitcct .gt_stub {
  color: #333333;
  background-color: #FFFFFF;
  font-size: 100%;
  font-weight: initial;
  text-transform: inherit;
  border-right-style: solid;
  border-right-width: 2px;
  border-right-color: #D3D3D3;
  padding-left: 5px;
  padding-right: 5px;
}

#egyvmitcct .gt_stub_row_group {
  color: #333333;
  background-color: #FFFFFF;
  font-size: 100%;
  font-weight: initial;
  text-transform: inherit;
  border-right-style: solid;
  border-right-width: 2px;
  border-right-color: #D3D3D3;
  padding-left: 5px;
  padding-right: 5px;
  vertical-align: top;
}

#egyvmitcct .gt_row_group_first td {
  border-top-width: 2px;
}

#egyvmitcct .gt_row_group_first th {
  border-top-width: 2px;
}

#egyvmitcct .gt_summary_row {
  color: #333333;
  background-color: #FFFFFF;
  text-transform: inherit;
  padding-top: 8px;
  padding-bottom: 8px;
  padding-left: 5px;
  padding-right: 5px;
}

#egyvmitcct .gt_first_summary_row {
  border-top-style: solid;
  border-top-color: #D3D3D3;
}

#egyvmitcct .gt_first_summary_row.thick {
  border-top-width: 2px;
}

#egyvmitcct .gt_last_summary_row {
  padding-top: 8px;
  padding-bottom: 8px;
  padding-left: 5px;
  padding-right: 5px;
  border-bottom-style: solid;
  border-bottom-width: 2px;
  border-bottom-color: #D3D3D3;
}

#egyvmitcct .gt_grand_summary_row {
  color: #333333;
  background-color: #FFFFFF;
  text-transform: inherit;
  padding-top: 8px;
  padding-bottom: 8px;
  padding-left: 5px;
  padding-right: 5px;
}

#egyvmitcct .gt_first_grand_summary_row {
  padding-top: 8px;
  padding-bottom: 8px;
  padding-left: 5px;
  padding-right: 5px;
  border-top-style: double;
  border-top-width: 6px;
  border-top-color: #D3D3D3;
}

#egyvmitcct .gt_last_grand_summary_row_top {
  padding-top: 8px;
  padding-bottom: 8px;
  padding-left: 5px;
  padding-right: 5px;
  border-bottom-style: double;
  border-bottom-width: 6px;
  border-bottom-color: #D3D3D3;
}

#egyvmitcct .gt_striped {
  background-color: rgba(128, 128, 128, 0.05);
}

#egyvmitcct .gt_table_body {
  border-top-style: solid;
  border-top-width: 2px;
  border-top-color: #D3D3D3;
  border-bottom-style: solid;
  border-bottom-width: 2px;
  border-bottom-color: #D3D3D3;
}

#egyvmitcct .gt_footnotes {
  color: #333333;
  background-color: #FFFFFF;
  border-bottom-style: none;
  border-bottom-width: 2px;
  border-bottom-color: #D3D3D3;
  border-left-style: none;
  border-left-width: 2px;
  border-left-color: #D3D3D3;
  border-right-style: none;
  border-right-width: 2px;
  border-right-color: #D3D3D3;
}

#egyvmitcct .gt_footnote {
  margin: 0px;
  font-size: 90%;
  padding-top: 4px;
  padding-bottom: 4px;
  padding-left: 5px;
  padding-right: 5px;
}

#egyvmitcct .gt_sourcenotes {
  color: #333333;
  background-color: #FFFFFF;
  border-bottom-style: none;
  border-bottom-width: 2px;
  border-bottom-color: #D3D3D3;
  border-left-style: none;
  border-left-width: 2px;
  border-left-color: #D3D3D3;
  border-right-style: none;
  border-right-width: 2px;
  border-right-color: #D3D3D3;
}

#egyvmitcct .gt_sourcenote {
  font-size: 90%;
  padding-top: 4px;
  padding-bottom: 4px;
  padding-left: 5px;
  padding-right: 5px;
}

#egyvmitcct .gt_left {
  text-align: left;
}

#egyvmitcct .gt_center {
  text-align: center;
}

#egyvmitcct .gt_right {
  text-align: right;
  font-variant-numeric: tabular-nums;
}

#egyvmitcct .gt_font_normal {
  font-weight: normal;
}

#egyvmitcct .gt_font_bold {
  font-weight: bold;
}

#egyvmitcct .gt_font_italic {
  font-style: italic;
}

#egyvmitcct .gt_super {
  font-size: 65%;
}

#egyvmitcct .gt_footnote_marks {
  font-size: 75%;
  vertical-align: 0.4em;
  position: initial;
}

#egyvmitcct .gt_asterisk {
  font-size: 100%;
  vertical-align: 0;
}

#egyvmitcct .gt_indent_1 {
  text-indent: 5px;
}

#egyvmitcct .gt_indent_2 {
  text-indent: 10px;
}

#egyvmitcct .gt_indent_3 {
  text-indent: 15px;
}

#egyvmitcct .gt_indent_4 {
  text-indent: 20px;
}

#egyvmitcct .gt_indent_5 {
  text-indent: 25px;
}

#egyvmitcct .katex-display {
  display: inline-flex !important;
  margin-bottom: 0.75em !important;
}

#egyvmitcct div.Reactable > div.rt-table > div.rt-thead > div.rt-tr.rt-tr-group-header > div.rt-th-group:after {
  height: 0px !important;
}
</style>
<table class="gt_table" data-quarto-disable-processing="false" data-quarto-bootstrap="false">
  <thead>
    <tr class="gt_col_headings">
      <th class="gt_col_heading gt_columns_bottom_border gt_left" rowspan="1" colspan="1" scope="col" id="Regi√≥n">Regi√≥n</th>
      <th class="gt_col_heading gt_columns_bottom_border gt_right" rowspan="1" colspan="1" scope="col" id="SDO">SDO</th>
    </tr>
  </thead>
  <tbody class="gt_table_body">
    <tr><td headers="Regi√≥n" class="gt_row gt_left">Este</td>
<td headers="SDO" class="gt_row gt_right">320.3419</td></tr>
    <tr><td headers="Regi√≥n" class="gt_row gt_left">Norte</td>
<td headers="SDO" class="gt_row gt_right">303.3541</td></tr>
    <tr><td headers="Regi√≥n" class="gt_row gt_left">Oeste</td>
<td headers="SDO" class="gt_row gt_right">327.8227</td></tr>
  </tbody>
  
  
</table>
</div>
</div>
</div>
<p>Efectivamente el efecto en cada regi√≥n se acerca a los $<span class="math inline">\(300\)</span>. Pero para hacer una √∫nica estimaci√≥n del efecto vamos a usar el estimador de subclasifiaci√≥n, que no es otra cosa que un promedio ponderado de estos <strong>SDOs</strong> por regi√≥n. Formalmente ser√≠a algo as√≠:</p>
<p><span class="math display">\[
\hat\delta_{ATE} = \sum_{k=1}^K SDO_k \times \frac{N_k}{N}  
\]</span></p>
<p>donde <span class="math inline">\(k\)</span> es un √≠ndice que codifica al grupo, <span class="math inline">\(K\)</span> es la cantidad total de grupos, <span class="math inline">\(SDO_k\)</span> la diferencia de medias para el grupo <span class="math inline">\(k\)</span>, <span class="math inline">\(N_k\)</span> la cantidad de individuos del grupo <span class="math inline">\(k\)</span> y <span class="math inline">\(N_t\)</span> la cantidad total de individuos. Un promedio pesado, bah. En lenguaje de <strong>R</strong> ser√≠a algo como:</p>
<p><code>subclas_estimator &lt;- SDO_este * (n_este/n_total) +   SDO_norte * (n_norte/n_total) +   SDO_oeste * (n_oeste/n_total)</code></p>
<p>En nuestro caso el estimador vale $312. Bastante bien, ¬øno?</p>
<p>Pero ¬øpor qu√© pas√≥ esto? Veamos algunas figuritas que nos ayuden a entender un poco. Para esto vamos a echar mano a la ventaja de haber generado los datos y vamos a graficar tanto el observable (<span class="math inline">\(Y_0\)</span> si son grupo control o <span class="math inline">\(Y_1\)</span> si son grupo tratamiento) como el contraf√°ctico (<span class="math inline">\(Y_1\)</span> si son grupo control o <span class="math inline">\(Y_0\)</span> si son grupo tratamiento).</p>
<div class="cell">
<details>
<summary>Ver el c√≥digo</summary>
<div class="sourceCode cell-code" id="cb5"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb5-1"><a href="#cb5-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Plots de independencia ####</span></span>
<span id="cb5-2"><a href="#cb5-2" aria-hidden="true" tabindex="-1"></a><span class="co"># Armo un tibble para plotear</span></span>
<span id="cb5-3"><a href="#cb5-3" aria-hidden="true" tabindex="-1"></a>customers_4_plot <span class="ot">&lt;-</span> customers <span class="sc">%&gt;%</span> </span>
<span id="cb5-4"><a href="#cb5-4" aria-hidden="true" tabindex="-1"></a>  <span class="fu">select</span>(region, d, y1, y0, tratamiento) <span class="sc">%&gt;%</span> </span>
<span id="cb5-5"><a href="#cb5-5" aria-hidden="true" tabindex="-1"></a>  <span class="fu">pivot_longer</span>(<span class="at">cols =</span> <span class="fu">c</span>(y1, y0),</span>
<span id="cb5-6"><a href="#cb5-6" aria-hidden="true" tabindex="-1"></a>               <span class="at">names_to =</span> <span class="st">"potential_outcome"</span>,</span>
<span id="cb5-7"><a href="#cb5-7" aria-hidden="true" tabindex="-1"></a>               <span class="at">values_to =</span> <span class="st">"value"</span>)</span></code><button title="Copiar al portapapeles" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
</div>
<div class="cell">
<details>
<summary>Ver el c√≥digo</summary>
<div class="sourceCode cell-code" id="cb6"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb6-1"><a href="#cb6-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Independencia</span></span>
<span id="cb6-2"><a href="#cb6-2" aria-hidden="true" tabindex="-1"></a><span class="fu">ggplot</span>(customers_4_plot) <span class="sc">+</span></span>
<span id="cb6-3"><a href="#cb6-3" aria-hidden="true" tabindex="-1"></a>  <span class="fu">aes</span>(potential_outcome, value, <span class="at">colour =</span> tratamiento) <span class="sc">+</span></span>
<span id="cb6-4"><a href="#cb6-4" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_boxplot</span>() <span class="sc">+</span></span>
<span id="cb6-5"><a href="#cb6-5" aria-hidden="true" tabindex="-1"></a>  <span class="fu">labs</span>(<span class="at">x =</span> <span class="st">"Potential Outcome"</span>,</span>
<span id="cb6-6"><a href="#cb6-6" aria-hidden="true" tabindex="-1"></a>       <span class="at">y =</span> <span class="st">"Ventas por mes por cliente"</span>,</span>
<span id="cb6-7"><a href="#cb6-7" aria-hidden="true" tabindex="-1"></a>       <span class="at">colour =</span> <span class="st">"Treatment status"</span>,) <span class="sc">+</span></span>
<span id="cb6-8"><a href="#cb6-8" aria-hidden="true" tabindex="-1"></a>  <span class="fu">scale_color_brewer</span>(<span class="at">palette =</span> <span class="st">"Dark2"</span>) <span class="sc">+</span></span>
<span id="cb6-9"><a href="#cb6-9" aria-hidden="true" tabindex="-1"></a>  <span class="fu">theme_minimal</span>() <span class="sc">+</span></span>
<span id="cb6-10"><a href="#cb6-10" aria-hidden="true" tabindex="-1"></a>  <span class="fu">labs</span>(<span class="at">color =</span> <span class="cn">NULL</span>) <span class="sc">+</span></span>
<span id="cb6-11"><a href="#cb6-11" aria-hidden="true" tabindex="-1"></a>  <span class="fu">theme</span>(<span class="at">legend.position =</span> <span class="st">"top"</span>)</span></code><button title="Copiar al portapapeles" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
<div class="cell-output-display">
<p><img src="matching_files/figure-html/unnamed-chunk-8-1.png" class="img-fluid" width="576"></p>
</div>
</div>
<p>En esta figura lo que estamos viendo es que la asignaci√≥n a los grupos depende fuertemente del <em>outcome</em> ya que podemos ver que los del grupo control tienden a tener <em>outcomes</em> m√°s altos tanto observado como contraf√°ctico. O sea, no se cumple la independencia (<span class="math inline">\(D \perp (Y_0,Y_1)\)</span>). Ke sad bro üôç. Ahora, ¬øQu√© pasa si vemos esto mismo pero para cada regi√≥n?</p>
<div class="cell">
<details>
<summary>Ver el c√≥digo</summary>
<div class="sourceCode cell-code" id="cb7"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb7-1"><a href="#cb7-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Independencia condicional a la regi√≥n</span></span>
<span id="cb7-2"><a href="#cb7-2" aria-hidden="true" tabindex="-1"></a><span class="fu">ggplot</span>(customers_4_plot) <span class="sc">+</span></span>
<span id="cb7-3"><a href="#cb7-3" aria-hidden="true" tabindex="-1"></a>  <span class="fu">aes</span>(potential_outcome, value, <span class="at">colour =</span> tratamiento) <span class="sc">+</span></span>
<span id="cb7-4"><a href="#cb7-4" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_boxplot</span>() <span class="sc">+</span></span>
<span id="cb7-5"><a href="#cb7-5" aria-hidden="true" tabindex="-1"></a>  <span class="fu">facet_wrap</span>(<span class="sc">~</span>region) <span class="sc">+</span></span>
<span id="cb7-6"><a href="#cb7-6" aria-hidden="true" tabindex="-1"></a>  <span class="fu">labs</span>(<span class="at">x =</span> <span class="st">"Potential Outcome"</span>,</span>
<span id="cb7-7"><a href="#cb7-7" aria-hidden="true" tabindex="-1"></a>       <span class="at">y =</span> <span class="st">"Ventas por mes por cliente"</span>,</span>
<span id="cb7-8"><a href="#cb7-8" aria-hidden="true" tabindex="-1"></a>       <span class="at">colour =</span> <span class="st">"Treatment status"</span>,) <span class="sc">+</span></span>
<span id="cb7-9"><a href="#cb7-9" aria-hidden="true" tabindex="-1"></a>  <span class="fu">scale_color_brewer</span>(<span class="at">palette =</span> <span class="st">"Dark2"</span>) <span class="sc">+</span></span>
<span id="cb7-10"><a href="#cb7-10" aria-hidden="true" tabindex="-1"></a>  <span class="fu">theme_minimal</span>() <span class="sc">+</span></span>
<span id="cb7-11"><a href="#cb7-11" aria-hidden="true" tabindex="-1"></a>  <span class="fu">labs</span>(<span class="at">color =</span> <span class="cn">NULL</span>) <span class="sc">+</span></span>
<span id="cb7-12"><a href="#cb7-12" aria-hidden="true" tabindex="-1"></a>  <span class="fu">theme</span>(<span class="at">legend.position =</span> <span class="st">"top"</span>)</span>
<span id="cb7-13"><a href="#cb7-13" aria-hidden="true" tabindex="-1"></a>  </span></code><button title="Copiar al portapapeles" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
<div class="cell-output-display">
<p><img src="matching_files/figure-html/unnamed-chunk-9-1.png" class="img-fluid" width="576"></p>
</div>
</div>
<p><em>Et voil√°</em>, ac√° la cosa cambia. Que significa esto, que si bien el problema no tiene independencia, s√≠ podemos obtener la independencia condicional controlando por regi√≥n (<span class="math inline">\(D \perp (Y_0,Y_1) | Grupo\)</span>).</p>
<p>Todo esto es muy lindo, pero que pasa si en lugar de tener grupos tenemos que esta dependencia en la asignaci√≥n depende de una variable continua o, peor a√∫n, de varias. Tranquilos amigos, <em>matching</em> es el camino.</p>
</section>
</section>
<section id="matching" class="level2 page-columns page-full" data-number="6.2">
<h2 data-number="6.2" class="anchored" data-anchor-id="matching"><span class="header-section-number">6.2</span> <em>Matching</em></h2>
<p>Una forma alternativa de lidiar con la independencia condicional y el cierre de backdoors es el <strong>matching</strong>. La idea central es f√°cil: en vez de comparar el promedio de las unidades tratadas con el promedio de todas las unidades no tratadas, buscamos <strong>comparar cada unidad tratada con una unidad no tratada que se le parezca lo m√°s posible</strong> en funci√≥n de ciertas caracter√≠sticas observables (como la edad, la regi√≥n, los ingresos, etc.) que sean confusoras de nuestra relaci√≥n causal.</p>
<p>Entonces, con matching, en lugar de usar el promedio del grupo control como contrafactual, usamos un individuo que se parezca al que fue tratado.</p>
<p>Esto nos permite construir un estimador que sea m√°s cre√≠ble. Es intuitivo: <strong>si queremos estimar el efecto de un curso sobre los ingresos, tiene m√°s sentido comparar a una persona de 25 a√±os que hizo el programa con otra tambi√©n de 25 a√±os que no lo hizo, en lugar de con el promedio de todas las personas que no lo hicieron</strong>. De esta manera, el matching busca que cada comparaci√≥n sea m√°s consistente, emparejando unidades comparables.</p>
<p>Para esto, vamos a poder usar <em>exact matching</em> o <em>approximate matching</em>, dependiendo de cada caso.</p>
<p>Pensemos en un caso simple en el que tenemos s√≥lo una confusora observable <span class="math inline">\(X\)</span>.</p>
<p>Pero, ¬øpor qu√© antes compar√°bamos <em>cada unidad tratada con el promedio de todas las unidades no tratadas</em>?</p>
<p>Para entenderlo, recordemos que en el anterior enfoque cada unidad tratada compara su resultado con la media del control. Esto ser√≠a:</p>
<p><span class="math display">\[
\widehat{\delta}_i = Y_i - Y_{j(i)}
\]</span> donde <span class="math inline">\(Y_i\)</span> es el resultado observado de la unidad tratada <span class="math inline">\(i\)</span>, y <span class="math inline">\(Y_{j(i)}\)</span> es una unidad control <span class="math inline">\(j\)</span> que comparte el mismo valor de <span class="math inline">\(X\)</span> que la <span class="math inline">\(i\)</span> (representada por el √≠ndice <span class="math inline">\(j(i)\)</span>).</p>
<p>Pero luego, promediamos esas diferencias individuales, y llegamos al efecto total.</p>
<section id="exact-matching" class="level3 page-columns page-full" data-number="6.2.1">
<h3 data-number="6.2.1" class="anchored" data-anchor-id="exact-matching"><span class="header-section-number">6.2.1</span> <em>Exact Matching</em></h3>
<p>Hablamos de emparejar o <em>matchear</em> unidades tratadas con controles lo m√°s parecidos posibles. Lo primero que uno piensa es: Si quiero comparar el efecto de una pol√≠tica p√∫blica en las apuestas online y la edad es un confusor, es razonable comparar el monto que apost√≥ una persona de <span class="math inline">\(25\)</span> a√±os que estuvo expuesta a esa pol√≠tica con el monto que apost√≥ otra persona de <span class="math inline">\(25\)</span> a√±os que no estuvo expuesta. Cuando buscamos una unidad control que tenga exactamente el mismo nivel de la variable confusora hablamos de <em>exact matching</em>. Entonces, el <em>exact matching</em> consiste en emparejar unidades tratadas y no tratadas que compartan exactamente los mismos valores de ciertas covariables, supongamos <span class="math inline">\(X\)</span>.</p>
<p>En este caso, podemos decir que el efecto en la unidad tratada <span class="math inline">\(i\)</span> es la diferencia entre su resultado observado <span class="math inline">\(Y_i\)</span> y el resultado contrafactual de la unidad control <span class="math inline">\(Y_{j(i)}\)</span> que comparte el mismo valor de <span class="math inline">\(X_i\)</span>:</p>
<p><span class="math display">\[
\widehat{\delta}_i = Y_i(D_i=1) - Y_{j(i)}
\]</span> Entonces, podr√≠amos decir que el efecto promedio de las unidades tratadas [^ATT] ser√≠a lo siguiente:</p>
<p>[^ATT] Que se llama <strong>ATT</strong>, ¬øse acuerdan?</p>
<p><span class="math display">\[
\widehat{\delta}_{ATT} = \dfrac{1}{N_T} \sum_{i=1}^{N_T}(Y_i(D_i=1) - Y_{j(i)})
\]</span></p>
<p>Donde <span class="math inline">\(N_T\)</span> es el n√∫mero de unidades tratadas e <span class="math inline">\(Y_{j(i)}\)</span> es el resultado de la unidad control que comparte el mismo valor de <span class="math inline">\(X_i\)</span> que la unidad tratada <span class="math inline">\(i\)</span>.</p>
<p>Hasta ac√° muy lindo, pero la cosa no va a estar linda por mucho tiempo. Por ejemplo, una pregunta que alguien puede tener es: ¬øY si tenemos m√°s de un control de <span class="math inline">\(25\)</span> a√±os qu√© hacemos? ¬øNos quedamos con uno de los dos? Bueno, lo m√°s razonable que podemos hacer es tomar el promedio de los resultados de los controles que coinciden con la unidad tratada. Entonces, si tenemos <span class="math inline">\(m\)</span> controles que comparten el mismo valor de <span class="math inline">\(X_i\)</span>, el efecto individual del tratado <span class="math inline">\(i\)</span> ser√≠a:</p>
<p><span class="math display">\[
\widehat{\delta}_i = Y_i(D_i=1) - \sum_{m=1}^{m_i} \dfrac{1}{m_i} Y_{jm}
\]</span></p>
<p>Entonces, el <strong>ATT</strong> con exact matching podemos decir que tiene esta forma:</p>
<p><span id="eq-att_estim"><span class="math display">\[
\widehat{\delta}_{ATT} = \dfrac{1}{N_T} \sum_{i=1}^{N_T} \left( Y_i(D_i=1) - \sum_{m=1}^{m_i} \dfrac{1}{m_i} Y_{jm} \right)
\tag{6.1}\]</span></span></p>
<p>donde <span class="math inline">\(m_i\)</span> es el n√∫mero de controles que comparten el mismo valor de <span class="math inline">\(X_i\)</span> que la unidad tratada <span class="math inline">\(i\)</span>.</p>
<p>¬øSe puede calcular el <strong>ATE</strong>? Vamos a ver brevemente que s√≠, pero tambi√©n los problemas que ello conlleva.</p>
<p>Miremos un ejemplo y veamos c√≥mo se calculan estas cosas. Vamos a usar los datos de un programa de capacitaci√≥n que se realiz√≥ en una empresa ficticia. En este caso, lo que queremos no es otra cosa que estimar el efecto de una capacitaci√≥n laboral en el ingreso de los empleados. Para eso, tenemos la edad del empleado, si particip√≥ o no en el programa de capacitaci√≥n y su salario. Veamos unos datos de ejemplo.</p>
<div class="cell">
<details>
<summary>Ver el c√≥digo</summary>
<div class="sourceCode cell-code" id="cb8"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb8-1"><a href="#cb8-1" aria-hidden="true" tabindex="-1"></a>trainees_df <span class="ot">&lt;-</span> <span class="fu">read_csv</span>(<span class="st">"https://github.com/matheusfacure/python-causality-handbook/raw/master/causal-inference-for-the-brave-and-true/data/trainees.csv"</span>,</span>
<span id="cb8-2"><a href="#cb8-2" aria-hidden="true" tabindex="-1"></a>                        <span class="at">show_col_types=</span><span class="cn">FALSE</span>) <span class="sc">%&gt;%</span> </span>
<span id="cb8-3"><a href="#cb8-3" aria-hidden="true" tabindex="-1"></a>  <span class="fu">rename</span>(Capacitaci√≥n <span class="ot">=</span> trainees,</span>
<span id="cb8-4"><a href="#cb8-4" aria-hidden="true" tabindex="-1"></a>         <span class="at">Edad =</span> age,</span>
<span id="cb8-5"><a href="#cb8-5" aria-hidden="true" tabindex="-1"></a>         <span class="at">Unidad =</span> unit,</span>
<span id="cb8-6"><a href="#cb8-6" aria-hidden="true" tabindex="-1"></a>         <span class="at">Salario =</span> earnings)</span>
<span id="cb8-7"><a href="#cb8-7" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb8-8"><a href="#cb8-8" aria-hidden="true" tabindex="-1"></a>trainees_df <span class="sc">%&gt;%</span></span>
<span id="cb8-9"><a href="#cb8-9" aria-hidden="true" tabindex="-1"></a>  <span class="fu">mutate</span>(Capacitaci√≥n <span class="ot">=</span> <span class="fu">factor</span>(Capacitaci√≥n,</span>
<span id="cb8-10"><a href="#cb8-10" aria-hidden="true" tabindex="-1"></a>                               <span class="at">levels =</span> <span class="fu">c</span>(<span class="dv">0</span>, <span class="dv">1</span>),</span>
<span id="cb8-11"><a href="#cb8-11" aria-hidden="true" tabindex="-1"></a>                               <span class="at">labels =</span> <span class="fu">c</span>(<span class="st">"S√≠"</span>, <span class="st">"No"</span>))) <span class="sc">%&gt;%</span></span>
<span id="cb8-12"><a href="#cb8-12" aria-hidden="true" tabindex="-1"></a>  <span class="fu">sample_n</span>(<span class="dv">5</span>) <span class="sc">%&gt;%</span></span>
<span id="cb8-13"><a href="#cb8-13" aria-hidden="true" tabindex="-1"></a>  gt<span class="sc">::</span><span class="fu">gt</span>() <span class="sc">%&gt;%</span></span>
<span id="cb8-14"><a href="#cb8-14" aria-hidden="true" tabindex="-1"></a>  gt<span class="sc">::</span><span class="fu">tab_header</span>(</span>
<span id="cb8-15"><a href="#cb8-15" aria-hidden="true" tabindex="-1"></a>    <span class="at">title =</span> <span class="st">"Datos de participantes en un programa de capacitaci√≥n (5 filas al azar)"</span></span>
<span id="cb8-16"><a href="#cb8-16" aria-hidden="true" tabindex="-1"></a>  )</span></code><button title="Copiar al portapapeles" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
<div class="cell-output-display">

<div id="yyjzorrbsx" style="padding-left:0px;padding-right:0px;padding-top:10px;padding-bottom:10px;overflow-x:auto;overflow-y:auto;width:auto;height:auto;">
<style>#yyjzorrbsx table {
  font-family: system-ui, 'Segoe UI', Roboto, Helvetica, Arial, sans-serif, 'Apple Color Emoji', 'Segoe UI Emoji', 'Segoe UI Symbol', 'Noto Color Emoji';
  -webkit-font-smoothing: antialiased;
  -moz-osx-font-smoothing: grayscale;
}

#yyjzorrbsx thead, #yyjzorrbsx tbody, #yyjzorrbsx tfoot, #yyjzorrbsx tr, #yyjzorrbsx td, #yyjzorrbsx th {
  border-style: none;
}

#yyjzorrbsx p {
  margin: 0;
  padding: 0;
}

#yyjzorrbsx .gt_table {
  display: table;
  border-collapse: collapse;
  line-height: normal;
  margin-left: auto;
  margin-right: auto;
  color: #333333;
  font-size: 16px;
  font-weight: normal;
  font-style: normal;
  background-color: #FFFFFF;
  width: auto;
  border-top-style: solid;
  border-top-width: 2px;
  border-top-color: #A8A8A8;
  border-right-style: none;
  border-right-width: 2px;
  border-right-color: #D3D3D3;
  border-bottom-style: solid;
  border-bottom-width: 2px;
  border-bottom-color: #A8A8A8;
  border-left-style: none;
  border-left-width: 2px;
  border-left-color: #D3D3D3;
}

#yyjzorrbsx .gt_caption {
  padding-top: 4px;
  padding-bottom: 4px;
}

#yyjzorrbsx .gt_title {
  color: #333333;
  font-size: 125%;
  font-weight: initial;
  padding-top: 4px;
  padding-bottom: 4px;
  padding-left: 5px;
  padding-right: 5px;
  border-bottom-color: #FFFFFF;
  border-bottom-width: 0;
}

#yyjzorrbsx .gt_subtitle {
  color: #333333;
  font-size: 85%;
  font-weight: initial;
  padding-top: 3px;
  padding-bottom: 5px;
  padding-left: 5px;
  padding-right: 5px;
  border-top-color: #FFFFFF;
  border-top-width: 0;
}

#yyjzorrbsx .gt_heading {
  background-color: #FFFFFF;
  text-align: center;
  border-bottom-color: #FFFFFF;
  border-left-style: none;
  border-left-width: 1px;
  border-left-color: #D3D3D3;
  border-right-style: none;
  border-right-width: 1px;
  border-right-color: #D3D3D3;
}

#yyjzorrbsx .gt_bottom_border {
  border-bottom-style: solid;
  border-bottom-width: 2px;
  border-bottom-color: #D3D3D3;
}

#yyjzorrbsx .gt_col_headings {
  border-top-style: solid;
  border-top-width: 2px;
  border-top-color: #D3D3D3;
  border-bottom-style: solid;
  border-bottom-width: 2px;
  border-bottom-color: #D3D3D3;
  border-left-style: none;
  border-left-width: 1px;
  border-left-color: #D3D3D3;
  border-right-style: none;
  border-right-width: 1px;
  border-right-color: #D3D3D3;
}

#yyjzorrbsx .gt_col_heading {
  color: #333333;
  background-color: #FFFFFF;
  font-size: 100%;
  font-weight: normal;
  text-transform: inherit;
  border-left-style: none;
  border-left-width: 1px;
  border-left-color: #D3D3D3;
  border-right-style: none;
  border-right-width: 1px;
  border-right-color: #D3D3D3;
  vertical-align: bottom;
  padding-top: 5px;
  padding-bottom: 6px;
  padding-left: 5px;
  padding-right: 5px;
  overflow-x: hidden;
}

#yyjzorrbsx .gt_column_spanner_outer {
  color: #333333;
  background-color: #FFFFFF;
  font-size: 100%;
  font-weight: normal;
  text-transform: inherit;
  padding-top: 0;
  padding-bottom: 0;
  padding-left: 4px;
  padding-right: 4px;
}

#yyjzorrbsx .gt_column_spanner_outer:first-child {
  padding-left: 0;
}

#yyjzorrbsx .gt_column_spanner_outer:last-child {
  padding-right: 0;
}

#yyjzorrbsx .gt_column_spanner {
  border-bottom-style: solid;
  border-bottom-width: 2px;
  border-bottom-color: #D3D3D3;
  vertical-align: bottom;
  padding-top: 5px;
  padding-bottom: 5px;
  overflow-x: hidden;
  display: inline-block;
  width: 100%;
}

#yyjzorrbsx .gt_spanner_row {
  border-bottom-style: hidden;
}

#yyjzorrbsx .gt_group_heading {
  padding-top: 8px;
  padding-bottom: 8px;
  padding-left: 5px;
  padding-right: 5px;
  color: #333333;
  background-color: #FFFFFF;
  font-size: 100%;
  font-weight: initial;
  text-transform: inherit;
  border-top-style: solid;
  border-top-width: 2px;
  border-top-color: #D3D3D3;
  border-bottom-style: solid;
  border-bottom-width: 2px;
  border-bottom-color: #D3D3D3;
  border-left-style: none;
  border-left-width: 1px;
  border-left-color: #D3D3D3;
  border-right-style: none;
  border-right-width: 1px;
  border-right-color: #D3D3D3;
  vertical-align: middle;
  text-align: left;
}

#yyjzorrbsx .gt_empty_group_heading {
  padding: 0.5px;
  color: #333333;
  background-color: #FFFFFF;
  font-size: 100%;
  font-weight: initial;
  border-top-style: solid;
  border-top-width: 2px;
  border-top-color: #D3D3D3;
  border-bottom-style: solid;
  border-bottom-width: 2px;
  border-bottom-color: #D3D3D3;
  vertical-align: middle;
}

#yyjzorrbsx .gt_from_md > :first-child {
  margin-top: 0;
}

#yyjzorrbsx .gt_from_md > :last-child {
  margin-bottom: 0;
}

#yyjzorrbsx .gt_row {
  padding-top: 8px;
  padding-bottom: 8px;
  padding-left: 5px;
  padding-right: 5px;
  margin: 10px;
  border-top-style: solid;
  border-top-width: 1px;
  border-top-color: #D3D3D3;
  border-left-style: none;
  border-left-width: 1px;
  border-left-color: #D3D3D3;
  border-right-style: none;
  border-right-width: 1px;
  border-right-color: #D3D3D3;
  vertical-align: middle;
  overflow-x: hidden;
}

#yyjzorrbsx .gt_stub {
  color: #333333;
  background-color: #FFFFFF;
  font-size: 100%;
  font-weight: initial;
  text-transform: inherit;
  border-right-style: solid;
  border-right-width: 2px;
  border-right-color: #D3D3D3;
  padding-left: 5px;
  padding-right: 5px;
}

#yyjzorrbsx .gt_stub_row_group {
  color: #333333;
  background-color: #FFFFFF;
  font-size: 100%;
  font-weight: initial;
  text-transform: inherit;
  border-right-style: solid;
  border-right-width: 2px;
  border-right-color: #D3D3D3;
  padding-left: 5px;
  padding-right: 5px;
  vertical-align: top;
}

#yyjzorrbsx .gt_row_group_first td {
  border-top-width: 2px;
}

#yyjzorrbsx .gt_row_group_first th {
  border-top-width: 2px;
}

#yyjzorrbsx .gt_summary_row {
  color: #333333;
  background-color: #FFFFFF;
  text-transform: inherit;
  padding-top: 8px;
  padding-bottom: 8px;
  padding-left: 5px;
  padding-right: 5px;
}

#yyjzorrbsx .gt_first_summary_row {
  border-top-style: solid;
  border-top-color: #D3D3D3;
}

#yyjzorrbsx .gt_first_summary_row.thick {
  border-top-width: 2px;
}

#yyjzorrbsx .gt_last_summary_row {
  padding-top: 8px;
  padding-bottom: 8px;
  padding-left: 5px;
  padding-right: 5px;
  border-bottom-style: solid;
  border-bottom-width: 2px;
  border-bottom-color: #D3D3D3;
}

#yyjzorrbsx .gt_grand_summary_row {
  color: #333333;
  background-color: #FFFFFF;
  text-transform: inherit;
  padding-top: 8px;
  padding-bottom: 8px;
  padding-left: 5px;
  padding-right: 5px;
}

#yyjzorrbsx .gt_first_grand_summary_row {
  padding-top: 8px;
  padding-bottom: 8px;
  padding-left: 5px;
  padding-right: 5px;
  border-top-style: double;
  border-top-width: 6px;
  border-top-color: #D3D3D3;
}

#yyjzorrbsx .gt_last_grand_summary_row_top {
  padding-top: 8px;
  padding-bottom: 8px;
  padding-left: 5px;
  padding-right: 5px;
  border-bottom-style: double;
  border-bottom-width: 6px;
  border-bottom-color: #D3D3D3;
}

#yyjzorrbsx .gt_striped {
  background-color: rgba(128, 128, 128, 0.05);
}

#yyjzorrbsx .gt_table_body {
  border-top-style: solid;
  border-top-width: 2px;
  border-top-color: #D3D3D3;
  border-bottom-style: solid;
  border-bottom-width: 2px;
  border-bottom-color: #D3D3D3;
}

#yyjzorrbsx .gt_footnotes {
  color: #333333;
  background-color: #FFFFFF;
  border-bottom-style: none;
  border-bottom-width: 2px;
  border-bottom-color: #D3D3D3;
  border-left-style: none;
  border-left-width: 2px;
  border-left-color: #D3D3D3;
  border-right-style: none;
  border-right-width: 2px;
  border-right-color: #D3D3D3;
}

#yyjzorrbsx .gt_footnote {
  margin: 0px;
  font-size: 90%;
  padding-top: 4px;
  padding-bottom: 4px;
  padding-left: 5px;
  padding-right: 5px;
}

#yyjzorrbsx .gt_sourcenotes {
  color: #333333;
  background-color: #FFFFFF;
  border-bottom-style: none;
  border-bottom-width: 2px;
  border-bottom-color: #D3D3D3;
  border-left-style: none;
  border-left-width: 2px;
  border-left-color: #D3D3D3;
  border-right-style: none;
  border-right-width: 2px;
  border-right-color: #D3D3D3;
}

#yyjzorrbsx .gt_sourcenote {
  font-size: 90%;
  padding-top: 4px;
  padding-bottom: 4px;
  padding-left: 5px;
  padding-right: 5px;
}

#yyjzorrbsx .gt_left {
  text-align: left;
}

#yyjzorrbsx .gt_center {
  text-align: center;
}

#yyjzorrbsx .gt_right {
  text-align: right;
  font-variant-numeric: tabular-nums;
}

#yyjzorrbsx .gt_font_normal {
  font-weight: normal;
}

#yyjzorrbsx .gt_font_bold {
  font-weight: bold;
}

#yyjzorrbsx .gt_font_italic {
  font-style: italic;
}

#yyjzorrbsx .gt_super {
  font-size: 65%;
}

#yyjzorrbsx .gt_footnote_marks {
  font-size: 75%;
  vertical-align: 0.4em;
  position: initial;
}

#yyjzorrbsx .gt_asterisk {
  font-size: 100%;
  vertical-align: 0;
}

#yyjzorrbsx .gt_indent_1 {
  text-indent: 5px;
}

#yyjzorrbsx .gt_indent_2 {
  text-indent: 10px;
}

#yyjzorrbsx .gt_indent_3 {
  text-indent: 15px;
}

#yyjzorrbsx .gt_indent_4 {
  text-indent: 20px;
}

#yyjzorrbsx .gt_indent_5 {
  text-indent: 25px;
}

#yyjzorrbsx .katex-display {
  display: inline-flex !important;
  margin-bottom: 0.75em !important;
}

#yyjzorrbsx div.Reactable > div.rt-table > div.rt-thead > div.rt-tr.rt-tr-group-header > div.rt-th-group:after {
  height: 0px !important;
}
</style>
<table class="gt_table" data-quarto-disable-processing="false" data-quarto-bootstrap="false">
  <thead>
    <tr class="gt_heading">
      <td colspan="4" class="gt_heading gt_title gt_font_normal gt_bottom_border" style="">Datos de participantes en un programa de capacitaci√≥n (5 filas al azar)</td>
    </tr>
    
    <tr class="gt_col_headings">
      <th class="gt_col_heading gt_columns_bottom_border gt_right" rowspan="1" colspan="1" scope="col" id="Unidad">Unidad</th>
      <th class="gt_col_heading gt_columns_bottom_border gt_center" rowspan="1" colspan="1" scope="col" id="Capacitaci√≥n">Capacitaci√≥n</th>
      <th class="gt_col_heading gt_columns_bottom_border gt_right" rowspan="1" colspan="1" scope="col" id="Edad">Edad</th>
      <th class="gt_col_heading gt_columns_bottom_border gt_right" rowspan="1" colspan="1" scope="col" id="Salario">Salario</th>
    </tr>
  </thead>
  <tbody class="gt_table_body">
    <tr><td headers="Unidad" class="gt_row gt_right">14</td>
<td headers="Capacitaci√≥n" class="gt_row gt_center">No</td>
<td headers="Edad" class="gt_row gt_right">24</td>
<td headers="Salario" class="gt_row gt_right">19700</td></tr>
    <tr><td headers="Unidad" class="gt_row gt_right">38</td>
<td headers="Capacitaci√≥n" class="gt_row gt_center">S√≠</td>
<td headers="Edad" class="gt_row gt_right">35</td>
<td headers="Salario" class="gt_row gt_right">30200</td></tr>
    <tr><td headers="Unidad" class="gt_row gt_right">7</td>
<td headers="Capacitaci√≥n" class="gt_row gt_center">No</td>
<td headers="Edad" class="gt_row gt_right">33</td>
<td headers="Salario" class="gt_row gt_right">21900</td></tr>
    <tr><td headers="Unidad" class="gt_row gt_right">25</td>
<td headers="Capacitaci√≥n" class="gt_row gt_center">S√≠</td>
<td headers="Edad" class="gt_row gt_right">48</td>
<td headers="Salario" class="gt_row gt_right">29800</td></tr>
    <tr><td headers="Unidad" class="gt_row gt_right">39</td>
<td headers="Capacitaci√≥n" class="gt_row gt_center">S√≠</td>
<td headers="Edad" class="gt_row gt_right">32</td>
<td headers="Salario" class="gt_row gt_right">17800</td></tr>
  </tbody>
  
  
</table>
</div>
</div>
</div>
<p>Si uno no hubiera le√≠do nada de este libro, se sentir√≠a tentado a calcular la diferencia entre las medias entre los que participaron y los que no. Pero, como ya sabemos, eso no es correcto porque <strong>la asignaci√≥n al tratamiento no es aleatoria</strong>. De hecho, podemos calcular ese efecto y da $-4297. Pero, ¬øqu√© pasa si vemos la relaci√≥n entre la edad, el salario y la capacitaci√≥n? ¬øPodemos ver si hay alg√∫n confusor?</p>
<div class="cell">
<details>
<summary>Ver el c√≥digo</summary>
<div class="sourceCode cell-code" id="cb9"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb9-1"><a href="#cb9-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Vemos las distribuciones marginales</span></span>
<span id="cb9-2"><a href="#cb9-2" aria-hidden="true" tabindex="-1"></a>trainees_df <span class="sc">%&gt;%</span></span>
<span id="cb9-3"><a href="#cb9-3" aria-hidden="true" tabindex="-1"></a>  <span class="fu">mutate</span>(Capacitaci√≥n <span class="ot">=</span> <span class="fu">factor</span>(Capacitaci√≥n,</span>
<span id="cb9-4"><a href="#cb9-4" aria-hidden="true" tabindex="-1"></a>                               <span class="at">levels =</span> <span class="fu">c</span>(<span class="dv">0</span>, <span class="dv">1</span>),</span>
<span id="cb9-5"><a href="#cb9-5" aria-hidden="true" tabindex="-1"></a>                               <span class="at">labels =</span> <span class="fu">c</span>(<span class="st">"S√≠"</span>, <span class="st">"No"</span>))) <span class="sc">%&gt;%</span></span>
<span id="cb9-6"><a href="#cb9-6" aria-hidden="true" tabindex="-1"></a>  <span class="fu">ggplot</span>() <span class="sc">+</span></span>
<span id="cb9-7"><a href="#cb9-7" aria-hidden="true" tabindex="-1"></a>  <span class="fu">aes</span>(Edad, Salario, <span class="at">color =</span> Capacitaci√≥n) <span class="sc">+</span></span>
<span id="cb9-8"><a href="#cb9-8" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_jitter</span>() <span class="sc">+</span></span>
<span id="cb9-9"><a href="#cb9-9" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_xsidedensity</span>(</span>
<span id="cb9-10"><a href="#cb9-10" aria-hidden="true" tabindex="-1"></a>    <span class="fu">aes</span>(</span>
<span id="cb9-11"><a href="#cb9-11" aria-hidden="true" tabindex="-1"></a>      <span class="at">y =</span> <span class="fu">after_stat</span>(density),</span>
<span id="cb9-12"><a href="#cb9-12" aria-hidden="true" tabindex="-1"></a>      <span class="at">fill =</span> Capacitaci√≥n</span>
<span id="cb9-13"><a href="#cb9-13" aria-hidden="true" tabindex="-1"></a>    ),</span>
<span id="cb9-14"><a href="#cb9-14" aria-hidden="true" tabindex="-1"></a>    <span class="at">alpha =</span> <span class="fl">0.5</span>,</span>
<span id="cb9-15"><a href="#cb9-15" aria-hidden="true" tabindex="-1"></a>    <span class="at">size =</span> <span class="dv">1</span>,</span>
<span id="cb9-16"><a href="#cb9-16" aria-hidden="true" tabindex="-1"></a>    <span class="at">position =</span> <span class="st">"identity"</span></span>
<span id="cb9-17"><a href="#cb9-17" aria-hidden="true" tabindex="-1"></a>  ) <span class="sc">+</span></span>
<span id="cb9-18"><a href="#cb9-18" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_ysidedensity</span>(</span>
<span id="cb9-19"><a href="#cb9-19" aria-hidden="true" tabindex="-1"></a>    <span class="fu">aes</span>(</span>
<span id="cb9-20"><a href="#cb9-20" aria-hidden="true" tabindex="-1"></a>      <span class="at">x =</span> <span class="fu">after_stat</span>(density),</span>
<span id="cb9-21"><a href="#cb9-21" aria-hidden="true" tabindex="-1"></a>      <span class="at">fill =</span> Capacitaci√≥n</span>
<span id="cb9-22"><a href="#cb9-22" aria-hidden="true" tabindex="-1"></a>    ),</span>
<span id="cb9-23"><a href="#cb9-23" aria-hidden="true" tabindex="-1"></a>    <span class="at">alpha =</span> <span class="fl">0.5</span>,</span>
<span id="cb9-24"><a href="#cb9-24" aria-hidden="true" tabindex="-1"></a>    <span class="at">size =</span> <span class="dv">1</span>,</span>
<span id="cb9-25"><a href="#cb9-25" aria-hidden="true" tabindex="-1"></a>    <span class="at">position =</span> <span class="st">"identity"</span></span>
<span id="cb9-26"><a href="#cb9-26" aria-hidden="true" tabindex="-1"></a>  ) <span class="sc">+</span> </span>
<span id="cb9-27"><a href="#cb9-27" aria-hidden="true" tabindex="-1"></a>  <span class="fu">theme</span>(</span>
<span id="cb9-28"><a href="#cb9-28" aria-hidden="true" tabindex="-1"></a>    <span class="at">ggside.panel.scale.x =</span> <span class="fl">0.3</span>,</span>
<span id="cb9-29"><a href="#cb9-29" aria-hidden="true" tabindex="-1"></a>    <span class="at">ggside.panel.scale.y =</span> <span class="fl">0.3</span>,</span>
<span id="cb9-30"><a href="#cb9-30" aria-hidden="true" tabindex="-1"></a>    <span class="at">ggside.axis.text.y =</span> <span class="fu">element_blank</span>(),</span>
<span id="cb9-31"><a href="#cb9-31" aria-hidden="true" tabindex="-1"></a>    <span class="at">ggside.axis.ticks.y =</span> <span class="fu">element_blank</span>(),</span>
<span id="cb9-32"><a href="#cb9-32" aria-hidden="true" tabindex="-1"></a>    <span class="at">ggside.axis.text.x =</span> <span class="fu">element_blank</span>(),</span>
<span id="cb9-33"><a href="#cb9-33" aria-hidden="true" tabindex="-1"></a>    <span class="at">ggside.axis.ticks.x =</span> <span class="fu">element_blank</span>()</span>
<span id="cb9-34"><a href="#cb9-34" aria-hidden="true" tabindex="-1"></a>  ) <span class="sc">+</span></span>
<span id="cb9-35"><a href="#cb9-35" aria-hidden="true" tabindex="-1"></a>  <span class="fu">scale_color_brewer</span>(<span class="at">palette =</span> <span class="st">"Dark2"</span>) <span class="sc">+</span></span>
<span id="cb9-36"><a href="#cb9-36" aria-hidden="true" tabindex="-1"></a>  <span class="fu">scale_fill_brewer</span>(<span class="at">palette =</span> <span class="st">"Dark2"</span>) <span class="sc">+</span></span>
<span id="cb9-37"><a href="#cb9-37" aria-hidden="true" tabindex="-1"></a>  <span class="fu">theme_minimal</span>() <span class="sc">+</span></span>
<span id="cb9-38"><a href="#cb9-38" aria-hidden="true" tabindex="-1"></a>  <span class="fu">labs</span>(<span class="at">color =</span> <span class="st">"Capacitaci√≥n"</span>, <span class="at">fill =</span> <span class="st">"Capacitaci√≥n"</span>) <span class="sc">+</span></span>
<span id="cb9-39"><a href="#cb9-39" aria-hidden="true" tabindex="-1"></a>  <span class="fu">theme</span>(<span class="at">legend.position =</span> <span class="st">"top"</span>)</span>
<span id="cb9-40"><a href="#cb9-40" aria-hidden="true" tabindex="-1"></a><span class="co">#&gt; Warning: `is.ggproto()` was deprecated in ggplot2 3.5.2.</span></span>
<span id="cb9-41"><a href="#cb9-41" aria-hidden="true" tabindex="-1"></a><span class="co">#&gt; ‚Ñπ Please use `is_ggproto()` instead.</span></span></code><button title="Copiar al portapapeles" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
<div class="cell-output-display">
<p><img src="matching_files/figure-html/unnamed-chunk-11-1.png" class="img-fluid" width="576"></p>
</div>
</div>
<p>Al parecer, la gente de m√°s edad (y que naturalemte tiene m√°s salario) tiende a estar mayormente en el grupo que recibi√≥ la capacitaci√≥n. Esto es una gran <strong>red flag</strong> metodol√≥gica, ¬øno?. Bueno, lo que parece sugerir es que la edad es un confusor en la relaci√≥n causal entre la capacitaci√≥n y el salario. Entonces, bajo la suposici√≥n casi rid√≠cula pero √∫til de que el √∫nico confusor en nuestro problema es la edad. Usemos <em>exact matching</em> para emparejar a los participantes tratados con controles que tengan la misma edad y estimemos el <strong>ATT</strong>.</p>
<div class="page-columns page-full"><p>Escribamos una funci√≥n a mano para calcular el <strong>ATT</strong><a href="#fn2" class="footnote-ref" id="fnref2" role="doc-noteref"><sup>2</sup></a>:</p><div class="no-row-height column-margin column-container"><li id="fn2"><p><sup>2</sup>&nbsp;B√°sicamente es una funci√≥n que busca los puntos iguales en la covariable, calcula el promedio, los efectos individuales y el promedio final. Es decir, lo que aparece en la <a href="#eq-att_estim">Ecuaci√≥n&nbsp;<span>6.1</span></a>.</p></li></div></div>
<div class="cell">
<details>
<summary>Ver el c√≥digo</summary>
<div class="sourceCode cell-code" id="cb10"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb10-1"><a href="#cb10-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Funci√≥n para estimar el ATT con matching ####</span></span>
<span id="cb10-2"><a href="#cb10-2" aria-hidden="true" tabindex="-1"></a><span class="co"># Extact Matching Estimator of the ATT</span></span>
<span id="cb10-3"><a href="#cb10-3" aria-hidden="true" tabindex="-1"></a>exact_matching_estimator_att <span class="ot">&lt;-</span> <span class="cf">function</span>(df, <span class="co">#dataframe</span></span>
<span id="cb10-4"><a href="#cb10-4" aria-hidden="true" tabindex="-1"></a>                                         outcome, <span class="co"># nombre de la variable outcome</span></span>
<span id="cb10-5"><a href="#cb10-5" aria-hidden="true" tabindex="-1"></a>                                         treatment, <span class="co"># nombre de la variable donde est√° el tratamiento</span></span>
<span id="cb10-6"><a href="#cb10-6" aria-hidden="true" tabindex="-1"></a>                                         covariates <span class="co"># string o vector de strings</span></span>
<span id="cb10-7"><a href="#cb10-7" aria-hidden="true" tabindex="-1"></a>) {</span>
<span id="cb10-8"><a href="#cb10-8" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb10-9"><a href="#cb10-9" aria-hidden="true" tabindex="-1"></a>  <span class="co"># Renombro la columna como outcome</span></span>
<span id="cb10-10"><a href="#cb10-10" aria-hidden="true" tabindex="-1"></a>  df <span class="ot">&lt;-</span> df <span class="sc">%&gt;%</span></span>
<span id="cb10-11"><a href="#cb10-11" aria-hidden="true" tabindex="-1"></a>    <span class="fu">rename</span>(<span class="at">outcome :=</span> {{ outcome }}) <span class="sc">%&gt;%</span> </span>
<span id="cb10-12"><a href="#cb10-12" aria-hidden="true" tabindex="-1"></a>    <span class="fu">mutate</span>(<span class="at">id =</span> <span class="dv">1</span><span class="sc">:</span><span class="fu">n</span>())</span>
<span id="cb10-13"><a href="#cb10-13" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb10-14"><a href="#cb10-14" aria-hidden="true" tabindex="-1"></a>  <span class="co"># Creo un dataset s√≥lo con las unidades tratadas</span></span>
<span id="cb10-15"><a href="#cb10-15" aria-hidden="true" tabindex="-1"></a>  treated_df <span class="ot">&lt;-</span> df <span class="sc">%&gt;%</span> </span>
<span id="cb10-16"><a href="#cb10-16" aria-hidden="true" tabindex="-1"></a>    <span class="fu">filter</span>({{ treatment }} <span class="sc">==</span> <span class="dv">1</span>)</span>
<span id="cb10-17"><a href="#cb10-17" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb10-18"><a href="#cb10-18" aria-hidden="true" tabindex="-1"></a>  <span class="co"># Creo un dataset s√≥lo con las unidades NO tratadas</span></span>
<span id="cb10-19"><a href="#cb10-19" aria-hidden="true" tabindex="-1"></a>  control_df <span class="ot">&lt;-</span> df <span class="sc">%&gt;%</span> </span>
<span id="cb10-20"><a href="#cb10-20" aria-hidden="true" tabindex="-1"></a>    <span class="fu">filter</span>({{ treatment }} <span class="sc">==</span> <span class="dv">0</span>)</span>
<span id="cb10-21"><a href="#cb10-21" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb10-22"><a href="#cb10-22" aria-hidden="true" tabindex="-1"></a>  <span class="co"># Matcheo las tratadas y no tratadas para iguales valores de las covariates</span></span>
<span id="cb10-23"><a href="#cb10-23" aria-hidden="true" tabindex="-1"></a>  treated_matched <span class="ot">&lt;-</span> treated_df <span class="sc">%&gt;%</span> </span>
<span id="cb10-24"><a href="#cb10-24" aria-hidden="true" tabindex="-1"></a>    <span class="fu">left_join</span>(control_df, <span class="at">by =</span> covariates,</span>
<span id="cb10-25"><a href="#cb10-25" aria-hidden="true" tabindex="-1"></a>              <span class="at">suffix =</span> <span class="fu">c</span>(<span class="st">"_i"</span>, <span class="st">"_j"</span>))</span>
<span id="cb10-26"><a href="#cb10-26" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb10-27"><a href="#cb10-27" aria-hidden="true" tabindex="-1"></a>  <span class="co"># El estimador</span></span>
<span id="cb10-28"><a href="#cb10-28" aria-hidden="true" tabindex="-1"></a>  estimate_att <span class="ot">&lt;-</span> </span>
<span id="cb10-29"><a href="#cb10-29" aria-hidden="true" tabindex="-1"></a>    treated_matched <span class="sc">%&gt;%</span> </span>
<span id="cb10-30"><a href="#cb10-30" aria-hidden="true" tabindex="-1"></a>    <span class="co"># Promedio si hay m√°s de un match</span></span>
<span id="cb10-31"><a href="#cb10-31" aria-hidden="true" tabindex="-1"></a>    <span class="fu">group_by</span>(id_i) <span class="sc">%&gt;%</span></span>
<span id="cb10-32"><a href="#cb10-32" aria-hidden="true" tabindex="-1"></a>    <span class="fu">summarise</span>(<span class="at">outcome_j =</span> <span class="fu">mean</span>(outcome_j),</span>
<span id="cb10-33"><a href="#cb10-33" aria-hidden="true" tabindex="-1"></a>              <span class="at">outcome_i =</span> <span class="fu">first</span>(outcome_i)) <span class="sc">%&gt;%</span></span>
<span id="cb10-34"><a href="#cb10-34" aria-hidden="true" tabindex="-1"></a>    <span class="co"># Calculo las diferencias de cada unidad con su match</span></span>
<span id="cb10-35"><a href="#cb10-35" aria-hidden="true" tabindex="-1"></a>    <span class="fu">mutate</span>(<span class="at">treat_effect =</span> outcome_i <span class="sc">-</span> outcome_j) <span class="sc">%&gt;%</span> </span>
<span id="cb10-36"><a href="#cb10-36" aria-hidden="true" tabindex="-1"></a>    <span class="co"># Promedio las diferencias</span></span>
<span id="cb10-37"><a href="#cb10-37" aria-hidden="true" tabindex="-1"></a>    <span class="fu">summarise</span>(<span class="at">estimate_att =</span> <span class="fu">mean</span>(treat_effect)) <span class="sc">%&gt;%</span> </span>
<span id="cb10-38"><a href="#cb10-38" aria-hidden="true" tabindex="-1"></a>    <span class="co"># Me quedo con la variable</span></span>
<span id="cb10-39"><a href="#cb10-39" aria-hidden="true" tabindex="-1"></a>    <span class="fu">pull</span>(estimate_att)</span>
<span id="cb10-40"><a href="#cb10-40" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb10-41"><a href="#cb10-41" aria-hidden="true" tabindex="-1"></a>  estimate_att</span>
<span id="cb10-42"><a href="#cb10-42" aria-hidden="true" tabindex="-1"></a>}</span></code><button title="Copiar al portapapeles" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
</div>
<p>Y ahora lo calculamos con el siguiente c√≥digo:</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb11"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb11-1"><a href="#cb11-1" aria-hidden="true" tabindex="-1"></a>ATT <span class="ot">&lt;-</span> </span>
<span id="cb11-2"><a href="#cb11-2" aria-hidden="true" tabindex="-1"></a>  <span class="fu">exact_matching_estimator_att</span>(</span>
<span id="cb11-3"><a href="#cb11-3" aria-hidden="true" tabindex="-1"></a>    trainees_df,</span>
<span id="cb11-4"><a href="#cb11-4" aria-hidden="true" tabindex="-1"></a>    <span class="at">outcome =</span> Salario,</span>
<span id="cb11-5"><a href="#cb11-5" aria-hidden="true" tabindex="-1"></a>    <span class="at">treatment =</span> Capacitaci√≥n,</span>
<span id="cb11-6"><a href="#cb11-6" aria-hidden="true" tabindex="-1"></a>    <span class="at">covariates =</span> <span class="st">"Edad"</span>)</span></code><button title="Copiar al portapapeles" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<div class="cell">
<details>
<summary>Ver el c√≥digo</summary>
<div class="sourceCode cell-code" id="cb12"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb12-1"><a href="#cb12-1" aria-hidden="true" tabindex="-1"></a><span class="fu">tibble</span>(M√©todo <span class="ot">=</span> <span class="fu">c</span>(<span class="st">"SDO"</span>, <span class="st">"Exact Matching"</span>),</span>
<span id="cb12-2"><a href="#cb12-2" aria-hidden="true" tabindex="-1"></a>       Estimaci√≥n <span class="ot">=</span> <span class="fu">c</span>(</span>
<span id="cb12-3"><a href="#cb12-3" aria-hidden="true" tabindex="-1"></a>         <span class="fu">round</span>(<span class="fu">mean</span>(trainees_df<span class="sc">$</span>Salario[trainees_df<span class="sc">$</span>Capacitaci√≥n<span class="sc">==</span><span class="dv">1</span>]) <span class="sc">-</span> </span>
<span id="cb12-4"><a href="#cb12-4" aria-hidden="true" tabindex="-1"></a>                 <span class="fu">mean</span>(trainees_df<span class="sc">$</span>Salario[trainees_df<span class="sc">$</span>Capacitaci√≥n<span class="sc">==</span><span class="dv">0</span>])),</span>
<span id="cb12-5"><a href="#cb12-5" aria-hidden="true" tabindex="-1"></a>         <span class="fu">round</span>(ATT, <span class="dv">2</span>))) <span class="sc">%&gt;%</span></span>
<span id="cb12-6"><a href="#cb12-6" aria-hidden="true" tabindex="-1"></a>  <span class="fu">gt</span>() <span class="sc">%&gt;%</span></span>
<span id="cb12-7"><a href="#cb12-7" aria-hidden="true" tabindex="-1"></a>  <span class="fu">tab_header</span>(</span>
<span id="cb12-8"><a href="#cb12-8" aria-hidden="true" tabindex="-1"></a>    <span class="at">title =</span> <span class="st">"Estimaci√≥n del efecto de la capacitaci√≥n"</span></span>
<span id="cb12-9"><a href="#cb12-9" aria-hidden="true" tabindex="-1"></a>  )</span></code><button title="Copiar al portapapeles" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
<div class="cell-output-display">

<div id="fkvchnkmyt" style="padding-left:0px;padding-right:0px;padding-top:10px;padding-bottom:10px;overflow-x:auto;overflow-y:auto;width:auto;height:auto;">
<style>#fkvchnkmyt table {
  font-family: system-ui, 'Segoe UI', Roboto, Helvetica, Arial, sans-serif, 'Apple Color Emoji', 'Segoe UI Emoji', 'Segoe UI Symbol', 'Noto Color Emoji';
  -webkit-font-smoothing: antialiased;
  -moz-osx-font-smoothing: grayscale;
}

#fkvchnkmyt thead, #fkvchnkmyt tbody, #fkvchnkmyt tfoot, #fkvchnkmyt tr, #fkvchnkmyt td, #fkvchnkmyt th {
  border-style: none;
}

#fkvchnkmyt p {
  margin: 0;
  padding: 0;
}

#fkvchnkmyt .gt_table {
  display: table;
  border-collapse: collapse;
  line-height: normal;
  margin-left: auto;
  margin-right: auto;
  color: #333333;
  font-size: 16px;
  font-weight: normal;
  font-style: normal;
  background-color: #FFFFFF;
  width: auto;
  border-top-style: solid;
  border-top-width: 2px;
  border-top-color: #A8A8A8;
  border-right-style: none;
  border-right-width: 2px;
  border-right-color: #D3D3D3;
  border-bottom-style: solid;
  border-bottom-width: 2px;
  border-bottom-color: #A8A8A8;
  border-left-style: none;
  border-left-width: 2px;
  border-left-color: #D3D3D3;
}

#fkvchnkmyt .gt_caption {
  padding-top: 4px;
  padding-bottom: 4px;
}

#fkvchnkmyt .gt_title {
  color: #333333;
  font-size: 125%;
  font-weight: initial;
  padding-top: 4px;
  padding-bottom: 4px;
  padding-left: 5px;
  padding-right: 5px;
  border-bottom-color: #FFFFFF;
  border-bottom-width: 0;
}

#fkvchnkmyt .gt_subtitle {
  color: #333333;
  font-size: 85%;
  font-weight: initial;
  padding-top: 3px;
  padding-bottom: 5px;
  padding-left: 5px;
  padding-right: 5px;
  border-top-color: #FFFFFF;
  border-top-width: 0;
}

#fkvchnkmyt .gt_heading {
  background-color: #FFFFFF;
  text-align: center;
  border-bottom-color: #FFFFFF;
  border-left-style: none;
  border-left-width: 1px;
  border-left-color: #D3D3D3;
  border-right-style: none;
  border-right-width: 1px;
  border-right-color: #D3D3D3;
}

#fkvchnkmyt .gt_bottom_border {
  border-bottom-style: solid;
  border-bottom-width: 2px;
  border-bottom-color: #D3D3D3;
}

#fkvchnkmyt .gt_col_headings {
  border-top-style: solid;
  border-top-width: 2px;
  border-top-color: #D3D3D3;
  border-bottom-style: solid;
  border-bottom-width: 2px;
  border-bottom-color: #D3D3D3;
  border-left-style: none;
  border-left-width: 1px;
  border-left-color: #D3D3D3;
  border-right-style: none;
  border-right-width: 1px;
  border-right-color: #D3D3D3;
}

#fkvchnkmyt .gt_col_heading {
  color: #333333;
  background-color: #FFFFFF;
  font-size: 100%;
  font-weight: normal;
  text-transform: inherit;
  border-left-style: none;
  border-left-width: 1px;
  border-left-color: #D3D3D3;
  border-right-style: none;
  border-right-width: 1px;
  border-right-color: #D3D3D3;
  vertical-align: bottom;
  padding-top: 5px;
  padding-bottom: 6px;
  padding-left: 5px;
  padding-right: 5px;
  overflow-x: hidden;
}

#fkvchnkmyt .gt_column_spanner_outer {
  color: #333333;
  background-color: #FFFFFF;
  font-size: 100%;
  font-weight: normal;
  text-transform: inherit;
  padding-top: 0;
  padding-bottom: 0;
  padding-left: 4px;
  padding-right: 4px;
}

#fkvchnkmyt .gt_column_spanner_outer:first-child {
  padding-left: 0;
}

#fkvchnkmyt .gt_column_spanner_outer:last-child {
  padding-right: 0;
}

#fkvchnkmyt .gt_column_spanner {
  border-bottom-style: solid;
  border-bottom-width: 2px;
  border-bottom-color: #D3D3D3;
  vertical-align: bottom;
  padding-top: 5px;
  padding-bottom: 5px;
  overflow-x: hidden;
  display: inline-block;
  width: 100%;
}

#fkvchnkmyt .gt_spanner_row {
  border-bottom-style: hidden;
}

#fkvchnkmyt .gt_group_heading {
  padding-top: 8px;
  padding-bottom: 8px;
  padding-left: 5px;
  padding-right: 5px;
  color: #333333;
  background-color: #FFFFFF;
  font-size: 100%;
  font-weight: initial;
  text-transform: inherit;
  border-top-style: solid;
  border-top-width: 2px;
  border-top-color: #D3D3D3;
  border-bottom-style: solid;
  border-bottom-width: 2px;
  border-bottom-color: #D3D3D3;
  border-left-style: none;
  border-left-width: 1px;
  border-left-color: #D3D3D3;
  border-right-style: none;
  border-right-width: 1px;
  border-right-color: #D3D3D3;
  vertical-align: middle;
  text-align: left;
}

#fkvchnkmyt .gt_empty_group_heading {
  padding: 0.5px;
  color: #333333;
  background-color: #FFFFFF;
  font-size: 100%;
  font-weight: initial;
  border-top-style: solid;
  border-top-width: 2px;
  border-top-color: #D3D3D3;
  border-bottom-style: solid;
  border-bottom-width: 2px;
  border-bottom-color: #D3D3D3;
  vertical-align: middle;
}

#fkvchnkmyt .gt_from_md > :first-child {
  margin-top: 0;
}

#fkvchnkmyt .gt_from_md > :last-child {
  margin-bottom: 0;
}

#fkvchnkmyt .gt_row {
  padding-top: 8px;
  padding-bottom: 8px;
  padding-left: 5px;
  padding-right: 5px;
  margin: 10px;
  border-top-style: solid;
  border-top-width: 1px;
  border-top-color: #D3D3D3;
  border-left-style: none;
  border-left-width: 1px;
  border-left-color: #D3D3D3;
  border-right-style: none;
  border-right-width: 1px;
  border-right-color: #D3D3D3;
  vertical-align: middle;
  overflow-x: hidden;
}

#fkvchnkmyt .gt_stub {
  color: #333333;
  background-color: #FFFFFF;
  font-size: 100%;
  font-weight: initial;
  text-transform: inherit;
  border-right-style: solid;
  border-right-width: 2px;
  border-right-color: #D3D3D3;
  padding-left: 5px;
  padding-right: 5px;
}

#fkvchnkmyt .gt_stub_row_group {
  color: #333333;
  background-color: #FFFFFF;
  font-size: 100%;
  font-weight: initial;
  text-transform: inherit;
  border-right-style: solid;
  border-right-width: 2px;
  border-right-color: #D3D3D3;
  padding-left: 5px;
  padding-right: 5px;
  vertical-align: top;
}

#fkvchnkmyt .gt_row_group_first td {
  border-top-width: 2px;
}

#fkvchnkmyt .gt_row_group_first th {
  border-top-width: 2px;
}

#fkvchnkmyt .gt_summary_row {
  color: #333333;
  background-color: #FFFFFF;
  text-transform: inherit;
  padding-top: 8px;
  padding-bottom: 8px;
  padding-left: 5px;
  padding-right: 5px;
}

#fkvchnkmyt .gt_first_summary_row {
  border-top-style: solid;
  border-top-color: #D3D3D3;
}

#fkvchnkmyt .gt_first_summary_row.thick {
  border-top-width: 2px;
}

#fkvchnkmyt .gt_last_summary_row {
  padding-top: 8px;
  padding-bottom: 8px;
  padding-left: 5px;
  padding-right: 5px;
  border-bottom-style: solid;
  border-bottom-width: 2px;
  border-bottom-color: #D3D3D3;
}

#fkvchnkmyt .gt_grand_summary_row {
  color: #333333;
  background-color: #FFFFFF;
  text-transform: inherit;
  padding-top: 8px;
  padding-bottom: 8px;
  padding-left: 5px;
  padding-right: 5px;
}

#fkvchnkmyt .gt_first_grand_summary_row {
  padding-top: 8px;
  padding-bottom: 8px;
  padding-left: 5px;
  padding-right: 5px;
  border-top-style: double;
  border-top-width: 6px;
  border-top-color: #D3D3D3;
}

#fkvchnkmyt .gt_last_grand_summary_row_top {
  padding-top: 8px;
  padding-bottom: 8px;
  padding-left: 5px;
  padding-right: 5px;
  border-bottom-style: double;
  border-bottom-width: 6px;
  border-bottom-color: #D3D3D3;
}

#fkvchnkmyt .gt_striped {
  background-color: rgba(128, 128, 128, 0.05);
}

#fkvchnkmyt .gt_table_body {
  border-top-style: solid;
  border-top-width: 2px;
  border-top-color: #D3D3D3;
  border-bottom-style: solid;
  border-bottom-width: 2px;
  border-bottom-color: #D3D3D3;
}

#fkvchnkmyt .gt_footnotes {
  color: #333333;
  background-color: #FFFFFF;
  border-bottom-style: none;
  border-bottom-width: 2px;
  border-bottom-color: #D3D3D3;
  border-left-style: none;
  border-left-width: 2px;
  border-left-color: #D3D3D3;
  border-right-style: none;
  border-right-width: 2px;
  border-right-color: #D3D3D3;
}

#fkvchnkmyt .gt_footnote {
  margin: 0px;
  font-size: 90%;
  padding-top: 4px;
  padding-bottom: 4px;
  padding-left: 5px;
  padding-right: 5px;
}

#fkvchnkmyt .gt_sourcenotes {
  color: #333333;
  background-color: #FFFFFF;
  border-bottom-style: none;
  border-bottom-width: 2px;
  border-bottom-color: #D3D3D3;
  border-left-style: none;
  border-left-width: 2px;
  border-left-color: #D3D3D3;
  border-right-style: none;
  border-right-width: 2px;
  border-right-color: #D3D3D3;
}

#fkvchnkmyt .gt_sourcenote {
  font-size: 90%;
  padding-top: 4px;
  padding-bottom: 4px;
  padding-left: 5px;
  padding-right: 5px;
}

#fkvchnkmyt .gt_left {
  text-align: left;
}

#fkvchnkmyt .gt_center {
  text-align: center;
}

#fkvchnkmyt .gt_right {
  text-align: right;
  font-variant-numeric: tabular-nums;
}

#fkvchnkmyt .gt_font_normal {
  font-weight: normal;
}

#fkvchnkmyt .gt_font_bold {
  font-weight: bold;
}

#fkvchnkmyt .gt_font_italic {
  font-style: italic;
}

#fkvchnkmyt .gt_super {
  font-size: 65%;
}

#fkvchnkmyt .gt_footnote_marks {
  font-size: 75%;
  vertical-align: 0.4em;
  position: initial;
}

#fkvchnkmyt .gt_asterisk {
  font-size: 100%;
  vertical-align: 0;
}

#fkvchnkmyt .gt_indent_1 {
  text-indent: 5px;
}

#fkvchnkmyt .gt_indent_2 {
  text-indent: 10px;
}

#fkvchnkmyt .gt_indent_3 {
  text-indent: 15px;
}

#fkvchnkmyt .gt_indent_4 {
  text-indent: 20px;
}

#fkvchnkmyt .gt_indent_5 {
  text-indent: 25px;
}

#fkvchnkmyt .katex-display {
  display: inline-flex !important;
  margin-bottom: 0.75em !important;
}

#fkvchnkmyt div.Reactable > div.rt-table > div.rt-thead > div.rt-tr.rt-tr-group-header > div.rt-th-group:after {
  height: 0px !important;
}
</style>
<table class="gt_table" data-quarto-disable-processing="false" data-quarto-bootstrap="false">
  <thead>
    <tr class="gt_heading">
      <td colspan="2" class="gt_heading gt_title gt_font_normal gt_bottom_border" style="">Estimaci√≥n del efecto de la capacitaci√≥n</td>
    </tr>
    
    <tr class="gt_col_headings">
      <th class="gt_col_heading gt_columns_bottom_border gt_left" rowspan="1" colspan="1" scope="col" id="M√©todo">M√©todo</th>
      <th class="gt_col_heading gt_columns_bottom_border gt_right" rowspan="1" colspan="1" scope="col" id="Estimaci√≥n">Estimaci√≥n</th>
    </tr>
  </thead>
  <tbody class="gt_table_body">
    <tr><td headers="M√©todo" class="gt_row gt_left">SDO</td>
<td headers="Estimaci√≥n" class="gt_row gt_right">-4297</td></tr>
    <tr><td headers="M√©todo" class="gt_row gt_left">Exact Matching</td>
<td headers="Estimaci√≥n" class="gt_row gt_right">2450</td></tr>
  </tbody>
  
  
</table>
</div>
</div>
</div>
<p>Vemos que utilizar s√≥lo la diferencia de las medias no s√≥lo era una estimaci√≥n sesgada sino que suger√≠a una direcci√≥n del efecto contraria a la obtenida con <strong>Exact Matching</strong>.</p>
<div class="page-columns page-full"><p>Vamos a aventurarnos a calcular el <strong>ATE</strong>. Para esto vamos a buscar controles matcheados para cada unidad tratada, y unidades tratadas matcheadas para cada control. Es decir, vamos a hacer un <em>exact matching</em> en ambos sentidos. Luego, vamos a calcular el efecto individual de cada unidad y vamos a calcular el promedio<a href="#fn3" class="footnote-ref" id="fnref3" role="doc-noteref"><sup>3</sup></a>. Primero definimos la funci√≥n para calcular el <strong>ATE</strong>:</p><div class="no-row-height column-margin column-container"><li id="fn3"><p><sup>3</sup>&nbsp;Ni me gasto en poner ecuaciones porque nos vamos a confundir m√°s de lo que ya estamos pero si quieren la pueden ver en <a href="https://mixtape.scunning.com/05-matching_and_subclassification#exact-matching">el libro de Cunningham</a>.</p></li></div></div>
<div class="cell">
<details>
<summary>Ver el c√≥digo</summary>
<div class="sourceCode cell-code" id="cb13"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb13-1"><a href="#cb13-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Funci√≥n para estimar el ATE con matching ####</span></span>
<span id="cb13-2"><a href="#cb13-2" aria-hidden="true" tabindex="-1"></a><span class="co"># Extact Matching Estimator of the ATE</span></span>
<span id="cb13-3"><a href="#cb13-3" aria-hidden="true" tabindex="-1"></a>exact_matching_estimator_ate <span class="ot">&lt;-</span> <span class="cf">function</span>(df, <span class="co">#dataframe</span></span>
<span id="cb13-4"><a href="#cb13-4" aria-hidden="true" tabindex="-1"></a>                                         outcome, <span class="co"># nombre de la variable outcome</span></span>
<span id="cb13-5"><a href="#cb13-5" aria-hidden="true" tabindex="-1"></a>                                         treatment, <span class="co"># nombre de la variable donde est√° el tratamiento</span></span>
<span id="cb13-6"><a href="#cb13-6" aria-hidden="true" tabindex="-1"></a>                                         covariates <span class="co"># string o vector de strings</span></span>
<span id="cb13-7"><a href="#cb13-7" aria-hidden="true" tabindex="-1"></a>) {</span>
<span id="cb13-8"><a href="#cb13-8" aria-hidden="true" tabindex="-1"></a>  df <span class="ot">&lt;-</span> df <span class="sc">%&gt;%</span></span>
<span id="cb13-9"><a href="#cb13-9" aria-hidden="true" tabindex="-1"></a>    <span class="co"># Renombro outcome y tratemiento</span></span>
<span id="cb13-10"><a href="#cb13-10" aria-hidden="true" tabindex="-1"></a>    <span class="fu">rename</span>(<span class="at">outcome :=</span> {{ outcome }},</span>
<span id="cb13-11"><a href="#cb13-11" aria-hidden="true" tabindex="-1"></a>           <span class="at">treatment :=</span> {{ treatment }}) <span class="sc">%&gt;%</span> </span>
<span id="cb13-12"><a href="#cb13-12" aria-hidden="true" tabindex="-1"></a>    <span class="fu">mutate</span>(<span class="at">id =</span> <span class="dv">1</span><span class="sc">:</span><span class="fu">n</span>())</span>
<span id="cb13-13"><a href="#cb13-13" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb13-14"><a href="#cb13-14" aria-hidden="true" tabindex="-1"></a>  treated_df <span class="ot">&lt;-</span> df <span class="sc">%&gt;%</span> </span>
<span id="cb13-15"><a href="#cb13-15" aria-hidden="true" tabindex="-1"></a>    <span class="fu">filter</span>(treatment <span class="sc">==</span> <span class="dv">1</span>)</span>
<span id="cb13-16"><a href="#cb13-16" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb13-17"><a href="#cb13-17" aria-hidden="true" tabindex="-1"></a>  control_df <span class="ot">&lt;-</span> df <span class="sc">%&gt;%</span> </span>
<span id="cb13-18"><a href="#cb13-18" aria-hidden="true" tabindex="-1"></a>    <span class="fu">filter</span>(treatment <span class="sc">==</span> <span class="dv">0</span>)</span>
<span id="cb13-19"><a href="#cb13-19" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb13-20"><a href="#cb13-20" aria-hidden="true" tabindex="-1"></a>  treated_matched <span class="ot">&lt;-</span> treated_df <span class="sc">%&gt;%</span> </span>
<span id="cb13-21"><a href="#cb13-21" aria-hidden="true" tabindex="-1"></a>    <span class="fu">left_join</span>(control_df, <span class="at">by =</span> covariates,</span>
<span id="cb13-22"><a href="#cb13-22" aria-hidden="true" tabindex="-1"></a>              <span class="at">suffix =</span> <span class="fu">c</span>(<span class="st">"_i"</span>, <span class="st">"_j"</span>))</span>
<span id="cb13-23"><a href="#cb13-23" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb13-24"><a href="#cb13-24" aria-hidden="true" tabindex="-1"></a>  <span class="co"># Ahora matcheo tambi√©n los controles</span></span>
<span id="cb13-25"><a href="#cb13-25" aria-hidden="true" tabindex="-1"></a>  control_matched <span class="ot">&lt;-</span> control_df <span class="sc">%&gt;%</span> </span>
<span id="cb13-26"><a href="#cb13-26" aria-hidden="true" tabindex="-1"></a>    <span class="fu">left_join</span>(treated_df, <span class="at">by =</span> covariates,</span>
<span id="cb13-27"><a href="#cb13-27" aria-hidden="true" tabindex="-1"></a>              <span class="at">suffix =</span> <span class="fu">c</span>(<span class="st">"_i"</span>, <span class="st">"_j"</span>))</span>
<span id="cb13-28"><a href="#cb13-28" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb13-29"><a href="#cb13-29" aria-hidden="true" tabindex="-1"></a>  estimate_ate <span class="ot">&lt;-</span> </span>
<span id="cb13-30"><a href="#cb13-30" aria-hidden="true" tabindex="-1"></a>    <span class="co"># Juntamos las dos muestras matcheadas</span></span>
<span id="cb13-31"><a href="#cb13-31" aria-hidden="true" tabindex="-1"></a>    <span class="fu">bind_rows</span>(</span>
<span id="cb13-32"><a href="#cb13-32" aria-hidden="true" tabindex="-1"></a>      treated_matched,</span>
<span id="cb13-33"><a href="#cb13-33" aria-hidden="true" tabindex="-1"></a>      control_matched</span>
<span id="cb13-34"><a href="#cb13-34" aria-hidden="true" tabindex="-1"></a>    ) <span class="sc">%&gt;%</span> </span>
<span id="cb13-35"><a href="#cb13-35" aria-hidden="true" tabindex="-1"></a>    <span class="fu">group_by</span>(id_i) <span class="sc">%&gt;%</span></span>
<span id="cb13-36"><a href="#cb13-36" aria-hidden="true" tabindex="-1"></a>    <span class="fu">summarise</span>(<span class="at">outcome_j =</span> <span class="fu">mean</span>(outcome_j),</span>
<span id="cb13-37"><a href="#cb13-37" aria-hidden="true" tabindex="-1"></a>              <span class="at">outcome_i =</span> <span class="fu">first</span>(outcome_i),</span>
<span id="cb13-38"><a href="#cb13-38" aria-hidden="true" tabindex="-1"></a>              <span class="at">treatment_i =</span> <span class="fu">first</span>(treatment_i)) <span class="sc">%&gt;%</span></span>
<span id="cb13-39"><a href="#cb13-39" aria-hidden="true" tabindex="-1"></a>    <span class="fu">mutate</span>(<span class="at">treat_effect =</span> outcome_i <span class="sc">-</span> outcome_j,</span>
<span id="cb13-40"><a href="#cb13-40" aria-hidden="true" tabindex="-1"></a>           <span class="co"># Multiplicamos por -1 la diferencia entre controles</span></span>
<span id="cb13-41"><a href="#cb13-41" aria-hidden="true" tabindex="-1"></a>           <span class="co"># y sus matches. Porque es como el "anti tratamiento"</span></span>
<span id="cb13-42"><a href="#cb13-42" aria-hidden="true" tabindex="-1"></a>           <span class="at">treat_effect =</span> <span class="fu">ifelse</span>(</span>
<span id="cb13-43"><a href="#cb13-43" aria-hidden="true" tabindex="-1"></a>             treatment_i <span class="sc">==</span> <span class="dv">1</span>,</span>
<span id="cb13-44"><a href="#cb13-44" aria-hidden="true" tabindex="-1"></a>             <span class="at">yes =</span> treat_effect,</span>
<span id="cb13-45"><a href="#cb13-45" aria-hidden="true" tabindex="-1"></a>             <span class="at">no =</span> <span class="sc">-</span><span class="dv">1</span><span class="sc">*</span>treat_effect</span>
<span id="cb13-46"><a href="#cb13-46" aria-hidden="true" tabindex="-1"></a>           )) <span class="sc">%&gt;%</span></span>
<span id="cb13-47"><a href="#cb13-47" aria-hidden="true" tabindex="-1"></a>    <span class="fu">summarise</span>(<span class="at">estimate_ate =</span> <span class="fu">mean</span>(treat_effect)) <span class="sc">%&gt;%</span> </span>
<span id="cb13-48"><a href="#cb13-48" aria-hidden="true" tabindex="-1"></a>    <span class="fu">pull</span>(estimate_ate)</span>
<span id="cb13-49"><a href="#cb13-49" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb13-50"><a href="#cb13-50" aria-hidden="true" tabindex="-1"></a>  estimate_ate</span>
<span id="cb13-51"><a href="#cb13-51" aria-hidden="true" tabindex="-1"></a>}</span></code><button title="Copiar al portapapeles" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
</div>
<p>Y ahora lo calculamos con esta l√≠nea de c√≥digo:</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb14"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb14-1"><a href="#cb14-1" aria-hidden="true" tabindex="-1"></a>ATE <span class="ot">&lt;-</span> </span>
<span id="cb14-2"><a href="#cb14-2" aria-hidden="true" tabindex="-1"></a>  <span class="fu">exact_matching_estimator_ate</span>(</span>
<span id="cb14-3"><a href="#cb14-3" aria-hidden="true" tabindex="-1"></a>    trainees_df,</span>
<span id="cb14-4"><a href="#cb14-4" aria-hidden="true" tabindex="-1"></a>    <span class="at">outcome =</span> Salario,</span>
<span id="cb14-5"><a href="#cb14-5" aria-hidden="true" tabindex="-1"></a>    <span class="at">treatment =</span> Capacitaci√≥n,</span>
<span id="cb14-6"><a href="#cb14-6" aria-hidden="true" tabindex="-1"></a>    <span class="at">covariates =</span> <span class="st">"Edad"</span>)</span></code><button title="Copiar al portapapeles" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<div class="cell">
<details>
<summary>Ver el c√≥digo</summary>
<div class="sourceCode cell-code" id="cb15"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb15-1"><a href="#cb15-1" aria-hidden="true" tabindex="-1"></a><span class="fu">tibble</span>(M√©todo <span class="ot">=</span> <span class="fu">c</span>(<span class="st">"SDO"</span>, <span class="st">"Exact Matching ATT"</span>, <span class="st">"Exact Matching ATE"</span>),</span>
<span id="cb15-2"><a href="#cb15-2" aria-hidden="true" tabindex="-1"></a>       Estimaci√≥n <span class="ot">=</span> <span class="fu">c</span>(</span>
<span id="cb15-3"><a href="#cb15-3" aria-hidden="true" tabindex="-1"></a>         <span class="fu">round</span>(<span class="fu">mean</span>(trainees_df<span class="sc">$</span>Salario[trainees_df<span class="sc">$</span>Capacitaci√≥n<span class="sc">==</span><span class="dv">1</span>]) <span class="sc">-</span> </span>
<span id="cb15-4"><a href="#cb15-4" aria-hidden="true" tabindex="-1"></a>                 <span class="fu">mean</span>(trainees_df<span class="sc">$</span>Salario[trainees_df<span class="sc">$</span>Capacitaci√≥n<span class="sc">==</span><span class="dv">0</span>])),</span>
<span id="cb15-5"><a href="#cb15-5" aria-hidden="true" tabindex="-1"></a>         <span class="fu">round</span>(ATT, <span class="dv">2</span>),</span>
<span id="cb15-6"><a href="#cb15-6" aria-hidden="true" tabindex="-1"></a>         ATE)) <span class="sc">%&gt;%</span></span>
<span id="cb15-7"><a href="#cb15-7" aria-hidden="true" tabindex="-1"></a>  <span class="fu">gt</span>() <span class="sc">%&gt;%</span></span>
<span id="cb15-8"><a href="#cb15-8" aria-hidden="true" tabindex="-1"></a>  <span class="fu">tab_header</span>(</span>
<span id="cb15-9"><a href="#cb15-9" aria-hidden="true" tabindex="-1"></a>    <span class="at">title =</span> <span class="st">"Estimaci√≥n del efecto de la capacitaci√≥n"</span></span>
<span id="cb15-10"><a href="#cb15-10" aria-hidden="true" tabindex="-1"></a>  )</span></code><button title="Copiar al portapapeles" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
<div class="cell-output-display">

<div id="ngbkovndbt" style="padding-left:0px;padding-right:0px;padding-top:10px;padding-bottom:10px;overflow-x:auto;overflow-y:auto;width:auto;height:auto;">
<style>#ngbkovndbt table {
  font-family: system-ui, 'Segoe UI', Roboto, Helvetica, Arial, sans-serif, 'Apple Color Emoji', 'Segoe UI Emoji', 'Segoe UI Symbol', 'Noto Color Emoji';
  -webkit-font-smoothing: antialiased;
  -moz-osx-font-smoothing: grayscale;
}

#ngbkovndbt thead, #ngbkovndbt tbody, #ngbkovndbt tfoot, #ngbkovndbt tr, #ngbkovndbt td, #ngbkovndbt th {
  border-style: none;
}

#ngbkovndbt p {
  margin: 0;
  padding: 0;
}

#ngbkovndbt .gt_table {
  display: table;
  border-collapse: collapse;
  line-height: normal;
  margin-left: auto;
  margin-right: auto;
  color: #333333;
  font-size: 16px;
  font-weight: normal;
  font-style: normal;
  background-color: #FFFFFF;
  width: auto;
  border-top-style: solid;
  border-top-width: 2px;
  border-top-color: #A8A8A8;
  border-right-style: none;
  border-right-width: 2px;
  border-right-color: #D3D3D3;
  border-bottom-style: solid;
  border-bottom-width: 2px;
  border-bottom-color: #A8A8A8;
  border-left-style: none;
  border-left-width: 2px;
  border-left-color: #D3D3D3;
}

#ngbkovndbt .gt_caption {
  padding-top: 4px;
  padding-bottom: 4px;
}

#ngbkovndbt .gt_title {
  color: #333333;
  font-size: 125%;
  font-weight: initial;
  padding-top: 4px;
  padding-bottom: 4px;
  padding-left: 5px;
  padding-right: 5px;
  border-bottom-color: #FFFFFF;
  border-bottom-width: 0;
}

#ngbkovndbt .gt_subtitle {
  color: #333333;
  font-size: 85%;
  font-weight: initial;
  padding-top: 3px;
  padding-bottom: 5px;
  padding-left: 5px;
  padding-right: 5px;
  border-top-color: #FFFFFF;
  border-top-width: 0;
}

#ngbkovndbt .gt_heading {
  background-color: #FFFFFF;
  text-align: center;
  border-bottom-color: #FFFFFF;
  border-left-style: none;
  border-left-width: 1px;
  border-left-color: #D3D3D3;
  border-right-style: none;
  border-right-width: 1px;
  border-right-color: #D3D3D3;
}

#ngbkovndbt .gt_bottom_border {
  border-bottom-style: solid;
  border-bottom-width: 2px;
  border-bottom-color: #D3D3D3;
}

#ngbkovndbt .gt_col_headings {
  border-top-style: solid;
  border-top-width: 2px;
  border-top-color: #D3D3D3;
  border-bottom-style: solid;
  border-bottom-width: 2px;
  border-bottom-color: #D3D3D3;
  border-left-style: none;
  border-left-width: 1px;
  border-left-color: #D3D3D3;
  border-right-style: none;
  border-right-width: 1px;
  border-right-color: #D3D3D3;
}

#ngbkovndbt .gt_col_heading {
  color: #333333;
  background-color: #FFFFFF;
  font-size: 100%;
  font-weight: normal;
  text-transform: inherit;
  border-left-style: none;
  border-left-width: 1px;
  border-left-color: #D3D3D3;
  border-right-style: none;
  border-right-width: 1px;
  border-right-color: #D3D3D3;
  vertical-align: bottom;
  padding-top: 5px;
  padding-bottom: 6px;
  padding-left: 5px;
  padding-right: 5px;
  overflow-x: hidden;
}

#ngbkovndbt .gt_column_spanner_outer {
  color: #333333;
  background-color: #FFFFFF;
  font-size: 100%;
  font-weight: normal;
  text-transform: inherit;
  padding-top: 0;
  padding-bottom: 0;
  padding-left: 4px;
  padding-right: 4px;
}

#ngbkovndbt .gt_column_spanner_outer:first-child {
  padding-left: 0;
}

#ngbkovndbt .gt_column_spanner_outer:last-child {
  padding-right: 0;
}

#ngbkovndbt .gt_column_spanner {
  border-bottom-style: solid;
  border-bottom-width: 2px;
  border-bottom-color: #D3D3D3;
  vertical-align: bottom;
  padding-top: 5px;
  padding-bottom: 5px;
  overflow-x: hidden;
  display: inline-block;
  width: 100%;
}

#ngbkovndbt .gt_spanner_row {
  border-bottom-style: hidden;
}

#ngbkovndbt .gt_group_heading {
  padding-top: 8px;
  padding-bottom: 8px;
  padding-left: 5px;
  padding-right: 5px;
  color: #333333;
  background-color: #FFFFFF;
  font-size: 100%;
  font-weight: initial;
  text-transform: inherit;
  border-top-style: solid;
  border-top-width: 2px;
  border-top-color: #D3D3D3;
  border-bottom-style: solid;
  border-bottom-width: 2px;
  border-bottom-color: #D3D3D3;
  border-left-style: none;
  border-left-width: 1px;
  border-left-color: #D3D3D3;
  border-right-style: none;
  border-right-width: 1px;
  border-right-color: #D3D3D3;
  vertical-align: middle;
  text-align: left;
}

#ngbkovndbt .gt_empty_group_heading {
  padding: 0.5px;
  color: #333333;
  background-color: #FFFFFF;
  font-size: 100%;
  font-weight: initial;
  border-top-style: solid;
  border-top-width: 2px;
  border-top-color: #D3D3D3;
  border-bottom-style: solid;
  border-bottom-width: 2px;
  border-bottom-color: #D3D3D3;
  vertical-align: middle;
}

#ngbkovndbt .gt_from_md > :first-child {
  margin-top: 0;
}

#ngbkovndbt .gt_from_md > :last-child {
  margin-bottom: 0;
}

#ngbkovndbt .gt_row {
  padding-top: 8px;
  padding-bottom: 8px;
  padding-left: 5px;
  padding-right: 5px;
  margin: 10px;
  border-top-style: solid;
  border-top-width: 1px;
  border-top-color: #D3D3D3;
  border-left-style: none;
  border-left-width: 1px;
  border-left-color: #D3D3D3;
  border-right-style: none;
  border-right-width: 1px;
  border-right-color: #D3D3D3;
  vertical-align: middle;
  overflow-x: hidden;
}

#ngbkovndbt .gt_stub {
  color: #333333;
  background-color: #FFFFFF;
  font-size: 100%;
  font-weight: initial;
  text-transform: inherit;
  border-right-style: solid;
  border-right-width: 2px;
  border-right-color: #D3D3D3;
  padding-left: 5px;
  padding-right: 5px;
}

#ngbkovndbt .gt_stub_row_group {
  color: #333333;
  background-color: #FFFFFF;
  font-size: 100%;
  font-weight: initial;
  text-transform: inherit;
  border-right-style: solid;
  border-right-width: 2px;
  border-right-color: #D3D3D3;
  padding-left: 5px;
  padding-right: 5px;
  vertical-align: top;
}

#ngbkovndbt .gt_row_group_first td {
  border-top-width: 2px;
}

#ngbkovndbt .gt_row_group_first th {
  border-top-width: 2px;
}

#ngbkovndbt .gt_summary_row {
  color: #333333;
  background-color: #FFFFFF;
  text-transform: inherit;
  padding-top: 8px;
  padding-bottom: 8px;
  padding-left: 5px;
  padding-right: 5px;
}

#ngbkovndbt .gt_first_summary_row {
  border-top-style: solid;
  border-top-color: #D3D3D3;
}

#ngbkovndbt .gt_first_summary_row.thick {
  border-top-width: 2px;
}

#ngbkovndbt .gt_last_summary_row {
  padding-top: 8px;
  padding-bottom: 8px;
  padding-left: 5px;
  padding-right: 5px;
  border-bottom-style: solid;
  border-bottom-width: 2px;
  border-bottom-color: #D3D3D3;
}

#ngbkovndbt .gt_grand_summary_row {
  color: #333333;
  background-color: #FFFFFF;
  text-transform: inherit;
  padding-top: 8px;
  padding-bottom: 8px;
  padding-left: 5px;
  padding-right: 5px;
}

#ngbkovndbt .gt_first_grand_summary_row {
  padding-top: 8px;
  padding-bottom: 8px;
  padding-left: 5px;
  padding-right: 5px;
  border-top-style: double;
  border-top-width: 6px;
  border-top-color: #D3D3D3;
}

#ngbkovndbt .gt_last_grand_summary_row_top {
  padding-top: 8px;
  padding-bottom: 8px;
  padding-left: 5px;
  padding-right: 5px;
  border-bottom-style: double;
  border-bottom-width: 6px;
  border-bottom-color: #D3D3D3;
}

#ngbkovndbt .gt_striped {
  background-color: rgba(128, 128, 128, 0.05);
}

#ngbkovndbt .gt_table_body {
  border-top-style: solid;
  border-top-width: 2px;
  border-top-color: #D3D3D3;
  border-bottom-style: solid;
  border-bottom-width: 2px;
  border-bottom-color: #D3D3D3;
}

#ngbkovndbt .gt_footnotes {
  color: #333333;
  background-color: #FFFFFF;
  border-bottom-style: none;
  border-bottom-width: 2px;
  border-bottom-color: #D3D3D3;
  border-left-style: none;
  border-left-width: 2px;
  border-left-color: #D3D3D3;
  border-right-style: none;
  border-right-width: 2px;
  border-right-color: #D3D3D3;
}

#ngbkovndbt .gt_footnote {
  margin: 0px;
  font-size: 90%;
  padding-top: 4px;
  padding-bottom: 4px;
  padding-left: 5px;
  padding-right: 5px;
}

#ngbkovndbt .gt_sourcenotes {
  color: #333333;
  background-color: #FFFFFF;
  border-bottom-style: none;
  border-bottom-width: 2px;
  border-bottom-color: #D3D3D3;
  border-left-style: none;
  border-left-width: 2px;
  border-left-color: #D3D3D3;
  border-right-style: none;
  border-right-width: 2px;
  border-right-color: #D3D3D3;
}

#ngbkovndbt .gt_sourcenote {
  font-size: 90%;
  padding-top: 4px;
  padding-bottom: 4px;
  padding-left: 5px;
  padding-right: 5px;
}

#ngbkovndbt .gt_left {
  text-align: left;
}

#ngbkovndbt .gt_center {
  text-align: center;
}

#ngbkovndbt .gt_right {
  text-align: right;
  font-variant-numeric: tabular-nums;
}

#ngbkovndbt .gt_font_normal {
  font-weight: normal;
}

#ngbkovndbt .gt_font_bold {
  font-weight: bold;
}

#ngbkovndbt .gt_font_italic {
  font-style: italic;
}

#ngbkovndbt .gt_super {
  font-size: 65%;
}

#ngbkovndbt .gt_footnote_marks {
  font-size: 75%;
  vertical-align: 0.4em;
  position: initial;
}

#ngbkovndbt .gt_asterisk {
  font-size: 100%;
  vertical-align: 0;
}

#ngbkovndbt .gt_indent_1 {
  text-indent: 5px;
}

#ngbkovndbt .gt_indent_2 {
  text-indent: 10px;
}

#ngbkovndbt .gt_indent_3 {
  text-indent: 15px;
}

#ngbkovndbt .gt_indent_4 {
  text-indent: 20px;
}

#ngbkovndbt .gt_indent_5 {
  text-indent: 25px;
}

#ngbkovndbt .katex-display {
  display: inline-flex !important;
  margin-bottom: 0.75em !important;
}

#ngbkovndbt div.Reactable > div.rt-table > div.rt-thead > div.rt-tr.rt-tr-group-header > div.rt-th-group:after {
  height: 0px !important;
}
</style>
<table class="gt_table" data-quarto-disable-processing="false" data-quarto-bootstrap="false">
  <thead>
    <tr class="gt_heading">
      <td colspan="2" class="gt_heading gt_title gt_font_normal gt_bottom_border" style="">Estimaci√≥n del efecto de la capacitaci√≥n</td>
    </tr>
    
    <tr class="gt_col_headings">
      <th class="gt_col_heading gt_columns_bottom_border gt_left" rowspan="1" colspan="1" scope="col" id="M√©todo">M√©todo</th>
      <th class="gt_col_heading gt_columns_bottom_border gt_right" rowspan="1" colspan="1" scope="col" id="Estimaci√≥n">Estimaci√≥n</th>
    </tr>
  </thead>
  <tbody class="gt_table_body">
    <tr><td headers="M√©todo" class="gt_row gt_left">SDO</td>
<td headers="Estimaci√≥n" class="gt_row gt_right">-4297</td></tr>
    <tr><td headers="M√©todo" class="gt_row gt_left">Exact Matching ATT</td>
<td headers="Estimaci√≥n" class="gt_row gt_right">2450</td></tr>
    <tr><td headers="M√©todo" class="gt_row gt_left">Exact Matching ATE</td>
<td headers="Estimaci√≥n" class="gt_row gt_right">NA</td></tr>
  </tbody>
  
  
</table>
</div>
</div>
</div>
<p>Pero el <strong>ATE</strong> nos da <code>NA</code>. ¬øPor qu√©? Bueno, porque no hay controles que coincidan exactamente con los tratados. En este caso, el <strong>ATE</strong> no se puede estimar con <em>exact matching</em> porque no hay suficientes controles que compartan el mismo valor de la covariable <span class="math inline">\(X\)</span> (en este caso, la edad) que las unidades tratadas. Es por eso que de ac√° en adelante vamos a hablar m√°s del <strong>ATT</strong> que del <strong>ATE</strong>. No s√≥lo porque es m√°s f√°cil de estimar sino porque es lo que se calcula en la mayor√≠a de los casos. Recuerden que si tenemos motivos razonables para creer que no existen sesgos de efecto heterog√©neo, el <strong>ATT</strong> y el <strong>ATE</strong> son iguales.</p>
<p>La ventaja del <em>exact matching</em> es que asegura que las comparaciones se hagan entre unidades id√©nticas en las covariables <span class="math inline">\(X\)</span>. Sin embargo, cuando queremos emparejar seg√∫n muchas caracter√≠sticas al mismo tiempo, encontrar controles con valores id√©nticos se vuelve muy dif√≠cil. Por ejemplo, si emparejamos solo por edad hay pocas categor√≠as y es f√°cil encontrar controles; pero si agregamos otras variables como regi√≥n, nivel de ingreso o tama√±o de la tienda, las combinaciones posibles crecen exponencialmente. A esto √∫ltimo se lo conoce como la maldici√≥n de la dimensionalidad y tiene que ver con el hecho que los datos se vuelven m√°s dispersos a medida que aumentamos el n√∫mero de dimensiones (o covariables) en nuestro espacio de an√°lisis. Imaginen que tenemos 5 datos en una l√≠nea de largo <span class="math inline">\(10\)</span>. Bueno, ¬øqu√© pasa si los pasamos a un cuadrado de <span class="math inline">\(10\)</span> x <span class="math inline">\(10\)</span>? ¬øY a un cubo de <span class="math inline">\(10\)</span> x <span class="math inline">\(10\)</span> x <span class="math inline">\(10\)</span>? Los datos empiezan a estar m√°s lejos. Es por eso que para encontrar controles iguales deber√≠amos aumentar mucho el tama√±o de nuestra muestra.</p>
<p>Algo que se deben estar preguntando es ¬øy si en lugar de buscar un control de <span class="math inline">\(25\)</span> a√±os para el caso anterior buscamos uno que est√© ‚Äúbastante‚Äù cerca? Buenos, perm√≠tanme decirles que no son nada originales, eso existe y se llama <em>Approximate Matching</em>.</p>
</section>
<section id="approximate-matching" class="level3 page-columns page-full" data-number="6.2.2">
<h3 data-number="6.2.2" class="anchored" data-anchor-id="approximate-matching"><span class="header-section-number">6.2.2</span> <em>Approximate Matching</em></h3>
<div class="page-columns page-full"><p>Como dijimos en la secci√≥n anterior, cuando no encontramos controles que coincidan exactamente en todas las covariables <span class="math inline">\(X\)</span><a href="#fn4" class="footnote-ref" id="fnref4" role="doc-noteref"><sup>4</sup></a>, recurrimos al <em>approximate matching</em>. En lugar de exigir valores id√©nticos, buscamos en el grupo de control al individuo cuyos valores de <span class="math inline">\(X\)</span> sean m√°s parecidos a la de cada unidad tratada, y usamos su resultado como contrafactual.</p><div class="no-row-height column-margin column-container"><li id="fn4"><p><sup>4</sup>&nbsp;Cuando hablamos de <span class="math inline">\(X\)</span> nos referimos a un vector de covariables por las que queremos controlar, que puede incluir variables categ√≥ricas y continuas. Por ejemplo, si tenemos una variable categ√≥rica como ‚Äúregi√≥n‚Äù y una continua como ‚Äúedad‚Äù, el vector <span class="math inline">\(X\)</span> podr√≠a ser algo as√≠ como: <span class="math inline">\(X = (regi√≥n, edad)\)</span>.</p></li></div></div>
<div class="page-columns page-full"><p>Pero, ¬øqu√© significa ‚Äúparecida‚Äù? Si tenemos una sola covariable ser√° la m√°s cercana en n√∫mero, pero como discutimos, el espacio de covariables puede ser (y normalmente es) de m√°s de una dimensi√≥n. En este caso, para cuantificar la similitud entre dos unidades definimos una distancia en el espacio de covariables. Una opci√≥n es usar la distancia euclidiana, esta medida suma las diferencias al cuadrado en cada dimensi√≥n y luego toma ra√≠z, indicando qu√© tan ‚Äúlejos‚Äù est√°n los dos puntos en el espacio<a href="#fn5" class="footnote-ref" id="fnref5" role="doc-noteref"><sup>5</sup></a>. Por ejemplo, si tenemos que que las covariables son edad y salario, la distancia euclidiana entre dos puntos <span class="math inline">\((edad_1, salario_1)\)</span> y <span class="math inline">\((edad_2, salario_2)\)</span> ser√≠a:</p><div class="no-row-height column-margin column-container"><li id="fn5"><p><sup>5</sup>&nbsp;B√°sicamente el m√≥dulo del vector que une los dos puntos en el espacio de covariables (ahre).</p></li></div></div>
<p><span class="math display">\[
distancimatch_medicine &lt;- match.data(nearest_control)a_{euclidea} = \sqrt{(edad_1 - edad_2)^2 + (salario_1 - salario_2)^2}
\]</span></p>
<p>¬øPero esto es siempre as√≠? Veamos un ejemplo y reflexionemos un poco.</p>
<div class="cell">
<details>
<summary>Ver el c√≥digo</summary>
<div class="sourceCode cell-code" id="cb16"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb16-1"><a href="#cb16-1" aria-hidden="true" tabindex="-1"></a><span class="co"># La mitad son asignados al grupo tratamiento y la mitad al grupo control</span></span>
<span id="cb16-2"><a href="#cb16-2" aria-hidden="true" tabindex="-1"></a><span class="fu">set.seed</span>(<span class="dv">12</span>)</span>
<span id="cb16-3"><a href="#cb16-3" aria-hidden="true" tabindex="-1"></a>empleados_tbl <span class="ot">&lt;-</span> <span class="fu">tibble</span>(<span class="at">Grupo =</span> <span class="fu">c</span>(<span class="fu">rep</span>(<span class="st">"tratamiento"</span>, <span class="dv">10</span>), <span class="fu">rep</span>(<span class="st">"control"</span>, <span class="dv">10</span>)),</span>
<span id="cb16-4"><a href="#cb16-4" aria-hidden="true" tabindex="-1"></a>                        <span class="at">Edad =</span> <span class="fu">rnorm</span>(<span class="at">n =</span> <span class="dv">20</span>, <span class="at">mean =</span> <span class="dv">35</span>, <span class="at">sd =</span> <span class="dv">5</span>),</span>
<span id="cb16-5"><a href="#cb16-5" aria-hidden="true" tabindex="-1"></a>                        <span class="at">Salario =</span> Edad<span class="sc">*</span><span class="dv">1500</span> <span class="sc">+</span> <span class="fu">rnorm</span>(<span class="at">n =</span> <span class="dv">20</span>, <span class="at">mean =</span> <span class="dv">0</span>, <span class="at">sd =</span> <span class="dv">5000</span>))</span>
<span id="cb16-6"><a href="#cb16-6" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb16-7"><a href="#cb16-7" aria-hidden="true" tabindex="-1"></a>empleados_tbl <span class="sc">|&gt;</span> <span class="fu">ggplot</span>(<span class="fu">aes</span>(<span class="at">x =</span> Edad,</span>
<span id="cb16-8"><a href="#cb16-8" aria-hidden="true" tabindex="-1"></a>                            <span class="at">y =</span> Salario,</span>
<span id="cb16-9"><a href="#cb16-9" aria-hidden="true" tabindex="-1"></a>                            <span class="at">color =</span> Grupo)) <span class="sc">+</span></span>
<span id="cb16-10"><a href="#cb16-10" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_point</span>(<span class="at">alpha =</span> .<span class="dv">2</span>) <span class="sc">+</span> </span>
<span id="cb16-11"><a href="#cb16-11" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_point</span>(<span class="at">data =</span> empleados_tbl[<span class="fu">c</span>(<span class="dv">9</span>, <span class="dv">10</span>, <span class="dv">18</span>),]) <span class="sc">+</span> </span>
<span id="cb16-12"><a href="#cb16-12" aria-hidden="true" tabindex="-1"></a>  <span class="fu">scale_color_brewer</span>(<span class="at">palette =</span> <span class="st">"Dark2"</span>) <span class="sc">+</span></span>
<span id="cb16-13"><a href="#cb16-13" aria-hidden="true" tabindex="-1"></a>  <span class="fu">labs</span>(<span class="at">color =</span> <span class="cn">NULL</span>) <span class="sc">+</span></span>
<span id="cb16-14"><a href="#cb16-14" aria-hidden="true" tabindex="-1"></a>  <span class="fu">theme_bw</span>() <span class="sc">+</span></span>
<span id="cb16-15"><a href="#cb16-15" aria-hidden="true" tabindex="-1"></a>  <span class="fu">theme</span>(<span class="at">legend.position =</span> <span class="st">"top"</span>)</span></code><button title="Copiar al portapapeles" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
<div class="cell-output-display">
<p><img src="matching_files/figure-html/unnamed-chunk-18-1.png" class="img-fluid" width="576"></p>
</div>
</div>
<p>Imaginen que queremos encontrar al empleado m√°s cercano al empleado verde lleno (el empleado <span class="math inline">\(18\)</span>). Los candidatos ser√≠an los dos naranjas (los empleados <span class="math inline">\(9\)</span> el de la izquierda y <span class="math inline">\(10\)</span> el de la derecha) ¬øno? Y estamos de acuerdo que el que est√° hacia la derecha es el m√°s cercano (o sea el empleado <span class="math inline">\(10\)</span>), ¬øno? Bueno, calculemos las distancias y veamos qu√© pasa.</p>
<div class="cell">
<details>
<summary>Ver el c√≥digo</summary>
<div class="sourceCode cell-code" id="cb17"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb17-1"><a href="#cb17-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Defino una funci√≥n para calcular la distancia euclidiana entre dos puntos en el espacio de covariables de dos dimensiones. </span></span>
<span id="cb17-2"><a href="#cb17-2" aria-hidden="true" tabindex="-1"></a>distancia_euclidea <span class="ot">&lt;-</span> <span class="cf">function</span>(x_i, x_j) {</span>
<span id="cb17-3"><a href="#cb17-3" aria-hidden="true" tabindex="-1"></a>  dist <span class="ot">&lt;-</span> <span class="fu">sqrt</span>((x_i[<span class="dv">1</span>]<span class="sc">-</span>x_j[<span class="dv">1</span>])<span class="sc">^</span><span class="dv">2</span> <span class="sc">+</span> (x_i[<span class="dv">2</span>]<span class="sc">-</span>x_j[<span class="dv">2</span>])<span class="sc">^</span><span class="dv">2</span>)</span>
<span id="cb17-4"><a href="#cb17-4" aria-hidden="true" tabindex="-1"></a>  dist</span>
<span id="cb17-5"><a href="#cb17-5" aria-hidden="true" tabindex="-1"></a>}</span>
<span id="cb17-6"><a href="#cb17-6" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb17-7"><a href="#cb17-7" aria-hidden="true" tabindex="-1"></a>distancia_a_9 <span class="ot">&lt;-</span> <span class="fu">distancia_euclidea</span>(empleados_tbl[<span class="dv">9</span>, <span class="fu">c</span>(<span class="st">"Edad"</span>, <span class="st">"Salario"</span>)],</span>
<span id="cb17-8"><a href="#cb17-8" aria-hidden="true" tabindex="-1"></a>                                    empleados_tbl[<span class="dv">18</span>, <span class="fu">c</span>(<span class="st">"Edad"</span>, <span class="st">"Salario"</span>)])</span>
<span id="cb17-9"><a href="#cb17-9" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb17-10"><a href="#cb17-10" aria-hidden="true" tabindex="-1"></a>distancia_a_10 <span class="ot">&lt;-</span> <span class="fu">distancia_euclidea</span>(empleados_tbl[<span class="dv">10</span>, <span class="fu">c</span>(<span class="st">"Edad"</span>, <span class="st">"Salario"</span>)],</span>
<span id="cb17-11"><a href="#cb17-11" aria-hidden="true" tabindex="-1"></a>                                     empleados_tbl[<span class="dv">18</span>, <span class="fu">c</span>(<span class="st">"Edad"</span>, <span class="st">"Salario"</span>)])</span>
<span id="cb17-12"><a href="#cb17-12" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb17-13"><a href="#cb17-13" aria-hidden="true" tabindex="-1"></a><span class="fu">tibble</span>(<span class="at">Empleado =</span> <span class="fu">c</span>(<span class="st">"9"</span>, <span class="st">"10"</span>),</span>
<span id="cb17-14"><a href="#cb17-14" aria-hidden="true" tabindex="-1"></a>       <span class="at">Distancia =</span> <span class="fu">c</span>(distancia_a_9, distancia_a_10)) <span class="sc">%&gt;%</span></span>
<span id="cb17-15"><a href="#cb17-15" aria-hidden="true" tabindex="-1"></a>  <span class="fu">gt</span>() <span class="sc">%&gt;%</span></span>
<span id="cb17-16"><a href="#cb17-16" aria-hidden="true" tabindex="-1"></a>  <span class="fu">tab_header</span>(</span>
<span id="cb17-17"><a href="#cb17-17" aria-hidden="true" tabindex="-1"></a>    <span class="at">title =</span> <span class="st">"Distancias euclidianas entre el empleado 18 y los empleados 9 y 10"</span></span>
<span id="cb17-18"><a href="#cb17-18" aria-hidden="true" tabindex="-1"></a>  )</span></code><button title="Copiar al portapapeles" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
<div class="cell-output-display">

<div id="txugjhohgn" style="padding-left:0px;padding-right:0px;padding-top:10px;padding-bottom:10px;overflow-x:auto;overflow-y:auto;width:auto;height:auto;">
<style>#txugjhohgn table {
  font-family: system-ui, 'Segoe UI', Roboto, Helvetica, Arial, sans-serif, 'Apple Color Emoji', 'Segoe UI Emoji', 'Segoe UI Symbol', 'Noto Color Emoji';
  -webkit-font-smoothing: antialiased;
  -moz-osx-font-smoothing: grayscale;
}

#txugjhohgn thead, #txugjhohgn tbody, #txugjhohgn tfoot, #txugjhohgn tr, #txugjhohgn td, #txugjhohgn th {
  border-style: none;
}

#txugjhohgn p {
  margin: 0;
  padding: 0;
}

#txugjhohgn .gt_table {
  display: table;
  border-collapse: collapse;
  line-height: normal;
  margin-left: auto;
  margin-right: auto;
  color: #333333;
  font-size: 16px;
  font-weight: normal;
  font-style: normal;
  background-color: #FFFFFF;
  width: auto;
  border-top-style: solid;
  border-top-width: 2px;
  border-top-color: #A8A8A8;
  border-right-style: none;
  border-right-width: 2px;
  border-right-color: #D3D3D3;
  border-bottom-style: solid;
  border-bottom-width: 2px;
  border-bottom-color: #A8A8A8;
  border-left-style: none;
  border-left-width: 2px;
  border-left-color: #D3D3D3;
}

#txugjhohgn .gt_caption {
  padding-top: 4px;
  padding-bottom: 4px;
}

#txugjhohgn .gt_title {
  color: #333333;
  font-size: 125%;
  font-weight: initial;
  padding-top: 4px;
  padding-bottom: 4px;
  padding-left: 5px;
  padding-right: 5px;
  border-bottom-color: #FFFFFF;
  border-bottom-width: 0;
}

#txugjhohgn .gt_subtitle {
  color: #333333;
  font-size: 85%;
  font-weight: initial;
  padding-top: 3px;
  padding-bottom: 5px;
  padding-left: 5px;
  padding-right: 5px;
  border-top-color: #FFFFFF;
  border-top-width: 0;
}

#txugjhohgn .gt_heading {
  background-color: #FFFFFF;
  text-align: center;
  border-bottom-color: #FFFFFF;
  border-left-style: none;
  border-left-width: 1px;
  border-left-color: #D3D3D3;
  border-right-style: none;
  border-right-width: 1px;
  border-right-color: #D3D3D3;
}

#txugjhohgn .gt_bottom_border {
  border-bottom-style: solid;
  border-bottom-width: 2px;
  border-bottom-color: #D3D3D3;
}

#txugjhohgn .gt_col_headings {
  border-top-style: solid;
  border-top-width: 2px;
  border-top-color: #D3D3D3;
  border-bottom-style: solid;
  border-bottom-width: 2px;
  border-bottom-color: #D3D3D3;
  border-left-style: none;
  border-left-width: 1px;
  border-left-color: #D3D3D3;
  border-right-style: none;
  border-right-width: 1px;
  border-right-color: #D3D3D3;
}

#txugjhohgn .gt_col_heading {
  color: #333333;
  background-color: #FFFFFF;
  font-size: 100%;
  font-weight: normal;
  text-transform: inherit;
  border-left-style: none;
  border-left-width: 1px;
  border-left-color: #D3D3D3;
  border-right-style: none;
  border-right-width: 1px;
  border-right-color: #D3D3D3;
  vertical-align: bottom;
  padding-top: 5px;
  padding-bottom: 6px;
  padding-left: 5px;
  padding-right: 5px;
  overflow-x: hidden;
}

#txugjhohgn .gt_column_spanner_outer {
  color: #333333;
  background-color: #FFFFFF;
  font-size: 100%;
  font-weight: normal;
  text-transform: inherit;
  padding-top: 0;
  padding-bottom: 0;
  padding-left: 4px;
  padding-right: 4px;
}

#txugjhohgn .gt_column_spanner_outer:first-child {
  padding-left: 0;
}

#txugjhohgn .gt_column_spanner_outer:last-child {
  padding-right: 0;
}

#txugjhohgn .gt_column_spanner {
  border-bottom-style: solid;
  border-bottom-width: 2px;
  border-bottom-color: #D3D3D3;
  vertical-align: bottom;
  padding-top: 5px;
  padding-bottom: 5px;
  overflow-x: hidden;
  display: inline-block;
  width: 100%;
}

#txugjhohgn .gt_spanner_row {
  border-bottom-style: hidden;
}

#txugjhohgn .gt_group_heading {
  padding-top: 8px;
  padding-bottom: 8px;
  padding-left: 5px;
  padding-right: 5px;
  color: #333333;
  background-color: #FFFFFF;
  font-size: 100%;
  font-weight: initial;
  text-transform: inherit;
  border-top-style: solid;
  border-top-width: 2px;
  border-top-color: #D3D3D3;
  border-bottom-style: solid;
  border-bottom-width: 2px;
  border-bottom-color: #D3D3D3;
  border-left-style: none;
  border-left-width: 1px;
  border-left-color: #D3D3D3;
  border-right-style: none;
  border-right-width: 1px;
  border-right-color: #D3D3D3;
  vertical-align: middle;
  text-align: left;
}

#txugjhohgn .gt_empty_group_heading {
  padding: 0.5px;
  color: #333333;
  background-color: #FFFFFF;
  font-size: 100%;
  font-weight: initial;
  border-top-style: solid;
  border-top-width: 2px;
  border-top-color: #D3D3D3;
  border-bottom-style: solid;
  border-bottom-width: 2px;
  border-bottom-color: #D3D3D3;
  vertical-align: middle;
}

#txugjhohgn .gt_from_md > :first-child {
  margin-top: 0;
}

#txugjhohgn .gt_from_md > :last-child {
  margin-bottom: 0;
}

#txugjhohgn .gt_row {
  padding-top: 8px;
  padding-bottom: 8px;
  padding-left: 5px;
  padding-right: 5px;
  margin: 10px;
  border-top-style: solid;
  border-top-width: 1px;
  border-top-color: #D3D3D3;
  border-left-style: none;
  border-left-width: 1px;
  border-left-color: #D3D3D3;
  border-right-style: none;
  border-right-width: 1px;
  border-right-color: #D3D3D3;
  vertical-align: middle;
  overflow-x: hidden;
}

#txugjhohgn .gt_stub {
  color: #333333;
  background-color: #FFFFFF;
  font-size: 100%;
  font-weight: initial;
  text-transform: inherit;
  border-right-style: solid;
  border-right-width: 2px;
  border-right-color: #D3D3D3;
  padding-left: 5px;
  padding-right: 5px;
}

#txugjhohgn .gt_stub_row_group {
  color: #333333;
  background-color: #FFFFFF;
  font-size: 100%;
  font-weight: initial;
  text-transform: inherit;
  border-right-style: solid;
  border-right-width: 2px;
  border-right-color: #D3D3D3;
  padding-left: 5px;
  padding-right: 5px;
  vertical-align: top;
}

#txugjhohgn .gt_row_group_first td {
  border-top-width: 2px;
}

#txugjhohgn .gt_row_group_first th {
  border-top-width: 2px;
}

#txugjhohgn .gt_summary_row {
  color: #333333;
  background-color: #FFFFFF;
  text-transform: inherit;
  padding-top: 8px;
  padding-bottom: 8px;
  padding-left: 5px;
  padding-right: 5px;
}

#txugjhohgn .gt_first_summary_row {
  border-top-style: solid;
  border-top-color: #D3D3D3;
}

#txugjhohgn .gt_first_summary_row.thick {
  border-top-width: 2px;
}

#txugjhohgn .gt_last_summary_row {
  padding-top: 8px;
  padding-bottom: 8px;
  padding-left: 5px;
  padding-right: 5px;
  border-bottom-style: solid;
  border-bottom-width: 2px;
  border-bottom-color: #D3D3D3;
}

#txugjhohgn .gt_grand_summary_row {
  color: #333333;
  background-color: #FFFFFF;
  text-transform: inherit;
  padding-top: 8px;
  padding-bottom: 8px;
  padding-left: 5px;
  padding-right: 5px;
}

#txugjhohgn .gt_first_grand_summary_row {
  padding-top: 8px;
  padding-bottom: 8px;
  padding-left: 5px;
  padding-right: 5px;
  border-top-style: double;
  border-top-width: 6px;
  border-top-color: #D3D3D3;
}

#txugjhohgn .gt_last_grand_summary_row_top {
  padding-top: 8px;
  padding-bottom: 8px;
  padding-left: 5px;
  padding-right: 5px;
  border-bottom-style: double;
  border-bottom-width: 6px;
  border-bottom-color: #D3D3D3;
}

#txugjhohgn .gt_striped {
  background-color: rgba(128, 128, 128, 0.05);
}

#txugjhohgn .gt_table_body {
  border-top-style: solid;
  border-top-width: 2px;
  border-top-color: #D3D3D3;
  border-bottom-style: solid;
  border-bottom-width: 2px;
  border-bottom-color: #D3D3D3;
}

#txugjhohgn .gt_footnotes {
  color: #333333;
  background-color: #FFFFFF;
  border-bottom-style: none;
  border-bottom-width: 2px;
  border-bottom-color: #D3D3D3;
  border-left-style: none;
  border-left-width: 2px;
  border-left-color: #D3D3D3;
  border-right-style: none;
  border-right-width: 2px;
  border-right-color: #D3D3D3;
}

#txugjhohgn .gt_footnote {
  margin: 0px;
  font-size: 90%;
  padding-top: 4px;
  padding-bottom: 4px;
  padding-left: 5px;
  padding-right: 5px;
}

#txugjhohgn .gt_sourcenotes {
  color: #333333;
  background-color: #FFFFFF;
  border-bottom-style: none;
  border-bottom-width: 2px;
  border-bottom-color: #D3D3D3;
  border-left-style: none;
  border-left-width: 2px;
  border-left-color: #D3D3D3;
  border-right-style: none;
  border-right-width: 2px;
  border-right-color: #D3D3D3;
}

#txugjhohgn .gt_sourcenote {
  font-size: 90%;
  padding-top: 4px;
  padding-bottom: 4px;
  padding-left: 5px;
  padding-right: 5px;
}

#txugjhohgn .gt_left {
  text-align: left;
}

#txugjhohgn .gt_center {
  text-align: center;
}

#txugjhohgn .gt_right {
  text-align: right;
  font-variant-numeric: tabular-nums;
}

#txugjhohgn .gt_font_normal {
  font-weight: normal;
}

#txugjhohgn .gt_font_bold {
  font-weight: bold;
}

#txugjhohgn .gt_font_italic {
  font-style: italic;
}

#txugjhohgn .gt_super {
  font-size: 65%;
}

#txugjhohgn .gt_footnote_marks {
  font-size: 75%;
  vertical-align: 0.4em;
  position: initial;
}

#txugjhohgn .gt_asterisk {
  font-size: 100%;
  vertical-align: 0;
}

#txugjhohgn .gt_indent_1 {
  text-indent: 5px;
}

#txugjhohgn .gt_indent_2 {
  text-indent: 10px;
}

#txugjhohgn .gt_indent_3 {
  text-indent: 15px;
}

#txugjhohgn .gt_indent_4 {
  text-indent: 20px;
}

#txugjhohgn .gt_indent_5 {
  text-indent: 25px;
}

#txugjhohgn .katex-display {
  display: inline-flex !important;
  margin-bottom: 0.75em !important;
}

#txugjhohgn div.Reactable > div.rt-table > div.rt-thead > div.rt-tr.rt-tr-group-header > div.rt-th-group:after {
  height: 0px !important;
}
</style>
<table class="gt_table" data-quarto-disable-processing="false" data-quarto-bootstrap="false">
  <thead>
    <tr class="gt_heading">
      <td colspan="2" class="gt_heading gt_title gt_font_normal gt_bottom_border" style="">Distancias euclidianas entre el empleado 18 y los empleados 9 y 10</td>
    </tr>
    
    <tr class="gt_col_headings">
      <th class="gt_col_heading gt_columns_bottom_border gt_right" rowspan="1" colspan="1" scope="col" id="Empleado">Empleado</th>
      <th class="gt_col_heading gt_columns_bottom_border gt_center" rowspan="1" colspan="1" scope="col" id="Distancia">Distancia</th>
    </tr>
  </thead>
  <tbody class="gt_table_body">
    <tr><td headers="Empleado" class="gt_row gt_right">9</td>
<td headers="Distancia" class="gt_row gt_center">225.7699</td></tr>
    <tr><td headers="Empleado" class="gt_row gt_right">10</td>
<td headers="Distancia" class="gt_row gt_center">4864.155</td></tr>
  </tbody>
  
  
</table>
</div>
</div>
</div>
<p>Esto dice que el m√°s cercano es el <span class="math inline">\(9\)</span>, pero si lo miramos en el gr√°fico, claramente el <span class="math inline">\(10\)</span> es el m√°s cercano. ¬øPor qu√© pasa esto? Bueno, porque las covariables no tienen la misma escala. La edad est√° en un rango de <span class="math inline">\(20\)</span> a <span class="math inline">\(50\)</span> y el salario en un rango de <span class="math inline">\(10,000\)</span> a <span class="math inline">\(100,000\)</span>. Entonces, la distancia euclidiana est√° siendo dominada por la variable salario. Es decir, que si bien el el empleado <span class="math inline">\(10\)</span> est√° m√°s cerca en general, el empleado <span class="math inline">\(9\)</span> est√° m√°s cerca en t√©rminos de salario, que es una magnitud con un rango m√°s amplio.</p>
<div class="page-columns page-full"><p>¬øC√≥mo resolvemos esto? Pues estandarizando las covariables<a href="#fn6" class="footnote-ref" id="fnref6" role="doc-noteref"><sup>6</sup></a>. Veamos la misma figura pero estandarizada:</p><div class="no-row-height column-margin column-container"><li id="fn6"><p><sup>6</sup>&nbsp;Es decir, le restamos la media y dividimos por la desviaci√≥n est√°ndar.</p></li></div></div>
<div class="cell">
<details>
<summary>Ver el c√≥digo</summary>
<div class="sourceCode cell-code" id="cb18"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb18-1"><a href="#cb18-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Estandarizamos las covariables</span></span>
<span id="cb18-2"><a href="#cb18-2" aria-hidden="true" tabindex="-1"></a>empleados_tbl_estandarizado <span class="ot">&lt;-</span> empleados_tbl <span class="sc">|&gt;</span> </span>
<span id="cb18-3"><a href="#cb18-3" aria-hidden="true" tabindex="-1"></a>  <span class="fu">mutate</span>(<span class="at">Edad_st =</span> (Edad <span class="sc">-</span> <span class="fu">mean</span>(Edad)) <span class="sc">/</span> <span class="fu">sd</span>(Edad),</span>
<span id="cb18-4"><a href="#cb18-4" aria-hidden="true" tabindex="-1"></a>         <span class="at">Salario_st =</span> (Salario <span class="sc">-</span> <span class="fu">mean</span>(Salario)) <span class="sc">/</span> <span class="fu">sd</span>(Salario))</span>
<span id="cb18-5"><a href="#cb18-5" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb18-6"><a href="#cb18-6" aria-hidden="true" tabindex="-1"></a>empleados_tbl_estandarizado <span class="sc">%&gt;%</span> </span>
<span id="cb18-7"><a href="#cb18-7" aria-hidden="true" tabindex="-1"></a>  <span class="fu">ggplot</span>(<span class="fu">aes</span>(<span class="at">x =</span> Edad_st,</span>
<span id="cb18-8"><a href="#cb18-8" aria-hidden="true" tabindex="-1"></a>             <span class="at">y =</span> Salario_st,</span>
<span id="cb18-9"><a href="#cb18-9" aria-hidden="true" tabindex="-1"></a>             <span class="at">color =</span> Grupo)) <span class="sc">+</span></span>
<span id="cb18-10"><a href="#cb18-10" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_point</span>(<span class="at">alpha =</span> .<span class="dv">2</span>) <span class="sc">+</span> </span>
<span id="cb18-11"><a href="#cb18-11" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_point</span>(<span class="at">data =</span> empleados_tbl_estandarizado[<span class="fu">c</span>(<span class="dv">9</span>, <span class="dv">10</span>, <span class="dv">18</span>),]) <span class="sc">+</span> </span>
<span id="cb18-12"><a href="#cb18-12" aria-hidden="true" tabindex="-1"></a>  <span class="fu">scale_color_brewer</span>(<span class="at">palette =</span> <span class="st">"Dark2"</span>) <span class="sc">+</span></span>
<span id="cb18-13"><a href="#cb18-13" aria-hidden="true" tabindex="-1"></a>  <span class="fu">labs</span>(<span class="at">color =</span> <span class="cn">NULL</span>, <span class="at">x =</span> <span class="st">"Edad estandarizada"</span>, <span class="at">y =</span> <span class="st">"Salario estandarizado"</span>) <span class="sc">+</span></span>
<span id="cb18-14"><a href="#cb18-14" aria-hidden="true" tabindex="-1"></a>  <span class="fu">theme_bw</span>() <span class="sc">+</span></span>
<span id="cb18-15"><a href="#cb18-15" aria-hidden="true" tabindex="-1"></a>  <span class="fu">theme</span>(<span class="at">legend.position =</span> <span class="st">"top"</span>)</span></code><button title="Copiar al portapapeles" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
<div class="cell-output-display">
<p><img src="matching_files/figure-html/unnamed-chunk-20-1.png" class="img-fluid" width="576"></p>
</div>
</div>
<p>Pero se ve igual. ¬ø<em>EMOSIDO ENGA√ëADO</em>? No, la relaci√≥n geom√©trica va a seguir siendo la misma y est√° perfecto que as√≠ sea, pero calculemos de nuevo las distancias y veamos qu√© punto es el m√°s cercano.</p>
<div class="cell">
<details>
<summary>Ver el c√≥digo</summary>
<div class="sourceCode cell-code" id="cb19"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb19-1"><a href="#cb19-1" aria-hidden="true" tabindex="-1"></a>distancia_a_9_st <span class="ot">&lt;-</span> <span class="fu">distancia_euclidea</span>(empleados_tbl_estandarizado[<span class="dv">9</span>, <span class="fu">c</span>(<span class="st">"Edad_st"</span>, <span class="st">"Salario_st"</span>)],</span>
<span id="cb19-2"><a href="#cb19-2" aria-hidden="true" tabindex="-1"></a>                                        empleados_tbl_estandarizado[<span class="dv">18</span>, <span class="fu">c</span>(<span class="st">"Edad_st"</span>, <span class="st">"Salario_st"</span>)])</span>
<span id="cb19-3"><a href="#cb19-3" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb19-4"><a href="#cb19-4" aria-hidden="true" tabindex="-1"></a>distancia_a_10_st <span class="ot">&lt;-</span> <span class="fu">distancia_euclidea</span>(empleados_tbl_estandarizado[<span class="dv">10</span>, <span class="fu">c</span>(<span class="st">"Edad_st"</span>, <span class="st">"Salario_st"</span>)],</span>
<span id="cb19-5"><a href="#cb19-5" aria-hidden="true" tabindex="-1"></a>                                         empleados_tbl_estandarizado[<span class="dv">18</span>, <span class="fu">c</span>(<span class="st">"Edad_st"</span>, <span class="st">"Salario_st"</span>)])</span>
<span id="cb19-6"><a href="#cb19-6" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb19-7"><a href="#cb19-7" aria-hidden="true" tabindex="-1"></a><span class="fu">tibble</span>(<span class="at">Empleado =</span> <span class="fu">c</span>(<span class="st">"9"</span>, <span class="st">"10"</span>),</span>
<span id="cb19-8"><a href="#cb19-8" aria-hidden="true" tabindex="-1"></a>       <span class="at">Distancia =</span> <span class="fu">c</span>(distancia_a_9_st, distancia_a_10_st)) <span class="sc">%&gt;%</span></span>
<span id="cb19-9"><a href="#cb19-9" aria-hidden="true" tabindex="-1"></a>  <span class="fu">gt</span>() <span class="sc">%&gt;%</span></span>
<span id="cb19-10"><a href="#cb19-10" aria-hidden="true" tabindex="-1"></a>  <span class="fu">tab_header</span>(</span>
<span id="cb19-11"><a href="#cb19-11" aria-hidden="true" tabindex="-1"></a>    <span class="at">title =</span> <span class="st">"Distancias euclidianas entre el empleado 18 y los empleados 9 y 10 (estandarizado)"</span></span>
<span id="cb19-12"><a href="#cb19-12" aria-hidden="true" tabindex="-1"></a>  )</span></code><button title="Copiar al portapapeles" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
<div class="cell-output-display">

<div id="pjbljhepek" style="padding-left:0px;padding-right:0px;padding-top:10px;padding-bottom:10px;overflow-x:auto;overflow-y:auto;width:auto;height:auto;">
<style>#pjbljhepek table {
  font-family: system-ui, 'Segoe UI', Roboto, Helvetica, Arial, sans-serif, 'Apple Color Emoji', 'Segoe UI Emoji', 'Segoe UI Symbol', 'Noto Color Emoji';
  -webkit-font-smoothing: antialiased;
  -moz-osx-font-smoothing: grayscale;
}

#pjbljhepek thead, #pjbljhepek tbody, #pjbljhepek tfoot, #pjbljhepek tr, #pjbljhepek td, #pjbljhepek th {
  border-style: none;
}

#pjbljhepek p {
  margin: 0;
  padding: 0;
}

#pjbljhepek .gt_table {
  display: table;
  border-collapse: collapse;
  line-height: normal;
  margin-left: auto;
  margin-right: auto;
  color: #333333;
  font-size: 16px;
  font-weight: normal;
  font-style: normal;
  background-color: #FFFFFF;
  width: auto;
  border-top-style: solid;
  border-top-width: 2px;
  border-top-color: #A8A8A8;
  border-right-style: none;
  border-right-width: 2px;
  border-right-color: #D3D3D3;
  border-bottom-style: solid;
  border-bottom-width: 2px;
  border-bottom-color: #A8A8A8;
  border-left-style: none;
  border-left-width: 2px;
  border-left-color: #D3D3D3;
}

#pjbljhepek .gt_caption {
  padding-top: 4px;
  padding-bottom: 4px;
}

#pjbljhepek .gt_title {
  color: #333333;
  font-size: 125%;
  font-weight: initial;
  padding-top: 4px;
  padding-bottom: 4px;
  padding-left: 5px;
  padding-right: 5px;
  border-bottom-color: #FFFFFF;
  border-bottom-width: 0;
}

#pjbljhepek .gt_subtitle {
  color: #333333;
  font-size: 85%;
  font-weight: initial;
  padding-top: 3px;
  padding-bottom: 5px;
  padding-left: 5px;
  padding-right: 5px;
  border-top-color: #FFFFFF;
  border-top-width: 0;
}

#pjbljhepek .gt_heading {
  background-color: #FFFFFF;
  text-align: center;
  border-bottom-color: #FFFFFF;
  border-left-style: none;
  border-left-width: 1px;
  border-left-color: #D3D3D3;
  border-right-style: none;
  border-right-width: 1px;
  border-right-color: #D3D3D3;
}

#pjbljhepek .gt_bottom_border {
  border-bottom-style: solid;
  border-bottom-width: 2px;
  border-bottom-color: #D3D3D3;
}

#pjbljhepek .gt_col_headings {
  border-top-style: solid;
  border-top-width: 2px;
  border-top-color: #D3D3D3;
  border-bottom-style: solid;
  border-bottom-width: 2px;
  border-bottom-color: #D3D3D3;
  border-left-style: none;
  border-left-width: 1px;
  border-left-color: #D3D3D3;
  border-right-style: none;
  border-right-width: 1px;
  border-right-color: #D3D3D3;
}

#pjbljhepek .gt_col_heading {
  color: #333333;
  background-color: #FFFFFF;
  font-size: 100%;
  font-weight: normal;
  text-transform: inherit;
  border-left-style: none;
  border-left-width: 1px;
  border-left-color: #D3D3D3;
  border-right-style: none;
  border-right-width: 1px;
  border-right-color: #D3D3D3;
  vertical-align: bottom;
  padding-top: 5px;
  padding-bottom: 6px;
  padding-left: 5px;
  padding-right: 5px;
  overflow-x: hidden;
}

#pjbljhepek .gt_column_spanner_outer {
  color: #333333;
  background-color: #FFFFFF;
  font-size: 100%;
  font-weight: normal;
  text-transform: inherit;
  padding-top: 0;
  padding-bottom: 0;
  padding-left: 4px;
  padding-right: 4px;
}

#pjbljhepek .gt_column_spanner_outer:first-child {
  padding-left: 0;
}

#pjbljhepek .gt_column_spanner_outer:last-child {
  padding-right: 0;
}

#pjbljhepek .gt_column_spanner {
  border-bottom-style: solid;
  border-bottom-width: 2px;
  border-bottom-color: #D3D3D3;
  vertical-align: bottom;
  padding-top: 5px;
  padding-bottom: 5px;
  overflow-x: hidden;
  display: inline-block;
  width: 100%;
}

#pjbljhepek .gt_spanner_row {
  border-bottom-style: hidden;
}

#pjbljhepek .gt_group_heading {
  padding-top: 8px;
  padding-bottom: 8px;
  padding-left: 5px;
  padding-right: 5px;
  color: #333333;
  background-color: #FFFFFF;
  font-size: 100%;
  font-weight: initial;
  text-transform: inherit;
  border-top-style: solid;
  border-top-width: 2px;
  border-top-color: #D3D3D3;
  border-bottom-style: solid;
  border-bottom-width: 2px;
  border-bottom-color: #D3D3D3;
  border-left-style: none;
  border-left-width: 1px;
  border-left-color: #D3D3D3;
  border-right-style: none;
  border-right-width: 1px;
  border-right-color: #D3D3D3;
  vertical-align: middle;
  text-align: left;
}

#pjbljhepek .gt_empty_group_heading {
  padding: 0.5px;
  color: #333333;
  background-color: #FFFFFF;
  font-size: 100%;
  font-weight: initial;
  border-top-style: solid;
  border-top-width: 2px;
  border-top-color: #D3D3D3;
  border-bottom-style: solid;
  border-bottom-width: 2px;
  border-bottom-color: #D3D3D3;
  vertical-align: middle;
}

#pjbljhepek .gt_from_md > :first-child {
  margin-top: 0;
}

#pjbljhepek .gt_from_md > :last-child {
  margin-bottom: 0;
}

#pjbljhepek .gt_row {
  padding-top: 8px;
  padding-bottom: 8px;
  padding-left: 5px;
  padding-right: 5px;
  margin: 10px;
  border-top-style: solid;
  border-top-width: 1px;
  border-top-color: #D3D3D3;
  border-left-style: none;
  border-left-width: 1px;
  border-left-color: #D3D3D3;
  border-right-style: none;
  border-right-width: 1px;
  border-right-color: #D3D3D3;
  vertical-align: middle;
  overflow-x: hidden;
}

#pjbljhepek .gt_stub {
  color: #333333;
  background-color: #FFFFFF;
  font-size: 100%;
  font-weight: initial;
  text-transform: inherit;
  border-right-style: solid;
  border-right-width: 2px;
  border-right-color: #D3D3D3;
  padding-left: 5px;
  padding-right: 5px;
}

#pjbljhepek .gt_stub_row_group {
  color: #333333;
  background-color: #FFFFFF;
  font-size: 100%;
  font-weight: initial;
  text-transform: inherit;
  border-right-style: solid;
  border-right-width: 2px;
  border-right-color: #D3D3D3;
  padding-left: 5px;
  padding-right: 5px;
  vertical-align: top;
}

#pjbljhepek .gt_row_group_first td {
  border-top-width: 2px;
}

#pjbljhepek .gt_row_group_first th {
  border-top-width: 2px;
}

#pjbljhepek .gt_summary_row {
  color: #333333;
  background-color: #FFFFFF;
  text-transform: inherit;
  padding-top: 8px;
  padding-bottom: 8px;
  padding-left: 5px;
  padding-right: 5px;
}

#pjbljhepek .gt_first_summary_row {
  border-top-style: solid;
  border-top-color: #D3D3D3;
}

#pjbljhepek .gt_first_summary_row.thick {
  border-top-width: 2px;
}

#pjbljhepek .gt_last_summary_row {
  padding-top: 8px;
  padding-bottom: 8px;
  padding-left: 5px;
  padding-right: 5px;
  border-bottom-style: solid;
  border-bottom-width: 2px;
  border-bottom-color: #D3D3D3;
}

#pjbljhepek .gt_grand_summary_row {
  color: #333333;
  background-color: #FFFFFF;
  text-transform: inherit;
  padding-top: 8px;
  padding-bottom: 8px;
  padding-left: 5px;
  padding-right: 5px;
}

#pjbljhepek .gt_first_grand_summary_row {
  padding-top: 8px;
  padding-bottom: 8px;
  padding-left: 5px;
  padding-right: 5px;
  border-top-style: double;
  border-top-width: 6px;
  border-top-color: #D3D3D3;
}

#pjbljhepek .gt_last_grand_summary_row_top {
  padding-top: 8px;
  padding-bottom: 8px;
  padding-left: 5px;
  padding-right: 5px;
  border-bottom-style: double;
  border-bottom-width: 6px;
  border-bottom-color: #D3D3D3;
}

#pjbljhepek .gt_striped {
  background-color: rgba(128, 128, 128, 0.05);
}

#pjbljhepek .gt_table_body {
  border-top-style: solid;
  border-top-width: 2px;
  border-top-color: #D3D3D3;
  border-bottom-style: solid;
  border-bottom-width: 2px;
  border-bottom-color: #D3D3D3;
}

#pjbljhepek .gt_footnotes {
  color: #333333;
  background-color: #FFFFFF;
  border-bottom-style: none;
  border-bottom-width: 2px;
  border-bottom-color: #D3D3D3;
  border-left-style: none;
  border-left-width: 2px;
  border-left-color: #D3D3D3;
  border-right-style: none;
  border-right-width: 2px;
  border-right-color: #D3D3D3;
}

#pjbljhepek .gt_footnote {
  margin: 0px;
  font-size: 90%;
  padding-top: 4px;
  padding-bottom: 4px;
  padding-left: 5px;
  padding-right: 5px;
}

#pjbljhepek .gt_sourcenotes {
  color: #333333;
  background-color: #FFFFFF;
  border-bottom-style: none;
  border-bottom-width: 2px;
  border-bottom-color: #D3D3D3;
  border-left-style: none;
  border-left-width: 2px;
  border-left-color: #D3D3D3;
  border-right-style: none;
  border-right-width: 2px;
  border-right-color: #D3D3D3;
}

#pjbljhepek .gt_sourcenote {
  font-size: 90%;
  padding-top: 4px;
  padding-bottom: 4px;
  padding-left: 5px;
  padding-right: 5px;
}

#pjbljhepek .gt_left {
  text-align: left;
}

#pjbljhepek .gt_center {
  text-align: center;
}

#pjbljhepek .gt_right {
  text-align: right;
  font-variant-numeric: tabular-nums;
}

#pjbljhepek .gt_font_normal {
  font-weight: normal;
}

#pjbljhepek .gt_font_bold {
  font-weight: bold;
}

#pjbljhepek .gt_font_italic {
  font-style: italic;
}

#pjbljhepek .gt_super {
  font-size: 65%;
}

#pjbljhepek .gt_footnote_marks {
  font-size: 75%;
  vertical-align: 0.4em;
  position: initial;
}

#pjbljhepek .gt_asterisk {
  font-size: 100%;
  vertical-align: 0;
}

#pjbljhepek .gt_indent_1 {
  text-indent: 5px;
}

#pjbljhepek .gt_indent_2 {
  text-indent: 10px;
}

#pjbljhepek .gt_indent_3 {
  text-indent: 15px;
}

#pjbljhepek .gt_indent_4 {
  text-indent: 20px;
}

#pjbljhepek .gt_indent_5 {
  text-indent: 25px;
}

#pjbljhepek .katex-display {
  display: inline-flex !important;
  margin-bottom: 0.75em !important;
}

#pjbljhepek div.Reactable > div.rt-table > div.rt-thead > div.rt-tr.rt-tr-group-header > div.rt-th-group:after {
  height: 0px !important;
}
</style>
<table class="gt_table" data-quarto-disable-processing="false" data-quarto-bootstrap="false">
  <thead>
    <tr class="gt_heading">
      <td colspan="2" class="gt_heading gt_title gt_font_normal gt_bottom_border" style="">Distancias euclidianas entre el empleado 18 y los empleados 9 y 10 (estandarizado)</td>
    </tr>
    
    <tr class="gt_col_headings">
      <th class="gt_col_heading gt_columns_bottom_border gt_right" rowspan="1" colspan="1" scope="col" id="Empleado">Empleado</th>
      <th class="gt_col_heading gt_columns_bottom_border gt_center" rowspan="1" colspan="1" scope="col" id="Distancia">Distancia</th>
    </tr>
  </thead>
  <tbody class="gt_table_body">
    <tr><td headers="Empleado" class="gt_row gt_right">9</td>
<td headers="Distancia" class="gt_row gt_center">0.5162689</td></tr>
    <tr><td headers="Empleado" class="gt_row gt_right">10</td>
<td headers="Distancia" class="gt_row gt_center">0.5684286</td></tr>
  </tbody>
  
  
</table>
</div>
</div>
</div>
<p>Ahora s√≠ el m√°s cercano es el empleado <span class="math inline">\(9\)</span>.</p>
<div class="page-columns page-full"><p>Otra opci√≥n es la distancia de <strong>Mahalanobis</strong>, adem√°s de ver ‚Äúqu√© tan lejos‚Äù est√°n dos puntos en cada variable, tambi√©n ajusta por la forma en que esas variables se relacionan entre s√≠. Es decir, si las variables est√°n correlacionadas, la distancia de Mahalanobis las considera m√°s cercanas que la distancia euclidiana <a href="#fn7" class="footnote-ref" id="fnref7" role="doc-noteref"><sup>7</sup></a>.</p><div class="no-row-height column-margin column-container"><li id="fn7"><p><sup>7</sup>&nbsp;NSi tienen inter√©s en entender un poco m√°s profundamente qu√© es la distancia de Mahalanobis les recomiendo <a href="https://www.youtube.com/watch?v=eutzTEGgLpE&amp;t=139s">este video</a>.</p></li></div></div>
<p>Siempre que podamos vamos a usar la distancia de <strong>Mahalanobis</strong>, porque es la que refleja mejor las relaciones entre las dimensiones y, en caso de que no haya correlaci√≥n, va a terminar siendo la distancia euclideana (es f√°cil de demostrar si tienen ganas y, claro, tiempo).</p>
<p>Una √∫ltima aclaraci√≥n, en esta distancia no es necesario estandarizar las covariables porque la distancia de Mahalanobis ya lo hace por nosotros. Entonces, si tenemos dos puntos <span class="math inline">\((edad_1, salario_1)\)</span> y <span class="math inline">\((edad_2, salario_2)\)</span>, la distancia de Mahalanobis ser√≠a:</p>
<p><span class="math display">\[
distancia_{mahalanobis} = \sqrt{(edad_1 - edad_2, salario_1 - salario_2) \cdot S^{-1} \cdot (edad_1 - edad_2, salario_1 - salario_2)^T}
\]</span></p>
<p>Donde <span class="math inline">\(S\)</span> es la matriz de covarianzas de las variables <span class="math inline">\(edad\)</span> y <span class="math inline">\(salario\)</span>. Esta distancia nos dice qu√© tan lejos est√°n los puntos considerando no solo sus diferencias individuales, sino tambi√©n c√≥mo se relacionan entre s√≠.</p>
<p>Dejemos un poquito las comparaciones entre m√©tricas de distancia para m√°s adelante y veamos c√≥mo podemos usar estas distancias para hacer <em>matching</em>.</p>
<p>En este caso vamos a analizar un ejemplo en el que queremos evaluar la efectividad en la recuperaci√≥n de una determinada medicina. En este caso (supongamos que hicimos el <strong>DAG</strong>, identificamos los <em>backdoors</em>, etc.) queremos controlar por tres variables: Edad, Sexo y Severidad (el famoso vector <span class="math inline">\(X\)</span>). Veamos <span class="math inline">\(5\)</span> datos la azar.</p>
<div class="cell">
<details>
<summary>Ver el c√≥digo</summary>
<div class="sourceCode cell-code" id="cb20"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb20-1"><a href="#cb20-1" aria-hidden="true" tabindex="-1"></a>medicine_impact_recovery <span class="ot">&lt;-</span> </span>
<span id="cb20-2"><a href="#cb20-2" aria-hidden="true" tabindex="-1"></a>  <span class="fu">read_csv</span>(<span class="st">"https://raw.githubusercontent.com/matheusfacure/python-causality-handbook/master/causal-inference-for-the-brave-and-true/data/medicine_impact_recovery.csv"</span>,</span>
<span id="cb20-3"><a href="#cb20-3" aria-hidden="true" tabindex="-1"></a>           <span class="at">show_col_types =</span> <span class="cn">FALSE</span>) <span class="sc">%&gt;%</span></span>
<span id="cb20-4"><a href="#cb20-4" aria-hidden="true" tabindex="-1"></a>  <span class="fu">rename</span>(Recuperaci√≥n <span class="ot">=</span> recovery,</span>
<span id="cb20-5"><a href="#cb20-5" aria-hidden="true" tabindex="-1"></a>         <span class="at">Medicina =</span> medication,</span>
<span id="cb20-6"><a href="#cb20-6" aria-hidden="true" tabindex="-1"></a>         <span class="at">Sexo =</span> sex,</span>
<span id="cb20-7"><a href="#cb20-7" aria-hidden="true" tabindex="-1"></a>         <span class="at">Edad =</span> age,</span>
<span id="cb20-8"><a href="#cb20-8" aria-hidden="true" tabindex="-1"></a>         <span class="at">Severidad =</span> severity)</span>
<span id="cb20-9"><a href="#cb20-9" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb20-10"><a href="#cb20-10" aria-hidden="true" tabindex="-1"></a><span class="fu">set.seed</span>(<span class="dv">1</span>)</span>
<span id="cb20-11"><a href="#cb20-11" aria-hidden="true" tabindex="-1"></a>medicine_impact_recovery <span class="sc">|&gt;</span> </span>
<span id="cb20-12"><a href="#cb20-12" aria-hidden="true" tabindex="-1"></a>  <span class="fu">sample_n</span>(<span class="dv">5</span>) <span class="sc">|&gt;</span> </span>
<span id="cb20-13"><a href="#cb20-13" aria-hidden="true" tabindex="-1"></a>  gt<span class="sc">::</span><span class="fu">gt</span>() <span class="sc">|&gt;</span> </span>
<span id="cb20-14"><a href="#cb20-14" aria-hidden="true" tabindex="-1"></a>  gt<span class="sc">::</span><span class="fu">tab_header</span>(</span>
<span id="cb20-15"><a href="#cb20-15" aria-hidden="true" tabindex="-1"></a>    <span class="at">title =</span> <span class="st">"Datos de un experimento sobre el impacto de una medicina en la recuperaci√≥n"</span></span>
<span id="cb20-16"><a href="#cb20-16" aria-hidden="true" tabindex="-1"></a>  )</span></code><button title="Copiar al portapapeles" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
<div class="cell-output-display">

<div id="rsauujvnjg" style="padding-left:0px;padding-right:0px;padding-top:10px;padding-bottom:10px;overflow-x:auto;overflow-y:auto;width:auto;height:auto;">
<style>#rsauujvnjg table {
  font-family: system-ui, 'Segoe UI', Roboto, Helvetica, Arial, sans-serif, 'Apple Color Emoji', 'Segoe UI Emoji', 'Segoe UI Symbol', 'Noto Color Emoji';
  -webkit-font-smoothing: antialiased;
  -moz-osx-font-smoothing: grayscale;
}

#rsauujvnjg thead, #rsauujvnjg tbody, #rsauujvnjg tfoot, #rsauujvnjg tr, #rsauujvnjg td, #rsauujvnjg th {
  border-style: none;
}

#rsauujvnjg p {
  margin: 0;
  padding: 0;
}

#rsauujvnjg .gt_table {
  display: table;
  border-collapse: collapse;
  line-height: normal;
  margin-left: auto;
  margin-right: auto;
  color: #333333;
  font-size: 16px;
  font-weight: normal;
  font-style: normal;
  background-color: #FFFFFF;
  width: auto;
  border-top-style: solid;
  border-top-width: 2px;
  border-top-color: #A8A8A8;
  border-right-style: none;
  border-right-width: 2px;
  border-right-color: #D3D3D3;
  border-bottom-style: solid;
  border-bottom-width: 2px;
  border-bottom-color: #A8A8A8;
  border-left-style: none;
  border-left-width: 2px;
  border-left-color: #D3D3D3;
}

#rsauujvnjg .gt_caption {
  padding-top: 4px;
  padding-bottom: 4px;
}

#rsauujvnjg .gt_title {
  color: #333333;
  font-size: 125%;
  font-weight: initial;
  padding-top: 4px;
  padding-bottom: 4px;
  padding-left: 5px;
  padding-right: 5px;
  border-bottom-color: #FFFFFF;
  border-bottom-width: 0;
}

#rsauujvnjg .gt_subtitle {
  color: #333333;
  font-size: 85%;
  font-weight: initial;
  padding-top: 3px;
  padding-bottom: 5px;
  padding-left: 5px;
  padding-right: 5px;
  border-top-color: #FFFFFF;
  border-top-width: 0;
}

#rsauujvnjg .gt_heading {
  background-color: #FFFFFF;
  text-align: center;
  border-bottom-color: #FFFFFF;
  border-left-style: none;
  border-left-width: 1px;
  border-left-color: #D3D3D3;
  border-right-style: none;
  border-right-width: 1px;
  border-right-color: #D3D3D3;
}

#rsauujvnjg .gt_bottom_border {
  border-bottom-style: solid;
  border-bottom-width: 2px;
  border-bottom-color: #D3D3D3;
}

#rsauujvnjg .gt_col_headings {
  border-top-style: solid;
  border-top-width: 2px;
  border-top-color: #D3D3D3;
  border-bottom-style: solid;
  border-bottom-width: 2px;
  border-bottom-color: #D3D3D3;
  border-left-style: none;
  border-left-width: 1px;
  border-left-color: #D3D3D3;
  border-right-style: none;
  border-right-width: 1px;
  border-right-color: #D3D3D3;
}

#rsauujvnjg .gt_col_heading {
  color: #333333;
  background-color: #FFFFFF;
  font-size: 100%;
  font-weight: normal;
  text-transform: inherit;
  border-left-style: none;
  border-left-width: 1px;
  border-left-color: #D3D3D3;
  border-right-style: none;
  border-right-width: 1px;
  border-right-color: #D3D3D3;
  vertical-align: bottom;
  padding-top: 5px;
  padding-bottom: 6px;
  padding-left: 5px;
  padding-right: 5px;
  overflow-x: hidden;
}

#rsauujvnjg .gt_column_spanner_outer {
  color: #333333;
  background-color: #FFFFFF;
  font-size: 100%;
  font-weight: normal;
  text-transform: inherit;
  padding-top: 0;
  padding-bottom: 0;
  padding-left: 4px;
  padding-right: 4px;
}

#rsauujvnjg .gt_column_spanner_outer:first-child {
  padding-left: 0;
}

#rsauujvnjg .gt_column_spanner_outer:last-child {
  padding-right: 0;
}

#rsauujvnjg .gt_column_spanner {
  border-bottom-style: solid;
  border-bottom-width: 2px;
  border-bottom-color: #D3D3D3;
  vertical-align: bottom;
  padding-top: 5px;
  padding-bottom: 5px;
  overflow-x: hidden;
  display: inline-block;
  width: 100%;
}

#rsauujvnjg .gt_spanner_row {
  border-bottom-style: hidden;
}

#rsauujvnjg .gt_group_heading {
  padding-top: 8px;
  padding-bottom: 8px;
  padding-left: 5px;
  padding-right: 5px;
  color: #333333;
  background-color: #FFFFFF;
  font-size: 100%;
  font-weight: initial;
  text-transform: inherit;
  border-top-style: solid;
  border-top-width: 2px;
  border-top-color: #D3D3D3;
  border-bottom-style: solid;
  border-bottom-width: 2px;
  border-bottom-color: #D3D3D3;
  border-left-style: none;
  border-left-width: 1px;
  border-left-color: #D3D3D3;
  border-right-style: none;
  border-right-width: 1px;
  border-right-color: #D3D3D3;
  vertical-align: middle;
  text-align: left;
}

#rsauujvnjg .gt_empty_group_heading {
  padding: 0.5px;
  color: #333333;
  background-color: #FFFFFF;
  font-size: 100%;
  font-weight: initial;
  border-top-style: solid;
  border-top-width: 2px;
  border-top-color: #D3D3D3;
  border-bottom-style: solid;
  border-bottom-width: 2px;
  border-bottom-color: #D3D3D3;
  vertical-align: middle;
}

#rsauujvnjg .gt_from_md > :first-child {
  margin-top: 0;
}

#rsauujvnjg .gt_from_md > :last-child {
  margin-bottom: 0;
}

#rsauujvnjg .gt_row {
  padding-top: 8px;
  padding-bottom: 8px;
  padding-left: 5px;
  padding-right: 5px;
  margin: 10px;
  border-top-style: solid;
  border-top-width: 1px;
  border-top-color: #D3D3D3;
  border-left-style: none;
  border-left-width: 1px;
  border-left-color: #D3D3D3;
  border-right-style: none;
  border-right-width: 1px;
  border-right-color: #D3D3D3;
  vertical-align: middle;
  overflow-x: hidden;
}

#rsauujvnjg .gt_stub {
  color: #333333;
  background-color: #FFFFFF;
  font-size: 100%;
  font-weight: initial;
  text-transform: inherit;
  border-right-style: solid;
  border-right-width: 2px;
  border-right-color: #D3D3D3;
  padding-left: 5px;
  padding-right: 5px;
}

#rsauujvnjg .gt_stub_row_group {
  color: #333333;
  background-color: #FFFFFF;
  font-size: 100%;
  font-weight: initial;
  text-transform: inherit;
  border-right-style: solid;
  border-right-width: 2px;
  border-right-color: #D3D3D3;
  padding-left: 5px;
  padding-right: 5px;
  vertical-align: top;
}

#rsauujvnjg .gt_row_group_first td {
  border-top-width: 2px;
}

#rsauujvnjg .gt_row_group_first th {
  border-top-width: 2px;
}

#rsauujvnjg .gt_summary_row {
  color: #333333;
  background-color: #FFFFFF;
  text-transform: inherit;
  padding-top: 8px;
  padding-bottom: 8px;
  padding-left: 5px;
  padding-right: 5px;
}

#rsauujvnjg .gt_first_summary_row {
  border-top-style: solid;
  border-top-color: #D3D3D3;
}

#rsauujvnjg .gt_first_summary_row.thick {
  border-top-width: 2px;
}

#rsauujvnjg .gt_last_summary_row {
  padding-top: 8px;
  padding-bottom: 8px;
  padding-left: 5px;
  padding-right: 5px;
  border-bottom-style: solid;
  border-bottom-width: 2px;
  border-bottom-color: #D3D3D3;
}

#rsauujvnjg .gt_grand_summary_row {
  color: #333333;
  background-color: #FFFFFF;
  text-transform: inherit;
  padding-top: 8px;
  padding-bottom: 8px;
  padding-left: 5px;
  padding-right: 5px;
}

#rsauujvnjg .gt_first_grand_summary_row {
  padding-top: 8px;
  padding-bottom: 8px;
  padding-left: 5px;
  padding-right: 5px;
  border-top-style: double;
  border-top-width: 6px;
  border-top-color: #D3D3D3;
}

#rsauujvnjg .gt_last_grand_summary_row_top {
  padding-top: 8px;
  padding-bottom: 8px;
  padding-left: 5px;
  padding-right: 5px;
  border-bottom-style: double;
  border-bottom-width: 6px;
  border-bottom-color: #D3D3D3;
}

#rsauujvnjg .gt_striped {
  background-color: rgba(128, 128, 128, 0.05);
}

#rsauujvnjg .gt_table_body {
  border-top-style: solid;
  border-top-width: 2px;
  border-top-color: #D3D3D3;
  border-bottom-style: solid;
  border-bottom-width: 2px;
  border-bottom-color: #D3D3D3;
}

#rsauujvnjg .gt_footnotes {
  color: #333333;
  background-color: #FFFFFF;
  border-bottom-style: none;
  border-bottom-width: 2px;
  border-bottom-color: #D3D3D3;
  border-left-style: none;
  border-left-width: 2px;
  border-left-color: #D3D3D3;
  border-right-style: none;
  border-right-width: 2px;
  border-right-color: #D3D3D3;
}

#rsauujvnjg .gt_footnote {
  margin: 0px;
  font-size: 90%;
  padding-top: 4px;
  padding-bottom: 4px;
  padding-left: 5px;
  padding-right: 5px;
}

#rsauujvnjg .gt_sourcenotes {
  color: #333333;
  background-color: #FFFFFF;
  border-bottom-style: none;
  border-bottom-width: 2px;
  border-bottom-color: #D3D3D3;
  border-left-style: none;
  border-left-width: 2px;
  border-left-color: #D3D3D3;
  border-right-style: none;
  border-right-width: 2px;
  border-right-color: #D3D3D3;
}

#rsauujvnjg .gt_sourcenote {
  font-size: 90%;
  padding-top: 4px;
  padding-bottom: 4px;
  padding-left: 5px;
  padding-right: 5px;
}

#rsauujvnjg .gt_left {
  text-align: left;
}

#rsauujvnjg .gt_center {
  text-align: center;
}

#rsauujvnjg .gt_right {
  text-align: right;
  font-variant-numeric: tabular-nums;
}

#rsauujvnjg .gt_font_normal {
  font-weight: normal;
}

#rsauujvnjg .gt_font_bold {
  font-weight: bold;
}

#rsauujvnjg .gt_font_italic {
  font-style: italic;
}

#rsauujvnjg .gt_super {
  font-size: 65%;
}

#rsauujvnjg .gt_footnote_marks {
  font-size: 75%;
  vertical-align: 0.4em;
  position: initial;
}

#rsauujvnjg .gt_asterisk {
  font-size: 100%;
  vertical-align: 0;
}

#rsauujvnjg .gt_indent_1 {
  text-indent: 5px;
}

#rsauujvnjg .gt_indent_2 {
  text-indent: 10px;
}

#rsauujvnjg .gt_indent_3 {
  text-indent: 15px;
}

#rsauujvnjg .gt_indent_4 {
  text-indent: 20px;
}

#rsauujvnjg .gt_indent_5 {
  text-indent: 25px;
}

#rsauujvnjg .katex-display {
  display: inline-flex !important;
  margin-bottom: 0.75em !important;
}

#rsauujvnjg div.Reactable > div.rt-table > div.rt-thead > div.rt-tr.rt-tr-group-header > div.rt-th-group:after {
  height: 0px !important;
}
</style>
<table class="gt_table" data-quarto-disable-processing="false" data-quarto-bootstrap="false">
  <thead>
    <tr class="gt_heading">
      <td colspan="5" class="gt_heading gt_title gt_font_normal gt_bottom_border" style="">Datos de un experimento sobre el impacto de una medicina en la recuperaci√≥n</td>
    </tr>
    
    <tr class="gt_col_headings">
      <th class="gt_col_heading gt_columns_bottom_border gt_right" rowspan="1" colspan="1" scope="col" id="Sexo">Sexo</th>
      <th class="gt_col_heading gt_columns_bottom_border gt_right" rowspan="1" colspan="1" scope="col" id="Edad">Edad</th>
      <th class="gt_col_heading gt_columns_bottom_border gt_right" rowspan="1" colspan="1" scope="col" id="Severidad">Severidad</th>
      <th class="gt_col_heading gt_columns_bottom_border gt_right" rowspan="1" colspan="1" scope="col" id="Medicina">Medicina</th>
      <th class="gt_col_heading gt_columns_bottom_border gt_right" rowspan="1" colspan="1" scope="col" id="Recuperaci√≥n">Recuperaci√≥n</th>
    </tr>
  </thead>
  <tbody class="gt_table_body">
    <tr><td headers="Sexo" class="gt_row gt_right">0</td>
<td headers="Edad" class="gt_row gt_right">47.67569</td>
<td headers="Severidad" class="gt_row gt_right">0.43410184</td>
<td headers="Medicina" class="gt_row gt_right">0</td>
<td headers="Recuperaci√≥n" class="gt_row gt_right">37</td></tr>
    <tr><td headers="Sexo" class="gt_row gt_right">0</td>
<td headers="Edad" class="gt_row gt_right">19.89644</td>
<td headers="Severidad" class="gt_row gt_right">0.24021836</td>
<td headers="Medicina" class="gt_row gt_right">0</td>
<td headers="Recuperaci√≥n" class="gt_row gt_right">15</td></tr>
    <tr><td headers="Sexo" class="gt_row gt_right">1</td>
<td headers="Edad" class="gt_row gt_right">26.93100</td>
<td headers="Severidad" class="gt_row gt_right">0.09442637</td>
<td headers="Medicina" class="gt_row gt_right">0</td>
<td headers="Recuperaci√≥n" class="gt_row gt_right">13</td></tr>
    <tr><td headers="Sexo" class="gt_row gt_right">1</td>
<td headers="Edad" class="gt_row gt_right">11.63124</td>
<td headers="Severidad" class="gt_row gt_right">0.33707949</td>
<td headers="Medicina" class="gt_row gt_right">0</td>
<td headers="Recuperaci√≥n" class="gt_row gt_right">24</td></tr>
    <tr><td headers="Sexo" class="gt_row gt_right">0</td>
<td headers="Edad" class="gt_row gt_right">58.04307</td>
<td headers="Severidad" class="gt_row gt_right">0.91946590</td>
<td headers="Medicina" class="gt_row gt_right">1</td>
<td headers="Recuperaci√≥n" class="gt_row gt_right">45</td></tr>
  </tbody>
  
  
</table>
</div>
</div>
</div>
<p>Y ahora veamos c√≥mo se distribuyen los datos en las variables Edad y Severidad.</p>
<div class="cell">
<details>
<summary>Ver el c√≥digo</summary>
<div class="sourceCode cell-code" id="cb21"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb21-1"><a href="#cb21-1" aria-hidden="true" tabindex="-1"></a>medicine_impact_recovery <span class="sc">|&gt;</span> </span>
<span id="cb21-2"><a href="#cb21-2" aria-hidden="true" tabindex="-1"></a>  <span class="fu">ggplot</span>(<span class="fu">aes</span>(<span class="at">x =</span> Edad,</span>
<span id="cb21-3"><a href="#cb21-3" aria-hidden="true" tabindex="-1"></a>             <span class="at">y =</span> Severidad,</span>
<span id="cb21-4"><a href="#cb21-4" aria-hidden="true" tabindex="-1"></a>             <span class="at">color =</span> <span class="fu">factor</span>(Medicina))) <span class="sc">+</span></span>
<span id="cb21-5"><a href="#cb21-5" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_point</span>(<span class="at">size =</span> .<span class="dv">2</span>) <span class="sc">+</span></span>
<span id="cb21-6"><a href="#cb21-6" aria-hidden="true" tabindex="-1"></a>  <span class="fu">scale_color_brewer</span>(<span class="at">palette =</span> <span class="st">"Dark2"</span>) <span class="sc">+</span></span>
<span id="cb21-7"><a href="#cb21-7" aria-hidden="true" tabindex="-1"></a>  <span class="fu">labs</span>(<span class="at">color =</span> <span class="st">"Medicina"</span>) <span class="sc">+</span></span>
<span id="cb21-8"><a href="#cb21-8" aria-hidden="true" tabindex="-1"></a>  <span class="fu">theme_bw</span>() <span class="sc">+</span></span>
<span id="cb21-9"><a href="#cb21-9" aria-hidden="true" tabindex="-1"></a>  <span class="fu">theme</span>(<span class="at">legend.position =</span> <span class="st">"top"</span>)</span></code><button title="Copiar al portapapeles" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
<div class="cell-output-display">
<div class="quarto-figure quarto-figure-center">
<figure class="figure">
<p><img src="matching_files/figure-html/unnamed-chunk-23-1.png" class="img-fluid figure-img" width="576"></p>
<p></p><figcaption class="figure-caption">Como se distribuyen los datos en las variables edad y severidad.</figcaption><p></p>
</figure>
</div>
</div>
</div>
<p>Vemos que claramente calcular el <strong>SDO</strong> no es una buena idea porque la asignaci√≥n al tratamiento no es aleatoria (igual dejemos anotado que vale 16.9). Tambi√©n podemos ver qu√© pasa con el sexo.</p>
<div class="cell">
<details>
<summary>Ver el c√≥digo</summary>
<div class="sourceCode cell-code" id="cb22"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb22-1"><a href="#cb22-1" aria-hidden="true" tabindex="-1"></a>medicine_impact_recovery <span class="sc">|&gt;</span> </span>
<span id="cb22-2"><a href="#cb22-2" aria-hidden="true" tabindex="-1"></a>  <span class="fu">group_by</span>(Sexo) <span class="sc">|&gt;</span></span>
<span id="cb22-3"><a href="#cb22-3" aria-hidden="true" tabindex="-1"></a>  <span class="fu">summarise</span>(<span class="at">No_Medicina =</span> <span class="fu">sum</span>(Medicina <span class="sc">==</span> <span class="dv">0</span>),</span>
<span id="cb22-4"><a href="#cb22-4" aria-hidden="true" tabindex="-1"></a>            <span class="at">Medicina =</span> <span class="fu">sum</span>(Medicina <span class="sc">==</span> <span class="dv">1</span>)) <span class="sc">|&gt;</span></span>
<span id="cb22-5"><a href="#cb22-5" aria-hidden="true" tabindex="-1"></a>  <span class="fu">gt</span>()</span></code><button title="Copiar al portapapeles" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
<div class="cell-output-display">

<div id="ioueiyneeb" style="padding-left:0px;padding-right:0px;padding-top:10px;padding-bottom:10px;overflow-x:auto;overflow-y:auto;width:auto;height:auto;">
<style>#ioueiyneeb table {
  font-family: system-ui, 'Segoe UI', Roboto, Helvetica, Arial, sans-serif, 'Apple Color Emoji', 'Segoe UI Emoji', 'Segoe UI Symbol', 'Noto Color Emoji';
  -webkit-font-smoothing: antialiased;
  -moz-osx-font-smoothing: grayscale;
}

#ioueiyneeb thead, #ioueiyneeb tbody, #ioueiyneeb tfoot, #ioueiyneeb tr, #ioueiyneeb td, #ioueiyneeb th {
  border-style: none;
}

#ioueiyneeb p {
  margin: 0;
  padding: 0;
}

#ioueiyneeb .gt_table {
  display: table;
  border-collapse: collapse;
  line-height: normal;
  margin-left: auto;
  margin-right: auto;
  color: #333333;
  font-size: 16px;
  font-weight: normal;
  font-style: normal;
  background-color: #FFFFFF;
  width: auto;
  border-top-style: solid;
  border-top-width: 2px;
  border-top-color: #A8A8A8;
  border-right-style: none;
  border-right-width: 2px;
  border-right-color: #D3D3D3;
  border-bottom-style: solid;
  border-bottom-width: 2px;
  border-bottom-color: #A8A8A8;
  border-left-style: none;
  border-left-width: 2px;
  border-left-color: #D3D3D3;
}

#ioueiyneeb .gt_caption {
  padding-top: 4px;
  padding-bottom: 4px;
}

#ioueiyneeb .gt_title {
  color: #333333;
  font-size: 125%;
  font-weight: initial;
  padding-top: 4px;
  padding-bottom: 4px;
  padding-left: 5px;
  padding-right: 5px;
  border-bottom-color: #FFFFFF;
  border-bottom-width: 0;
}

#ioueiyneeb .gt_subtitle {
  color: #333333;
  font-size: 85%;
  font-weight: initial;
  padding-top: 3px;
  padding-bottom: 5px;
  padding-left: 5px;
  padding-right: 5px;
  border-top-color: #FFFFFF;
  border-top-width: 0;
}

#ioueiyneeb .gt_heading {
  background-color: #FFFFFF;
  text-align: center;
  border-bottom-color: #FFFFFF;
  border-left-style: none;
  border-left-width: 1px;
  border-left-color: #D3D3D3;
  border-right-style: none;
  border-right-width: 1px;
  border-right-color: #D3D3D3;
}

#ioueiyneeb .gt_bottom_border {
  border-bottom-style: solid;
  border-bottom-width: 2px;
  border-bottom-color: #D3D3D3;
}

#ioueiyneeb .gt_col_headings {
  border-top-style: solid;
  border-top-width: 2px;
  border-top-color: #D3D3D3;
  border-bottom-style: solid;
  border-bottom-width: 2px;
  border-bottom-color: #D3D3D3;
  border-left-style: none;
  border-left-width: 1px;
  border-left-color: #D3D3D3;
  border-right-style: none;
  border-right-width: 1px;
  border-right-color: #D3D3D3;
}

#ioueiyneeb .gt_col_heading {
  color: #333333;
  background-color: #FFFFFF;
  font-size: 100%;
  font-weight: normal;
  text-transform: inherit;
  border-left-style: none;
  border-left-width: 1px;
  border-left-color: #D3D3D3;
  border-right-style: none;
  border-right-width: 1px;
  border-right-color: #D3D3D3;
  vertical-align: bottom;
  padding-top: 5px;
  padding-bottom: 6px;
  padding-left: 5px;
  padding-right: 5px;
  overflow-x: hidden;
}

#ioueiyneeb .gt_column_spanner_outer {
  color: #333333;
  background-color: #FFFFFF;
  font-size: 100%;
  font-weight: normal;
  text-transform: inherit;
  padding-top: 0;
  padding-bottom: 0;
  padding-left: 4px;
  padding-right: 4px;
}

#ioueiyneeb .gt_column_spanner_outer:first-child {
  padding-left: 0;
}

#ioueiyneeb .gt_column_spanner_outer:last-child {
  padding-right: 0;
}

#ioueiyneeb .gt_column_spanner {
  border-bottom-style: solid;
  border-bottom-width: 2px;
  border-bottom-color: #D3D3D3;
  vertical-align: bottom;
  padding-top: 5px;
  padding-bottom: 5px;
  overflow-x: hidden;
  display: inline-block;
  width: 100%;
}

#ioueiyneeb .gt_spanner_row {
  border-bottom-style: hidden;
}

#ioueiyneeb .gt_group_heading {
  padding-top: 8px;
  padding-bottom: 8px;
  padding-left: 5px;
  padding-right: 5px;
  color: #333333;
  background-color: #FFFFFF;
  font-size: 100%;
  font-weight: initial;
  text-transform: inherit;
  border-top-style: solid;
  border-top-width: 2px;
  border-top-color: #D3D3D3;
  border-bottom-style: solid;
  border-bottom-width: 2px;
  border-bottom-color: #D3D3D3;
  border-left-style: none;
  border-left-width: 1px;
  border-left-color: #D3D3D3;
  border-right-style: none;
  border-right-width: 1px;
  border-right-color: #D3D3D3;
  vertical-align: middle;
  text-align: left;
}

#ioueiyneeb .gt_empty_group_heading {
  padding: 0.5px;
  color: #333333;
  background-color: #FFFFFF;
  font-size: 100%;
  font-weight: initial;
  border-top-style: solid;
  border-top-width: 2px;
  border-top-color: #D3D3D3;
  border-bottom-style: solid;
  border-bottom-width: 2px;
  border-bottom-color: #D3D3D3;
  vertical-align: middle;
}

#ioueiyneeb .gt_from_md > :first-child {
  margin-top: 0;
}

#ioueiyneeb .gt_from_md > :last-child {
  margin-bottom: 0;
}

#ioueiyneeb .gt_row {
  padding-top: 8px;
  padding-bottom: 8px;
  padding-left: 5px;
  padding-right: 5px;
  margin: 10px;
  border-top-style: solid;
  border-top-width: 1px;
  border-top-color: #D3D3D3;
  border-left-style: none;
  border-left-width: 1px;
  border-left-color: #D3D3D3;
  border-right-style: none;
  border-right-width: 1px;
  border-right-color: #D3D3D3;
  vertical-align: middle;
  overflow-x: hidden;
}

#ioueiyneeb .gt_stub {
  color: #333333;
  background-color: #FFFFFF;
  font-size: 100%;
  font-weight: initial;
  text-transform: inherit;
  border-right-style: solid;
  border-right-width: 2px;
  border-right-color: #D3D3D3;
  padding-left: 5px;
  padding-right: 5px;
}

#ioueiyneeb .gt_stub_row_group {
  color: #333333;
  background-color: #FFFFFF;
  font-size: 100%;
  font-weight: initial;
  text-transform: inherit;
  border-right-style: solid;
  border-right-width: 2px;
  border-right-color: #D3D3D3;
  padding-left: 5px;
  padding-right: 5px;
  vertical-align: top;
}

#ioueiyneeb .gt_row_group_first td {
  border-top-width: 2px;
}

#ioueiyneeb .gt_row_group_first th {
  border-top-width: 2px;
}

#ioueiyneeb .gt_summary_row {
  color: #333333;
  background-color: #FFFFFF;
  text-transform: inherit;
  padding-top: 8px;
  padding-bottom: 8px;
  padding-left: 5px;
  padding-right: 5px;
}

#ioueiyneeb .gt_first_summary_row {
  border-top-style: solid;
  border-top-color: #D3D3D3;
}

#ioueiyneeb .gt_first_summary_row.thick {
  border-top-width: 2px;
}

#ioueiyneeb .gt_last_summary_row {
  padding-top: 8px;
  padding-bottom: 8px;
  padding-left: 5px;
  padding-right: 5px;
  border-bottom-style: solid;
  border-bottom-width: 2px;
  border-bottom-color: #D3D3D3;
}

#ioueiyneeb .gt_grand_summary_row {
  color: #333333;
  background-color: #FFFFFF;
  text-transform: inherit;
  padding-top: 8px;
  padding-bottom: 8px;
  padding-left: 5px;
  padding-right: 5px;
}

#ioueiyneeb .gt_first_grand_summary_row {
  padding-top: 8px;
  padding-bottom: 8px;
  padding-left: 5px;
  padding-right: 5px;
  border-top-style: double;
  border-top-width: 6px;
  border-top-color: #D3D3D3;
}

#ioueiyneeb .gt_last_grand_summary_row_top {
  padding-top: 8px;
  padding-bottom: 8px;
  padding-left: 5px;
  padding-right: 5px;
  border-bottom-style: double;
  border-bottom-width: 6px;
  border-bottom-color: #D3D3D3;
}

#ioueiyneeb .gt_striped {
  background-color: rgba(128, 128, 128, 0.05);
}

#ioueiyneeb .gt_table_body {
  border-top-style: solid;
  border-top-width: 2px;
  border-top-color: #D3D3D3;
  border-bottom-style: solid;
  border-bottom-width: 2px;
  border-bottom-color: #D3D3D3;
}

#ioueiyneeb .gt_footnotes {
  color: #333333;
  background-color: #FFFFFF;
  border-bottom-style: none;
  border-bottom-width: 2px;
  border-bottom-color: #D3D3D3;
  border-left-style: none;
  border-left-width: 2px;
  border-left-color: #D3D3D3;
  border-right-style: none;
  border-right-width: 2px;
  border-right-color: #D3D3D3;
}

#ioueiyneeb .gt_footnote {
  margin: 0px;
  font-size: 90%;
  padding-top: 4px;
  padding-bottom: 4px;
  padding-left: 5px;
  padding-right: 5px;
}

#ioueiyneeb .gt_sourcenotes {
  color: #333333;
  background-color: #FFFFFF;
  border-bottom-style: none;
  border-bottom-width: 2px;
  border-bottom-color: #D3D3D3;
  border-left-style: none;
  border-left-width: 2px;
  border-left-color: #D3D3D3;
  border-right-style: none;
  border-right-width: 2px;
  border-right-color: #D3D3D3;
}

#ioueiyneeb .gt_sourcenote {
  font-size: 90%;
  padding-top: 4px;
  padding-bottom: 4px;
  padding-left: 5px;
  padding-right: 5px;
}

#ioueiyneeb .gt_left {
  text-align: left;
}

#ioueiyneeb .gt_center {
  text-align: center;
}

#ioueiyneeb .gt_right {
  text-align: right;
  font-variant-numeric: tabular-nums;
}

#ioueiyneeb .gt_font_normal {
  font-weight: normal;
}

#ioueiyneeb .gt_font_bold {
  font-weight: bold;
}

#ioueiyneeb .gt_font_italic {
  font-style: italic;
}

#ioueiyneeb .gt_super {
  font-size: 65%;
}

#ioueiyneeb .gt_footnote_marks {
  font-size: 75%;
  vertical-align: 0.4em;
  position: initial;
}

#ioueiyneeb .gt_asterisk {
  font-size: 100%;
  vertical-align: 0;
}

#ioueiyneeb .gt_indent_1 {
  text-indent: 5px;
}

#ioueiyneeb .gt_indent_2 {
  text-indent: 10px;
}

#ioueiyneeb .gt_indent_3 {
  text-indent: 15px;
}

#ioueiyneeb .gt_indent_4 {
  text-indent: 20px;
}

#ioueiyneeb .gt_indent_5 {
  text-indent: 25px;
}

#ioueiyneeb .katex-display {
  display: inline-flex !important;
  margin-bottom: 0.75em !important;
}

#ioueiyneeb div.Reactable > div.rt-table > div.rt-thead > div.rt-tr.rt-tr-group-header > div.rt-th-group:after {
  height: 0px !important;
}
</style>
<table class="gt_table" data-quarto-disable-processing="false" data-quarto-bootstrap="false">
  <thead>
    <tr class="gt_col_headings">
      <th class="gt_col_heading gt_columns_bottom_border gt_right" rowspan="1" colspan="1" scope="col" id="Sexo">Sexo</th>
      <th class="gt_col_heading gt_columns_bottom_border gt_right" rowspan="1" colspan="1" scope="col" id="No_Medicina">No_Medicina</th>
      <th class="gt_col_heading gt_columns_bottom_border gt_right" rowspan="1" colspan="1" scope="col" id="Medicina">Medicina</th>
    </tr>
  </thead>
  <tbody class="gt_table_body">
    <tr><td headers="Sexo" class="gt_row gt_right">0</td>
<td headers="No_Medicina" class="gt_row gt_right">7134</td>
<td headers="Medicina" class="gt_row gt_right">2896</td></tr>
    <tr><td headers="Sexo" class="gt_row gt_right">1</td>
<td headers="No_Medicina" class="gt_row gt_right">5942</td>
<td headers="Medicina" class="gt_row gt_right">4028</td></tr>
  </tbody>
  
  
</table>
</div>
<p>Tratados por sexo.</p>
</div>
</div>
<div class="page-columns page-full"><p>Y aqu√≠ vemos dos cosas. Que en sexo <span class="math inline">\(0\)</span> la mayor√≠a son controles y en sexo <span class="math inline">\(1\)</span> no es tan as√≠. Y que, en general hay m√°s controles que tratados<a href="#fn8" class="footnote-ref" id="fnref8" role="doc-noteref"><sup>8</sup></a>.</p><div class="no-row-height column-margin column-container"><li id="fn8"><p><sup>8</sup>&nbsp;Algo que va a hacer que sea m√°s f√°cil encontrarle controles <em>matcheados</em> a los tratados y no viceverse.</p></li></div></div>
<div class="page-columns page-full"><p>Vamos a estimar el <strong>ATT</strong> utilizando la funci√≥n <code>matchit</code> del paquete <code>MatchIt</code><a href="#fn9" class="footnote-ref" id="fnref9" role="doc-noteref"><sup>9</sup></a>. Esta funci√≥n nos permite hacer <em>matching</em> de forma sencilla y r√°pida. Vamos a usar la distancia de Mahalanobis para emparejar los tratados con los controles.</p><div class="no-row-height column-margin column-container"><li id="fn9"><p><sup>9</sup>&nbsp;Para m√°s detalles de c√≥mo funciona el paquete <code>MatchIt</code> pueden ver la <a href="https://cran.r-project.org/web/packages/MatchIt/vignettes/MatchIt.html">documentaci√≥n oficial</a>.</p></li></div></div>
<div class="cell">
<div class="sourceCode cell-code" id="cb23"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb23-1"><a href="#cb23-1" aria-hidden="true" tabindex="-1"></a>nearest_control <span class="ot">&lt;-</span> <span class="fu">matchit</span>(Medicina <span class="sc">~</span> Sexo <span class="sc">+</span> Edad <span class="sc">+</span> Severidad, </span>
<span id="cb23-2"><a href="#cb23-2" aria-hidden="true" tabindex="-1"></a>                           <span class="at">data =</span> medicine_impact_recovery,</span>
<span id="cb23-3"><a href="#cb23-3" aria-hidden="true" tabindex="-1"></a>                           <span class="at">method =</span> <span class="st">"nearest"</span>, </span>
<span id="cb23-4"><a href="#cb23-4" aria-hidden="true" tabindex="-1"></a>                           <span class="at">distance =</span> <span class="st">"mahalanobis"</span>,</span>
<span id="cb23-5"><a href="#cb23-5" aria-hidden="true" tabindex="-1"></a>                           <span class="at">replace =</span> T,</span>
<span id="cb23-6"><a href="#cb23-6" aria-hidden="true" tabindex="-1"></a>                           <span class="at">ratio =</span> <span class="dv">1</span>)</span>
<span id="cb23-7"><a href="#cb23-7" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb23-8"><a href="#cb23-8" aria-hidden="true" tabindex="-1"></a><span class="fu">summary</span>(nearest_control, <span class="at">un =</span> F)<span class="sc">$</span>nn[<span class="dv">4</span><span class="sc">:</span><span class="dv">5</span>,]</span>
<span id="cb23-9"><a href="#cb23-9" aria-hidden="true" tabindex="-1"></a><span class="co">#&gt;           Control Treated</span></span>
<span id="cb23-10"><a href="#cb23-10" aria-hidden="true" tabindex="-1"></a><span class="co">#&gt; Matched       733    6924</span></span>
<span id="cb23-11"><a href="#cb23-11" aria-hidden="true" tabindex="-1"></a><span class="co">#&gt; Unmatched   12343       0</span></span></code><button title="Copiar al portapapeles" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<p>Vemos que de los <span class="math inline">\(20000\)</span> datos originales, los <span class="math inline">\(6924\)</span> individuos tratados fueron emparejados con <span class="math inline">\(733\)</span> controles. ¬øC√≥mo pueden ser menos controles que tratados? Bueno, resumidamente, porque al decirle <code>replace = T</code> le estamos diciendo que puede usar el mismo control m√°s de una vez. Es decir, que un control puede ser emparejado con m√°s de un tratado. Esto es √∫til cuando tenemos pocos controles y muchos tratados, como en este caso.</p>
<p>Ahora calculemos el tama√±o del efecto:</p>
<div class="cell">
<details>
<summary>Ver el c√≥digo</summary>
<div class="sourceCode cell-code" id="cb24"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb24-1"><a href="#cb24-1" aria-hidden="true" tabindex="-1"></a>match_medicine <span class="ot">&lt;-</span> <span class="fu">match.data</span>(nearest_control)</span>
<span id="cb24-2"><a href="#cb24-2" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb24-3"><a href="#cb24-3" aria-hidden="true" tabindex="-1"></a>matching_model_medicine <span class="ot">&lt;-</span> <span class="fu">lm</span>(Recuperaci√≥n <span class="sc">~</span> Medicina <span class="sc">+</span> Sexo <span class="sc">+</span> Edad <span class="sc">+</span> Severidad, </span>
<span id="cb24-4"><a href="#cb24-4" aria-hidden="true" tabindex="-1"></a>                              <span class="at">data =</span> match_medicine, </span>
<span id="cb24-5"><a href="#cb24-5" aria-hidden="true" tabindex="-1"></a>                              <span class="at">weights =</span> weights)</span>
<span id="cb24-6"><a href="#cb24-6" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb24-7"><a href="#cb24-7" aria-hidden="true" tabindex="-1"></a><span class="fu">modelsummary</span>(<span class="fu">list</span>(<span class="st">"Matching"</span><span class="ot">=</span> matching_model_medicine),</span>
<span id="cb24-8"><a href="#cb24-8" aria-hidden="true" tabindex="-1"></a>             <span class="at">statistic =</span> <span class="st">"p.value"</span>, </span>
<span id="cb24-9"><a href="#cb24-9" aria-hidden="true" tabindex="-1"></a>             <span class="at">gof_omit =</span> <span class="st">".*"</span>,</span>
<span id="cb24-10"><a href="#cb24-10" aria-hidden="true" tabindex="-1"></a>             <span class="at">output =</span> <span class="st">"gt"</span>) <span class="sc">|&gt;</span></span>
<span id="cb24-11"><a href="#cb24-11" aria-hidden="true" tabindex="-1"></a>  <span class="fu">gt_highlight_rows</span>(<span class="at">rows =</span> <span class="fu">c</span>(<span class="dv">3</span>,<span class="dv">4</span>), </span>
<span id="cb24-12"><a href="#cb24-12" aria-hidden="true" tabindex="-1"></a>                    <span class="at">fill =</span> <span class="st">"lightyellow"</span>,</span>
<span id="cb24-13"><a href="#cb24-13" aria-hidden="true" tabindex="-1"></a>                    <span class="at">font_weight =</span> <span class="st">"bold"</span>)</span></code><button title="Copiar al portapapeles" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
<div class="cell-output-display">

<div id="jyloatcfjj" style="padding-left:0px;padding-right:0px;padding-top:10px;padding-bottom:10px;overflow-x:auto;overflow-y:auto;width:auto;height:auto;">
<style>#jyloatcfjj table {
  font-family: system-ui, 'Segoe UI', Roboto, Helvetica, Arial, sans-serif, 'Apple Color Emoji', 'Segoe UI Emoji', 'Segoe UI Symbol', 'Noto Color Emoji';
  -webkit-font-smoothing: antialiased;
  -moz-osx-font-smoothing: grayscale;
}

#jyloatcfjj thead, #jyloatcfjj tbody, #jyloatcfjj tfoot, #jyloatcfjj tr, #jyloatcfjj td, #jyloatcfjj th {
  border-style: none;
}

#jyloatcfjj p {
  margin: 0;
  padding: 0;
}

#jyloatcfjj .gt_table {
  display: table;
  border-collapse: collapse;
  line-height: normal;
  margin-left: auto;
  margin-right: auto;
  color: #333333;
  font-size: 16px;
  font-weight: normal;
  font-style: normal;
  background-color: #FFFFFF;
  width: auto;
  border-top-style: solid;
  border-top-width: 2px;
  border-top-color: #A8A8A8;
  border-right-style: none;
  border-right-width: 2px;
  border-right-color: #D3D3D3;
  border-bottom-style: solid;
  border-bottom-width: 2px;
  border-bottom-color: #A8A8A8;
  border-left-style: none;
  border-left-width: 2px;
  border-left-color: #D3D3D3;
}

#jyloatcfjj .gt_caption {
  padding-top: 4px;
  padding-bottom: 4px;
}

#jyloatcfjj .gt_title {
  color: #333333;
  font-size: 125%;
  font-weight: initial;
  padding-top: 4px;
  padding-bottom: 4px;
  padding-left: 5px;
  padding-right: 5px;
  border-bottom-color: #FFFFFF;
  border-bottom-width: 0;
}

#jyloatcfjj .gt_subtitle {
  color: #333333;
  font-size: 85%;
  font-weight: initial;
  padding-top: 3px;
  padding-bottom: 5px;
  padding-left: 5px;
  padding-right: 5px;
  border-top-color: #FFFFFF;
  border-top-width: 0;
}

#jyloatcfjj .gt_heading {
  background-color: #FFFFFF;
  text-align: center;
  border-bottom-color: #FFFFFF;
  border-left-style: none;
  border-left-width: 1px;
  border-left-color: #D3D3D3;
  border-right-style: none;
  border-right-width: 1px;
  border-right-color: #D3D3D3;
}

#jyloatcfjj .gt_bottom_border {
  border-bottom-style: solid;
  border-bottom-width: 2px;
  border-bottom-color: #D3D3D3;
}

#jyloatcfjj .gt_col_headings {
  border-top-style: solid;
  border-top-width: 2px;
  border-top-color: #D3D3D3;
  border-bottom-style: solid;
  border-bottom-width: 2px;
  border-bottom-color: #D3D3D3;
  border-left-style: none;
  border-left-width: 1px;
  border-left-color: #D3D3D3;
  border-right-style: none;
  border-right-width: 1px;
  border-right-color: #D3D3D3;
}

#jyloatcfjj .gt_col_heading {
  color: #333333;
  background-color: #FFFFFF;
  font-size: 100%;
  font-weight: normal;
  text-transform: inherit;
  border-left-style: none;
  border-left-width: 1px;
  border-left-color: #D3D3D3;
  border-right-style: none;
  border-right-width: 1px;
  border-right-color: #D3D3D3;
  vertical-align: bottom;
  padding-top: 5px;
  padding-bottom: 6px;
  padding-left: 5px;
  padding-right: 5px;
  overflow-x: hidden;
}

#jyloatcfjj .gt_column_spanner_outer {
  color: #333333;
  background-color: #FFFFFF;
  font-size: 100%;
  font-weight: normal;
  text-transform: inherit;
  padding-top: 0;
  padding-bottom: 0;
  padding-left: 4px;
  padding-right: 4px;
}

#jyloatcfjj .gt_column_spanner_outer:first-child {
  padding-left: 0;
}

#jyloatcfjj .gt_column_spanner_outer:last-child {
  padding-right: 0;
}

#jyloatcfjj .gt_column_spanner {
  border-bottom-style: solid;
  border-bottom-width: 2px;
  border-bottom-color: #D3D3D3;
  vertical-align: bottom;
  padding-top: 5px;
  padding-bottom: 5px;
  overflow-x: hidden;
  display: inline-block;
  width: 100%;
}

#jyloatcfjj .gt_spanner_row {
  border-bottom-style: hidden;
}

#jyloatcfjj .gt_group_heading {
  padding-top: 8px;
  padding-bottom: 8px;
  padding-left: 5px;
  padding-right: 5px;
  color: #333333;
  background-color: #FFFFFF;
  font-size: 100%;
  font-weight: initial;
  text-transform: inherit;
  border-top-style: solid;
  border-top-width: 2px;
  border-top-color: #D3D3D3;
  border-bottom-style: solid;
  border-bottom-width: 2px;
  border-bottom-color: #D3D3D3;
  border-left-style: none;
  border-left-width: 1px;
  border-left-color: #D3D3D3;
  border-right-style: none;
  border-right-width: 1px;
  border-right-color: #D3D3D3;
  vertical-align: middle;
  text-align: left;
}

#jyloatcfjj .gt_empty_group_heading {
  padding: 0.5px;
  color: #333333;
  background-color: #FFFFFF;
  font-size: 100%;
  font-weight: initial;
  border-top-style: solid;
  border-top-width: 2px;
  border-top-color: #D3D3D3;
  border-bottom-style: solid;
  border-bottom-width: 2px;
  border-bottom-color: #D3D3D3;
  vertical-align: middle;
}

#jyloatcfjj .gt_from_md > :first-child {
  margin-top: 0;
}

#jyloatcfjj .gt_from_md > :last-child {
  margin-bottom: 0;
}

#jyloatcfjj .gt_row {
  padding-top: 8px;
  padding-bottom: 8px;
  padding-left: 5px;
  padding-right: 5px;
  margin: 10px;
  border-top-style: solid;
  border-top-width: 1px;
  border-top-color: #D3D3D3;
  border-left-style: none;
  border-left-width: 1px;
  border-left-color: #D3D3D3;
  border-right-style: none;
  border-right-width: 1px;
  border-right-color: #D3D3D3;
  vertical-align: middle;
  overflow-x: hidden;
}

#jyloatcfjj .gt_stub {
  color: #333333;
  background-color: #FFFFFF;
  font-size: 100%;
  font-weight: initial;
  text-transform: inherit;
  border-right-style: solid;
  border-right-width: 2px;
  border-right-color: #D3D3D3;
  padding-left: 5px;
  padding-right: 5px;
}

#jyloatcfjj .gt_stub_row_group {
  color: #333333;
  background-color: #FFFFFF;
  font-size: 100%;
  font-weight: initial;
  text-transform: inherit;
  border-right-style: solid;
  border-right-width: 2px;
  border-right-color: #D3D3D3;
  padding-left: 5px;
  padding-right: 5px;
  vertical-align: top;
}

#jyloatcfjj .gt_row_group_first td {
  border-top-width: 2px;
}

#jyloatcfjj .gt_row_group_first th {
  border-top-width: 2px;
}

#jyloatcfjj .gt_summary_row {
  color: #333333;
  background-color: #FFFFFF;
  text-transform: inherit;
  padding-top: 8px;
  padding-bottom: 8px;
  padding-left: 5px;
  padding-right: 5px;
}

#jyloatcfjj .gt_first_summary_row {
  border-top-style: solid;
  border-top-color: #D3D3D3;
}

#jyloatcfjj .gt_first_summary_row.thick {
  border-top-width: 2px;
}

#jyloatcfjj .gt_last_summary_row {
  padding-top: 8px;
  padding-bottom: 8px;
  padding-left: 5px;
  padding-right: 5px;
  border-bottom-style: solid;
  border-bottom-width: 2px;
  border-bottom-color: #D3D3D3;
}

#jyloatcfjj .gt_grand_summary_row {
  color: #333333;
  background-color: #FFFFFF;
  text-transform: inherit;
  padding-top: 8px;
  padding-bottom: 8px;
  padding-left: 5px;
  padding-right: 5px;
}

#jyloatcfjj .gt_first_grand_summary_row {
  padding-top: 8px;
  padding-bottom: 8px;
  padding-left: 5px;
  padding-right: 5px;
  border-top-style: double;
  border-top-width: 6px;
  border-top-color: #D3D3D3;
}

#jyloatcfjj .gt_last_grand_summary_row_top {
  padding-top: 8px;
  padding-bottom: 8px;
  padding-left: 5px;
  padding-right: 5px;
  border-bottom-style: double;
  border-bottom-width: 6px;
  border-bottom-color: #D3D3D3;
}

#jyloatcfjj .gt_striped {
  background-color: rgba(128, 128, 128, 0.05);
}

#jyloatcfjj .gt_table_body {
  border-top-style: solid;
  border-top-width: 2px;
  border-top-color: #D3D3D3;
  border-bottom-style: solid;
  border-bottom-width: 2px;
  border-bottom-color: #D3D3D3;
}

#jyloatcfjj .gt_footnotes {
  color: #333333;
  background-color: #FFFFFF;
  border-bottom-style: none;
  border-bottom-width: 2px;
  border-bottom-color: #D3D3D3;
  border-left-style: none;
  border-left-width: 2px;
  border-left-color: #D3D3D3;
  border-right-style: none;
  border-right-width: 2px;
  border-right-color: #D3D3D3;
}

#jyloatcfjj .gt_footnote {
  margin: 0px;
  font-size: 90%;
  padding-top: 4px;
  padding-bottom: 4px;
  padding-left: 5px;
  padding-right: 5px;
}

#jyloatcfjj .gt_sourcenotes {
  color: #333333;
  background-color: #FFFFFF;
  border-bottom-style: none;
  border-bottom-width: 2px;
  border-bottom-color: #D3D3D3;
  border-left-style: none;
  border-left-width: 2px;
  border-left-color: #D3D3D3;
  border-right-style: none;
  border-right-width: 2px;
  border-right-color: #D3D3D3;
}

#jyloatcfjj .gt_sourcenote {
  font-size: 90%;
  padding-top: 4px;
  padding-bottom: 4px;
  padding-left: 5px;
  padding-right: 5px;
}

#jyloatcfjj .gt_left {
  text-align: left;
}

#jyloatcfjj .gt_center {
  text-align: center;
}

#jyloatcfjj .gt_right {
  text-align: right;
  font-variant-numeric: tabular-nums;
}

#jyloatcfjj .gt_font_normal {
  font-weight: normal;
}

#jyloatcfjj .gt_font_bold {
  font-weight: bold;
}

#jyloatcfjj .gt_font_italic {
  font-style: italic;
}

#jyloatcfjj .gt_super {
  font-size: 65%;
}

#jyloatcfjj .gt_footnote_marks {
  font-size: 75%;
  vertical-align: 0.4em;
  position: initial;
}

#jyloatcfjj .gt_asterisk {
  font-size: 100%;
  vertical-align: 0;
}

#jyloatcfjj .gt_indent_1 {
  text-indent: 5px;
}

#jyloatcfjj .gt_indent_2 {
  text-indent: 10px;
}

#jyloatcfjj .gt_indent_3 {
  text-indent: 15px;
}

#jyloatcfjj .gt_indent_4 {
  text-indent: 20px;
}

#jyloatcfjj .gt_indent_5 {
  text-indent: 25px;
}

#jyloatcfjj .katex-display {
  display: inline-flex !important;
  margin-bottom: 0.75em !important;
}

#jyloatcfjj div.Reactable > div.rt-table > div.rt-thead > div.rt-tr.rt-tr-group-header > div.rt-th-group:after {
  height: 0px !important;
}
</style>
<table class="gt_table" data-quarto-disable-processing="false" data-quarto-bootstrap="false">
  <thead>
    <tr class="gt_col_headings">
      <th class="gt_col_heading gt_columns_bottom_border gt_left" rowspan="1" colspan="1" scope="col" id="a-"> </th>
      <th class="gt_col_heading gt_columns_bottom_border gt_center" rowspan="1" colspan="1" scope="col" id="Matching">Matching</th>
    </tr>
  </thead>
  <tbody class="gt_table_body">
    <tr><td headers=" " class="gt_row gt_left">(Intercept)</td>
<td headers="Matching" class="gt_row gt_center">-3.831</td></tr>
    <tr><td headers=" " class="gt_row gt_left"></td>
<td headers="Matching" class="gt_row gt_center">(&lt;0.001)</td></tr>
    <tr><td headers=" " class="gt_row gt_left" style="background-color: rgba(255,255,224,0.8); color: #000000; font-weight: bold;">Medicina</td>
<td headers="Matching" class="gt_row gt_center" style="background-color: rgba(255,255,224,0.8); color: #000000; font-weight: bold;">-9.944</td></tr>
    <tr><td headers=" " class="gt_row gt_left" style="background-color: rgba(255,255,224,0.8); color: #000000; font-weight: bold;"></td>
<td headers="Matching" class="gt_row gt_center" style="background-color: rgba(255,255,224,0.8); color: #000000; font-weight: bold;">(&lt;0.001)</td></tr>
    <tr><td headers=" " class="gt_row gt_left">Sexo</td>
<td headers="Matching" class="gt_row gt_center">12.946</td></tr>
    <tr><td headers=" " class="gt_row gt_left"></td>
<td headers="Matching" class="gt_row gt_center">(&lt;0.001)</td></tr>
    <tr><td headers=" " class="gt_row gt_left">Edad</td>
<td headers="Matching" class="gt_row gt_center">0.554</td></tr>
    <tr><td headers=" " class="gt_row gt_left"></td>
<td headers="Matching" class="gt_row gt_center">(&lt;0.001)</td></tr>
    <tr><td headers=" " class="gt_row gt_left">Severidad</td>
<td headers="Matching" class="gt_row gt_center">29.696</td></tr>
    <tr><td headers=" " class="gt_row gt_left"></td>
<td headers="Matching" class="gt_row gt_center">(&lt;0.001)</td></tr>
  </tbody>
  
  
</table>
</div>
</div>
</div>
<p>Vemos que hay un efecto negativo de la medicaci√≥n en la recuperaci√≥n, algo que hubi√©ramos malinterpretado totalmente si hubi√©ramos usado el <strong>SDO</strong>. Recordemos que:</p>
<div class="cell">
<details>
<summary>Ver el c√≥digo</summary>
<div class="sourceCode cell-code" id="cb25"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb25-1"><a href="#cb25-1" aria-hidden="true" tabindex="-1"></a><span class="fu">tibble</span>(M√©todo <span class="ot">=</span> <span class="fu">c</span>(<span class="st">"SDO"</span>, <span class="st">"Matching"</span>),</span>
<span id="cb25-2"><a href="#cb25-2" aria-hidden="true" tabindex="-1"></a>       Estimaci√≥n <span class="ot">=</span> <span class="fu">c</span>(<span class="fu">round</span>(<span class="fu">mean</span>(medicine_impact_recovery<span class="sc">$</span>Recuperaci√≥n[medicine_impact_recovery<span class="sc">$</span>Medicina<span class="sc">==</span><span class="dv">1</span>]) <span class="sc">-</span> </span>
<span id="cb25-3"><a href="#cb25-3" aria-hidden="true" tabindex="-1"></a>                 <span class="fu">mean</span>(medicine_impact_recovery<span class="sc">$</span>Recuperaci√≥n[medicine_impact_recovery<span class="sc">$</span>Medicina<span class="sc">==</span><span class="dv">0</span>]), <span class="dv">2</span>),</span>
<span id="cb25-4"><a href="#cb25-4" aria-hidden="true" tabindex="-1"></a>                 <span class="fu">round</span>(<span class="fu">coef</span>(matching_model_medicine)[<span class="st">"Medicina"</span>], <span class="dv">2</span>))) <span class="sc">%&gt;%</span></span>
<span id="cb25-5"><a href="#cb25-5" aria-hidden="true" tabindex="-1"></a>  <span class="fu">gt</span>() <span class="sc">%&gt;%</span></span>
<span id="cb25-6"><a href="#cb25-6" aria-hidden="true" tabindex="-1"></a>  <span class="fu">tab_header</span>(</span>
<span id="cb25-7"><a href="#cb25-7" aria-hidden="true" tabindex="-1"></a>    <span class="at">title =</span> <span class="st">"Estimaci√≥n del efecto de la medicina en la recuperaci√≥n"</span></span>
<span id="cb25-8"><a href="#cb25-8" aria-hidden="true" tabindex="-1"></a>  )</span></code><button title="Copiar al portapapeles" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
<div class="cell-output-display">

<div id="fottzlywfy" style="padding-left:0px;padding-right:0px;padding-top:10px;padding-bottom:10px;overflow-x:auto;overflow-y:auto;width:auto;height:auto;">
<style>#fottzlywfy table {
  font-family: system-ui, 'Segoe UI', Roboto, Helvetica, Arial, sans-serif, 'Apple Color Emoji', 'Segoe UI Emoji', 'Segoe UI Symbol', 'Noto Color Emoji';
  -webkit-font-smoothing: antialiased;
  -moz-osx-font-smoothing: grayscale;
}

#fottzlywfy thead, #fottzlywfy tbody, #fottzlywfy tfoot, #fottzlywfy tr, #fottzlywfy td, #fottzlywfy th {
  border-style: none;
}

#fottzlywfy p {
  margin: 0;
  padding: 0;
}

#fottzlywfy .gt_table {
  display: table;
  border-collapse: collapse;
  line-height: normal;
  margin-left: auto;
  margin-right: auto;
  color: #333333;
  font-size: 16px;
  font-weight: normal;
  font-style: normal;
  background-color: #FFFFFF;
  width: auto;
  border-top-style: solid;
  border-top-width: 2px;
  border-top-color: #A8A8A8;
  border-right-style: none;
  border-right-width: 2px;
  border-right-color: #D3D3D3;
  border-bottom-style: solid;
  border-bottom-width: 2px;
  border-bottom-color: #A8A8A8;
  border-left-style: none;
  border-left-width: 2px;
  border-left-color: #D3D3D3;
}

#fottzlywfy .gt_caption {
  padding-top: 4px;
  padding-bottom: 4px;
}

#fottzlywfy .gt_title {
  color: #333333;
  font-size: 125%;
  font-weight: initial;
  padding-top: 4px;
  padding-bottom: 4px;
  padding-left: 5px;
  padding-right: 5px;
  border-bottom-color: #FFFFFF;
  border-bottom-width: 0;
}

#fottzlywfy .gt_subtitle {
  color: #333333;
  font-size: 85%;
  font-weight: initial;
  padding-top: 3px;
  padding-bottom: 5px;
  padding-left: 5px;
  padding-right: 5px;
  border-top-color: #FFFFFF;
  border-top-width: 0;
}

#fottzlywfy .gt_heading {
  background-color: #FFFFFF;
  text-align: center;
  border-bottom-color: #FFFFFF;
  border-left-style: none;
  border-left-width: 1px;
  border-left-color: #D3D3D3;
  border-right-style: none;
  border-right-width: 1px;
  border-right-color: #D3D3D3;
}

#fottzlywfy .gt_bottom_border {
  border-bottom-style: solid;
  border-bottom-width: 2px;
  border-bottom-color: #D3D3D3;
}

#fottzlywfy .gt_col_headings {
  border-top-style: solid;
  border-top-width: 2px;
  border-top-color: #D3D3D3;
  border-bottom-style: solid;
  border-bottom-width: 2px;
  border-bottom-color: #D3D3D3;
  border-left-style: none;
  border-left-width: 1px;
  border-left-color: #D3D3D3;
  border-right-style: none;
  border-right-width: 1px;
  border-right-color: #D3D3D3;
}

#fottzlywfy .gt_col_heading {
  color: #333333;
  background-color: #FFFFFF;
  font-size: 100%;
  font-weight: normal;
  text-transform: inherit;
  border-left-style: none;
  border-left-width: 1px;
  border-left-color: #D3D3D3;
  border-right-style: none;
  border-right-width: 1px;
  border-right-color: #D3D3D3;
  vertical-align: bottom;
  padding-top: 5px;
  padding-bottom: 6px;
  padding-left: 5px;
  padding-right: 5px;
  overflow-x: hidden;
}

#fottzlywfy .gt_column_spanner_outer {
  color: #333333;
  background-color: #FFFFFF;
  font-size: 100%;
  font-weight: normal;
  text-transform: inherit;
  padding-top: 0;
  padding-bottom: 0;
  padding-left: 4px;
  padding-right: 4px;
}

#fottzlywfy .gt_column_spanner_outer:first-child {
  padding-left: 0;
}

#fottzlywfy .gt_column_spanner_outer:last-child {
  padding-right: 0;
}

#fottzlywfy .gt_column_spanner {
  border-bottom-style: solid;
  border-bottom-width: 2px;
  border-bottom-color: #D3D3D3;
  vertical-align: bottom;
  padding-top: 5px;
  padding-bottom: 5px;
  overflow-x: hidden;
  display: inline-block;
  width: 100%;
}

#fottzlywfy .gt_spanner_row {
  border-bottom-style: hidden;
}

#fottzlywfy .gt_group_heading {
  padding-top: 8px;
  padding-bottom: 8px;
  padding-left: 5px;
  padding-right: 5px;
  color: #333333;
  background-color: #FFFFFF;
  font-size: 100%;
  font-weight: initial;
  text-transform: inherit;
  border-top-style: solid;
  border-top-width: 2px;
  border-top-color: #D3D3D3;
  border-bottom-style: solid;
  border-bottom-width: 2px;
  border-bottom-color: #D3D3D3;
  border-left-style: none;
  border-left-width: 1px;
  border-left-color: #D3D3D3;
  border-right-style: none;
  border-right-width: 1px;
  border-right-color: #D3D3D3;
  vertical-align: middle;
  text-align: left;
}

#fottzlywfy .gt_empty_group_heading {
  padding: 0.5px;
  color: #333333;
  background-color: #FFFFFF;
  font-size: 100%;
  font-weight: initial;
  border-top-style: solid;
  border-top-width: 2px;
  border-top-color: #D3D3D3;
  border-bottom-style: solid;
  border-bottom-width: 2px;
  border-bottom-color: #D3D3D3;
  vertical-align: middle;
}

#fottzlywfy .gt_from_md > :first-child {
  margin-top: 0;
}

#fottzlywfy .gt_from_md > :last-child {
  margin-bottom: 0;
}

#fottzlywfy .gt_row {
  padding-top: 8px;
  padding-bottom: 8px;
  padding-left: 5px;
  padding-right: 5px;
  margin: 10px;
  border-top-style: solid;
  border-top-width: 1px;
  border-top-color: #D3D3D3;
  border-left-style: none;
  border-left-width: 1px;
  border-left-color: #D3D3D3;
  border-right-style: none;
  border-right-width: 1px;
  border-right-color: #D3D3D3;
  vertical-align: middle;
  overflow-x: hidden;
}

#fottzlywfy .gt_stub {
  color: #333333;
  background-color: #FFFFFF;
  font-size: 100%;
  font-weight: initial;
  text-transform: inherit;
  border-right-style: solid;
  border-right-width: 2px;
  border-right-color: #D3D3D3;
  padding-left: 5px;
  padding-right: 5px;
}

#fottzlywfy .gt_stub_row_group {
  color: #333333;
  background-color: #FFFFFF;
  font-size: 100%;
  font-weight: initial;
  text-transform: inherit;
  border-right-style: solid;
  border-right-width: 2px;
  border-right-color: #D3D3D3;
  padding-left: 5px;
  padding-right: 5px;
  vertical-align: top;
}

#fottzlywfy .gt_row_group_first td {
  border-top-width: 2px;
}

#fottzlywfy .gt_row_group_first th {
  border-top-width: 2px;
}

#fottzlywfy .gt_summary_row {
  color: #333333;
  background-color: #FFFFFF;
  text-transform: inherit;
  padding-top: 8px;
  padding-bottom: 8px;
  padding-left: 5px;
  padding-right: 5px;
}

#fottzlywfy .gt_first_summary_row {
  border-top-style: solid;
  border-top-color: #D3D3D3;
}

#fottzlywfy .gt_first_summary_row.thick {
  border-top-width: 2px;
}

#fottzlywfy .gt_last_summary_row {
  padding-top: 8px;
  padding-bottom: 8px;
  padding-left: 5px;
  padding-right: 5px;
  border-bottom-style: solid;
  border-bottom-width: 2px;
  border-bottom-color: #D3D3D3;
}

#fottzlywfy .gt_grand_summary_row {
  color: #333333;
  background-color: #FFFFFF;
  text-transform: inherit;
  padding-top: 8px;
  padding-bottom: 8px;
  padding-left: 5px;
  padding-right: 5px;
}

#fottzlywfy .gt_first_grand_summary_row {
  padding-top: 8px;
  padding-bottom: 8px;
  padding-left: 5px;
  padding-right: 5px;
  border-top-style: double;
  border-top-width: 6px;
  border-top-color: #D3D3D3;
}

#fottzlywfy .gt_last_grand_summary_row_top {
  padding-top: 8px;
  padding-bottom: 8px;
  padding-left: 5px;
  padding-right: 5px;
  border-bottom-style: double;
  border-bottom-width: 6px;
  border-bottom-color: #D3D3D3;
}

#fottzlywfy .gt_striped {
  background-color: rgba(128, 128, 128, 0.05);
}

#fottzlywfy .gt_table_body {
  border-top-style: solid;
  border-top-width: 2px;
  border-top-color: #D3D3D3;
  border-bottom-style: solid;
  border-bottom-width: 2px;
  border-bottom-color: #D3D3D3;
}

#fottzlywfy .gt_footnotes {
  color: #333333;
  background-color: #FFFFFF;
  border-bottom-style: none;
  border-bottom-width: 2px;
  border-bottom-color: #D3D3D3;
  border-left-style: none;
  border-left-width: 2px;
  border-left-color: #D3D3D3;
  border-right-style: none;
  border-right-width: 2px;
  border-right-color: #D3D3D3;
}

#fottzlywfy .gt_footnote {
  margin: 0px;
  font-size: 90%;
  padding-top: 4px;
  padding-bottom: 4px;
  padding-left: 5px;
  padding-right: 5px;
}

#fottzlywfy .gt_sourcenotes {
  color: #333333;
  background-color: #FFFFFF;
  border-bottom-style: none;
  border-bottom-width: 2px;
  border-bottom-color: #D3D3D3;
  border-left-style: none;
  border-left-width: 2px;
  border-left-color: #D3D3D3;
  border-right-style: none;
  border-right-width: 2px;
  border-right-color: #D3D3D3;
}

#fottzlywfy .gt_sourcenote {
  font-size: 90%;
  padding-top: 4px;
  padding-bottom: 4px;
  padding-left: 5px;
  padding-right: 5px;
}

#fottzlywfy .gt_left {
  text-align: left;
}

#fottzlywfy .gt_center {
  text-align: center;
}

#fottzlywfy .gt_right {
  text-align: right;
  font-variant-numeric: tabular-nums;
}

#fottzlywfy .gt_font_normal {
  font-weight: normal;
}

#fottzlywfy .gt_font_bold {
  font-weight: bold;
}

#fottzlywfy .gt_font_italic {
  font-style: italic;
}

#fottzlywfy .gt_super {
  font-size: 65%;
}

#fottzlywfy .gt_footnote_marks {
  font-size: 75%;
  vertical-align: 0.4em;
  position: initial;
}

#fottzlywfy .gt_asterisk {
  font-size: 100%;
  vertical-align: 0;
}

#fottzlywfy .gt_indent_1 {
  text-indent: 5px;
}

#fottzlywfy .gt_indent_2 {
  text-indent: 10px;
}

#fottzlywfy .gt_indent_3 {
  text-indent: 15px;
}

#fottzlywfy .gt_indent_4 {
  text-indent: 20px;
}

#fottzlywfy .gt_indent_5 {
  text-indent: 25px;
}

#fottzlywfy .katex-display {
  display: inline-flex !important;
  margin-bottom: 0.75em !important;
}

#fottzlywfy div.Reactable > div.rt-table > div.rt-thead > div.rt-tr.rt-tr-group-header > div.rt-th-group:after {
  height: 0px !important;
}
</style>
<table class="gt_table" data-quarto-disable-processing="false" data-quarto-bootstrap="false">
  <thead>
    <tr class="gt_heading">
      <td colspan="2" class="gt_heading gt_title gt_font_normal gt_bottom_border" style="">Estimaci√≥n del efecto de la medicina en la recuperaci√≥n</td>
    </tr>
    
    <tr class="gt_col_headings">
      <th class="gt_col_heading gt_columns_bottom_border gt_left" rowspan="1" colspan="1" scope="col" id="M√©todo">M√©todo</th>
      <th class="gt_col_heading gt_columns_bottom_border gt_right" rowspan="1" colspan="1" scope="col" id="Estimaci√≥n">Estimaci√≥n</th>
    </tr>
  </thead>
  <tbody class="gt_table_body">
    <tr><td headers="M√©todo" class="gt_row gt_left">SDO</td>
<td headers="Estimaci√≥n" class="gt_row gt_right">16.90</td></tr>
    <tr><td headers="M√©todo" class="gt_row gt_left">Matching</td>
<td headers="Estimaci√≥n" class="gt_row gt_right">-9.94</td></tr>
  </tbody>
  
  
</table>
</div>
</div>
</div>
<p>Recordemos que la estimaci√≥n de <em>approximate matching</em> en este caso es una estimaci√≥n del <strong>ATT</strong>, ya que lo que hicimos fue encontrar controles <em>matcheados</em> para los sujetos tratados. Es decir, que estamos estimando el efecto de la medicina en la recuperaci√≥n de los pacientes que recibieron la medicina y que tienen un perfil similar a los controles. Podemos tener buenas razones para creer que el <strong>ATT</strong> es igual al <strong>ATE</strong> en este caso‚Ä¶ O no.</p>
</section>
<section id="la-quesoporte-com√∫n" class="level3" data-number="6.2.3">
<h3 data-number="6.2.3" class="anchored" data-anchor-id="la-quesoporte-com√∫n"><span class="header-section-number">6.2.3</span> La queso(porte com√∫n)</h3>
<p>En la secci√≥n anterior vimos c√≥mo hacer <em>matching</em> con la distancia de Mahalanobis y c√≥mo calcular el <strong>ATT</strong>. Pero, ¬øqu√© pasa si queremos hacer <em>matching</em> con m√°s de una covariable? Como adelantamos cuando mencionamos la maldici√≥n de la dimensionalidad, la cosa se puede complicar, y mucho. Es por eso que una de las condiciones necesarias para hacer <em>matching</em> es que los datos tengan <strong>soporte com√∫n</strong>.</p>
<p>Pero, ¬øde qu√© hablamos cuando hablamos de soporte com√∫n? B√°sicamente, nos referimos a que las covariables <span class="math inline">\(X\)</span> deben tener valores que se superpongan entre los grupos de tratamiento y control. Es decir, que debe haber sujetos tratados y no tratados con valores similares en las covariables que estamos usando para emparejar. Suena a algo b√°sico, pero no siempre es el caso (en la secci√≥n @#sec-matching_vs_reg discutimos un poquito esto).</p>
</section>
<section id="euclideana-vs.-mahalanobis-la-batalla-final" class="level3" data-number="6.2.4">
<h3 data-number="6.2.4" class="anchored" data-anchor-id="euclideana-vs.-mahalanobis-la-batalla-final"><span class="header-section-number">6.2.4</span> Euclideana vs.&nbsp;Mahalanobis, la batalla final</h3>
<p>En mi experiencia, entender claramente la diferencia entre estas dos distancia no es cosa sencilla y, si bien no es vital para entender <strong>matching</strong>, es una excelente excusa pensar un poco en qu√© significa <strong>ser parecido</strong>. Vamos al lio.</p>
<p>Supongamos que queremos estudiar el efecto de la entrega de un bono en la satisfacci√≥n con la empresa. Para esto identificamos dos confusores y vamos a <em>matchear</em> a los sujetos del grupo tratamiento (recibieron un bono) con sus controles correspondientes (no recibieron bono). Los confusores que identificamos son la edad y el salario de los empleados. Vamos a generar una base de datos con <span class="math inline">\(200\)</span> empleados, <span class="math inline">\(100\)</span> del grupo tratamiento y <span class="math inline">\(100\)</span> del grupo control y ver algunos datos tomados al azar.</p>
<div class="cell">
<details>
<summary>Ver el c√≥digo</summary>
<div class="sourceCode cell-code" id="cb26"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb26-1"><a href="#cb26-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Generamos los datos</span></span>
<span id="cb26-2"><a href="#cb26-2" aria-hidden="true" tabindex="-1"></a><span class="fu">set.seed</span>(<span class="dv">12</span>)</span>
<span id="cb26-3"><a href="#cb26-3" aria-hidden="true" tabindex="-1"></a>empleados_tbl <span class="ot">&lt;-</span> <span class="fu">tibble</span>(<span class="at">Grupo =</span> <span class="fu">c</span>(<span class="fu">rep</span>(<span class="st">"tratamiento"</span>, <span class="dv">100</span>), <span class="fu">rep</span>(<span class="st">"control"</span>, <span class="dv">100</span>)),</span>
<span id="cb26-4"><a href="#cb26-4" aria-hidden="true" tabindex="-1"></a>                        <span class="at">Edad =</span> <span class="fu">rnorm</span>(<span class="at">n =</span> <span class="dv">200</span>, <span class="at">mean =</span> <span class="dv">35</span>, <span class="at">sd =</span> <span class="dv">5</span>),</span>
<span id="cb26-5"><a href="#cb26-5" aria-hidden="true" tabindex="-1"></a>                        <span class="at">Salario =</span> Edad<span class="sc">*</span><span class="dv">1500</span> <span class="sc">+</span> <span class="fu">rnorm</span>(<span class="at">n =</span> <span class="dv">200</span>, <span class="at">mean =</span> <span class="dv">0</span>, <span class="at">sd =</span> <span class="dv">5000</span>))</span>
<span id="cb26-6"><a href="#cb26-6" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb26-7"><a href="#cb26-7" aria-hidden="true" tabindex="-1"></a><span class="fu">set.seed</span>(<span class="dv">12</span>)</span>
<span id="cb26-8"><a href="#cb26-8" aria-hidden="true" tabindex="-1"></a>empleados_tbl <span class="sc">|&gt;</span> </span>
<span id="cb26-9"><a href="#cb26-9" aria-hidden="true" tabindex="-1"></a>  <span class="fu">sample_n</span>(<span class="dv">6</span>) <span class="sc">|&gt;</span> </span>
<span id="cb26-10"><a href="#cb26-10" aria-hidden="true" tabindex="-1"></a>  <span class="fu">gt</span>()</span></code><button title="Copiar al portapapeles" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
<div class="cell-output-display">

<div id="bhrryfljzg" style="padding-left:0px;padding-right:0px;padding-top:10px;padding-bottom:10px;overflow-x:auto;overflow-y:auto;width:auto;height:auto;">
<style>#bhrryfljzg table {
  font-family: system-ui, 'Segoe UI', Roboto, Helvetica, Arial, sans-serif, 'Apple Color Emoji', 'Segoe UI Emoji', 'Segoe UI Symbol', 'Noto Color Emoji';
  -webkit-font-smoothing: antialiased;
  -moz-osx-font-smoothing: grayscale;
}

#bhrryfljzg thead, #bhrryfljzg tbody, #bhrryfljzg tfoot, #bhrryfljzg tr, #bhrryfljzg td, #bhrryfljzg th {
  border-style: none;
}

#bhrryfljzg p {
  margin: 0;
  padding: 0;
}

#bhrryfljzg .gt_table {
  display: table;
  border-collapse: collapse;
  line-height: normal;
  margin-left: auto;
  margin-right: auto;
  color: #333333;
  font-size: 16px;
  font-weight: normal;
  font-style: normal;
  background-color: #FFFFFF;
  width: auto;
  border-top-style: solid;
  border-top-width: 2px;
  border-top-color: #A8A8A8;
  border-right-style: none;
  border-right-width: 2px;
  border-right-color: #D3D3D3;
  border-bottom-style: solid;
  border-bottom-width: 2px;
  border-bottom-color: #A8A8A8;
  border-left-style: none;
  border-left-width: 2px;
  border-left-color: #D3D3D3;
}

#bhrryfljzg .gt_caption {
  padding-top: 4px;
  padding-bottom: 4px;
}

#bhrryfljzg .gt_title {
  color: #333333;
  font-size: 125%;
  font-weight: initial;
  padding-top: 4px;
  padding-bottom: 4px;
  padding-left: 5px;
  padding-right: 5px;
  border-bottom-color: #FFFFFF;
  border-bottom-width: 0;
}

#bhrryfljzg .gt_subtitle {
  color: #333333;
  font-size: 85%;
  font-weight: initial;
  padding-top: 3px;
  padding-bottom: 5px;
  padding-left: 5px;
  padding-right: 5px;
  border-top-color: #FFFFFF;
  border-top-width: 0;
}

#bhrryfljzg .gt_heading {
  background-color: #FFFFFF;
  text-align: center;
  border-bottom-color: #FFFFFF;
  border-left-style: none;
  border-left-width: 1px;
  border-left-color: #D3D3D3;
  border-right-style: none;
  border-right-width: 1px;
  border-right-color: #D3D3D3;
}

#bhrryfljzg .gt_bottom_border {
  border-bottom-style: solid;
  border-bottom-width: 2px;
  border-bottom-color: #D3D3D3;
}

#bhrryfljzg .gt_col_headings {
  border-top-style: solid;
  border-top-width: 2px;
  border-top-color: #D3D3D3;
  border-bottom-style: solid;
  border-bottom-width: 2px;
  border-bottom-color: #D3D3D3;
  border-left-style: none;
  border-left-width: 1px;
  border-left-color: #D3D3D3;
  border-right-style: none;
  border-right-width: 1px;
  border-right-color: #D3D3D3;
}

#bhrryfljzg .gt_col_heading {
  color: #333333;
  background-color: #FFFFFF;
  font-size: 100%;
  font-weight: normal;
  text-transform: inherit;
  border-left-style: none;
  border-left-width: 1px;
  border-left-color: #D3D3D3;
  border-right-style: none;
  border-right-width: 1px;
  border-right-color: #D3D3D3;
  vertical-align: bottom;
  padding-top: 5px;
  padding-bottom: 6px;
  padding-left: 5px;
  padding-right: 5px;
  overflow-x: hidden;
}

#bhrryfljzg .gt_column_spanner_outer {
  color: #333333;
  background-color: #FFFFFF;
  font-size: 100%;
  font-weight: normal;
  text-transform: inherit;
  padding-top: 0;
  padding-bottom: 0;
  padding-left: 4px;
  padding-right: 4px;
}

#bhrryfljzg .gt_column_spanner_outer:first-child {
  padding-left: 0;
}

#bhrryfljzg .gt_column_spanner_outer:last-child {
  padding-right: 0;
}

#bhrryfljzg .gt_column_spanner {
  border-bottom-style: solid;
  border-bottom-width: 2px;
  border-bottom-color: #D3D3D3;
  vertical-align: bottom;
  padding-top: 5px;
  padding-bottom: 5px;
  overflow-x: hidden;
  display: inline-block;
  width: 100%;
}

#bhrryfljzg .gt_spanner_row {
  border-bottom-style: hidden;
}

#bhrryfljzg .gt_group_heading {
  padding-top: 8px;
  padding-bottom: 8px;
  padding-left: 5px;
  padding-right: 5px;
  color: #333333;
  background-color: #FFFFFF;
  font-size: 100%;
  font-weight: initial;
  text-transform: inherit;
  border-top-style: solid;
  border-top-width: 2px;
  border-top-color: #D3D3D3;
  border-bottom-style: solid;
  border-bottom-width: 2px;
  border-bottom-color: #D3D3D3;
  border-left-style: none;
  border-left-width: 1px;
  border-left-color: #D3D3D3;
  border-right-style: none;
  border-right-width: 1px;
  border-right-color: #D3D3D3;
  vertical-align: middle;
  text-align: left;
}

#bhrryfljzg .gt_empty_group_heading {
  padding: 0.5px;
  color: #333333;
  background-color: #FFFFFF;
  font-size: 100%;
  font-weight: initial;
  border-top-style: solid;
  border-top-width: 2px;
  border-top-color: #D3D3D3;
  border-bottom-style: solid;
  border-bottom-width: 2px;
  border-bottom-color: #D3D3D3;
  vertical-align: middle;
}

#bhrryfljzg .gt_from_md > :first-child {
  margin-top: 0;
}

#bhrryfljzg .gt_from_md > :last-child {
  margin-bottom: 0;
}

#bhrryfljzg .gt_row {
  padding-top: 8px;
  padding-bottom: 8px;
  padding-left: 5px;
  padding-right: 5px;
  margin: 10px;
  border-top-style: solid;
  border-top-width: 1px;
  border-top-color: #D3D3D3;
  border-left-style: none;
  border-left-width: 1px;
  border-left-color: #D3D3D3;
  border-right-style: none;
  border-right-width: 1px;
  border-right-color: #D3D3D3;
  vertical-align: middle;
  overflow-x: hidden;
}

#bhrryfljzg .gt_stub {
  color: #333333;
  background-color: #FFFFFF;
  font-size: 100%;
  font-weight: initial;
  text-transform: inherit;
  border-right-style: solid;
  border-right-width: 2px;
  border-right-color: #D3D3D3;
  padding-left: 5px;
  padding-right: 5px;
}

#bhrryfljzg .gt_stub_row_group {
  color: #333333;
  background-color: #FFFFFF;
  font-size: 100%;
  font-weight: initial;
  text-transform: inherit;
  border-right-style: solid;
  border-right-width: 2px;
  border-right-color: #D3D3D3;
  padding-left: 5px;
  padding-right: 5px;
  vertical-align: top;
}

#bhrryfljzg .gt_row_group_first td {
  border-top-width: 2px;
}

#bhrryfljzg .gt_row_group_first th {
  border-top-width: 2px;
}

#bhrryfljzg .gt_summary_row {
  color: #333333;
  background-color: #FFFFFF;
  text-transform: inherit;
  padding-top: 8px;
  padding-bottom: 8px;
  padding-left: 5px;
  padding-right: 5px;
}

#bhrryfljzg .gt_first_summary_row {
  border-top-style: solid;
  border-top-color: #D3D3D3;
}

#bhrryfljzg .gt_first_summary_row.thick {
  border-top-width: 2px;
}

#bhrryfljzg .gt_last_summary_row {
  padding-top: 8px;
  padding-bottom: 8px;
  padding-left: 5px;
  padding-right: 5px;
  border-bottom-style: solid;
  border-bottom-width: 2px;
  border-bottom-color: #D3D3D3;
}

#bhrryfljzg .gt_grand_summary_row {
  color: #333333;
  background-color: #FFFFFF;
  text-transform: inherit;
  padding-top: 8px;
  padding-bottom: 8px;
  padding-left: 5px;
  padding-right: 5px;
}

#bhrryfljzg .gt_first_grand_summary_row {
  padding-top: 8px;
  padding-bottom: 8px;
  padding-left: 5px;
  padding-right: 5px;
  border-top-style: double;
  border-top-width: 6px;
  border-top-color: #D3D3D3;
}

#bhrryfljzg .gt_last_grand_summary_row_top {
  padding-top: 8px;
  padding-bottom: 8px;
  padding-left: 5px;
  padding-right: 5px;
  border-bottom-style: double;
  border-bottom-width: 6px;
  border-bottom-color: #D3D3D3;
}

#bhrryfljzg .gt_striped {
  background-color: rgba(128, 128, 128, 0.05);
}

#bhrryfljzg .gt_table_body {
  border-top-style: solid;
  border-top-width: 2px;
  border-top-color: #D3D3D3;
  border-bottom-style: solid;
  border-bottom-width: 2px;
  border-bottom-color: #D3D3D3;
}

#bhrryfljzg .gt_footnotes {
  color: #333333;
  background-color: #FFFFFF;
  border-bottom-style: none;
  border-bottom-width: 2px;
  border-bottom-color: #D3D3D3;
  border-left-style: none;
  border-left-width: 2px;
  border-left-color: #D3D3D3;
  border-right-style: none;
  border-right-width: 2px;
  border-right-color: #D3D3D3;
}

#bhrryfljzg .gt_footnote {
  margin: 0px;
  font-size: 90%;
  padding-top: 4px;
  padding-bottom: 4px;
  padding-left: 5px;
  padding-right: 5px;
}

#bhrryfljzg .gt_sourcenotes {
  color: #333333;
  background-color: #FFFFFF;
  border-bottom-style: none;
  border-bottom-width: 2px;
  border-bottom-color: #D3D3D3;
  border-left-style: none;
  border-left-width: 2px;
  border-left-color: #D3D3D3;
  border-right-style: none;
  border-right-width: 2px;
  border-right-color: #D3D3D3;
}

#bhrryfljzg .gt_sourcenote {
  font-size: 90%;
  padding-top: 4px;
  padding-bottom: 4px;
  padding-left: 5px;
  padding-right: 5px;
}

#bhrryfljzg .gt_left {
  text-align: left;
}

#bhrryfljzg .gt_center {
  text-align: center;
}

#bhrryfljzg .gt_right {
  text-align: right;
  font-variant-numeric: tabular-nums;
}

#bhrryfljzg .gt_font_normal {
  font-weight: normal;
}

#bhrryfljzg .gt_font_bold {
  font-weight: bold;
}

#bhrryfljzg .gt_font_italic {
  font-style: italic;
}

#bhrryfljzg .gt_super {
  font-size: 65%;
}

#bhrryfljzg .gt_footnote_marks {
  font-size: 75%;
  vertical-align: 0.4em;
  position: initial;
}

#bhrryfljzg .gt_asterisk {
  font-size: 100%;
  vertical-align: 0;
}

#bhrryfljzg .gt_indent_1 {
  text-indent: 5px;
}

#bhrryfljzg .gt_indent_2 {
  text-indent: 10px;
}

#bhrryfljzg .gt_indent_3 {
  text-indent: 15px;
}

#bhrryfljzg .gt_indent_4 {
  text-indent: 20px;
}

#bhrryfljzg .gt_indent_5 {
  text-indent: 25px;
}

#bhrryfljzg .katex-display {
  display: inline-flex !important;
  margin-bottom: 0.75em !important;
}

#bhrryfljzg div.Reactable > div.rt-table > div.rt-thead > div.rt-tr.rt-tr-group-header > div.rt-th-group:after {
  height: 0px !important;
}
</style>
<table class="gt_table" data-quarto-disable-processing="false" data-quarto-bootstrap="false">
  <thead>
    <tr class="gt_col_headings">
      <th class="gt_col_heading gt_columns_bottom_border gt_left" rowspan="1" colspan="1" scope="col" id="Grupo">Grupo</th>
      <th class="gt_col_heading gt_columns_bottom_border gt_right" rowspan="1" colspan="1" scope="col" id="Edad">Edad</th>
      <th class="gt_col_heading gt_columns_bottom_border gt_right" rowspan="1" colspan="1" scope="col" id="Salario">Salario</th>
    </tr>
  </thead>
  <tbody class="gt_table_body">
    <tr><td headers="Grupo" class="gt_row gt_left">control</td>
<td headers="Edad" class="gt_row gt_right">37.59256</td>
<td headers="Salario" class="gt_row gt_right">48814.57</td></tr>
    <tr><td headers="Grupo" class="gt_row gt_left">tratamiento</td>
<td headers="Edad" class="gt_row gt_right">30.18301</td>
<td headers="Salario" class="gt_row gt_right">50000.95</td></tr>
    <tr><td headers="Grupo" class="gt_row gt_left">tratamiento</td>
<td headers="Edad" class="gt_row gt_right">34.11016</td>
<td headers="Salario" class="gt_row gt_right">59497.67</td></tr>
    <tr><td headers="Grupo" class="gt_row gt_left">tratamiento</td>
<td headers="Edad" class="gt_row gt_right">36.88224</td>
<td headers="Salario" class="gt_row gt_right">55811.62</td></tr>
    <tr><td headers="Grupo" class="gt_row gt_left">control</td>
<td headers="Edad" class="gt_row gt_right">33.29116</td>
<td headers="Salario" class="gt_row gt_right">61942.17</td></tr>
    <tr><td headers="Grupo" class="gt_row gt_left">tratamiento</td>
<td headers="Edad" class="gt_row gt_right">39.85560</td>
<td headers="Salario" class="gt_row gt_right">68503.98</td></tr>
  </tbody>
  
  
</table>
</div>
<p>Datos de seis filas tomadas al azar.</p>
</div>
</div>
<p>Como es de esperarse (y lo esperamos mucho porque los datos los generamos nosotros), la edad y el salario est√°n correlacionados (r=0.83). Vamos a graficar los datos.</p>
<div class="cell">
<details>
<summary>Ver el c√≥digo</summary>
<div class="sourceCode cell-code" id="cb27"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb27-1"><a href="#cb27-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Y los graficamos</span></span>
<span id="cb27-2"><a href="#cb27-2" aria-hidden="true" tabindex="-1"></a><span class="co"># El texto de la correlaci√≥n</span></span>
<span id="cb27-3"><a href="#cb27-3" aria-hidden="true" tabindex="-1"></a>text_tbl <span class="ot">&lt;-</span> <span class="fu">tibble</span>(<span class="at">x =</span> <span class="fu">min</span>(empleados_tbl<span class="sc">$</span>Edad, <span class="at">na.rm =</span> T),</span>
<span id="cb27-4"><a href="#cb27-4" aria-hidden="true" tabindex="-1"></a>                   <span class="at">y =</span> <span class="fu">max</span>(empleados_tbl<span class="sc">$</span>Salario, <span class="at">na.rm =</span> T),</span>
<span id="cb27-5"><a href="#cb27-5" aria-hidden="true" tabindex="-1"></a>                   <span class="at">label =</span> <span class="fu">paste</span>(<span class="st">"r pearson ="</span>, <span class="fu">round</span>(<span class="fu">cor</span>(empleados_tbl<span class="sc">$</span>Edad, empleados_tbl<span class="sc">$</span>Salario, <span class="at">use=</span><span class="st">"complete.obs"</span>), <span class="dv">2</span>)))</span>
<span id="cb27-6"><a href="#cb27-6" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb27-7"><a href="#cb27-7" aria-hidden="true" tabindex="-1"></a>empleados_tbl <span class="sc">|&gt;</span> <span class="fu">ggplot</span>(<span class="fu">aes</span>(<span class="at">x =</span> Edad,</span>
<span id="cb27-8"><a href="#cb27-8" aria-hidden="true" tabindex="-1"></a>                            <span class="at">y =</span> Salario)) <span class="sc">+</span></span>
<span id="cb27-9"><a href="#cb27-9" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_point</span>(<span class="fu">aes</span>(<span class="at">color =</span> Grupo)) <span class="sc">+</span></span>
<span id="cb27-10"><a href="#cb27-10" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_smooth</span>(<span class="at">method =</span> <span class="st">"lm"</span>, <span class="at">color =</span> <span class="st">"black"</span>, <span class="at">se =</span> F) <span class="sc">+</span></span>
<span id="cb27-11"><a href="#cb27-11" aria-hidden="true" tabindex="-1"></a>  <span class="fu">scale_color_brewer</span>(<span class="at">palette =</span> <span class="st">"Dark2"</span>) <span class="sc">+</span></span>
<span id="cb27-12"><a href="#cb27-12" aria-hidden="true" tabindex="-1"></a>  <span class="fu">labs</span>(<span class="at">color =</span> <span class="cn">NULL</span>) <span class="sc">+</span></span>
<span id="cb27-13"><a href="#cb27-13" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_text</span>(<span class="at">data =</span> text_tbl, <span class="fu">aes</span>(<span class="at">x =</span> x, <span class="at">y =</span> y, <span class="at">label =</span> label), <span class="at">hjust =</span> <span class="dv">0</span>) <span class="sc">+</span></span>
<span id="cb27-14"><a href="#cb27-14" aria-hidden="true" tabindex="-1"></a>  <span class="fu">theme_bw</span>() <span class="sc">+</span></span>
<span id="cb27-15"><a href="#cb27-15" aria-hidden="true" tabindex="-1"></a>  <span class="fu">theme</span>(<span class="at">legend.position =</span> <span class="st">"top"</span>)</span>
<span id="cb27-16"><a href="#cb27-16" aria-hidden="true" tabindex="-1"></a><span class="co">#&gt; `geom_smooth()` using formula = 'y ~ x'</span></span></code><button title="Copiar al portapapeles" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
<div class="cell-output-display">
<div class="quarto-figure quarto-figure-center">
<figure class="figure">
<p><img src="matching_files/figure-html/unnamed-chunk-29-1.png" class="img-fluid figure-img" width="576"></p>
<p></p><figcaption class="figure-caption">Edad y salario de los empleados.</figcaption><p></p>
</figure>
</div>
</div>
</div>
<p>Ahora, qu√© pasa si queremos emparejar a un empleado del grupo tratamiento (el que tiene el ID <span class="math inline">\(I_{emp} = 2\)</span>) con uno del grupo control. Si usamos la distancia euclidiana, vamos a calcular la distancia entre cada empleado del grupo tratamiento y todos los del grupo control, y luego elegimos el m√°s cercano.</p>
<div class="cell">
<details>
<summary>Ver el c√≥digo</summary>
<div class="sourceCode cell-code" id="cb28"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb28-1"><a href="#cb28-1" aria-hidden="true" tabindex="-1"></a>I_emp <span class="ot">&lt;-</span> <span class="dv">2</span> <span class="co"># Al que le queremos encontrar la distancia m√°s cercana</span></span>
<span id="cb28-2"><a href="#cb28-2" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb28-3"><a href="#cb28-3" aria-hidden="true" tabindex="-1"></a>empleados_tbl <span class="sc">|&gt;</span> <span class="fu">ggplot</span>(<span class="fu">aes</span>(<span class="at">x =</span> Edad,</span>
<span id="cb28-4"><a href="#cb28-4" aria-hidden="true" tabindex="-1"></a>                            <span class="at">y =</span> Salario)) <span class="sc">+</span></span>
<span id="cb28-5"><a href="#cb28-5" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_point</span>(<span class="fu">aes</span>(<span class="at">color =</span> Grupo), <span class="at">alpha =</span> <span class="fl">0.2</span>) <span class="sc">+</span></span>
<span id="cb28-6"><a href="#cb28-6" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_point</span>(<span class="at">data =</span> empleados_tbl[I_emp,], <span class="at">color =</span> <span class="st">"black"</span>, <span class="at">size =</span> <span class="dv">3</span>) <span class="sc">+</span></span>
<span id="cb28-7"><a href="#cb28-7" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_magnify</span>(<span class="at">from =</span> <span class="fu">c</span>(empleados_tbl<span class="sc">$</span>Edad[I_emp]<span class="sc">*</span>.<span class="dv">98</span>, empleados_tbl<span class="sc">$</span>Edad[I_emp]<span class="sc">*</span><span class="fl">1.01</span>, </span>
<span id="cb28-8"><a href="#cb28-8" aria-hidden="true" tabindex="-1"></a>                        empleados_tbl<span class="sc">$</span>Salario[I_emp]<span class="sc">*</span>.<span class="dv">98</span>, empleados_tbl<span class="sc">$</span>Salario[I_emp]<span class="sc">*</span><span class="fl">1.01</span>), </span>
<span id="cb28-9"><a href="#cb28-9" aria-hidden="true" tabindex="-1"></a>               <span class="at">to =</span> <span class="fu">c</span>(<span class="dv">35</span>, <span class="dv">45</span>, <span class="fl">3E4</span>, <span class="fl">5E4</span>)) <span class="sc">+</span></span>
<span id="cb28-10"><a href="#cb28-10" aria-hidden="true" tabindex="-1"></a>  <span class="fu">theme_bw</span>() <span class="sc">+</span></span>
<span id="cb28-11"><a href="#cb28-11" aria-hidden="true" tabindex="-1"></a>  <span class="fu">scale_color_brewer</span>(<span class="at">palette =</span> <span class="st">"Dark2"</span>) <span class="sc">+</span></span>
<span id="cb28-12"><a href="#cb28-12" aria-hidden="true" tabindex="-1"></a>  <span class="fu">labs</span>(<span class="at">color =</span> <span class="cn">NULL</span>) <span class="sc">+</span></span>
<span id="cb28-13"><a href="#cb28-13" aria-hidden="true" tabindex="-1"></a>  <span class="fu">theme</span>(<span class="at">legend.position =</span> <span class="st">"top"</span>)</span>
<span id="cb28-14"><a href="#cb28-14" aria-hidden="true" tabindex="-1"></a><span class="co">#&gt; Warning in .setMask(mask$f, mask$ref): Ignored alpha mask (not supported on</span></span>
<span id="cb28-15"><a href="#cb28-15" aria-hidden="true" tabindex="-1"></a><span class="co">#&gt; this device)</span></span>
<span id="cb28-16"><a href="#cb28-16" aria-hidden="true" tabindex="-1"></a><span class="co">#&gt; Warning in .setMask(mask$f, mask$ref): Ignored alpha mask (not supported on</span></span>
<span id="cb28-17"><a href="#cb28-17" aria-hidden="true" tabindex="-1"></a><span class="co">#&gt; this device)</span></span>
<span id="cb28-18"><a href="#cb28-18" aria-hidden="true" tabindex="-1"></a><span class="co">#&gt; Warning in .setMask(mask$f, mask$ref): Ignored alpha mask (not supported on</span></span>
<span id="cb28-19"><a href="#cb28-19" aria-hidden="true" tabindex="-1"></a><span class="co">#&gt; this device)</span></span>
<span id="cb28-20"><a href="#cb28-20" aria-hidden="true" tabindex="-1"></a><span class="co">#&gt; Warning in .setMask(mask$f, mask$ref): Ignored alpha mask (not supported on</span></span>
<span id="cb28-21"><a href="#cb28-21" aria-hidden="true" tabindex="-1"></a><span class="co">#&gt; this device)</span></span>
<span id="cb28-22"><a href="#cb28-22" aria-hidden="true" tabindex="-1"></a><span class="co">#&gt; Warning in .setMask(mask$f, mask$ref): Ignored alpha mask (not supported on</span></span>
<span id="cb28-23"><a href="#cb28-23" aria-hidden="true" tabindex="-1"></a><span class="co">#&gt; this device)</span></span>
<span id="cb28-24"><a href="#cb28-24" aria-hidden="true" tabindex="-1"></a><span class="co">#&gt; Warning in .setMask(mask$f, mask$ref): Ignored alpha mask (not supported on</span></span>
<span id="cb28-25"><a href="#cb28-25" aria-hidden="true" tabindex="-1"></a><span class="co">#&gt; this device)</span></span>
<span id="cb28-26"><a href="#cb28-26" aria-hidden="true" tabindex="-1"></a><span class="co">#&gt; Warning in .setMask(mask$f, mask$ref): Ignored alpha mask (not supported on</span></span>
<span id="cb28-27"><a href="#cb28-27" aria-hidden="true" tabindex="-1"></a><span class="co">#&gt; this device)</span></span>
<span id="cb28-28"><a href="#cb28-28" aria-hidden="true" tabindex="-1"></a><span class="co">#&gt; Warning in .setMask(mask$f, mask$ref): Ignored alpha mask (not supported on</span></span>
<span id="cb28-29"><a href="#cb28-29" aria-hidden="true" tabindex="-1"></a><span class="co">#&gt; this device)</span></span>
<span id="cb28-30"><a href="#cb28-30" aria-hidden="true" tabindex="-1"></a><span class="co">#&gt; Warning in .setMask(mask$f, mask$ref): Ignored alpha mask (not supported on</span></span>
<span id="cb28-31"><a href="#cb28-31" aria-hidden="true" tabindex="-1"></a><span class="co">#&gt; this device)</span></span>
<span id="cb28-32"><a href="#cb28-32" aria-hidden="true" tabindex="-1"></a><span class="co">#&gt; Warning in .setMask(mask$f, mask$ref): Ignored alpha mask (not supported on</span></span>
<span id="cb28-33"><a href="#cb28-33" aria-hidden="true" tabindex="-1"></a><span class="co">#&gt; this device)</span></span>
<span id="cb28-34"><a href="#cb28-34" aria-hidden="true" tabindex="-1"></a><span class="co">#&gt; Warning in .setMask(mask$f, mask$ref): Ignored alpha mask (not supported on</span></span>
<span id="cb28-35"><a href="#cb28-35" aria-hidden="true" tabindex="-1"></a><span class="co">#&gt; this device)</span></span>
<span id="cb28-36"><a href="#cb28-36" aria-hidden="true" tabindex="-1"></a><span class="co">#&gt; Warning in .setMask(mask$f, mask$ref): Ignored alpha mask (not supported on</span></span>
<span id="cb28-37"><a href="#cb28-37" aria-hidden="true" tabindex="-1"></a><span class="co">#&gt; this device)</span></span>
<span id="cb28-38"><a href="#cb28-38" aria-hidden="true" tabindex="-1"></a><span class="co">#&gt; Warning in .setMask(mask$f, mask$ref): Ignored alpha mask (not supported on</span></span>
<span id="cb28-39"><a href="#cb28-39" aria-hidden="true" tabindex="-1"></a><span class="co">#&gt; this device)</span></span>
<span id="cb28-40"><a href="#cb28-40" aria-hidden="true" tabindex="-1"></a><span class="co">#&gt; Warning in .setMask(mask$f, mask$ref): Ignored alpha mask (not supported on</span></span>
<span id="cb28-41"><a href="#cb28-41" aria-hidden="true" tabindex="-1"></a><span class="co">#&gt; this device)</span></span>
<span id="cb28-42"><a href="#cb28-42" aria-hidden="true" tabindex="-1"></a><span class="co">#&gt; Warning in .setMask(mask$f, mask$ref): Ignored alpha mask (not supported on</span></span>
<span id="cb28-43"><a href="#cb28-43" aria-hidden="true" tabindex="-1"></a><span class="co">#&gt; this device)</span></span>
<span id="cb28-44"><a href="#cb28-44" aria-hidden="true" tabindex="-1"></a><span class="co">#&gt; Warning in .setMask(mask$f, mask$ref): Ignored alpha mask (not supported on</span></span>
<span id="cb28-45"><a href="#cb28-45" aria-hidden="true" tabindex="-1"></a><span class="co">#&gt; this device)</span></span>
<span id="cb28-46"><a href="#cb28-46" aria-hidden="true" tabindex="-1"></a><span class="co">#&gt; Warning in .setMask(mask$f, mask$ref): Ignored alpha mask (not supported on</span></span>
<span id="cb28-47"><a href="#cb28-47" aria-hidden="true" tabindex="-1"></a><span class="co">#&gt; this device)</span></span>
<span id="cb28-48"><a href="#cb28-48" aria-hidden="true" tabindex="-1"></a><span class="co">#&gt; Warning in .setMask(mask$f, mask$ref): Ignored alpha mask (not supported on</span></span>
<span id="cb28-49"><a href="#cb28-49" aria-hidden="true" tabindex="-1"></a><span class="co">#&gt; this device)</span></span>
<span id="cb28-50"><a href="#cb28-50" aria-hidden="true" tabindex="-1"></a><span class="co">#&gt; Warning in .setMask(mask$f, mask$ref): Ignored alpha mask (not supported on</span></span>
<span id="cb28-51"><a href="#cb28-51" aria-hidden="true" tabindex="-1"></a><span class="co">#&gt; this device)</span></span>
<span id="cb28-52"><a href="#cb28-52" aria-hidden="true" tabindex="-1"></a><span class="co">#&gt; Warning in .setMask(mask$f, mask$ref): Ignored alpha mask (not supported on</span></span>
<span id="cb28-53"><a href="#cb28-53" aria-hidden="true" tabindex="-1"></a><span class="co">#&gt; this device)</span></span>
<span id="cb28-54"><a href="#cb28-54" aria-hidden="true" tabindex="-1"></a><span class="co">#&gt; Warning in .setMask(mask$f, mask$ref): Ignored alpha mask (not supported on</span></span>
<span id="cb28-55"><a href="#cb28-55" aria-hidden="true" tabindex="-1"></a><span class="co">#&gt; this device)</span></span>
<span id="cb28-56"><a href="#cb28-56" aria-hidden="true" tabindex="-1"></a><span class="co">#&gt; Warning in .setMask(mask$f, mask$ref): Ignored alpha mask (not supported on</span></span>
<span id="cb28-57"><a href="#cb28-57" aria-hidden="true" tabindex="-1"></a><span class="co">#&gt; this device)</span></span>
<span id="cb28-58"><a href="#cb28-58" aria-hidden="true" tabindex="-1"></a><span class="co">#&gt; Warning in .setMask(mask$f, mask$ref): Ignored alpha mask (not supported on</span></span>
<span id="cb28-59"><a href="#cb28-59" aria-hidden="true" tabindex="-1"></a><span class="co">#&gt; this device)</span></span>
<span id="cb28-60"><a href="#cb28-60" aria-hidden="true" tabindex="-1"></a><span class="co">#&gt; Warning in .setMask(mask$f, mask$ref): Ignored alpha mask (not supported on</span></span>
<span id="cb28-61"><a href="#cb28-61" aria-hidden="true" tabindex="-1"></a><span class="co">#&gt; this device)</span></span>
<span id="cb28-62"><a href="#cb28-62" aria-hidden="true" tabindex="-1"></a><span class="co">#&gt; Warning in .setMask(mask$f, mask$ref): Ignored alpha mask (not supported on</span></span>
<span id="cb28-63"><a href="#cb28-63" aria-hidden="true" tabindex="-1"></a><span class="co">#&gt; this device)</span></span>
<span id="cb28-64"><a href="#cb28-64" aria-hidden="true" tabindex="-1"></a><span class="co">#&gt; Warning in .setMask(mask$f, mask$ref): Ignored alpha mask (not supported on</span></span>
<span id="cb28-65"><a href="#cb28-65" aria-hidden="true" tabindex="-1"></a><span class="co">#&gt; this device)</span></span>
<span id="cb28-66"><a href="#cb28-66" aria-hidden="true" tabindex="-1"></a><span class="co">#&gt; Warning in .setMask(mask$f, mask$ref): Ignored alpha mask (not supported on</span></span>
<span id="cb28-67"><a href="#cb28-67" aria-hidden="true" tabindex="-1"></a><span class="co">#&gt; this device)</span></span>
<span id="cb28-68"><a href="#cb28-68" aria-hidden="true" tabindex="-1"></a><span class="co">#&gt; Warning in .setMask(mask$f, mask$ref): Ignored alpha mask (not supported on</span></span>
<span id="cb28-69"><a href="#cb28-69" aria-hidden="true" tabindex="-1"></a><span class="co">#&gt; this device)</span></span>
<span id="cb28-70"><a href="#cb28-70" aria-hidden="true" tabindex="-1"></a><span class="co">#&gt; Warning in .setMask(mask$f, mask$ref): Ignored alpha mask (not supported on</span></span>
<span id="cb28-71"><a href="#cb28-71" aria-hidden="true" tabindex="-1"></a><span class="co">#&gt; this device)</span></span>
<span id="cb28-72"><a href="#cb28-72" aria-hidden="true" tabindex="-1"></a><span class="co">#&gt; Warning in .setMask(mask$f, mask$ref): Ignored alpha mask (not supported on</span></span>
<span id="cb28-73"><a href="#cb28-73" aria-hidden="true" tabindex="-1"></a><span class="co">#&gt; this device)</span></span>
<span id="cb28-74"><a href="#cb28-74" aria-hidden="true" tabindex="-1"></a><span class="co">#&gt; Warning in .setMask(mask$f, mask$ref): Ignored alpha mask (not supported on</span></span>
<span id="cb28-75"><a href="#cb28-75" aria-hidden="true" tabindex="-1"></a><span class="co">#&gt; this device)</span></span>
<span id="cb28-76"><a href="#cb28-76" aria-hidden="true" tabindex="-1"></a><span class="co">#&gt; Warning in .setMask(mask$f, mask$ref): Ignored alpha mask (not supported on</span></span>
<span id="cb28-77"><a href="#cb28-77" aria-hidden="true" tabindex="-1"></a><span class="co">#&gt; this device)</span></span>
<span id="cb28-78"><a href="#cb28-78" aria-hidden="true" tabindex="-1"></a><span class="co">#&gt; Warning in .setMask(mask$f, mask$ref): Ignored alpha mask (not supported on</span></span>
<span id="cb28-79"><a href="#cb28-79" aria-hidden="true" tabindex="-1"></a><span class="co">#&gt; this device)</span></span></code><button title="Copiar al portapapeles" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
<div class="cell-output-display">
<div class="quarto-figure quarto-figure-center">
<figure class="figure">
<p><img src="matching_files/figure-html/unnamed-chunk-30-1.png" class="img-fluid figure-img" width="576"></p>
<p></p><figcaption class="figure-caption">DAG que representa la relaci√≥n causal entre las vitaminas y los defectos de nacimiento.</figcaption><p></p>
</figure>
</div>
</div>
</div>
<div class="cell">
<details>
<summary>Ver el c√≥digo</summary>
<div class="sourceCode cell-code" id="cb29"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb29-1"><a href="#cb29-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Calculamos las distancias</span></span>
<span id="cb29-2"><a href="#cb29-2" aria-hidden="true" tabindex="-1"></a>matriz_varianzas <span class="ot">&lt;-</span> <span class="fu">matrix</span>(<span class="fu">c</span>(<span class="fu">var</span>(empleados_tbl<span class="sc">$</span>Edad), <span class="dv">0</span>, <span class="dv">0</span>, <span class="fu">var</span>(empleados_tbl<span class="sc">$</span>Salario)),</span>
<span id="cb29-3"><a href="#cb29-3" aria-hidden="true" tabindex="-1"></a>                           <span class="at">ncol =</span> <span class="dv">2</span>)</span>
<span id="cb29-4"><a href="#cb29-4" aria-hidden="true" tabindex="-1"></a>matriz_varianzas_inv <span class="ot">&lt;-</span> <span class="fu">solve</span>(matriz_varianzas)</span>
<span id="cb29-5"><a href="#cb29-5" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb29-6"><a href="#cb29-6" aria-hidden="true" tabindex="-1"></a>matriz_covarianzas <span class="ot">&lt;-</span> <span class="fu">var</span>(<span class="fu">as.matrix</span>(empleados_tbl[,<span class="dv">2</span><span class="sc">:</span><span class="dv">3</span>]))</span>
<span id="cb29-7"><a href="#cb29-7" aria-hidden="true" tabindex="-1"></a>matriz_covarianzas_inv <span class="ot">&lt;-</span> <span class="fu">solve</span>(matriz_covarianzas)</span>
<span id="cb29-8"><a href="#cb29-8" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb29-9"><a href="#cb29-9" aria-hidden="true" tabindex="-1"></a>euclidean <span class="ot">&lt;-</span> <span class="fu">rep</span>(<span class="cn">NA</span>, <span class="fu">nrow</span>(empleados_tbl))</span>
<span id="cb29-10"><a href="#cb29-10" aria-hidden="true" tabindex="-1"></a>mahalanobis <span class="ot">&lt;-</span> <span class="fu">rep</span>(<span class="cn">NA</span>, <span class="fu">nrow</span>(empleados_tbl))</span>
<span id="cb29-11"><a href="#cb29-11" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb29-12"><a href="#cb29-12" aria-hidden="true" tabindex="-1"></a><span class="cf">for</span> (i <span class="cf">in</span> <span class="dv">1</span><span class="sc">:</span><span class="fu">nrow</span>(empleados_tbl)) {</span>
<span id="cb29-13"><a href="#cb29-13" aria-hidden="true" tabindex="-1"></a>  resta <span class="ot">&lt;-</span> <span class="fu">as.matrix</span>(empleados_tbl[I_emp,<span class="dv">2</span><span class="sc">:</span><span class="dv">3</span>])<span class="sc">-</span><span class="fu">as.matrix</span>(empleados_tbl[i,<span class="dv">2</span><span class="sc">:</span><span class="dv">3</span>])</span>
<span id="cb29-14"><a href="#cb29-14" aria-hidden="true" tabindex="-1"></a>  euclidean[i] <span class="ot">&lt;-</span> resta <span class="sc">%*%</span> matriz_varianzas_inv <span class="sc">%*%</span> <span class="fu">t</span>(resta)</span>
<span id="cb29-15"><a href="#cb29-15" aria-hidden="true" tabindex="-1"></a>  mahalanobis[i] <span class="ot">&lt;-</span> resta <span class="sc">%*%</span> matriz_covarianzas_inv <span class="sc">%*%</span> <span class="fu">t</span>(resta)</span>
<span id="cb29-16"><a href="#cb29-16" aria-hidden="true" tabindex="-1"></a>}</span>
<span id="cb29-17"><a href="#cb29-17" aria-hidden="true" tabindex="-1"></a>min_euclidean <span class="ot">&lt;-</span> <span class="fu">which.min</span>(euclidean[<span class="dv">101</span><span class="sc">:</span><span class="dv">200</span>]) <span class="sc">+</span> <span class="dv">100</span></span>
<span id="cb29-18"><a href="#cb29-18" aria-hidden="true" tabindex="-1"></a>min_mahalab <span class="ot">&lt;-</span> <span class="fu">which.min</span>(mahalanobis[<span class="dv">101</span><span class="sc">:</span><span class="dv">200</span>]) <span class="sc">+</span> <span class="dv">100</span></span>
<span id="cb29-19"><a href="#cb29-19" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb29-20"><a href="#cb29-20" aria-hidden="true" tabindex="-1"></a><span class="co"># Las vizualizamos</span></span>
<span id="cb29-21"><a href="#cb29-21" aria-hidden="true" tabindex="-1"></a>empleados_tbl <span class="sc">|&gt;</span> <span class="fu">ggplot</span>(<span class="fu">aes</span>(<span class="at">x =</span> Edad,</span>
<span id="cb29-22"><a href="#cb29-22" aria-hidden="true" tabindex="-1"></a>                            <span class="at">y =</span> Salario)) <span class="sc">+</span></span>
<span id="cb29-23"><a href="#cb29-23" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_point</span>(<span class="fu">aes</span>(<span class="at">color =</span> Grupo), <span class="at">alpha =</span> <span class="fl">0.2</span>) <span class="sc">+</span></span>
<span id="cb29-24"><a href="#cb29-24" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_point</span>(<span class="at">data =</span> empleados_tbl[I_emp,], <span class="at">color =</span> <span class="st">"black"</span>, <span class="at">size =</span> <span class="dv">3</span>) <span class="sc">+</span></span>
<span id="cb29-25"><a href="#cb29-25" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_point</span>(<span class="at">data =</span> empleados_tbl[min_euclidean,], <span class="at">size =</span> <span class="dv">3</span>, <span class="at">color =</span> <span class="st">"darkred"</span>) <span class="sc">+</span></span>
<span id="cb29-26"><a href="#cb29-26" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_point</span>(<span class="at">data =</span> empleados_tbl[min_mahalab,], <span class="at">size =</span> <span class="dv">3</span>, <span class="at">color =</span> <span class="st">"steelblue"</span>) <span class="sc">+</span></span>
<span id="cb29-27"><a href="#cb29-27" aria-hidden="true" tabindex="-1"></a>  <span class="fu">theme_bw</span>() <span class="sc">+</span></span>
<span id="cb29-28"><a href="#cb29-28" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_magnify</span>(<span class="at">from =</span> <span class="fu">c</span>(empleados_tbl<span class="sc">$</span>Edad[I_emp]<span class="sc">*</span>.<span class="dv">98</span>, empleados_tbl<span class="sc">$</span>Edad[I_emp]<span class="sc">*</span><span class="fl">1.01</span>, </span>
<span id="cb29-29"><a href="#cb29-29" aria-hidden="true" tabindex="-1"></a>                        empleados_tbl<span class="sc">$</span>Salario[I_emp]<span class="sc">*</span>.<span class="dv">98</span>, empleados_tbl<span class="sc">$</span>Salario[I_emp]<span class="sc">*</span><span class="fl">1.01</span>), </span>
<span id="cb29-30"><a href="#cb29-30" aria-hidden="true" tabindex="-1"></a>               <span class="at">to =</span> <span class="fu">c</span>(<span class="dv">35</span>, <span class="dv">45</span>, <span class="fl">3E4</span>, <span class="fl">5E4</span>)) <span class="sc">+</span></span>
<span id="cb29-31"><a href="#cb29-31" aria-hidden="true" tabindex="-1"></a>  <span class="fu">scale_color_brewer</span>(<span class="at">palette =</span> <span class="st">"Dark2"</span>) <span class="sc">+</span></span>
<span id="cb29-32"><a href="#cb29-32" aria-hidden="true" tabindex="-1"></a>  <span class="fu">labs</span>(<span class="at">color =</span> <span class="cn">NULL</span>) <span class="sc">+</span></span>
<span id="cb29-33"><a href="#cb29-33" aria-hidden="true" tabindex="-1"></a>  <span class="fu">theme</span>(<span class="at">legend.position =</span> <span class="st">"top"</span>)</span>
<span id="cb29-34"><a href="#cb29-34" aria-hidden="true" tabindex="-1"></a><span class="co">#&gt; Warning in .setMask(mask$f, mask$ref): Ignored alpha mask (not supported on</span></span>
<span id="cb29-35"><a href="#cb29-35" aria-hidden="true" tabindex="-1"></a><span class="co">#&gt; this device)</span></span>
<span id="cb29-36"><a href="#cb29-36" aria-hidden="true" tabindex="-1"></a><span class="co">#&gt; Warning in .setMask(mask$f, mask$ref): Ignored alpha mask (not supported on</span></span>
<span id="cb29-37"><a href="#cb29-37" aria-hidden="true" tabindex="-1"></a><span class="co">#&gt; this device)</span></span>
<span id="cb29-38"><a href="#cb29-38" aria-hidden="true" tabindex="-1"></a><span class="co">#&gt; Warning in .setMask(mask$f, mask$ref): Ignored alpha mask (not supported on</span></span>
<span id="cb29-39"><a href="#cb29-39" aria-hidden="true" tabindex="-1"></a><span class="co">#&gt; this device)</span></span>
<span id="cb29-40"><a href="#cb29-40" aria-hidden="true" tabindex="-1"></a><span class="co">#&gt; Warning in .setMask(mask$f, mask$ref): Ignored alpha mask (not supported on</span></span>
<span id="cb29-41"><a href="#cb29-41" aria-hidden="true" tabindex="-1"></a><span class="co">#&gt; this device)</span></span>
<span id="cb29-42"><a href="#cb29-42" aria-hidden="true" tabindex="-1"></a><span class="co">#&gt; Warning in .setMask(mask$f, mask$ref): Ignored alpha mask (not supported on</span></span>
<span id="cb29-43"><a href="#cb29-43" aria-hidden="true" tabindex="-1"></a><span class="co">#&gt; this device)</span></span>
<span id="cb29-44"><a href="#cb29-44" aria-hidden="true" tabindex="-1"></a><span class="co">#&gt; Warning in .setMask(mask$f, mask$ref): Ignored alpha mask (not supported on</span></span>
<span id="cb29-45"><a href="#cb29-45" aria-hidden="true" tabindex="-1"></a><span class="co">#&gt; this device)</span></span>
<span id="cb29-46"><a href="#cb29-46" aria-hidden="true" tabindex="-1"></a><span class="co">#&gt; Warning in .setMask(mask$f, mask$ref): Ignored alpha mask (not supported on</span></span>
<span id="cb29-47"><a href="#cb29-47" aria-hidden="true" tabindex="-1"></a><span class="co">#&gt; this device)</span></span>
<span id="cb29-48"><a href="#cb29-48" aria-hidden="true" tabindex="-1"></a><span class="co">#&gt; Warning in .setMask(mask$f, mask$ref): Ignored alpha mask (not supported on</span></span>
<span id="cb29-49"><a href="#cb29-49" aria-hidden="true" tabindex="-1"></a><span class="co">#&gt; this device)</span></span>
<span id="cb29-50"><a href="#cb29-50" aria-hidden="true" tabindex="-1"></a><span class="co">#&gt; Warning in .setMask(mask$f, mask$ref): Ignored alpha mask (not supported on</span></span>
<span id="cb29-51"><a href="#cb29-51" aria-hidden="true" tabindex="-1"></a><span class="co">#&gt; this device)</span></span>
<span id="cb29-52"><a href="#cb29-52" aria-hidden="true" tabindex="-1"></a><span class="co">#&gt; Warning in .setMask(mask$f, mask$ref): Ignored alpha mask (not supported on</span></span>
<span id="cb29-53"><a href="#cb29-53" aria-hidden="true" tabindex="-1"></a><span class="co">#&gt; this device)</span></span>
<span id="cb29-54"><a href="#cb29-54" aria-hidden="true" tabindex="-1"></a><span class="co">#&gt; Warning in .setMask(mask$f, mask$ref): Ignored alpha mask (not supported on</span></span>
<span id="cb29-55"><a href="#cb29-55" aria-hidden="true" tabindex="-1"></a><span class="co">#&gt; this device)</span></span>
<span id="cb29-56"><a href="#cb29-56" aria-hidden="true" tabindex="-1"></a><span class="co">#&gt; Warning in .setMask(mask$f, mask$ref): Ignored alpha mask (not supported on</span></span>
<span id="cb29-57"><a href="#cb29-57" aria-hidden="true" tabindex="-1"></a><span class="co">#&gt; this device)</span></span>
<span id="cb29-58"><a href="#cb29-58" aria-hidden="true" tabindex="-1"></a><span class="co">#&gt; Warning in .setMask(mask$f, mask$ref): Ignored alpha mask (not supported on</span></span>
<span id="cb29-59"><a href="#cb29-59" aria-hidden="true" tabindex="-1"></a><span class="co">#&gt; this device)</span></span>
<span id="cb29-60"><a href="#cb29-60" aria-hidden="true" tabindex="-1"></a><span class="co">#&gt; Warning in .setMask(mask$f, mask$ref): Ignored alpha mask (not supported on</span></span>
<span id="cb29-61"><a href="#cb29-61" aria-hidden="true" tabindex="-1"></a><span class="co">#&gt; this device)</span></span>
<span id="cb29-62"><a href="#cb29-62" aria-hidden="true" tabindex="-1"></a><span class="co">#&gt; Warning in .setMask(mask$f, mask$ref): Ignored alpha mask (not supported on</span></span>
<span id="cb29-63"><a href="#cb29-63" aria-hidden="true" tabindex="-1"></a><span class="co">#&gt; this device)</span></span>
<span id="cb29-64"><a href="#cb29-64" aria-hidden="true" tabindex="-1"></a><span class="co">#&gt; Warning in .setMask(mask$f, mask$ref): Ignored alpha mask (not supported on</span></span>
<span id="cb29-65"><a href="#cb29-65" aria-hidden="true" tabindex="-1"></a><span class="co">#&gt; this device)</span></span>
<span id="cb29-66"><a href="#cb29-66" aria-hidden="true" tabindex="-1"></a><span class="co">#&gt; Warning in .setMask(mask$f, mask$ref): Ignored alpha mask (not supported on</span></span>
<span id="cb29-67"><a href="#cb29-67" aria-hidden="true" tabindex="-1"></a><span class="co">#&gt; this device)</span></span>
<span id="cb29-68"><a href="#cb29-68" aria-hidden="true" tabindex="-1"></a><span class="co">#&gt; Warning in .setMask(mask$f, mask$ref): Ignored alpha mask (not supported on</span></span>
<span id="cb29-69"><a href="#cb29-69" aria-hidden="true" tabindex="-1"></a><span class="co">#&gt; this device)</span></span>
<span id="cb29-70"><a href="#cb29-70" aria-hidden="true" tabindex="-1"></a><span class="co">#&gt; Warning in .setMask(mask$f, mask$ref): Ignored alpha mask (not supported on</span></span>
<span id="cb29-71"><a href="#cb29-71" aria-hidden="true" tabindex="-1"></a><span class="co">#&gt; this device)</span></span>
<span id="cb29-72"><a href="#cb29-72" aria-hidden="true" tabindex="-1"></a><span class="co">#&gt; Warning in .setMask(mask$f, mask$ref): Ignored alpha mask (not supported on</span></span>
<span id="cb29-73"><a href="#cb29-73" aria-hidden="true" tabindex="-1"></a><span class="co">#&gt; this device)</span></span>
<span id="cb29-74"><a href="#cb29-74" aria-hidden="true" tabindex="-1"></a><span class="co">#&gt; Warning in .setMask(mask$f, mask$ref): Ignored alpha mask (not supported on</span></span>
<span id="cb29-75"><a href="#cb29-75" aria-hidden="true" tabindex="-1"></a><span class="co">#&gt; this device)</span></span>
<span id="cb29-76"><a href="#cb29-76" aria-hidden="true" tabindex="-1"></a><span class="co">#&gt; Warning in .setMask(mask$f, mask$ref): Ignored alpha mask (not supported on</span></span>
<span id="cb29-77"><a href="#cb29-77" aria-hidden="true" tabindex="-1"></a><span class="co">#&gt; this device)</span></span>
<span id="cb29-78"><a href="#cb29-78" aria-hidden="true" tabindex="-1"></a><span class="co">#&gt; Warning in .setMask(mask$f, mask$ref): Ignored alpha mask (not supported on</span></span>
<span id="cb29-79"><a href="#cb29-79" aria-hidden="true" tabindex="-1"></a><span class="co">#&gt; this device)</span></span>
<span id="cb29-80"><a href="#cb29-80" aria-hidden="true" tabindex="-1"></a><span class="co">#&gt; Warning in .setMask(mask$f, mask$ref): Ignored alpha mask (not supported on</span></span>
<span id="cb29-81"><a href="#cb29-81" aria-hidden="true" tabindex="-1"></a><span class="co">#&gt; this device)</span></span>
<span id="cb29-82"><a href="#cb29-82" aria-hidden="true" tabindex="-1"></a><span class="co">#&gt; Warning in .setMask(mask$f, mask$ref): Ignored alpha mask (not supported on</span></span>
<span id="cb29-83"><a href="#cb29-83" aria-hidden="true" tabindex="-1"></a><span class="co">#&gt; this device)</span></span>
<span id="cb29-84"><a href="#cb29-84" aria-hidden="true" tabindex="-1"></a><span class="co">#&gt; Warning in .setMask(mask$f, mask$ref): Ignored alpha mask (not supported on</span></span>
<span id="cb29-85"><a href="#cb29-85" aria-hidden="true" tabindex="-1"></a><span class="co">#&gt; this device)</span></span>
<span id="cb29-86"><a href="#cb29-86" aria-hidden="true" tabindex="-1"></a><span class="co">#&gt; Warning in .setMask(mask$f, mask$ref): Ignored alpha mask (not supported on</span></span>
<span id="cb29-87"><a href="#cb29-87" aria-hidden="true" tabindex="-1"></a><span class="co">#&gt; this device)</span></span>
<span id="cb29-88"><a href="#cb29-88" aria-hidden="true" tabindex="-1"></a><span class="co">#&gt; Warning in .setMask(mask$f, mask$ref): Ignored alpha mask (not supported on</span></span>
<span id="cb29-89"><a href="#cb29-89" aria-hidden="true" tabindex="-1"></a><span class="co">#&gt; this device)</span></span>
<span id="cb29-90"><a href="#cb29-90" aria-hidden="true" tabindex="-1"></a><span class="co">#&gt; Warning in .setMask(mask$f, mask$ref): Ignored alpha mask (not supported on</span></span>
<span id="cb29-91"><a href="#cb29-91" aria-hidden="true" tabindex="-1"></a><span class="co">#&gt; this device)</span></span>
<span id="cb29-92"><a href="#cb29-92" aria-hidden="true" tabindex="-1"></a><span class="co">#&gt; Warning in .setMask(mask$f, mask$ref): Ignored alpha mask (not supported on</span></span>
<span id="cb29-93"><a href="#cb29-93" aria-hidden="true" tabindex="-1"></a><span class="co">#&gt; this device)</span></span>
<span id="cb29-94"><a href="#cb29-94" aria-hidden="true" tabindex="-1"></a><span class="co">#&gt; Warning in .setMask(mask$f, mask$ref): Ignored alpha mask (not supported on</span></span>
<span id="cb29-95"><a href="#cb29-95" aria-hidden="true" tabindex="-1"></a><span class="co">#&gt; this device)</span></span>
<span id="cb29-96"><a href="#cb29-96" aria-hidden="true" tabindex="-1"></a><span class="co">#&gt; Warning in .setMask(mask$f, mask$ref): Ignored alpha mask (not supported on</span></span>
<span id="cb29-97"><a href="#cb29-97" aria-hidden="true" tabindex="-1"></a><span class="co">#&gt; this device)</span></span>
<span id="cb29-98"><a href="#cb29-98" aria-hidden="true" tabindex="-1"></a><span class="co">#&gt; Warning in .setMask(mask$f, mask$ref): Ignored alpha mask (not supported on</span></span>
<span id="cb29-99"><a href="#cb29-99" aria-hidden="true" tabindex="-1"></a><span class="co">#&gt; this device)</span></span></code><button title="Copiar al portapapeles" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
<div class="cell-output-display">
<div class="quarto-figure quarto-figure-center">
<figure class="figure">
<p><img src="matching_files/figure-html/unnamed-chunk-31-1.png" class="img-fluid figure-img" width="576"></p>
<p></p><figcaption class="figure-caption">DAG que representa la relaci√≥n causal entre las vitaminas y los defectos de nacimiento.</figcaption><p></p>
</figure>
</div>
</div>
</div>
<p>¬øCu√°l dir√≠an que es el m√°s cercano? ¬øEl punto rojo o el punto azul?</p>
</section>
</section>
<section id="sec-matching_vs_reg" class="level2 page-columns page-full" data-number="6.3">
<h2 data-number="6.3" class="anchored page-columns page-full" data-anchor-id="sec-matching_vs_reg"><span class="header-section-number">6.3</span> <em>Matching</em> vs.&nbsp;regresi√≥n<a href="#fn10" class="footnote-ref" id="fnref10" role="doc-noteref"><sup>10</sup></a><div class="no-row-height column-margin column-container"><li id="fn10"><p><sup>10</sup>&nbsp;Toda esta secci√≥n est√° fuertemente ‚Äúinspirada‚Äù en <a href="https://www.franciscoyira.com/post/matching-in-r-2-differences-regression/">este</a> <em>blogpost</em> que uso y recomiendo</p></li></div></h2>
<p>En el ejemplo anterior, vimos c√≥mo el <em>matching</em> busca emparejar unidades tratadas y no tratadas bas√°ndose en sus caracter√≠sticas observables. Pero, ¬øqu√© pasa si en lugar de emparejar, simplemente ajustamos un modelo de regresi√≥n que incluya esas mismas covariables? ¬øNo era la forma en la que control√°bamos por los confusores antes de este cap√≠tulo? Bueno, s√≠ y no. La regresi√≥n y el <em>matching</em> son dos enfoques diferentes para obtener la tan ansiada independencia condicional, pero cada uno tiene sus propias ventajas y desventajas. Vamos con un ejemplo paradigm√°tico para que podamos entender un poquito m√°s de que estamos hablando.</p>
<p>Vamos a generar un conjunto de datos donde <span class="math inline">\(x\)</span> es un confusor, el tratamiento <span class="math inline">\(d\)</span> se asigna de forma no lineal en funci√≥n de <span class="math inline">\(x\)</span>, y el <em>outcome</em> tambi√©n depende de <span class="math inline">\(x\)</span> de forma no lineal, y el efecto del tratamiento es homog√©neo y vale <span class="math inline">\(1\)</span>.</p>
<div class="cell">
<details>
<summary>Ver el c√≥digo</summary>
<div class="sourceCode cell-code" id="cb30"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb30-1"><a href="#cb30-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Genero la data ####</span></span>
<span id="cb30-2"><a href="#cb30-2" aria-hidden="true" tabindex="-1"></a>df <span class="ot">&lt;-</span> <span class="fu">tibble</span>(</span>
<span id="cb30-3"><a href="#cb30-3" aria-hidden="true" tabindex="-1"></a>  <span class="co"># x es un confusor</span></span>
<span id="cb30-4"><a href="#cb30-4" aria-hidden="true" tabindex="-1"></a>  <span class="at">x =</span> <span class="fu">runif</span>(<span class="dv">1000</span>, <span class="sc">-</span><span class="dv">1</span>, <span class="dv">4</span>),</span>
<span id="cb30-5"><a href="#cb30-5" aria-hidden="true" tabindex="-1"></a>  <span class="co"># Afecta la probabilidad de recibir el tratamiento de forma NO LINEAL (funci√≥n escal√≥n)</span></span>
<span id="cb30-6"><a href="#cb30-6" aria-hidden="true" tabindex="-1"></a>  <span class="at">prob_d =</span> <span class="fu">ifelse</span>(x <span class="sc">&gt;</span> <span class="fl">0.5</span> <span class="sc">&amp;</span> x <span class="sc">&lt;</span> <span class="fl">2.5</span>, <span class="fl">0.1</span>, <span class="fl">0.9</span>),</span>
<span id="cb30-7"><a href="#cb30-7" aria-hidden="true" tabindex="-1"></a>  <span class="at">d =</span> <span class="fu">rbinom</span>(<span class="dv">1000</span>, <span class="dv">1</span>, prob_d),</span>
<span id="cb30-8"><a href="#cb30-8" aria-hidden="true" tabindex="-1"></a>  <span class="at">noise =</span> <span class="fu">rnorm</span>(<span class="dv">1000</span>, <span class="at">sd =</span> <span class="fl">0.1</span>),</span>
<span id="cb30-9"><a href="#cb30-9" aria-hidden="true" tabindex="-1"></a>  <span class="co"># Pra simplificar, el ATE es homogeneo y vale 1</span></span>
<span id="cb30-10"><a href="#cb30-10" aria-hidden="true" tabindex="-1"></a>  <span class="at">treat_effect =</span> <span class="dv">1</span>,</span>
<span id="cb30-11"><a href="#cb30-11" aria-hidden="true" tabindex="-1"></a>  <span class="co"># x afecta al outcome de manera no lineal (una funci√≥n seno)</span></span>
<span id="cb30-12"><a href="#cb30-12" aria-hidden="true" tabindex="-1"></a>  <span class="at">outcome =</span> <span class="fu">sin</span>(x) <span class="sc">+</span> d<span class="sc">*</span>treat_effect <span class="sc">+</span> noise</span>
<span id="cb30-13"><a href="#cb30-13" aria-hidden="true" tabindex="-1"></a>) <span class="sc">%&gt;%</span> </span>
<span id="cb30-14"><a href="#cb30-14" aria-hidden="true" tabindex="-1"></a>  <span class="fu">mutate</span>(<span class="at">d_factor =</span> <span class="fu">factor</span>(d,</span>
<span id="cb30-15"><a href="#cb30-15" aria-hidden="true" tabindex="-1"></a>                           <span class="at">levels=</span><span class="fu">c</span>(<span class="dv">0</span>,<span class="dv">1</span>), <span class="at">labels=</span><span class="fu">c</span>(<span class="st">"No tratado"</span>,</span>
<span id="cb30-16"><a href="#cb30-16" aria-hidden="true" tabindex="-1"></a>                                                   <span class="st">"Tratado"</span>)))</span>
<span id="cb30-17"><a href="#cb30-17" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb30-18"><a href="#cb30-18" aria-hidden="true" tabindex="-1"></a><span class="fu">ggplot</span>(df,</span>
<span id="cb30-19"><a href="#cb30-19" aria-hidden="true" tabindex="-1"></a>       <span class="fu">aes</span>(x, outcome, <span class="at">color =</span> d_factor)) <span class="sc">+</span></span>
<span id="cb30-20"><a href="#cb30-20" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_point</span>(<span class="at">size =</span> <span class="dv">1</span>) <span class="sc">+</span> </span>
<span id="cb30-21"><a href="#cb30-21" aria-hidden="true" tabindex="-1"></a>  <span class="fu">scale_color_brewer</span>(<span class="at">palette =</span> <span class="st">"Dark2"</span>) <span class="sc">+</span></span>
<span id="cb30-22"><a href="#cb30-22" aria-hidden="true" tabindex="-1"></a>  <span class="fu">labs</span>(<span class="at">color =</span> <span class="st">"Estado del tratamiento"</span>) <span class="sc">+</span></span>
<span id="cb30-23"><a href="#cb30-23" aria-hidden="true" tabindex="-1"></a>  <span class="fu">theme_bw</span>() <span class="sc">+</span></span>
<span id="cb30-24"><a href="#cb30-24" aria-hidden="true" tabindex="-1"></a>  <span class="fu">theme</span>(<span class="at">legend.position =</span> <span class="st">"top"</span>)</span></code><button title="Copiar al portapapeles" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
<div class="cell-output-display">
<div class="quarto-figure quarto-figure-center">
<figure class="figure">
<p><img src="matching_files/figure-html/unnamed-chunk-32-1.png" class="img-fluid figure-img" width="576"></p>
<p></p><figcaption class="figure-caption">Cada uno de los sujetos pertenecientes al grupo control y tratamiento con sus respectivos valores de outcome y covariable x.</figcaption><p></p>
</figure>
</div>
</div>
</div>
<p>De estos datos podemos ver dos cosas claras: 1) <span class="math inline">\(x\)</span> es claramente un confusor, ya que el valor de <span class="math inline">\(x\)</span> no solo afecta al <em>outcome</em> sino tambi√©n a la probabilidad de recibir el tratamiento (los sujetos del medio son m√°s ‚ÄúNo tratados‚Äù), y 2) la relaci√≥n entre <span class="math inline">\(x\)</span> y el <em>outcome</em> es no lineal. El efecto del tratamiento es homog√©neo y vale <span class="math inline">\(1\)</span>, y esto lo sabemos porque generamos los datos nosotros mismos.</p>
<p>Ahora probemos dos cosas: Estimar el efecto del tratamiento usando una regresi√≥n lineal y luego usando <em>matching</em> aproximado con la librer√≠a <code>MatchIt</code>(para detalles pueden ver el c√≥digo). A continuaci√≥n tenemos los efectos estimados con los dos m√©todos:</p>
<div class="cell">
<details>
<summary>Ver el c√≥digo</summary>
<div class="sourceCode cell-code" id="cb31"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb31-1"><a href="#cb31-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Ajustemos un modelo lineal ####</span></span>
<span id="cb31-2"><a href="#cb31-2" aria-hidden="true" tabindex="-1"></a>linear_model1 <span class="ot">&lt;-</span> <span class="fu">lm</span>(outcome <span class="sc">~</span> d <span class="sc">+</span> x, <span class="at">data =</span> df)</span>
<span id="cb31-3"><a href="#cb31-3" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb31-4"><a href="#cb31-4" aria-hidden="true" tabindex="-1"></a><span class="co"># Con matching ####</span></span>
<span id="cb31-5"><a href="#cb31-5" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(MatchIt)</span>
<span id="cb31-6"><a href="#cb31-6" aria-hidden="true" tabindex="-1"></a>nearest_control <span class="ot">&lt;-</span> <span class="fu">matchit</span>(d <span class="sc">~</span> x, </span>
<span id="cb31-7"><a href="#cb31-7" aria-hidden="true" tabindex="-1"></a>                           <span class="at">data =</span> df,</span>
<span id="cb31-8"><a href="#cb31-8" aria-hidden="true" tabindex="-1"></a>                           <span class="at">method =</span> <span class="st">"nearest"</span>, </span>
<span id="cb31-9"><a href="#cb31-9" aria-hidden="true" tabindex="-1"></a>                           <span class="at">distance =</span> <span class="st">"mahalanobis"</span>,</span>
<span id="cb31-10"><a href="#cb31-10" aria-hidden="true" tabindex="-1"></a>                           <span class="at">replace =</span> T,</span>
<span id="cb31-11"><a href="#cb31-11" aria-hidden="true" tabindex="-1"></a>                           <span class="at">ratio =</span> <span class="dv">1</span>)</span>
<span id="cb31-12"><a href="#cb31-12" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb31-13"><a href="#cb31-13" aria-hidden="true" tabindex="-1"></a>match_df <span class="ot">&lt;-</span> <span class="fu">match.data</span>(nearest_control)</span>
<span id="cb31-14"><a href="#cb31-14" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb31-15"><a href="#cb31-15" aria-hidden="true" tabindex="-1"></a>matching_model1 <span class="ot">&lt;-</span> <span class="fu">lm</span>(outcome <span class="sc">~</span> d <span class="sc">+</span> x, </span>
<span id="cb31-16"><a href="#cb31-16" aria-hidden="true" tabindex="-1"></a>                      <span class="at">data =</span> match_df, </span>
<span id="cb31-17"><a href="#cb31-17" aria-hidden="true" tabindex="-1"></a>                      <span class="at">weights =</span> weights)</span>
<span id="cb31-18"><a href="#cb31-18" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb31-19"><a href="#cb31-19" aria-hidden="true" tabindex="-1"></a><span class="co"># Comparamos los modelos</span></span>
<span id="cb31-20"><a href="#cb31-20" aria-hidden="true" tabindex="-1"></a><span class="fu">modelsummary</span>(<span class="fu">list</span>(<span class="st">"Regresi√≥n"</span><span class="ot">=</span> linear_model1,</span>
<span id="cb31-21"><a href="#cb31-21" aria-hidden="true" tabindex="-1"></a>                  <span class="st">"Matching"</span> <span class="ot">=</span> matching_model1),</span>
<span id="cb31-22"><a href="#cb31-22" aria-hidden="true" tabindex="-1"></a>             <span class="at">coef_rename =</span> <span class="fu">c</span>(<span class="st">"d"</span> <span class="ot">=</span> <span class="st">"Tratamiento"</span>),</span>
<span id="cb31-23"><a href="#cb31-23" aria-hidden="true" tabindex="-1"></a>             <span class="at">statistic =</span> <span class="cn">NULL</span>, </span>
<span id="cb31-24"><a href="#cb31-24" aria-hidden="true" tabindex="-1"></a>               <span class="at">gof_omit =</span> <span class="st">'DF|Deviance|R2|AIC|BIC|Log.Lik|F|RMSE'</span>,</span>
<span id="cb31-25"><a href="#cb31-25" aria-hidden="true" tabindex="-1"></a>             <span class="at">output =</span> <span class="st">"gt"</span>) <span class="sc">|&gt;</span></span>
<span id="cb31-26"><a href="#cb31-26" aria-hidden="true" tabindex="-1"></a>  <span class="fu">gt_highlight_rows</span>(<span class="at">rows =</span> <span class="dv">2</span>, </span>
<span id="cb31-27"><a href="#cb31-27" aria-hidden="true" tabindex="-1"></a>                    <span class="at">fill =</span> <span class="st">"lightyellow"</span>,</span>
<span id="cb31-28"><a href="#cb31-28" aria-hidden="true" tabindex="-1"></a>                    <span class="at">font_weight =</span> <span class="st">"bold"</span>)</span></code><button title="Copiar al portapapeles" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
<div class="cell-output-display">

<div id="dddwpubkde" style="padding-left:0px;padding-right:0px;padding-top:10px;padding-bottom:10px;overflow-x:auto;overflow-y:auto;width:auto;height:auto;">
<style>#dddwpubkde table {
  font-family: system-ui, 'Segoe UI', Roboto, Helvetica, Arial, sans-serif, 'Apple Color Emoji', 'Segoe UI Emoji', 'Segoe UI Symbol', 'Noto Color Emoji';
  -webkit-font-smoothing: antialiased;
  -moz-osx-font-smoothing: grayscale;
}

#dddwpubkde thead, #dddwpubkde tbody, #dddwpubkde tfoot, #dddwpubkde tr, #dddwpubkde td, #dddwpubkde th {
  border-style: none;
}

#dddwpubkde p {
  margin: 0;
  padding: 0;
}

#dddwpubkde .gt_table {
  display: table;
  border-collapse: collapse;
  line-height: normal;
  margin-left: auto;
  margin-right: auto;
  color: #333333;
  font-size: 16px;
  font-weight: normal;
  font-style: normal;
  background-color: #FFFFFF;
  width: auto;
  border-top-style: solid;
  border-top-width: 2px;
  border-top-color: #A8A8A8;
  border-right-style: none;
  border-right-width: 2px;
  border-right-color: #D3D3D3;
  border-bottom-style: solid;
  border-bottom-width: 2px;
  border-bottom-color: #A8A8A8;
  border-left-style: none;
  border-left-width: 2px;
  border-left-color: #D3D3D3;
}

#dddwpubkde .gt_caption {
  padding-top: 4px;
  padding-bottom: 4px;
}

#dddwpubkde .gt_title {
  color: #333333;
  font-size: 125%;
  font-weight: initial;
  padding-top: 4px;
  padding-bottom: 4px;
  padding-left: 5px;
  padding-right: 5px;
  border-bottom-color: #FFFFFF;
  border-bottom-width: 0;
}

#dddwpubkde .gt_subtitle {
  color: #333333;
  font-size: 85%;
  font-weight: initial;
  padding-top: 3px;
  padding-bottom: 5px;
  padding-left: 5px;
  padding-right: 5px;
  border-top-color: #FFFFFF;
  border-top-width: 0;
}

#dddwpubkde .gt_heading {
  background-color: #FFFFFF;
  text-align: center;
  border-bottom-color: #FFFFFF;
  border-left-style: none;
  border-left-width: 1px;
  border-left-color: #D3D3D3;
  border-right-style: none;
  border-right-width: 1px;
  border-right-color: #D3D3D3;
}

#dddwpubkde .gt_bottom_border {
  border-bottom-style: solid;
  border-bottom-width: 2px;
  border-bottom-color: #D3D3D3;
}

#dddwpubkde .gt_col_headings {
  border-top-style: solid;
  border-top-width: 2px;
  border-top-color: #D3D3D3;
  border-bottom-style: solid;
  border-bottom-width: 2px;
  border-bottom-color: #D3D3D3;
  border-left-style: none;
  border-left-width: 1px;
  border-left-color: #D3D3D3;
  border-right-style: none;
  border-right-width: 1px;
  border-right-color: #D3D3D3;
}

#dddwpubkde .gt_col_heading {
  color: #333333;
  background-color: #FFFFFF;
  font-size: 100%;
  font-weight: normal;
  text-transform: inherit;
  border-left-style: none;
  border-left-width: 1px;
  border-left-color: #D3D3D3;
  border-right-style: none;
  border-right-width: 1px;
  border-right-color: #D3D3D3;
  vertical-align: bottom;
  padding-top: 5px;
  padding-bottom: 6px;
  padding-left: 5px;
  padding-right: 5px;
  overflow-x: hidden;
}

#dddwpubkde .gt_column_spanner_outer {
  color: #333333;
  background-color: #FFFFFF;
  font-size: 100%;
  font-weight: normal;
  text-transform: inherit;
  padding-top: 0;
  padding-bottom: 0;
  padding-left: 4px;
  padding-right: 4px;
}

#dddwpubkde .gt_column_spanner_outer:first-child {
  padding-left: 0;
}

#dddwpubkde .gt_column_spanner_outer:last-child {
  padding-right: 0;
}

#dddwpubkde .gt_column_spanner {
  border-bottom-style: solid;
  border-bottom-width: 2px;
  border-bottom-color: #D3D3D3;
  vertical-align: bottom;
  padding-top: 5px;
  padding-bottom: 5px;
  overflow-x: hidden;
  display: inline-block;
  width: 100%;
}

#dddwpubkde .gt_spanner_row {
  border-bottom-style: hidden;
}

#dddwpubkde .gt_group_heading {
  padding-top: 8px;
  padding-bottom: 8px;
  padding-left: 5px;
  padding-right: 5px;
  color: #333333;
  background-color: #FFFFFF;
  font-size: 100%;
  font-weight: initial;
  text-transform: inherit;
  border-top-style: solid;
  border-top-width: 2px;
  border-top-color: #D3D3D3;
  border-bottom-style: solid;
  border-bottom-width: 2px;
  border-bottom-color: #D3D3D3;
  border-left-style: none;
  border-left-width: 1px;
  border-left-color: #D3D3D3;
  border-right-style: none;
  border-right-width: 1px;
  border-right-color: #D3D3D3;
  vertical-align: middle;
  text-align: left;
}

#dddwpubkde .gt_empty_group_heading {
  padding: 0.5px;
  color: #333333;
  background-color: #FFFFFF;
  font-size: 100%;
  font-weight: initial;
  border-top-style: solid;
  border-top-width: 2px;
  border-top-color: #D3D3D3;
  border-bottom-style: solid;
  border-bottom-width: 2px;
  border-bottom-color: #D3D3D3;
  vertical-align: middle;
}

#dddwpubkde .gt_from_md > :first-child {
  margin-top: 0;
}

#dddwpubkde .gt_from_md > :last-child {
  margin-bottom: 0;
}

#dddwpubkde .gt_row {
  padding-top: 8px;
  padding-bottom: 8px;
  padding-left: 5px;
  padding-right: 5px;
  margin: 10px;
  border-top-style: solid;
  border-top-width: 1px;
  border-top-color: #D3D3D3;
  border-left-style: none;
  border-left-width: 1px;
  border-left-color: #D3D3D3;
  border-right-style: none;
  border-right-width: 1px;
  border-right-color: #D3D3D3;
  vertical-align: middle;
  overflow-x: hidden;
}

#dddwpubkde .gt_stub {
  color: #333333;
  background-color: #FFFFFF;
  font-size: 100%;
  font-weight: initial;
  text-transform: inherit;
  border-right-style: solid;
  border-right-width: 2px;
  border-right-color: #D3D3D3;
  padding-left: 5px;
  padding-right: 5px;
}

#dddwpubkde .gt_stub_row_group {
  color: #333333;
  background-color: #FFFFFF;
  font-size: 100%;
  font-weight: initial;
  text-transform: inherit;
  border-right-style: solid;
  border-right-width: 2px;
  border-right-color: #D3D3D3;
  padding-left: 5px;
  padding-right: 5px;
  vertical-align: top;
}

#dddwpubkde .gt_row_group_first td {
  border-top-width: 2px;
}

#dddwpubkde .gt_row_group_first th {
  border-top-width: 2px;
}

#dddwpubkde .gt_summary_row {
  color: #333333;
  background-color: #FFFFFF;
  text-transform: inherit;
  padding-top: 8px;
  padding-bottom: 8px;
  padding-left: 5px;
  padding-right: 5px;
}

#dddwpubkde .gt_first_summary_row {
  border-top-style: solid;
  border-top-color: #D3D3D3;
}

#dddwpubkde .gt_first_summary_row.thick {
  border-top-width: 2px;
}

#dddwpubkde .gt_last_summary_row {
  padding-top: 8px;
  padding-bottom: 8px;
  padding-left: 5px;
  padding-right: 5px;
  border-bottom-style: solid;
  border-bottom-width: 2px;
  border-bottom-color: #D3D3D3;
}

#dddwpubkde .gt_grand_summary_row {
  color: #333333;
  background-color: #FFFFFF;
  text-transform: inherit;
  padding-top: 8px;
  padding-bottom: 8px;
  padding-left: 5px;
  padding-right: 5px;
}

#dddwpubkde .gt_first_grand_summary_row {
  padding-top: 8px;
  padding-bottom: 8px;
  padding-left: 5px;
  padding-right: 5px;
  border-top-style: double;
  border-top-width: 6px;
  border-top-color: #D3D3D3;
}

#dddwpubkde .gt_last_grand_summary_row_top {
  padding-top: 8px;
  padding-bottom: 8px;
  padding-left: 5px;
  padding-right: 5px;
  border-bottom-style: double;
  border-bottom-width: 6px;
  border-bottom-color: #D3D3D3;
}

#dddwpubkde .gt_striped {
  background-color: rgba(128, 128, 128, 0.05);
}

#dddwpubkde .gt_table_body {
  border-top-style: solid;
  border-top-width: 2px;
  border-top-color: #D3D3D3;
  border-bottom-style: solid;
  border-bottom-width: 2px;
  border-bottom-color: #D3D3D3;
}

#dddwpubkde .gt_footnotes {
  color: #333333;
  background-color: #FFFFFF;
  border-bottom-style: none;
  border-bottom-width: 2px;
  border-bottom-color: #D3D3D3;
  border-left-style: none;
  border-left-width: 2px;
  border-left-color: #D3D3D3;
  border-right-style: none;
  border-right-width: 2px;
  border-right-color: #D3D3D3;
}

#dddwpubkde .gt_footnote {
  margin: 0px;
  font-size: 90%;
  padding-top: 4px;
  padding-bottom: 4px;
  padding-left: 5px;
  padding-right: 5px;
}

#dddwpubkde .gt_sourcenotes {
  color: #333333;
  background-color: #FFFFFF;
  border-bottom-style: none;
  border-bottom-width: 2px;
  border-bottom-color: #D3D3D3;
  border-left-style: none;
  border-left-width: 2px;
  border-left-color: #D3D3D3;
  border-right-style: none;
  border-right-width: 2px;
  border-right-color: #D3D3D3;
}

#dddwpubkde .gt_sourcenote {
  font-size: 90%;
  padding-top: 4px;
  padding-bottom: 4px;
  padding-left: 5px;
  padding-right: 5px;
}

#dddwpubkde .gt_left {
  text-align: left;
}

#dddwpubkde .gt_center {
  text-align: center;
}

#dddwpubkde .gt_right {
  text-align: right;
  font-variant-numeric: tabular-nums;
}

#dddwpubkde .gt_font_normal {
  font-weight: normal;
}

#dddwpubkde .gt_font_bold {
  font-weight: bold;
}

#dddwpubkde .gt_font_italic {
  font-style: italic;
}

#dddwpubkde .gt_super {
  font-size: 65%;
}

#dddwpubkde .gt_footnote_marks {
  font-size: 75%;
  vertical-align: 0.4em;
  position: initial;
}

#dddwpubkde .gt_asterisk {
  font-size: 100%;
  vertical-align: 0;
}

#dddwpubkde .gt_indent_1 {
  text-indent: 5px;
}

#dddwpubkde .gt_indent_2 {
  text-indent: 10px;
}

#dddwpubkde .gt_indent_3 {
  text-indent: 15px;
}

#dddwpubkde .gt_indent_4 {
  text-indent: 20px;
}

#dddwpubkde .gt_indent_5 {
  text-indent: 25px;
}

#dddwpubkde .katex-display {
  display: inline-flex !important;
  margin-bottom: 0.75em !important;
}

#dddwpubkde div.Reactable > div.rt-table > div.rt-thead > div.rt-tr.rt-tr-group-header > div.rt-th-group:after {
  height: 0px !important;
}
</style>
<table class="gt_table" data-quarto-disable-processing="false" data-quarto-bootstrap="false">
  <thead>
    <tr class="gt_col_headings">
      <th class="gt_col_heading gt_columns_bottom_border gt_left" rowspan="1" colspan="1" scope="col" id="a-"> </th>
      <th class="gt_col_heading gt_columns_bottom_border gt_center" rowspan="1" colspan="1" scope="col" id="Regresi√≥n">Regresi√≥n</th>
      <th class="gt_col_heading gt_columns_bottom_border gt_center" rowspan="1" colspan="1" scope="col" id="Matching">Matching</th>
    </tr>
  </thead>
  <tbody class="gt_table_body">
    <tr><td headers=" " class="gt_row gt_left">(Intercept)</td>
<td headers="Regresi√≥n" class="gt_row gt_center">0.630</td>
<td headers="Matching" class="gt_row gt_center">-0.139</td></tr>
    <tr><td headers=" " class="gt_row gt_left" style="background-color: rgba(255,255,224,0.8); color: #000000; font-weight: bold;">Tratamiento</td>
<td headers="Regresi√≥n" class="gt_row gt_center" style="background-color: rgba(255,255,224,0.8); color: #000000; font-weight: bold;">0.247</td>
<td headers="Matching" class="gt_row gt_center" style="background-color: rgba(255,255,224,0.8); color: #000000; font-weight: bold;">1.004</td></tr>
    <tr><td headers=" " class="gt_row gt_left" style="border-bottom-width: 1px; border-bottom-style: solid; border-bottom-color: #000000;">x</td>
<td headers="Regresi√≥n" class="gt_row gt_center" style="border-bottom-width: 1px; border-bottom-style: solid; border-bottom-color: #000000;">0.036</td>
<td headers="Matching" class="gt_row gt_center" style="border-bottom-width: 1px; border-bottom-style: solid; border-bottom-color: #000000;">0.044</td></tr>
    <tr><td headers=" " class="gt_row gt_left">Num.Obs.</td>
<td headers="Regresi√≥n" class="gt_row gt_center">1000</td>
<td headers="Matching" class="gt_row gt_center">665</td></tr>
  </tbody>
  
  
</table>
</div>
<p>Estimaciones del efecto del tratamiento utilizando regresi√≥n y matching.</p>
</div>
</div>
<div class="page-columns page-full"><p>Como era de esperarse, la regresi√≥n lineal nos da un estimador del efecto del tratamiento de <span class="math inline">\(0.220\)</span>, mientras que el <em>matching</em> nos da un estimador de <span class="math inline">\(0.992\)</span>. Pero ¬øPor qu√© era esperable? La regresi√≥n lineal asume una relaci√≥n lineal entre <span class="math inline">\(x\)</span> y el <em>outcome</em>, lo que no es cierto en nuestros datos. Por lo tanto, el modelo no captura correctamente la relaci√≥n entre <span class="math inline">\(x\)</span> y el <em>outcome</em>, lo que sesga el estimador del efecto del tratamiento<a href="#fn11" class="footnote-ref" id="fnref11" role="doc-noteref"><sup>11</sup></a>.</p><div class="no-row-height column-margin column-container"><li id="fn11"><p><sup>11</sup>&nbsp;Otra cosa interesante que podemos observar, es que al estimar el efecto con <em>matching</em>, el tama√±o de la muestra efectivo es menor que al estimar con regresi√≥n lineal. Esto se debe a que el <em>matching</em> elimina las unidades que no tienen un par cercano en el grupo de control, lo que reduce el tama√±o de la muestra efectiva.</p></li></div></div>
<p>Veamos qu√© forma tiene el modelo lineal ajustado con estos datos:</p>
<div class="cell">
<details>
<summary>Ver el c√≥digo</summary>
<div class="sourceCode cell-code" id="cb32"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb32-1"><a href="#cb32-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Regression</span></span>
<span id="cb32-2"><a href="#cb32-2" aria-hidden="true" tabindex="-1"></a>df_linear <span class="ot">&lt;-</span> df <span class="sc">%&gt;%</span></span>
<span id="cb32-3"><a href="#cb32-3" aria-hidden="true" tabindex="-1"></a>  modelr<span class="sc">::</span><span class="fu">add_predictions</span>(linear_model1, <span class="at">var =</span> <span class="st">"pred_linear"</span>)</span>
<span id="cb32-4"><a href="#cb32-4" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb32-5"><a href="#cb32-5" aria-hidden="true" tabindex="-1"></a>plot_linear <span class="ot">&lt;-</span></span>
<span id="cb32-6"><a href="#cb32-6" aria-hidden="true" tabindex="-1"></a>  <span class="fu">ggplot</span>(df_linear) <span class="sc">+</span></span>
<span id="cb32-7"><a href="#cb32-7" aria-hidden="true" tabindex="-1"></a>  <span class="fu">aes</span>(<span class="at">x =</span> x, <span class="at">color =</span> d_factor) <span class="sc">+</span></span>
<span id="cb32-8"><a href="#cb32-8" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_point</span>(<span class="fu">aes</span>(<span class="at">y =</span> outcome), <span class="at">alpha =</span> <span class="fl">0.3</span>, <span class="at">size =</span> <span class="dv">1</span>) <span class="sc">+</span></span>
<span id="cb32-9"><a href="#cb32-9" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_line</span>(<span class="fu">aes</span>(<span class="at">y =</span> pred_linear), <span class="at">size =</span> <span class="dv">1</span>) <span class="sc">+</span></span>
<span id="cb32-10"><a href="#cb32-10" aria-hidden="true" tabindex="-1"></a>  <span class="fu">labs</span>(<span class="at">color =</span> <span class="st">"Treatment status"</span>) <span class="sc">+</span></span>
<span id="cb32-11"><a href="#cb32-11" aria-hidden="true" tabindex="-1"></a>  <span class="fu">scale_color_brewer</span>(<span class="at">palette =</span> <span class="st">"Dark2"</span>) <span class="sc">+</span></span>
<span id="cb32-12"><a href="#cb32-12" aria-hidden="true" tabindex="-1"></a>  <span class="fu">labs</span>(<span class="at">color =</span> <span class="st">"Estado del tratamiento"</span>) <span class="sc">+</span></span>
<span id="cb32-13"><a href="#cb32-13" aria-hidden="true" tabindex="-1"></a>  <span class="fu">theme_bw</span>() <span class="sc">+</span></span>
<span id="cb32-14"><a href="#cb32-14" aria-hidden="true" tabindex="-1"></a>  <span class="fu">theme</span>(<span class="at">legend.position =</span> <span class="st">"top"</span>)</span>
<span id="cb32-15"><a href="#cb32-15" aria-hidden="true" tabindex="-1"></a><span class="co">#&gt; Warning: Using `size` aesthetic for lines was deprecated in ggplot2 3.4.0.</span></span>
<span id="cb32-16"><a href="#cb32-16" aria-hidden="true" tabindex="-1"></a><span class="co">#&gt; ‚Ñπ Please use `linewidth` instead.</span></span>
<span id="cb32-17"><a href="#cb32-17" aria-hidden="true" tabindex="-1"></a>plot_linear</span></code><button title="Copiar al portapapeles" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
<div class="cell-output-display">
<div class="quarto-figure quarto-figure-center">
<figure class="figure">
<p><img src="matching_files/figure-html/unnamed-chunk-34-1.png" class="img-fluid figure-img" width="576"></p>
<p></p><figcaption class="figure-caption">La regresi√≥n lineal ajustada.</figcaption><p></p>
</figure>
</div>
</div>
</div>
<p>Entonces esto es esperable porque los datos son claramente no lineales. Ahora, usemos un suavizado de los datos para reflejar, m√°s o menos, qu√© es lo que est√° haciendo el algoritmo de <em>matching</em> para estimar el efecto.</p>
<div class="cell">
<details>
<summary>Ver el c√≥digo</summary>
<div class="sourceCode cell-code" id="cb33"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb33-1"><a href="#cb33-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Matching</span></span>
<span id="cb33-2"><a href="#cb33-2" aria-hidden="true" tabindex="-1"></a>knn1 <span class="ot">&lt;-</span> <span class="fu">knn.reg</span>(</span>
<span id="cb33-3"><a href="#cb33-3" aria-hidden="true" tabindex="-1"></a>  <span class="at">train =</span> dplyr<span class="sc">::</span><span class="fu">select</span>(df, x, d),</span>
<span id="cb33-4"><a href="#cb33-4" aria-hidden="true" tabindex="-1"></a>  <span class="at">y =</span> df<span class="sc">$</span>outcome,</span>
<span id="cb33-5"><a href="#cb33-5" aria-hidden="true" tabindex="-1"></a>  <span class="at">test =</span> dplyr<span class="sc">::</span><span class="fu">select</span>(df, x, d),</span>
<span id="cb33-6"><a href="#cb33-6" aria-hidden="true" tabindex="-1"></a>  <span class="at">k =</span> <span class="dv">10</span>,</span>
<span id="cb33-7"><a href="#cb33-7" aria-hidden="true" tabindex="-1"></a>  <span class="at">algorithm =</span> <span class="st">"brute"</span></span>
<span id="cb33-8"><a href="#cb33-8" aria-hidden="true" tabindex="-1"></a>)</span>
<span id="cb33-9"><a href="#cb33-9" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb33-10"><a href="#cb33-10" aria-hidden="true" tabindex="-1"></a>df_knn <span class="ot">&lt;-</span> df <span class="sc">%&gt;%</span> </span>
<span id="cb33-11"><a href="#cb33-11" aria-hidden="true" tabindex="-1"></a>  <span class="fu">mutate</span>(<span class="at">pred_knn =</span> knn1<span class="sc">$</span>pred)</span>
<span id="cb33-12"><a href="#cb33-12" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb33-13"><a href="#cb33-13" aria-hidden="true" tabindex="-1"></a>plot_matching <span class="ot">&lt;-</span> </span>
<span id="cb33-14"><a href="#cb33-14" aria-hidden="true" tabindex="-1"></a>  <span class="fu">ggplot</span>(df_knn) <span class="sc">+</span></span>
<span id="cb33-15"><a href="#cb33-15" aria-hidden="true" tabindex="-1"></a>  <span class="fu">aes</span>(<span class="at">x =</span> x, <span class="at">color =</span> d_factor) <span class="sc">+</span></span>
<span id="cb33-16"><a href="#cb33-16" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_point</span>(<span class="fu">aes</span>(<span class="at">y =</span> outcome), <span class="at">alpha =</span> <span class="fl">0.3</span>, <span class="at">size =</span> <span class="dv">1</span>) <span class="sc">+</span></span>
<span id="cb33-17"><a href="#cb33-17" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_line</span>(<span class="fu">aes</span>(<span class="at">y =</span> pred_knn), <span class="at">linewidth =</span> <span class="dv">1</span>) <span class="sc">+</span></span>
<span id="cb33-18"><a href="#cb33-18" aria-hidden="true" tabindex="-1"></a>  <span class="fu">labs</span>(<span class="at">color =</span> <span class="st">"Treatment status"</span>) <span class="sc">+</span>  </span>
<span id="cb33-19"><a href="#cb33-19" aria-hidden="true" tabindex="-1"></a>  <span class="fu">scale_color_brewer</span>(<span class="at">palette =</span> <span class="st">"Dark2"</span>) <span class="sc">+</span></span>
<span id="cb33-20"><a href="#cb33-20" aria-hidden="true" tabindex="-1"></a>  <span class="fu">labs</span>(<span class="at">color =</span> <span class="st">"Estado del tratamiento"</span>) <span class="sc">+</span></span>
<span id="cb33-21"><a href="#cb33-21" aria-hidden="true" tabindex="-1"></a>  <span class="fu">theme_bw</span>() <span class="sc">+</span></span>
<span id="cb33-22"><a href="#cb33-22" aria-hidden="true" tabindex="-1"></a>  <span class="fu">theme</span>(<span class="at">legend.position =</span> <span class="st">"top"</span>)</span>
<span id="cb33-23"><a href="#cb33-23" aria-hidden="true" tabindex="-1"></a>plot_matching</span></code><button title="Copiar al portapapeles" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
<div class="cell-output-display">
<div class="quarto-figure quarto-figure-center">
<figure class="figure">
<p><img src="matching_files/figure-html/unnamed-chunk-35-1.png" class="img-fluid figure-img" width="576"></p>
<p></p><figcaption class="figure-caption">Algo parecido a lo que usa el matching para estimar el efecto.</figcaption><p></p>
</figure>
</div>
</div>
</div>
<p>Podemos ver a todas luces que esto tiene mucho sentido. Ahora, ¬øUsamos siempre <em>matching</em> o alguna vez puede no convenirnos?</p>
<p>Uno de los supuestos de los modelos lineales es la linealidad de la relaci√≥n entre, en este caso, <em>x</em> y el <em>outcome</em>. Si esto no se cumple, el modelo lineal no va a capturar bien la relaci√≥n y, por lo tanto, el estimador del efecto del tratamiento va a estar sesgado. En cambio, el <em>matching</em> no asume una relaci√≥n lineal entre las covariables y el <em>outcome</em>, por lo que puede ser m√°s robusto en estos casos. Sin embargo, recordemos que uno de los supuestos del <em>matching</em> es la necesidad de <strong>soporte com√∫n</strong>. En el ejemplo anterior hab√≠a soporte com√∫n, es decir, en el mismo rango de <span class="math inline">\(x\)</span> hab√≠a tanto tratados como no tratados. Veamos un ejemplo donde esto no es as√≠.</p>
<div class="cell">
<details>
<summary>Ver el c√≥digo</summary>
<div class="sourceCode cell-code" id="cb34"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb34-1"><a href="#cb34-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Datos sin soporte com√∫n ####</span></span>
<span id="cb34-2"><a href="#cb34-2" aria-hidden="true" tabindex="-1"></a>df_wo_common_support <span class="ot">&lt;-</span> <span class="fu">tibble</span>(</span>
<span id="cb34-3"><a href="#cb34-3" aria-hidden="true" tabindex="-1"></a>  <span class="co"># x es un confusor</span></span>
<span id="cb34-4"><a href="#cb34-4" aria-hidden="true" tabindex="-1"></a>  <span class="at">x =</span> <span class="fu">runif</span>(<span class="dv">1000</span>, <span class="sc">-</span><span class="dv">1</span>, <span class="dv">4</span>),</span>
<span id="cb34-5"><a href="#cb34-5" aria-hidden="true" tabindex="-1"></a>  <span class="co"># No hay m√°s prob_d, es determin√≠stico</span></span>
<span id="cb34-6"><a href="#cb34-6" aria-hidden="true" tabindex="-1"></a>  <span class="at">d =</span> <span class="fu">ifelse</span>(x <span class="sc">&gt;</span> <span class="fl">0.5</span> <span class="sc">&amp;</span> x <span class="sc">&lt;</span> <span class="fl">2.5</span>, <span class="dv">0</span>, <span class="dv">1</span>),</span>
<span id="cb34-7"><a href="#cb34-7" aria-hidden="true" tabindex="-1"></a>  <span class="at">noise =</span> <span class="fu">rnorm</span>(<span class="dv">1000</span>, <span class="at">sd =</span> <span class="fl">0.1</span>),</span>
<span id="cb34-8"><a href="#cb34-8" aria-hidden="true" tabindex="-1"></a>  <span class="co"># Pra simplificar, el ATE es homogeneo y vale 1</span></span>
<span id="cb34-9"><a href="#cb34-9" aria-hidden="true" tabindex="-1"></a>  <span class="at">treat_effect =</span> <span class="dv">1</span>,</span>
<span id="cb34-10"><a href="#cb34-10" aria-hidden="true" tabindex="-1"></a>  <span class="co"># x afecta al outcome de manera no lineal (una funci√≥n seno)</span></span>
<span id="cb34-11"><a href="#cb34-11" aria-hidden="true" tabindex="-1"></a>  <span class="at">outcome =</span> <span class="fu">sin</span>(x) <span class="sc">+</span> d<span class="sc">*</span>treat_effect <span class="sc">+</span> noise</span>
<span id="cb34-12"><a href="#cb34-12" aria-hidden="true" tabindex="-1"></a>) <span class="sc">%&gt;%</span> </span>
<span id="cb34-13"><a href="#cb34-13" aria-hidden="true" tabindex="-1"></a>  <span class="fu">mutate</span>(<span class="at">d_factor =</span> <span class="fu">factor</span>(d,</span>
<span id="cb34-14"><a href="#cb34-14" aria-hidden="true" tabindex="-1"></a>                           <span class="at">levels=</span><span class="fu">c</span>(<span class="dv">0</span>,<span class="dv">1</span>), <span class="at">labels=</span><span class="fu">c</span>(<span class="st">"No tratado"</span>,</span>
<span id="cb34-15"><a href="#cb34-15" aria-hidden="true" tabindex="-1"></a>                                                   <span class="st">"Tratado"</span>)))</span>
<span id="cb34-16"><a href="#cb34-16" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb34-17"><a href="#cb34-17" aria-hidden="true" tabindex="-1"></a><span class="fu">ggplot</span>(df_wo_common_support,</span>
<span id="cb34-18"><a href="#cb34-18" aria-hidden="true" tabindex="-1"></a>       <span class="fu">aes</span>(x, outcome, <span class="at">color =</span> d_factor)) <span class="sc">+</span></span>
<span id="cb34-19"><a href="#cb34-19" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_point</span>(<span class="at">size =</span> <span class="dv">1</span>) <span class="sc">+</span> </span>
<span id="cb34-20"><a href="#cb34-20" aria-hidden="true" tabindex="-1"></a>  <span class="fu">scale_color_brewer</span>(<span class="at">palette =</span> <span class="st">"Dark2"</span>) <span class="sc">+</span></span>
<span id="cb34-21"><a href="#cb34-21" aria-hidden="true" tabindex="-1"></a>  <span class="fu">labs</span>(<span class="at">color =</span> <span class="st">"Estado del tratamiento"</span>) <span class="sc">+</span></span>
<span id="cb34-22"><a href="#cb34-22" aria-hidden="true" tabindex="-1"></a>  <span class="fu">theme_bw</span>() <span class="sc">+</span></span>
<span id="cb34-23"><a href="#cb34-23" aria-hidden="true" tabindex="-1"></a>  <span class="fu">theme</span>(<span class="at">legend.position =</span> <span class="st">"top"</span>)</span></code><button title="Copiar al portapapeles" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
<div class="cell-output-display">
<div class="quarto-figure quarto-figure-center">
<figure class="figure">
<p><img src="matching_files/figure-html/unnamed-chunk-36-1.png" class="img-fluid figure-img" width="576"></p>
<p></p><figcaption class="figure-caption">Datos pero ahora sin soporte com√∫n.</figcaption><p></p>
</figure>
</div>
</div>
</div>
<p>En este ejemplo podemos ver claramente que todos los sujetos del grupo control tienen valores de <span class="math inline">\(x\)</span> mayores a <span class="math inline">\(0.5\)</span> y menores a <span class="math inline">\(2.5\)</span>. Es decir, ya no hay m√°s soporte com√∫n.</p>
<p>A estos datos le vamos a ajustar dos modelos, uno de <em>matching</em> usando <code>MatchIt</code> y otro de regresi√≥n lineal pero con un peque√±o truquito dado que sabemos la forma funcional. Lo que vamos a ajustar es el siguiente modelo:</p>
<p><span class="math display">\[
Y_i = \beta_{0i} + \beta_{di} D + \beta_{xi} \sin(X) + \epsilon_i
\]</span></p>
<div class="page-columns page-full"><p>Es decir, estamos asumiendo que la relaci√≥n entre <span class="math inline">\(x\)</span> y el <em>outcome</em> es una funci√≥n seno, y no lineal<a href="#fn12" class="footnote-ref" id="fnref12" role="doc-noteref"><sup>12</sup></a>. Vamos a ver qu√© pasa.</p><div class="no-row-height column-margin column-container"><li id="fn12"><p><sup>12</sup>&nbsp;Recordemos que, a pesar de que aparece <span class="math inline">\(\sin(X)\)</span>, la regresi√≥n lineal sigue siendo lineal en los par√°metros, por lo que no estamos violando ning√∫n supuesto de la regresi√≥n lineal.</p></li></div></div>
<div class="cell">
<details>
<summary>Ver el c√≥digo</summary>
<div class="sourceCode cell-code" id="cb35"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb35-1"><a href="#cb35-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Modelo lineal sin soporte comun ####</span></span>
<span id="cb35-2"><a href="#cb35-2" aria-hidden="true" tabindex="-1"></a>reg_wo_common_support <span class="ot">&lt;-</span> <span class="fu">lm</span>(outcome <span class="sc">~</span> d <span class="sc">+</span> <span class="fu">sin</span>(x), <span class="at">data =</span> df_wo_common_support)</span>
<span id="cb35-3"><a href="#cb35-3" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb35-4"><a href="#cb35-4" aria-hidden="true" tabindex="-1"></a><span class="co"># Matching sin soporte com√∫n ####</span></span>
<span id="cb35-5"><a href="#cb35-5" aria-hidden="true" tabindex="-1"></a>nearest_control <span class="ot">&lt;-</span> <span class="fu">matchit</span>(d <span class="sc">~</span> x, </span>
<span id="cb35-6"><a href="#cb35-6" aria-hidden="true" tabindex="-1"></a>                           <span class="at">data =</span> df_wo_common_support,</span>
<span id="cb35-7"><a href="#cb35-7" aria-hidden="true" tabindex="-1"></a>                           <span class="at">method =</span> <span class="st">"nearest"</span>, </span>
<span id="cb35-8"><a href="#cb35-8" aria-hidden="true" tabindex="-1"></a>                           <span class="at">distance =</span> <span class="st">"mahalanobis"</span>,</span>
<span id="cb35-9"><a href="#cb35-9" aria-hidden="true" tabindex="-1"></a>                           <span class="at">replace =</span> T,</span>
<span id="cb35-10"><a href="#cb35-10" aria-hidden="true" tabindex="-1"></a>                           <span class="at">ratio =</span> <span class="dv">1</span>)</span>
<span id="cb35-11"><a href="#cb35-11" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb35-12"><a href="#cb35-12" aria-hidden="true" tabindex="-1"></a>match_df_wo_common_support <span class="ot">&lt;-</span> <span class="fu">match.data</span>(nearest_control)</span>
<span id="cb35-13"><a href="#cb35-13" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb35-14"><a href="#cb35-14" aria-hidden="true" tabindex="-1"></a>mathing_wo_common_support <span class="ot">&lt;-</span> <span class="fu">lm</span>(outcome <span class="sc">~</span> d <span class="sc">+</span> x, </span>
<span id="cb35-15"><a href="#cb35-15" aria-hidden="true" tabindex="-1"></a>                     <span class="at">data =</span> match_df_wo_common_support, </span>
<span id="cb35-16"><a href="#cb35-16" aria-hidden="true" tabindex="-1"></a>                     <span class="at">weights =</span> weights)</span>
<span id="cb35-17"><a href="#cb35-17" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb35-18"><a href="#cb35-18" aria-hidden="true" tabindex="-1"></a><span class="co"># Comparamos los modelos</span></span>
<span id="cb35-19"><a href="#cb35-19" aria-hidden="true" tabindex="-1"></a><span class="fu">modelsummary</span>(<span class="fu">list</span>(<span class="st">"Regresi√≥n"</span><span class="ot">=</span> reg_wo_common_support,</span>
<span id="cb35-20"><a href="#cb35-20" aria-hidden="true" tabindex="-1"></a>                  <span class="st">"Matching"</span> <span class="ot">=</span> mathing_wo_common_support),</span>
<span id="cb35-21"><a href="#cb35-21" aria-hidden="true" tabindex="-1"></a>             <span class="at">coef_rename =</span> <span class="fu">c</span>(<span class="st">"d"</span> <span class="ot">=</span> <span class="st">"Tratamiento"</span>),</span>
<span id="cb35-22"><a href="#cb35-22" aria-hidden="true" tabindex="-1"></a>             <span class="at">statistic =</span> <span class="cn">NULL</span>, </span>
<span id="cb35-23"><a href="#cb35-23" aria-hidden="true" tabindex="-1"></a>             <span class="at">gof_omit =</span> <span class="st">'DF|Deviance|R2|AIC|BIC|Log.Lik|F|RMSE'</span>,</span>
<span id="cb35-24"><a href="#cb35-24" aria-hidden="true" tabindex="-1"></a>             <span class="at">output =</span> <span class="st">"gt"</span>) <span class="sc">|&gt;</span></span>
<span id="cb35-25"><a href="#cb35-25" aria-hidden="true" tabindex="-1"></a>  <span class="fu">gt_highlight_rows</span>(<span class="at">rows =</span> <span class="dv">2</span>, </span>
<span id="cb35-26"><a href="#cb35-26" aria-hidden="true" tabindex="-1"></a>                    <span class="at">fill =</span> <span class="st">"lightyellow"</span>,</span>
<span id="cb35-27"><a href="#cb35-27" aria-hidden="true" tabindex="-1"></a>                    <span class="at">font_weight =</span> <span class="st">"bold"</span>)</span></code><button title="Copiar al portapapeles" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
<div class="cell-output-display">

<div id="epxppztsig" style="padding-left:0px;padding-right:0px;padding-top:10px;padding-bottom:10px;overflow-x:auto;overflow-y:auto;width:auto;height:auto;">
<style>#epxppztsig table {
  font-family: system-ui, 'Segoe UI', Roboto, Helvetica, Arial, sans-serif, 'Apple Color Emoji', 'Segoe UI Emoji', 'Segoe UI Symbol', 'Noto Color Emoji';
  -webkit-font-smoothing: antialiased;
  -moz-osx-font-smoothing: grayscale;
}

#epxppztsig thead, #epxppztsig tbody, #epxppztsig tfoot, #epxppztsig tr, #epxppztsig td, #epxppztsig th {
  border-style: none;
}

#epxppztsig p {
  margin: 0;
  padding: 0;
}

#epxppztsig .gt_table {
  display: table;
  border-collapse: collapse;
  line-height: normal;
  margin-left: auto;
  margin-right: auto;
  color: #333333;
  font-size: 16px;
  font-weight: normal;
  font-style: normal;
  background-color: #FFFFFF;
  width: auto;
  border-top-style: solid;
  border-top-width: 2px;
  border-top-color: #A8A8A8;
  border-right-style: none;
  border-right-width: 2px;
  border-right-color: #D3D3D3;
  border-bottom-style: solid;
  border-bottom-width: 2px;
  border-bottom-color: #A8A8A8;
  border-left-style: none;
  border-left-width: 2px;
  border-left-color: #D3D3D3;
}

#epxppztsig .gt_caption {
  padding-top: 4px;
  padding-bottom: 4px;
}

#epxppztsig .gt_title {
  color: #333333;
  font-size: 125%;
  font-weight: initial;
  padding-top: 4px;
  padding-bottom: 4px;
  padding-left: 5px;
  padding-right: 5px;
  border-bottom-color: #FFFFFF;
  border-bottom-width: 0;
}

#epxppztsig .gt_subtitle {
  color: #333333;
  font-size: 85%;
  font-weight: initial;
  padding-top: 3px;
  padding-bottom: 5px;
  padding-left: 5px;
  padding-right: 5px;
  border-top-color: #FFFFFF;
  border-top-width: 0;
}

#epxppztsig .gt_heading {
  background-color: #FFFFFF;
  text-align: center;
  border-bottom-color: #FFFFFF;
  border-left-style: none;
  border-left-width: 1px;
  border-left-color: #D3D3D3;
  border-right-style: none;
  border-right-width: 1px;
  border-right-color: #D3D3D3;
}

#epxppztsig .gt_bottom_border {
  border-bottom-style: solid;
  border-bottom-width: 2px;
  border-bottom-color: #D3D3D3;
}

#epxppztsig .gt_col_headings {
  border-top-style: solid;
  border-top-width: 2px;
  border-top-color: #D3D3D3;
  border-bottom-style: solid;
  border-bottom-width: 2px;
  border-bottom-color: #D3D3D3;
  border-left-style: none;
  border-left-width: 1px;
  border-left-color: #D3D3D3;
  border-right-style: none;
  border-right-width: 1px;
  border-right-color: #D3D3D3;
}

#epxppztsig .gt_col_heading {
  color: #333333;
  background-color: #FFFFFF;
  font-size: 100%;
  font-weight: normal;
  text-transform: inherit;
  border-left-style: none;
  border-left-width: 1px;
  border-left-color: #D3D3D3;
  border-right-style: none;
  border-right-width: 1px;
  border-right-color: #D3D3D3;
  vertical-align: bottom;
  padding-top: 5px;
  padding-bottom: 6px;
  padding-left: 5px;
  padding-right: 5px;
  overflow-x: hidden;
}

#epxppztsig .gt_column_spanner_outer {
  color: #333333;
  background-color: #FFFFFF;
  font-size: 100%;
  font-weight: normal;
  text-transform: inherit;
  padding-top: 0;
  padding-bottom: 0;
  padding-left: 4px;
  padding-right: 4px;
}

#epxppztsig .gt_column_spanner_outer:first-child {
  padding-left: 0;
}

#epxppztsig .gt_column_spanner_outer:last-child {
  padding-right: 0;
}

#epxppztsig .gt_column_spanner {
  border-bottom-style: solid;
  border-bottom-width: 2px;
  border-bottom-color: #D3D3D3;
  vertical-align: bottom;
  padding-top: 5px;
  padding-bottom: 5px;
  overflow-x: hidden;
  display: inline-block;
  width: 100%;
}

#epxppztsig .gt_spanner_row {
  border-bottom-style: hidden;
}

#epxppztsig .gt_group_heading {
  padding-top: 8px;
  padding-bottom: 8px;
  padding-left: 5px;
  padding-right: 5px;
  color: #333333;
  background-color: #FFFFFF;
  font-size: 100%;
  font-weight: initial;
  text-transform: inherit;
  border-top-style: solid;
  border-top-width: 2px;
  border-top-color: #D3D3D3;
  border-bottom-style: solid;
  border-bottom-width: 2px;
  border-bottom-color: #D3D3D3;
  border-left-style: none;
  border-left-width: 1px;
  border-left-color: #D3D3D3;
  border-right-style: none;
  border-right-width: 1px;
  border-right-color: #D3D3D3;
  vertical-align: middle;
  text-align: left;
}

#epxppztsig .gt_empty_group_heading {
  padding: 0.5px;
  color: #333333;
  background-color: #FFFFFF;
  font-size: 100%;
  font-weight: initial;
  border-top-style: solid;
  border-top-width: 2px;
  border-top-color: #D3D3D3;
  border-bottom-style: solid;
  border-bottom-width: 2px;
  border-bottom-color: #D3D3D3;
  vertical-align: middle;
}

#epxppztsig .gt_from_md > :first-child {
  margin-top: 0;
}

#epxppztsig .gt_from_md > :last-child {
  margin-bottom: 0;
}

#epxppztsig .gt_row {
  padding-top: 8px;
  padding-bottom: 8px;
  padding-left: 5px;
  padding-right: 5px;
  margin: 10px;
  border-top-style: solid;
  border-top-width: 1px;
  border-top-color: #D3D3D3;
  border-left-style: none;
  border-left-width: 1px;
  border-left-color: #D3D3D3;
  border-right-style: none;
  border-right-width: 1px;
  border-right-color: #D3D3D3;
  vertical-align: middle;
  overflow-x: hidden;
}

#epxppztsig .gt_stub {
  color: #333333;
  background-color: #FFFFFF;
  font-size: 100%;
  font-weight: initial;
  text-transform: inherit;
  border-right-style: solid;
  border-right-width: 2px;
  border-right-color: #D3D3D3;
  padding-left: 5px;
  padding-right: 5px;
}

#epxppztsig .gt_stub_row_group {
  color: #333333;
  background-color: #FFFFFF;
  font-size: 100%;
  font-weight: initial;
  text-transform: inherit;
  border-right-style: solid;
  border-right-width: 2px;
  border-right-color: #D3D3D3;
  padding-left: 5px;
  padding-right: 5px;
  vertical-align: top;
}

#epxppztsig .gt_row_group_first td {
  border-top-width: 2px;
}

#epxppztsig .gt_row_group_first th {
  border-top-width: 2px;
}

#epxppztsig .gt_summary_row {
  color: #333333;
  background-color: #FFFFFF;
  text-transform: inherit;
  padding-top: 8px;
  padding-bottom: 8px;
  padding-left: 5px;
  padding-right: 5px;
}

#epxppztsig .gt_first_summary_row {
  border-top-style: solid;
  border-top-color: #D3D3D3;
}

#epxppztsig .gt_first_summary_row.thick {
  border-top-width: 2px;
}

#epxppztsig .gt_last_summary_row {
  padding-top: 8px;
  padding-bottom: 8px;
  padding-left: 5px;
  padding-right: 5px;
  border-bottom-style: solid;
  border-bottom-width: 2px;
  border-bottom-color: #D3D3D3;
}

#epxppztsig .gt_grand_summary_row {
  color: #333333;
  background-color: #FFFFFF;
  text-transform: inherit;
  padding-top: 8px;
  padding-bottom: 8px;
  padding-left: 5px;
  padding-right: 5px;
}

#epxppztsig .gt_first_grand_summary_row {
  padding-top: 8px;
  padding-bottom: 8px;
  padding-left: 5px;
  padding-right: 5px;
  border-top-style: double;
  border-top-width: 6px;
  border-top-color: #D3D3D3;
}

#epxppztsig .gt_last_grand_summary_row_top {
  padding-top: 8px;
  padding-bottom: 8px;
  padding-left: 5px;
  padding-right: 5px;
  border-bottom-style: double;
  border-bottom-width: 6px;
  border-bottom-color: #D3D3D3;
}

#epxppztsig .gt_striped {
  background-color: rgba(128, 128, 128, 0.05);
}

#epxppztsig .gt_table_body {
  border-top-style: solid;
  border-top-width: 2px;
  border-top-color: #D3D3D3;
  border-bottom-style: solid;
  border-bottom-width: 2px;
  border-bottom-color: #D3D3D3;
}

#epxppztsig .gt_footnotes {
  color: #333333;
  background-color: #FFFFFF;
  border-bottom-style: none;
  border-bottom-width: 2px;
  border-bottom-color: #D3D3D3;
  border-left-style: none;
  border-left-width: 2px;
  border-left-color: #D3D3D3;
  border-right-style: none;
  border-right-width: 2px;
  border-right-color: #D3D3D3;
}

#epxppztsig .gt_footnote {
  margin: 0px;
  font-size: 90%;
  padding-top: 4px;
  padding-bottom: 4px;
  padding-left: 5px;
  padding-right: 5px;
}

#epxppztsig .gt_sourcenotes {
  color: #333333;
  background-color: #FFFFFF;
  border-bottom-style: none;
  border-bottom-width: 2px;
  border-bottom-color: #D3D3D3;
  border-left-style: none;
  border-left-width: 2px;
  border-left-color: #D3D3D3;
  border-right-style: none;
  border-right-width: 2px;
  border-right-color: #D3D3D3;
}

#epxppztsig .gt_sourcenote {
  font-size: 90%;
  padding-top: 4px;
  padding-bottom: 4px;
  padding-left: 5px;
  padding-right: 5px;
}

#epxppztsig .gt_left {
  text-align: left;
}

#epxppztsig .gt_center {
  text-align: center;
}

#epxppztsig .gt_right {
  text-align: right;
  font-variant-numeric: tabular-nums;
}

#epxppztsig .gt_font_normal {
  font-weight: normal;
}

#epxppztsig .gt_font_bold {
  font-weight: bold;
}

#epxppztsig .gt_font_italic {
  font-style: italic;
}

#epxppztsig .gt_super {
  font-size: 65%;
}

#epxppztsig .gt_footnote_marks {
  font-size: 75%;
  vertical-align: 0.4em;
  position: initial;
}

#epxppztsig .gt_asterisk {
  font-size: 100%;
  vertical-align: 0;
}

#epxppztsig .gt_indent_1 {
  text-indent: 5px;
}

#epxppztsig .gt_indent_2 {
  text-indent: 10px;
}

#epxppztsig .gt_indent_3 {
  text-indent: 15px;
}

#epxppztsig .gt_indent_4 {
  text-indent: 20px;
}

#epxppztsig .gt_indent_5 {
  text-indent: 25px;
}

#epxppztsig .katex-display {
  display: inline-flex !important;
  margin-bottom: 0.75em !important;
}

#epxppztsig div.Reactable > div.rt-table > div.rt-thead > div.rt-tr.rt-tr-group-header > div.rt-th-group:after {
  height: 0px !important;
}
</style>
<table class="gt_table" data-quarto-disable-processing="false" data-quarto-bootstrap="false">
  <thead>
    <tr class="gt_col_headings">
      <th class="gt_col_heading gt_columns_bottom_border gt_left" rowspan="1" colspan="1" scope="col" id="a-"> </th>
      <th class="gt_col_heading gt_columns_bottom_border gt_center" rowspan="1" colspan="1" scope="col" id="Regresi√≥n">Regresi√≥n</th>
      <th class="gt_col_heading gt_columns_bottom_border gt_center" rowspan="1" colspan="1" scope="col" id="Matching">Matching</th>
    </tr>
  </thead>
  <tbody class="gt_table_body">
    <tr><td headers=" " class="gt_row gt_left">(Intercept)</td>
<td headers="Regresi√≥n" class="gt_row gt_center">-0.018</td>
<td headers="Matching" class="gt_row gt_center">0.437</td></tr>
    <tr><td headers=" " class="gt_row gt_left" style="background-color: rgba(255,255,224,0.8); color: #000000; font-weight: bold;">Tratamiento</td>
<td headers="Regresi√≥n" class="gt_row gt_center" style="background-color: rgba(255,255,224,0.8); color: #000000; font-weight: bold;">1.022</td>
<td headers="Matching" class="gt_row gt_center" style="background-color: rgba(255,255,224,0.8); color: #000000; font-weight: bold;">0.367</td></tr>
    <tr><td headers=" " class="gt_row gt_left">sin(x)</td>
<td headers="Regresi√≥n" class="gt_row gt_center">1.015</td>
<td headers="Matching" class="gt_row gt_center"></td></tr>
    <tr><td headers=" " class="gt_row gt_left" style="border-bottom-width: 1px; border-bottom-style: solid; border-bottom-color: #000000;">x</td>
<td headers="Regresi√≥n" class="gt_row gt_center" style="border-bottom-width: 1px; border-bottom-style: solid; border-bottom-color: #000000;"></td>
<td headers="Matching" class="gt_row gt_center" style="border-bottom-width: 1px; border-bottom-style: solid; border-bottom-color: #000000;">0.020</td></tr>
    <tr><td headers=" " class="gt_row gt_left">Num.Obs.</td>
<td headers="Regresi√≥n" class="gt_row gt_center">1000</td>
<td headers="Matching" class="gt_row gt_center">590</td></tr>
  </tbody>
  
  
</table>
</div>
<p>Estimaciones del efecto del tratamiento utilizando regresi√≥n y matching para los datos sin soporte com√∫n.</p>
</div>
</div>
<p>Lo que pasa ahora es que, gracias a la capacidad de extrapolar de la regresi√≥n lineal, la falta de soporte com√∫n no es un problema y el estimador del efecto del tratamiento es bastante bueno, <span class="math inline">\(1.022\)</span>. En cambio, el <em>matching</em> no puede extrapolar y, por lo tanto, el estimador del efecto del tratamiento es <span class="math inline">\(0.02\)</span>, es decir, un efecto casi nulo.</p>
<p>Volvamos a ver las cosas gr√°ficamente a ver si esto nos echa un poco de luz sobre lo que est√° ocurriendo. Primero veamos la regresi√≥n lineal ajustada:</p>
<div class="cell">
<details>
<summary>Ver el c√≥digo</summary>
<div class="sourceCode cell-code" id="cb36"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb36-1"><a href="#cb36-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Esto es s√≥lo una cosa para plotar los datos</span></span>
<span id="cb36-2"><a href="#cb36-2" aria-hidden="true" tabindex="-1"></a>df_wo_common_support <span class="ot">&lt;-</span> df_wo_common_support <span class="sc">%&gt;%</span></span>
<span id="cb36-3"><a href="#cb36-3" aria-hidden="true" tabindex="-1"></a>  <span class="fu">mutate</span>(<span class="at">group =</span> <span class="fu">case_when</span>(</span>
<span id="cb36-4"><a href="#cb36-4" aria-hidden="true" tabindex="-1"></a>    x <span class="sc">&lt;</span> <span class="fl">0.5</span> <span class="sc">~</span> <span class="st">"segment1"</span>,</span>
<span id="cb36-5"><a href="#cb36-5" aria-hidden="true" tabindex="-1"></a>    x <span class="sc">&gt;</span> <span class="fl">2.5</span> <span class="sc">~</span> <span class="st">"segment3"</span>,</span>
<span id="cb36-6"><a href="#cb36-6" aria-hidden="true" tabindex="-1"></a>    <span class="cn">TRUE</span> <span class="sc">~</span> <span class="st">"segment2"</span></span>
<span id="cb36-7"><a href="#cb36-7" aria-hidden="true" tabindex="-1"></a>  ))</span>
<span id="cb36-8"><a href="#cb36-8" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb36-9"><a href="#cb36-9" aria-hidden="true" tabindex="-1"></a><span class="co"># Los labels a una funci√≥n</span></span>
<span id="cb36-10"><a href="#cb36-10" aria-hidden="true" tabindex="-1"></a>creating_factor_d <span class="ot">&lt;-</span> <span class="cf">function</span>(x) <span class="fu">factor</span>(x,</span>
<span id="cb36-11"><a href="#cb36-11" aria-hidden="true" tabindex="-1"></a>                                        <span class="at">levels =</span> <span class="fu">c</span>(<span class="dv">0</span>, <span class="dv">1</span>),</span>
<span id="cb36-12"><a href="#cb36-12" aria-hidden="true" tabindex="-1"></a>                                        <span class="at">labels =</span> <span class="fu">c</span>(<span class="st">"No tratado"</span>,</span>
<span id="cb36-13"><a href="#cb36-13" aria-hidden="true" tabindex="-1"></a>                                                   <span class="st">"Tratado"</span>))</span>
<span id="cb36-14"><a href="#cb36-14" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb36-15"><a href="#cb36-15" aria-hidden="true" tabindex="-1"></a>df_wo_cs_treated <span class="ot">&lt;-</span> df_wo_common_support <span class="sc">%&gt;%</span> </span>
<span id="cb36-16"><a href="#cb36-16" aria-hidden="true" tabindex="-1"></a>  <span class="fu">mutate</span>(<span class="at">extrapolation =</span> <span class="fu">ifelse</span>(d <span class="sc">==</span> <span class="dv">1</span>, <span class="st">"No"</span>, <span class="st">"Yes"</span>),</span>
<span id="cb36-17"><a href="#cb36-17" aria-hidden="true" tabindex="-1"></a>         <span class="at">d =</span> <span class="dv">1</span>,</span>
<span id="cb36-18"><a href="#cb36-18" aria-hidden="true" tabindex="-1"></a>         <span class="at">d_factor =</span> <span class="fu">creating_factor_d</span>(d)) <span class="sc">%&gt;%</span> </span>
<span id="cb36-19"><a href="#cb36-19" aria-hidden="true" tabindex="-1"></a>  modelr<span class="sc">::</span><span class="fu">add_predictions</span>(reg_wo_common_support, <span class="at">var =</span> <span class="st">"pred_treated"</span>)</span>
<span id="cb36-20"><a href="#cb36-20" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb36-21"><a href="#cb36-21" aria-hidden="true" tabindex="-1"></a>df_wo_cs_untreated <span class="ot">&lt;-</span> df_wo_common_support <span class="sc">%&gt;%</span> </span>
<span id="cb36-22"><a href="#cb36-22" aria-hidden="true" tabindex="-1"></a>  <span class="fu">mutate</span>(<span class="at">extrapolation =</span> <span class="fu">ifelse</span>(d <span class="sc">==</span> <span class="dv">0</span>, <span class="st">"No"</span>, <span class="st">"Yes"</span>),</span>
<span id="cb36-23"><a href="#cb36-23" aria-hidden="true" tabindex="-1"></a>         <span class="at">d =</span> <span class="dv">0</span>,</span>
<span id="cb36-24"><a href="#cb36-24" aria-hidden="true" tabindex="-1"></a>         <span class="at">d_factor =</span> <span class="fu">creating_factor_d</span>(d)) <span class="sc">%&gt;%</span> </span>
<span id="cb36-25"><a href="#cb36-25" aria-hidden="true" tabindex="-1"></a>  modelr<span class="sc">::</span><span class="fu">add_predictions</span>(reg_wo_common_support, <span class="at">var =</span> <span class="st">"pred_untreated"</span>)</span>
<span id="cb36-26"><a href="#cb36-26" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb36-27"><a href="#cb36-27" aria-hidden="true" tabindex="-1"></a>plot_wo_cs_reg <span class="ot">&lt;-</span> </span>
<span id="cb36-28"><a href="#cb36-28" aria-hidden="true" tabindex="-1"></a>  <span class="fu">ggplot</span>() <span class="sc">+</span></span>
<span id="cb36-29"><a href="#cb36-29" aria-hidden="true" tabindex="-1"></a>  <span class="fu">aes</span>(x, outcome, <span class="at">color =</span> d_factor) <span class="sc">+</span></span>
<span id="cb36-30"><a href="#cb36-30" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_point</span>(<span class="at">data=</span> df_wo_common_support, <span class="at">alpha =</span> <span class="fl">0.3</span>, <span class="at">size =</span> <span class="dv">1</span>) <span class="sc">+</span></span>
<span id="cb36-31"><a href="#cb36-31" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_line</span>(<span class="at">data =</span> df_wo_cs_untreated,</span>
<span id="cb36-32"><a href="#cb36-32" aria-hidden="true" tabindex="-1"></a>            <span class="fu">aes</span>(<span class="at">y =</span> pred_untreated,</span>
<span id="cb36-33"><a href="#cb36-33" aria-hidden="true" tabindex="-1"></a>                <span class="at">alpha =</span> extrapolation,</span>
<span id="cb36-34"><a href="#cb36-34" aria-hidden="true" tabindex="-1"></a>                <span class="at">linetype =</span> extrapolation,</span>
<span id="cb36-35"><a href="#cb36-35" aria-hidden="true" tabindex="-1"></a>                <span class="at">group =</span> group), <span class="at">size =</span> <span class="dv">1</span>) <span class="sc">+</span></span>
<span id="cb36-36"><a href="#cb36-36" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_line</span>(<span class="at">data =</span> df_wo_cs_treated,</span>
<span id="cb36-37"><a href="#cb36-37" aria-hidden="true" tabindex="-1"></a>            <span class="fu">aes</span>(<span class="at">y =</span> pred_treated,</span>
<span id="cb36-38"><a href="#cb36-38" aria-hidden="true" tabindex="-1"></a>                <span class="at">alpha =</span> extrapolation,</span>
<span id="cb36-39"><a href="#cb36-39" aria-hidden="true" tabindex="-1"></a>                <span class="at">linetype =</span> extrapolation,</span>
<span id="cb36-40"><a href="#cb36-40" aria-hidden="true" tabindex="-1"></a>                <span class="at">group =</span> group), <span class="at">size =</span> <span class="dv">1</span>) <span class="sc">+</span></span>
<span id="cb36-41"><a href="#cb36-41" aria-hidden="true" tabindex="-1"></a>  <span class="fu">scale_alpha_manual</span>(<span class="at">values =</span> <span class="fu">c</span>(<span class="st">"Yes"</span> <span class="ot">=</span> <span class="fl">0.5</span>, <span class="st">"No"</span> <span class="ot">=</span> <span class="dv">1</span>)) <span class="sc">+</span></span>
<span id="cb36-42"><a href="#cb36-42" aria-hidden="true" tabindex="-1"></a>  <span class="fu">scale_linetype_manual</span>(<span class="at">values =</span> <span class="fu">c</span>(<span class="st">"Yes"</span> <span class="ot">=</span> <span class="st">"dashed"</span>, <span class="st">"No"</span> <span class="ot">=</span> <span class="st">"solid"</span>)) <span class="sc">+</span></span>
<span id="cb36-43"><a href="#cb36-43" aria-hidden="true" tabindex="-1"></a>  <span class="fu">scale_color_brewer</span>(<span class="at">palette =</span> <span class="st">"Dark2"</span>) <span class="sc">+</span></span>
<span id="cb36-44"><a href="#cb36-44" aria-hidden="true" tabindex="-1"></a>  <span class="fu">labs</span>(<span class="at">color =</span> <span class="st">"Estado del tratamiento"</span>,</span>
<span id="cb36-45"><a href="#cb36-45" aria-hidden="true" tabindex="-1"></a>       <span class="at">linetype =</span> <span class="st">"Extrapolaci√≥n"</span>) <span class="sc">+</span></span>
<span id="cb36-46"><a href="#cb36-46" aria-hidden="true" tabindex="-1"></a>  <span class="fu">guides</span>(<span class="at">alpha =</span> <span class="cn">FALSE</span>,</span>
<span id="cb36-47"><a href="#cb36-47" aria-hidden="true" tabindex="-1"></a>         <span class="at">linetype =</span> <span class="cn">FALSE</span>) <span class="sc">+</span></span>
<span id="cb36-48"><a href="#cb36-48" aria-hidden="true" tabindex="-1"></a>  <span class="fu">theme_bw</span>() <span class="sc">+</span></span>
<span id="cb36-49"><a href="#cb36-49" aria-hidden="true" tabindex="-1"></a>  <span class="fu">theme</span>(<span class="at">legend.position =</span> <span class="st">"top"</span>)</span>
<span id="cb36-50"><a href="#cb36-50" aria-hidden="true" tabindex="-1"></a><span class="co">#&gt; Warning: The `&lt;scale&gt;` argument of `guides()` cannot be `FALSE`. Use "none" instead</span></span>
<span id="cb36-51"><a href="#cb36-51" aria-hidden="true" tabindex="-1"></a><span class="co">#&gt; as of ggplot2 3.3.4.</span></span>
<span id="cb36-52"><a href="#cb36-52" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb36-53"><a href="#cb36-53" aria-hidden="true" tabindex="-1"></a>plot_wo_cs_reg</span></code><button title="Copiar al portapapeles" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
<div class="cell-output-display">
<div class="quarto-figure quarto-figure-center">
<figure class="figure">
<p><img src="matching_files/figure-html/unnamed-chunk-38-1.png" class="img-fluid figure-img" width="576"></p>
<p></p><figcaption class="figure-caption">La regresi√≥n lineal ajustada conociendo la forma de la relaci√≥n entre x y el outcome (seno). La l√≠nea punteada representa la fracci√≥n de x que es extrapolada por el modelo para estos datos sin soporte com√∫n.</figcaption><p></p>
</figure>
</div>
</div>
</div>
<p>En este caso podemos ver que al ajustar la regresi√≥n lineal, el modelo extrapola los valores de <span class="math inline">\(x\)</span> y la distancia entre ambas curvas es, efectivamente cercana a <span class="math inline">\(1\)</span> (que es el valor del par√°metro poblacional). ¬øY si vemos la estimaci√≥n de <em>matching</em>?</p>
<div class="cell">
<details>
<summary>Ver el c√≥digo</summary>
<div class="sourceCode cell-code" id="cb37"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb37-1"><a href="#cb37-1" aria-hidden="true" tabindex="-1"></a>x_values <span class="ot">&lt;-</span> df_wo_common_support <span class="sc">%&gt;%</span> dplyr<span class="sc">::</span><span class="fu">select</span>(x)</span>
<span id="cb37-2"><a href="#cb37-2" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb37-3"><a href="#cb37-3" aria-hidden="true" tabindex="-1"></a>knn_wo_cs_treated <span class="ot">&lt;-</span> <span class="fu">knn.reg</span>(</span>
<span id="cb37-4"><a href="#cb37-4" aria-hidden="true" tabindex="-1"></a>  <span class="at">train =</span> df_wo_common_support <span class="sc">%&gt;%</span> </span>
<span id="cb37-5"><a href="#cb37-5" aria-hidden="true" tabindex="-1"></a>    <span class="fu">filter</span>(d <span class="sc">==</span> <span class="dv">1</span>) <span class="sc">%&gt;%</span> </span>
<span id="cb37-6"><a href="#cb37-6" aria-hidden="true" tabindex="-1"></a>    dplyr<span class="sc">::</span><span class="fu">select</span>(x),</span>
<span id="cb37-7"><a href="#cb37-7" aria-hidden="true" tabindex="-1"></a>  <span class="at">y =</span> df_wo_common_support <span class="sc">%&gt;%</span> </span>
<span id="cb37-8"><a href="#cb37-8" aria-hidden="true" tabindex="-1"></a>    <span class="fu">filter</span>(d <span class="sc">==</span> <span class="dv">1</span>) <span class="sc">%&gt;%</span> </span>
<span id="cb37-9"><a href="#cb37-9" aria-hidden="true" tabindex="-1"></a>    dplyr<span class="sc">::</span><span class="fu">pull</span>(outcome),</span>
<span id="cb37-10"><a href="#cb37-10" aria-hidden="true" tabindex="-1"></a>  <span class="at">test =</span> x_values,</span>
<span id="cb37-11"><a href="#cb37-11" aria-hidden="true" tabindex="-1"></a>  <span class="at">k =</span> <span class="dv">15</span>,</span>
<span id="cb37-12"><a href="#cb37-12" aria-hidden="true" tabindex="-1"></a>  <span class="at">algorithm =</span> <span class="st">"brute"</span></span>
<span id="cb37-13"><a href="#cb37-13" aria-hidden="true" tabindex="-1"></a>)</span>
<span id="cb37-14"><a href="#cb37-14" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb37-15"><a href="#cb37-15" aria-hidden="true" tabindex="-1"></a>knn_wo_cs_untreated <span class="ot">&lt;-</span> <span class="fu">knn.reg</span>(</span>
<span id="cb37-16"><a href="#cb37-16" aria-hidden="true" tabindex="-1"></a>  <span class="at">train =</span> df_wo_common_support <span class="sc">%&gt;%</span> </span>
<span id="cb37-17"><a href="#cb37-17" aria-hidden="true" tabindex="-1"></a>    <span class="fu">filter</span>(d <span class="sc">==</span> <span class="dv">0</span>) <span class="sc">%&gt;%</span> </span>
<span id="cb37-18"><a href="#cb37-18" aria-hidden="true" tabindex="-1"></a>    dplyr<span class="sc">::</span><span class="fu">select</span>(x),</span>
<span id="cb37-19"><a href="#cb37-19" aria-hidden="true" tabindex="-1"></a>  <span class="at">y =</span> df_wo_common_support <span class="sc">%&gt;%</span> </span>
<span id="cb37-20"><a href="#cb37-20" aria-hidden="true" tabindex="-1"></a>    <span class="fu">filter</span>(d <span class="sc">==</span> <span class="dv">0</span>) <span class="sc">%&gt;%</span> </span>
<span id="cb37-21"><a href="#cb37-21" aria-hidden="true" tabindex="-1"></a>    dplyr<span class="sc">::</span><span class="fu">pull</span>(outcome),</span>
<span id="cb37-22"><a href="#cb37-22" aria-hidden="true" tabindex="-1"></a>  <span class="at">test =</span> x_values,</span>
<span id="cb37-23"><a href="#cb37-23" aria-hidden="true" tabindex="-1"></a>  <span class="at">k =</span> <span class="dv">15</span>,</span>
<span id="cb37-24"><a href="#cb37-24" aria-hidden="true" tabindex="-1"></a>  <span class="at">algorithm =</span> <span class="st">"brute"</span></span>
<span id="cb37-25"><a href="#cb37-25" aria-hidden="true" tabindex="-1"></a>)</span>
<span id="cb37-26"><a href="#cb37-26" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb37-27"><a href="#cb37-27" aria-hidden="true" tabindex="-1"></a>df_untr_matching_wo_cs <span class="ot">&lt;-</span></span>
<span id="cb37-28"><a href="#cb37-28" aria-hidden="true" tabindex="-1"></a>  <span class="fu">tibble</span>(</span>
<span id="cb37-29"><a href="#cb37-29" aria-hidden="true" tabindex="-1"></a>    <span class="at">y_pred =</span> knn_wo_cs_untreated<span class="sc">$</span>pred,</span>
<span id="cb37-30"><a href="#cb37-30" aria-hidden="true" tabindex="-1"></a>    <span class="at">x =</span> df_wo_common_support<span class="sc">$</span>x,</span>
<span id="cb37-31"><a href="#cb37-31" aria-hidden="true" tabindex="-1"></a>    <span class="at">d =</span> <span class="dv">0</span></span>
<span id="cb37-32"><a href="#cb37-32" aria-hidden="true" tabindex="-1"></a>  ) <span class="sc">%&gt;%</span></span>
<span id="cb37-33"><a href="#cb37-33" aria-hidden="true" tabindex="-1"></a>  <span class="fu">mutate</span>(<span class="at">d_factor =</span> <span class="fu">creating_factor_d</span>(d))</span>
<span id="cb37-34"><a href="#cb37-34" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb37-35"><a href="#cb37-35" aria-hidden="true" tabindex="-1"></a>df_tr_matching_wo_cs <span class="ot">&lt;-</span></span>
<span id="cb37-36"><a href="#cb37-36" aria-hidden="true" tabindex="-1"></a>  <span class="fu">tibble</span>(</span>
<span id="cb37-37"><a href="#cb37-37" aria-hidden="true" tabindex="-1"></a>    <span class="at">y_pred =</span> knn_wo_cs_treated<span class="sc">$</span>pred,</span>
<span id="cb37-38"><a href="#cb37-38" aria-hidden="true" tabindex="-1"></a>    <span class="at">x =</span> df_wo_common_support<span class="sc">$</span>x,</span>
<span id="cb37-39"><a href="#cb37-39" aria-hidden="true" tabindex="-1"></a>    <span class="at">d =</span> <span class="dv">1</span></span>
<span id="cb37-40"><a href="#cb37-40" aria-hidden="true" tabindex="-1"></a>  ) <span class="sc">%&gt;%</span></span>
<span id="cb37-41"><a href="#cb37-41" aria-hidden="true" tabindex="-1"></a>  <span class="fu">mutate</span>(<span class="at">d_factor =</span> <span class="fu">creating_factor_d</span>(d),</span>
<span id="cb37-42"><a href="#cb37-42" aria-hidden="true" tabindex="-1"></a>         <span class="at">group =</span> <span class="fu">case_when</span>(</span>
<span id="cb37-43"><a href="#cb37-43" aria-hidden="true" tabindex="-1"></a>           x <span class="sc">&lt;</span> <span class="fl">0.5</span> <span class="sc">~</span> <span class="st">"segment1"</span>,</span>
<span id="cb37-44"><a href="#cb37-44" aria-hidden="true" tabindex="-1"></a>           x <span class="sc">&gt;</span> <span class="fl">2.5</span> <span class="sc">~</span> <span class="st">"segment3"</span>,</span>
<span id="cb37-45"><a href="#cb37-45" aria-hidden="true" tabindex="-1"></a>           <span class="cn">TRUE</span> <span class="sc">~</span> <span class="st">"segment2"</span></span>
<span id="cb37-46"><a href="#cb37-46" aria-hidden="true" tabindex="-1"></a>         ))</span>
<span id="cb37-47"><a href="#cb37-47" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb37-48"><a href="#cb37-48" aria-hidden="true" tabindex="-1"></a>plot_matching_wo_cs <span class="ot">&lt;-</span> </span>
<span id="cb37-49"><a href="#cb37-49" aria-hidden="true" tabindex="-1"></a>  <span class="fu">ggplot</span>() <span class="sc">+</span></span>
<span id="cb37-50"><a href="#cb37-50" aria-hidden="true" tabindex="-1"></a>  <span class="fu">aes</span>(x, outcome, <span class="at">color =</span> d_factor) <span class="sc">+</span></span>
<span id="cb37-51"><a href="#cb37-51" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_point</span>(<span class="at">data=</span> df_wo_common_support, <span class="at">alpha =</span> <span class="fl">0.3</span>, <span class="at">size =</span> <span class="dv">1</span>) <span class="sc">+</span></span>
<span id="cb37-52"><a href="#cb37-52" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_line</span>(<span class="at">data =</span> df_untr_matching_wo_cs,</span>
<span id="cb37-53"><a href="#cb37-53" aria-hidden="true" tabindex="-1"></a>            <span class="fu">aes</span>(<span class="at">y =</span> y_pred), <span class="at">size =</span> <span class="dv">1</span>) <span class="sc">+</span></span>
<span id="cb37-54"><a href="#cb37-54" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_line</span>(<span class="at">data =</span> df_tr_matching_wo_cs,</span>
<span id="cb37-55"><a href="#cb37-55" aria-hidden="true" tabindex="-1"></a>            <span class="fu">aes</span>(<span class="at">y =</span> y_pred, <span class="at">group =</span> group), <span class="at">size =</span> <span class="dv">1</span>) <span class="sc">+</span></span>
<span id="cb37-56"><a href="#cb37-56" aria-hidden="true" tabindex="-1"></a>  <span class="fu">scale_color_brewer</span>(<span class="at">palette =</span> <span class="st">"Dark2"</span>) <span class="sc">+</span></span>
<span id="cb37-57"><a href="#cb37-57" aria-hidden="true" tabindex="-1"></a>  <span class="fu">labs</span>(<span class="at">color =</span> <span class="st">"Estado del tratamiento"</span>) <span class="sc">+</span></span>
<span id="cb37-58"><a href="#cb37-58" aria-hidden="true" tabindex="-1"></a>  <span class="fu">theme_bw</span>() <span class="sc">+</span></span>
<span id="cb37-59"><a href="#cb37-59" aria-hidden="true" tabindex="-1"></a>  <span class="fu">theme</span>(<span class="at">legend.position =</span> <span class="st">"top"</span>)</span>
<span id="cb37-60"><a href="#cb37-60" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb37-61"><a href="#cb37-61" aria-hidden="true" tabindex="-1"></a>plot_matching_wo_cs</span></code><button title="Copiar al portapapeles" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
<div class="cell-output-display">
<div class="quarto-figure quarto-figure-center">
<figure class="figure">
<p><img src="matching_files/figure-html/unnamed-chunk-39-1.png" class="img-fluid figure-img" width="576"></p>
<p></p><figcaption class="figure-caption">Algo parecido a lo que usa el matching para estimar el efecto pero ahora sin soporte com√∫n.</figcaption><p></p>
</figure>
</div>
</div>
</div>
<p>Podemos ver que para los valores de <span class="math inline">\(x\)</span> donde no hay soporte com√∫n, el <em>matching</em> hace una estimaciones que est√°n muy lejos del valor real del par√°metro poblacional, <span class="math inline">\(1\)</span>. Esto se debe a que el <em>matching</em> no puede extrapolar y, por lo tanto, no puede estimar el efecto del tratamiento en esos valores de <span class="math inline">\(x\)</span> donde no hay unidades tratadas.</p>
<p>En resumen, la regresi√≥n lineal puede ser una herramienta conveniente para obtener la independencia condicional, pero si la relaci√≥n entre las covariables y el <em>outcome</em> no es lineal (y no la conocemos) , el estimador del efecto del tratamiento puede estar sesgado. En cambio, el <em>matching</em> no asume una relaci√≥n lineal y puede ser m√°s robusto en estos casos, pero requiere soporte com√∫n para poder extrapolar. Si no hay soporte com√∫n, el <em>matching</em> no puede estimar el efecto del tratamiento en esos valores de las covariables donde no hay unidades tratadas.</p>


</section>


</main> <!-- /main -->
<script id="quarto-html-after-body" type="application/javascript">
window.document.addEventListener("DOMContentLoaded", function (event) {
  const toggleBodyColorMode = (bsSheetEl) => {
    const mode = bsSheetEl.getAttribute("data-mode");
    const bodyEl = window.document.querySelector("body");
    if (mode === "dark") {
      bodyEl.classList.add("quarto-dark");
      bodyEl.classList.remove("quarto-light");
    } else {
      bodyEl.classList.add("quarto-light");
      bodyEl.classList.remove("quarto-dark");
    }
  }
  const toggleBodyColorPrimary = () => {
    const bsSheetEl = window.document.querySelector("link#quarto-bootstrap");
    if (bsSheetEl) {
      toggleBodyColorMode(bsSheetEl);
    }
  }
  toggleBodyColorPrimary();  
  const disableStylesheet = (stylesheets) => {
    for (let i=0; i < stylesheets.length; i++) {
      const stylesheet = stylesheets[i];
      stylesheet.rel = 'prefetch';
    }
  }
  const enableStylesheet = (stylesheets) => {
    for (let i=0; i < stylesheets.length; i++) {
      const stylesheet = stylesheets[i];
      stylesheet.rel = 'stylesheet';
    }
  }
  const manageTransitions = (selector, allowTransitions) => {
    const els = window.document.querySelectorAll(selector);
    for (let i=0; i < els.length; i++) {
      const el = els[i];
      if (allowTransitions) {
        el.classList.remove('notransition');
      } else {
        el.classList.add('notransition');
      }
    }
  }
  const toggleColorMode = (alternate) => {
    // Switch the stylesheets
    const alternateStylesheets = window.document.querySelectorAll('link.quarto-color-scheme.quarto-color-alternate');
    manageTransitions('#quarto-margin-sidebar .nav-link', false);
    if (alternate) {
      enableStylesheet(alternateStylesheets);
      for (const sheetNode of alternateStylesheets) {
        if (sheetNode.id === "quarto-bootstrap") {
          toggleBodyColorMode(sheetNode);
        }
      }
    } else {
      disableStylesheet(alternateStylesheets);
      toggleBodyColorPrimary();
    }
    manageTransitions('#quarto-margin-sidebar .nav-link', true);
    // Switch the toggles
    const toggles = window.document.querySelectorAll('.quarto-color-scheme-toggle');
    for (let i=0; i < toggles.length; i++) {
      const toggle = toggles[i];
      if (toggle) {
        if (alternate) {
          toggle.classList.add("alternate");     
        } else {
          toggle.classList.remove("alternate");
        }
      }
    }
    // Hack to workaround the fact that safari doesn't
    // properly recolor the scrollbar when toggling (#1455)
    if (navigator.userAgent.indexOf('Safari') > 0 && navigator.userAgent.indexOf('Chrome') == -1) {
      manageTransitions("body", false);
      window.scrollTo(0, 1);
      setTimeout(() => {
        window.scrollTo(0, 0);
        manageTransitions("body", true);
      }, 40);  
    }
  }
  const isFileUrl = () => { 
    return window.location.protocol === 'file:';
  }
  const hasAlternateSentinel = () => {  
    let styleSentinel = getColorSchemeSentinel();
    if (styleSentinel !== null) {
      return styleSentinel === "alternate";
    } else {
      return false;
    }
  }
  const setStyleSentinel = (alternate) => {
    const value = alternate ? "alternate" : "default";
    if (!isFileUrl()) {
      window.localStorage.setItem("quarto-color-scheme", value);
    } else {
      localAlternateSentinel = value;
    }
  }
  const getColorSchemeSentinel = () => {
    if (!isFileUrl()) {
      const storageValue = window.localStorage.getItem("quarto-color-scheme");
      return storageValue != null ? storageValue : localAlternateSentinel;
    } else {
      return localAlternateSentinel;
    }
  }
  let localAlternateSentinel = 'default';
  // Dark / light mode switch
  window.quartoToggleColorScheme = () => {
    // Read the current dark / light value 
    let toAlternate = !hasAlternateSentinel();
    toggleColorMode(toAlternate);
    setStyleSentinel(toAlternate);
  };
  // Ensure there is a toggle, if there isn't float one in the top right
  if (window.document.querySelector('.quarto-color-scheme-toggle') === null) {
    const a = window.document.createElement('a');
    a.classList.add('top-right');
    a.classList.add('quarto-color-scheme-toggle');
    a.href = "";
    a.onclick = function() { try { window.quartoToggleColorScheme(); } catch {} return false; };
    const i = window.document.createElement("i");
    i.classList.add('bi');
    a.appendChild(i);
    window.document.body.appendChild(a);
  }
  // Switch to dark mode if need be
  if (hasAlternateSentinel()) {
    toggleColorMode(true);
  } 
  const icon = "Óßã";
  const anchorJS = new window.AnchorJS();
  anchorJS.options = {
    placement: 'right',
    icon: icon
  };
  anchorJS.add('.anchored');
  const clipboard = new window.ClipboardJS('.code-copy-button', {
    target: function(trigger) {
      return trigger.previousElementSibling;
    }
  });
  clipboard.on('success', function(e) {
    // button target
    const button = e.trigger;
    // don't keep focus
    button.blur();
    // flash "checked"
    button.classList.add('code-copy-button-checked');
    var currentTitle = button.getAttribute("title");
    button.setAttribute("title", "Copiada");
    setTimeout(function() {
      button.setAttribute("title", currentTitle);
      button.classList.remove('code-copy-button-checked');
    }, 1000);
    // clear code selection
    e.clearSelection();
  });
  function tippyHover(el, contentFn) {
    const config = {
      allowHTML: true,
      content: contentFn,
      maxWidth: 500,
      delay: 100,
      arrow: false,
      appendTo: function(el) {
          return el.parentElement;
      },
      interactive: true,
      interactiveBorder: 10,
      theme: 'quarto',
      placement: 'bottom-start'
    };
    window.tippy(el, config); 
  }
  const noterefs = window.document.querySelectorAll('a[role="doc-noteref"]');
  for (var i=0; i<noterefs.length; i++) {
    const ref = noterefs[i];
    tippyHover(ref, function() {
      // use id or data attribute instead here
      let href = ref.getAttribute('data-footnote-href') || ref.getAttribute('href');
      try { href = new URL(href).hash; } catch {}
      const id = href.replace(/^#\/?/, "");
      const note = window.document.getElementById(id);
      return note.innerHTML;
    });
  }
  var bibliorefs = window.document.querySelectorAll('a[role="doc-biblioref"]');
  for (var i=0; i<bibliorefs.length; i++) {
    const ref = bibliorefs[i];
    const cites = ref.parentNode.getAttribute('data-cites').split(' ');
    tippyHover(ref, function() {
      var popup = window.document.createElement('div');
      cites.forEach(function(cite) {
        var citeDiv = window.document.createElement('div');
        citeDiv.classList.add('hanging-indent');
        citeDiv.classList.add('csl-entry');
        var biblioDiv = window.document.getElementById('ref-' + cite);
        if (biblioDiv) {
          citeDiv.innerHTML = biblioDiv.innerHTML;
        }
        popup.appendChild(citeDiv);
      });
      return popup.innerHTML;
    });
  }
});
</script>
<nav class="page-navigation">
  <div class="nav-page nav-page-previous">
      <a href="./exp_aleatorios.html" class="pagination-link">
        <i class="bi bi-arrow-left-short"></i> <span class="nav-page-text"><span class="chapter-number">5</span>&nbsp; <span class="chapter-title">Experimentos aleatorios</span></span>
      </a>          
  </div>
  <div class="nav-page nav-page-next">
      <a href="./diff_in_diff.html" class="pagination-link">
        <span class="nav-page-text"><span class="chapter-number">7</span>&nbsp; <span class="chapter-title">Diferencias en diferencias</span></span> <i class="bi bi-arrow-right-short"></i>
      </a>
  </div>
</nav>
</div> <!-- /content -->
<footer class="footer">
  <div class="nav-footer">
    <div class="nav-footer-left">Dise√±os experimentales y cuasiexperimentales - Ignacio Spiousas.</div>   
    <div class="nav-footer-right">Este libro fue creado con <a href="https://quarto.org/">Quarto</a>.</div>
  </div>
</footer>



</body></html>